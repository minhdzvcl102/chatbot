2025-06-23 14:21:58,712 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:22:16,540 - __main__ - INFO - New client connected from ('127.0.0.1', 53397)
2025-06-23 14:22:16,541 - __main__ - INFO - Received request from ('127.0.0.1', 53397): chat
2025-06-23 14:22:16,542 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:22:16,542 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:22:22,178 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,504 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,505 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:22:27,506 - __main__ - INFO - Sent response to ('127.0.0.1', 53397): success
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) closed connection
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) disconnected
2025-06-23 14:23:57,066 - __main__ - INFO - New client connected from ('127.0.0.1', 53434)
2025-06-23 14:23:57,067 - __main__ - INFO - Received request from ('127.0.0.1', 53434): chat
2025-06-23 14:23:57,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:23:57,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:24:02,106 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,348 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,349 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:24:04,350 - __main__ - INFO - Sent response to ('127.0.0.1', 53434): success
2025-06-23 14:24:27,067 - __main__ - INFO - Client ('127.0.0.1', 53434) closed connection
2025-06-23 14:24:27,068 - __main__ - INFO - Client ('127.0.0.1', 53434) disconnected
2025-06-23 14:35:44,091 - __main__ - INFO - New client connected from ('127.0.0.1', 53627)
2025-06-23 14:35:44,108 - __main__ - INFO - Received request from ('127.0.0.1', 53627): chat
2025-06-23 14:35:44,133 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:35:44,136 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:35:51,416 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,150 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,151 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:36:12,153 - __main__ - INFO - Sent response to ('127.0.0.1', 53627): success
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) closed connection
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) disconnected
2025-06-23 14:52:19,674 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:52:31,065 - __main__ - INFO - New client connected from ('127.0.0.1', 53954)
2025-06-23 14:52:31,066 - __main__ - INFO - Received request from ('127.0.0.1', 53954): chat
2025-06-23 14:52:31,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:52:31,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:52:37,041 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,619 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,620 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:52:42,621 - __main__ - INFO - Sent response to ('127.0.0.1', 53954): success
2025-06-23 14:53:01,045 - __main__ - INFO - Client ('127.0.0.1', 53954) closed connection
2025-06-23 14:53:01,046 - __main__ - INFO - Client ('127.0.0.1', 53954) disconnected
2025-06-23 14:55:18,665 - __main__ - INFO - New client connected from ('127.0.0.1', 54018)
2025-06-23 14:55:18,665 - __main__ - INFO - Received request from ('127.0.0.1', 54018): chat
2025-06-23 14:55:18,666 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:18,667 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:23,301 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:31,925 - __main__ - INFO - New client connected from ('127.0.0.1', 54029)
2025-06-23 14:55:31,926 - __main__ - INFO - Received request from ('127.0.0.1', 54029): chat
2025-06-23 14:55:31,927 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:31,927 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:32,873 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:32,874 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:32,875 - __main__ - INFO - Sent response to ('127.0.0.1', 54018): success
2025-06-23 14:55:36,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:47,299 - __main__ - INFO - New client connected from ('127.0.0.1', 54040)
2025-06-23 14:55:47,300 - __main__ - INFO - Received request from ('127.0.0.1', 54040): chat
2025-06-23 14:55:47,301 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:47,301 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) closed connection
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) disconnected
2025-06-23 14:55:58,999 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:59,000 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:59,001 - __main__ - INFO - Sent response to ('127.0.0.1', 54029): success
2025-06-23 14:56:01,928 - __main__ - INFO - Client ('127.0.0.1', 54029) closed connection
2025-06-23 14:56:01,929 - __main__ - INFO - Client ('127.0.0.1', 54029) disconnected
2025-06-23 14:56:02,858 - __main__ - INFO - New client connected from ('127.0.0.1', 54052)
2025-06-23 14:56:02,858 - __main__ - INFO - Received request from ('127.0.0.1', 54052): chat
2025-06-23 14:56:02,859 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:56:02,859 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:56:02,863 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:02,877 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:07,268 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,872 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,873 - __main__ - INFO - Generated answer for conversation 6
2025-06-23 14:56:10,873 - __main__ - INFO - Sent response to ('127.0.0.1', 54040): success
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) closed connection
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) disconnected
2025-06-23 14:56:20,437 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:20,438 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:56:20,439 - __main__ - INFO - Sent response to ('127.0.0.1', 54052): success
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) closed connection
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) disconnected
2025-06-23 14:57:19,260 - __main__ - INFO - New client connected from ('127.0.0.1', 54121)
2025-06-23 14:57:19,261 - __main__ - INFO - Received request from ('127.0.0.1', 54121): chat
2025-06-23 14:57:19,262 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:57:19,262 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:57:24,110 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,412 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:57:37,413 - __main__ - INFO - Sent response to ('127.0.0.1', 54121): success
2025-06-23 14:57:49,265 - __main__ - INFO - Client ('127.0.0.1', 54121) closed connection
2025-06-23 14:57:49,266 - __main__ - INFO - Client ('127.0.0.1', 54121) disconnected
2025-06-23 14:59:27,754 - __main__ - INFO - New client connected from ('127.0.0.1', 54171)
2025-06-23 14:59:27,755 - __main__ - INFO - Received request from ('127.0.0.1', 54171): chat
2025-06-23 14:59:27,756 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:59:27,757 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:59:33,606 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,204 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,205 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:59:44,206 - __main__ - INFO - Sent response to ('127.0.0.1', 54171): success
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) closed connection
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) disconnected
2025-06-23 15:00:18,958 - __main__ - INFO - New client connected from ('127.0.0.1', 54182)
2025-06-23 15:00:18,961 - __main__ - INFO - Received request from ('127.0.0.1', 54182): chat
2025-06-23 15:00:18,962 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:00:18,962 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:00:23,733 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,882 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,883 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:00:34,884 - __main__ - INFO - Sent response to ('127.0.0.1', 54182): success
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) closed connection
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) disconnected
2025-06-23 15:01:53,236 - __main__ - INFO - New client connected from ('127.0.0.1', 54193)
2025-06-23 15:01:53,237 - __main__ - INFO - Received request from ('127.0.0.1', 54193): chat
2025-06-23 15:01:53,238 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:01:53,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:01:55,971 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-39' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,980 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,983 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,987 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:57,842 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,974 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,975 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:02:10,976 - __main__ - INFO - Sent response to ('127.0.0.1', 54193): success
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) closed connection
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) disconnected
2025-06-23 16:18:05,129 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:19:32,380 - __main__ - INFO - New client connected from ('127.0.0.1', 55113)
2025-06-23 16:19:32,380 - __main__ - INFO - Received request from ('127.0.0.1', 55113): chat
2025-06-23 16:19:32,382 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:19:32,383 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:19:38,307 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,360 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,361 - __main__ - INFO - Sent response to ('127.0.0.1', 55113): error
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) closed connection
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) disconnected
2025-06-23 16:21:50,133 - __main__ - INFO - New client connected from ('127.0.0.1', 55149)
2025-06-23 16:21:50,134 - __main__ - INFO - Received request from ('127.0.0.1', 55149): chat
2025-06-23 16:21:50,135 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:21:50,135 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:21:54,453 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:21:54,458 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:21:54,458 - __main__ - INFO - Sent response to ('127.0.0.1', 55149): error
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) closed connection
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) disconnected
2025-06-23 16:27:04,088 - __main__ - INFO - New client connected from ('127.0.0.1', 55218)
2025-06-23 16:27:04,089 - __main__ - INFO - Received request from ('127.0.0.1', 55218): chat
2025-06-23 16:27:04,089 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:04,090 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:10,517 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:10,520 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:10,521 - __main__ - INFO - Sent response to ('127.0.0.1', 55218): error
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) reset connection
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) disconnected
2025-06-23 16:27:38,357 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:38,358 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:43,655 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:27:47,047 - __main__ - INFO - New client connected from ('127.0.0.1', 55236)
2025-06-23 16:27:47,047 - __main__ - INFO - Received request from ('127.0.0.1', 55236): chat
2025-06-23 16:27:47,048 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:47,048 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:51,474 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:51,479 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:51,480 - __main__ - INFO - Sent response to ('127.0.0.1', 55236): error
2025-06-23 16:27:57,819 - __main__ - INFO - New client connected from ('127.0.0.1', 55258)
2025-06-23 16:27:57,819 - __main__ - INFO - Received request from ('127.0.0.1', 55258): chat
2025-06-23 16:27:57,820 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:57,821 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:28:01,811 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:28:01,814 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:28:01,815 - __main__ - INFO - Sent response to ('127.0.0.1', 55258): error
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) closed connection
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) disconnected
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) closed connection
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) disconnected
2025-06-23 16:29:47,965 - __main__ - INFO - New client connected from ('127.0.0.1', 55282)
2025-06-23 16:29:47,966 - __main__ - INFO - Received request from ('127.0.0.1', 55282): chat
2025-06-23 16:29:47,967 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:29:47,967 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:29:56,848 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,534 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,535 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 16:30:08,536 - __main__ - INFO - Sent response to ('127.0.0.1', 55282): success
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) closed connection
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) disconnected
2025-06-23 16:48:03,525 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:48:31,914 - __main__ - INFO - New client connected from ('127.0.0.1', 55696)
2025-06-23 16:48:31,915 - __main__ - INFO - Received request from ('127.0.0.1', 55696): chat
2025-06-23 16:48:31,919 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:48:31,919 - __main__ - ERROR - Error processing message for conversation 7: 'NoneType' object has no attribute 'list_resources'
2025-06-23 16:48:31,920 - __main__ - INFO - Sent response to ('127.0.0.1', 55696): error
2025-06-23 16:49:01,916 - __main__ - INFO - Client ('127.0.0.1', 55696) closed connection
2025-06-23 16:49:01,917 - __main__ - INFO - Client ('127.0.0.1', 55696) disconnected
2025-06-24 17:02:30,694 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 17:03:51,582 - __main__ - INFO - New client connected from ('127.0.0.1', 58883)
2025-06-24 17:03:51,584 - __main__ - INFO - Received request from ('127.0.0.1', 58883): chat
2025-06-24 17:03:51,588 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:03:51,588 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:03:57,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,436 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,437 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:04:02,438 - __main__ - INFO - Sent response to ('127.0.0.1', 58883): success
2025-06-24 17:04:21,588 - __main__ - INFO - Client ('127.0.0.1', 58883) closed connection
2025-06-24 17:04:21,589 - __main__ - INFO - Client ('127.0.0.1', 58883) disconnected
2025-06-24 17:04:35,833 - __main__ - INFO - New client connected from ('127.0.0.1', 58895)
2025-06-24 17:04:35,833 - __main__ - INFO - Received request from ('127.0.0.1', 58895): chat
2025-06-24 17:04:35,834 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:04:35,835 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:04:40,058 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:40,062 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-24 17:04:40,063 - __main__ - INFO - Sent response to ('127.0.0.1', 58895): error
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) closed connection
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) disconnected
2025-06-24 17:07:51,797 - __main__ - INFO - New client connected from ('127.0.0.1', 58951)
2025-06-24 17:07:51,801 - __main__ - INFO - Received request from ('127.0.0.1', 58951): chat
2025-06-24 17:07:51,812 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:07:51,813 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:07:59,254 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,592 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,593 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:08:15,594 - __main__ - INFO - Sent response to ('127.0.0.1', 58951): success
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) closed connection
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) disconnected
2025-06-24 17:08:52,083 - __main__ - INFO - New client connected from ('127.0.0.1', 58968)
2025-06-24 17:08:52,083 - __main__ - INFO - Received request from ('127.0.0.1', 58968): chat
2025-06-24 17:08:52,084 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:08:52,084 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:08:56,953 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,125 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,126 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:09:05,127 - __main__ - INFO - Sent response to ('127.0.0.1', 58968): success
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) closed connection
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) disconnected
2025-06-24 17:32:01,194 - __main__ - INFO - New client connected from ('127.0.0.1', 59416)
2025-06-24 17:32:01,212 - __main__ - INFO - Received request from ('127.0.0.1', 59416): chat
2025-06-24 17:32:01,227 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:32:01,229 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:32:06,212 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,298 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,304 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:08,320 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,858 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,860 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:32:27,862 - __main__ - INFO - Sent response to ('127.0.0.1', 59416): success
2025-06-24 17:32:31,134 - __main__ - INFO - Client ('127.0.0.1', 59416) closed connection
2025-06-24 17:32:31,135 - __main__ - INFO - Client ('127.0.0.1', 59416) disconnected
2025-06-24 17:48:50,942 - __main__ - INFO - New client connected from ('127.0.0.1', 59632)
2025-06-24 17:48:50,961 - __main__ - INFO - Received request from ('127.0.0.1', 59632): chat
2025-06-24 17:48:50,979 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:48:50,981 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:48:58,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,019 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:17,020 - __main__ - INFO - Sent response to ('127.0.0.1', 59632): success
2025-06-24 17:49:20,867 - __main__ - INFO - Client ('127.0.0.1', 59632) closed connection
2025-06-24 17:49:20,868 - __main__ - INFO - Client ('127.0.0.1', 59632) disconnected
2025-06-24 17:49:36,492 - __main__ - INFO - New client connected from ('127.0.0.1', 59667)
2025-06-24 17:49:36,492 - __main__ - INFO - Received request from ('127.0.0.1', 59667): chat
2025-06-24 17:49:36,493 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:49:36,494 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:49:42,650 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,465 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,466 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:45,467 - __main__ - INFO - Sent response to ('127.0.0.1', 59667): success
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) closed connection
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) disconnected
2025-06-24 18:12:40,183 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:23:15,801 - __main__ - INFO - New client connected from ('127.0.0.1', 50874)
2025-06-24 18:23:15,807 - __main__ - INFO - Received request from ('127.0.0.1', 50874): chat
2025-06-24 18:23:15,814 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:23:15,815 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:23:19,861 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:23:19,873 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:23:23,302 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:23:23,306 - __main__ - INFO - Executing tool call 1/1: rag_query_for_chart
2025-06-24 18:23:23,322 - __main__ - INFO - Tool rag_query_for_chart executed successfully
2025-06-24 18:23:23,323 - __main__ - ERROR - Tool call error: Expected where to have exactly one operator, got {'chart_suitable': True, 'suggested_chart_type': 'line_chart'} in query.
2025-06-24 18:23:23,324 - __main__ - INFO - Sent response to ('127.0.0.1', 50874): error
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) closed connection
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) disconnected
2025-06-24 18:27:18,568 - __main__ - INFO - New client connected from ('127.0.0.1', 50980)
2025-06-24 18:27:18,569 - __main__ - INFO - Received request from ('127.0.0.1', 50980): chat
2025-06-24 18:27:18,570 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:27:18,570 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:27:21,697 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:27:21,703 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:27:22,316 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:27:22,317 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-0f97311b-268a-9e55-9a1f-9ef6b6f99f37', 'request_id': '0f97311b-268a-9e55-9a1f-9ef6b6f99f37'}
2025-06-24 18:27:22,318 - __main__ - INFO - Sent response to ('127.0.0.1', 50980): error
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) closed connection
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) disconnected
2025-06-24 18:28:38,594 - __main__ - INFO - New client connected from ('127.0.0.1', 51014)
2025-06-24 18:28:38,594 - __main__ - INFO - Received request from ('127.0.0.1', 51014): chat
2025-06-24 18:28:38,595 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:28:38,595 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:28:41,276 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:28:41,281 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:28:41,959 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:28:41,959 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-6a2b416e-b393-9865-af78-c1197c2c40ae', 'request_id': '6a2b416e-b393-9865-af78-c1197c2c40ae'}
2025-06-24 18:28:41,960 - __main__ - INFO - Sent response to ('127.0.0.1', 51014): error
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) closed connection
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) disconnected
2025-06-24 18:29:54,164 - __main__ - INFO - New client connected from ('127.0.0.1', 51100)
2025-06-24 18:29:54,165 - __main__ - INFO - Received request from ('127.0.0.1', 51100): chat
2025-06-24 18:29:54,166 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:29:54,166 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:29:57,040 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:29:57,046 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:29:57,803 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:29:57,804 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-9ebf87b0-ea87-9c78-8eee-de142363422c', 'request_id': '9ebf87b0-ea87-9c78-8eee-de142363422c'}
2025-06-24 18:29:57,805 - __main__ - INFO - Sent response to ('127.0.0.1', 51100): error
2025-06-24 18:30:22,452 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:22,453 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:28,423 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:30:36,268 - __main__ - INFO - New client connected from ('127.0.0.1', 51126)
2025-06-24 18:30:36,268 - __main__ - INFO - Received request from ('127.0.0.1', 51126): chat
2025-06-24 18:30:36,269 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:30:36,269 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:30:38,817 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:30:38,821 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:30:41,462 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:30:41,464 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-24 18:30:42,119 - __main__ - INFO - Tool rag_query executed successfully
2025-06-24 18:31:05,970 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:05,971 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:05,972 - __main__ - INFO - Sent response to ('127.0.0.1', 51126): success
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) closed connection
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) disconnected
2025-06-24 18:31:38,187 - __main__ - INFO - New client connected from ('127.0.0.1', 51144)
2025-06-24 18:31:38,187 - __main__ - INFO - Received request from ('127.0.0.1', 51144): chat
2025-06-24 18:31:38,188 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:31:38,189 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:31:40,794 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:31:40,799 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:31:42,291 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:42,292 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-24 18:31:42,293 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-24 18:31:42,400 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-24 18:31:51,545 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:51,546 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:51,546 - __main__ - INFO - Sent response to ('127.0.0.1', 51144): success
2025-06-24 18:32:08,187 - __main__ - INFO - Client ('127.0.0.1', 51144) closed connection
2025-06-24 18:32:08,188 - __main__ - INFO - Client ('127.0.0.1', 51144) disconnected
2025-06-25 02:30:57,431 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-25 02:31:41,275 - __main__ - INFO - New client connected from ('127.0.0.1', 53921)
2025-06-25 02:31:41,276 - __main__ - INFO - Received request from ('127.0.0.1', 53921): chat
2025-06-25 02:31:41,278 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:31:41,278 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:31:43,948 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:31:43,954 - __main__ - ERROR - Error processing message for conversation 7: 'required'
2025-06-25 02:31:43,955 - __main__ - INFO - Sent response to ('127.0.0.1', 53921): error
2025-06-25 02:32:11,277 - __main__ - INFO - Client ('127.0.0.1', 53921) closed connection
2025-06-25 02:32:11,277 - __main__ - INFO - Client ('127.0.0.1', 53921) disconnected
2025-06-25 02:35:40,893 - __main__ - INFO - New client connected from ('127.0.0.1', 54011)
2025-06-25 02:35:40,894 - __main__ - INFO - Received request from ('127.0.0.1', 54011): chat
2025-06-25 02:35:40,896 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:35:40,896 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:35:44,646 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:35:44,652 - __main__ - ERROR - Error processing message for conversation 7: 'required'
2025-06-25 02:35:44,653 - __main__ - INFO - Sent response to ('127.0.0.1', 54011): error
2025-06-25 02:36:10,891 - __main__ - INFO - Client ('127.0.0.1', 54011) closed connection
2025-06-25 02:36:10,892 - __main__ - INFO - Client ('127.0.0.1', 54011) disconnected
2025-06-25 02:36:58,588 - __main__ - INFO - New client connected from ('127.0.0.1', 54049)
2025-06-25 02:36:58,589 - __main__ - INFO - Received request from ('127.0.0.1', 54049): chat
2025-06-25 02:36:58,591 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:36:58,592 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:37:01,591 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:37:01,597 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:37:04,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:37:04,021 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:37:04,720 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:37:16,008 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:37:16,010 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:37:16,011 - __main__ - INFO - Sent response to ('127.0.0.1', 54049): success
2025-06-25 02:37:28,587 - __main__ - INFO - Client ('127.0.0.1', 54049) closed connection
2025-06-25 02:37:28,588 - __main__ - INFO - Client ('127.0.0.1', 54049) disconnected
2025-06-25 02:40:11,015 - __main__ - INFO - New client connected from ('127.0.0.1', 54131)
2025-06-25 02:40:11,016 - __main__ - INFO - Received request from ('127.0.0.1', 54131): chat
2025-06-25 02:40:11,017 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:40:11,018 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:40:14,501 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:40:14,506 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:40:16,375 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:40:16,376 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:40:17,060 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:40:32,768 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:40:32,769 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:40:32,770 - __main__ - INFO - Sent response to ('127.0.0.1', 54131): success
2025-06-25 02:40:41,025 - __main__ - INFO - Client ('127.0.0.1', 54131) closed connection
2025-06-25 02:40:41,026 - __main__ - INFO - Client ('127.0.0.1', 54131) disconnected
2025-06-25 02:42:13,119 - __main__ - INFO - Stopping server...
2025-06-25 02:42:13,119 - __main__ - INFO - AI Socket Server stopped
2025-06-25 02:42:13,119 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-25 02:42:13,119 - __main__ - INFO - Stopping server...
2025-06-25 02:42:13,120 - __main__ - INFO - AI Socket Server stopped
2025-06-25 02:42:19,640 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-25 02:42:29,916 - __main__ - INFO - New client connected from ('127.0.0.1', 54201)
2025-06-25 02:42:29,917 - __main__ - INFO - Received request from ('127.0.0.1', 54201): chat
2025-06-25 02:42:29,919 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:42:29,919 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:42:32,955 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:42:32,961 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:42:34,945 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:34,948 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-25 02:42:34,948 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-25 02:42:35,106 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-25 02:42:43,014 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:43,016 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:42:43,017 - __main__ - INFO - Sent response to ('127.0.0.1', 54201): success
2025-06-25 02:42:51,398 - __main__ - INFO - New client connected from ('127.0.0.1', 54218)
2025-06-25 02:42:51,398 - __main__ - INFO - Received request from ('127.0.0.1', 54218): chat
2025-06-25 02:42:51,399 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:42:51,399 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:42:54,237 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:42:54,242 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:42:56,045 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:56,046 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:42:56,046 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'hoaphat2024 doanh thu c�c n�m'}
2025-06-25 02:42:56,687 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:42:59,925 - __main__ - INFO - Client ('127.0.0.1', 54201) closed connection
2025-06-25 02:42:59,926 - __main__ - INFO - Client ('127.0.0.1', 54201) disconnected
2025-06-25 02:43:06,206 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:43:06,207 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:43:06,208 - __main__ - INFO - Sent response to ('127.0.0.1', 54218): success
2025-06-25 02:43:21,410 - __main__ - INFO - Client ('127.0.0.1', 54218) closed connection
2025-06-25 02:43:21,410 - __main__ - INFO - Client ('127.0.0.1', 54218) disconnected
2025-06-25 02:46:30,594 - __main__ - INFO - New client connected from ('127.0.0.1', 54278)
2025-06-25 02:46:30,596 - __main__ - INFO - Received request from ('127.0.0.1', 54278): chat
2025-06-25 02:46:30,598 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:46:30,598 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:46:33,676 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:46:33,682 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:46:34,865 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:46:34,866 - __main__ - INFO - Generated answer for conversation 7
2025-06-25 02:46:34,867 - __main__ - INFO - Sent response to ('127.0.0.1', 54278): success
2025-06-25 02:47:00,597 - __main__ - INFO - Client ('127.0.0.1', 54278) closed connection
2025-06-25 02:47:00,598 - __main__ - INFO - Client ('127.0.0.1', 54278) disconnected
2025-06-25 03:28:53,405 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-25 03:31:33,897 - socket_server - INFO - New client connected from ('127.0.0.1', 56958)
2025-06-25 03:31:33,898 - socket_server - INFO - Received request from ('127.0.0.1', 56958): chat
2025-06-25 03:31:33,901 - __main__ - INFO - Processing message for conversation 7
2025-06-25 03:31:33,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 03:31:37,456 - __main__ - INFO - MCP client initialized successfully
2025-06-25 03:31:37,473 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 03:31:39,429 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 03:31:39,431 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 03:31:39,832 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 03:31:53,372 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 03:31:53,374 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 03:31:53,375 - socket_server - INFO - Sent response to ('127.0.0.1', 56958): success
2025-06-25 03:32:03,889 - socket_server - INFO - Client ('127.0.0.1', 56958) closed connection
2025-06-25 03:32:03,890 - socket_server - INFO - Client ('127.0.0.1', 56958) disconnected
2025-06-25 18:36:22,893 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:38:45,495 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:40:22,486 - socket_server - INFO - New client connected from ('127.0.0.1', 62046)
2025-06-26 00:40:22,486 - socket_server - INFO - Received request from ('127.0.0.1', 62046): chat
2025-06-26 00:40:22,488 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:40:22,489 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:40:26,112 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:40:26,118 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:40:28,883 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:40:28,887 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:40:28,887 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'financial_performance'}
2025-06-26 00:40:28,888 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/financial_performance
2025-06-26 00:40:28,895 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:40:28,895 - __main__ - ERROR - Tool call error: Database 'financial_performance' not found or has no tables
2025-06-26 00:40:28,896 - socket_server - INFO - Sent response to ('127.0.0.1', 62046): error
2025-06-26 00:40:52,491 - socket_server - INFO - Client ('127.0.0.1', 62046) closed connection
2025-06-26 00:40:52,491 - socket_server - INFO - Client ('127.0.0.1', 62046) disconnected
2025-06-26 00:41:11,792 - socket_server - INFO - New client connected from ('127.0.0.1', 62060)
2025-06-26 00:41:11,792 - socket_server - INFO - Received request from ('127.0.0.1', 62060): chat
2025-06-26 00:41:11,793 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:41:11,794 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:41:14,752 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:41:14,757 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:41:15,385 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:41:15,386 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d705aeaa-7b1c-97fe-b4e3-d9929f193d2f', 'request_id': 'd705aeaa-7b1c-97fe-b4e3-d9929f193d2f'}
2025-06-26 00:41:15,387 - socket_server - INFO - Sent response to ('127.0.0.1', 62060): error
2025-06-26 00:41:41,801 - socket_server - INFO - Client ('127.0.0.1', 62060) closed connection
2025-06-26 00:41:41,802 - socket_server - INFO - Client ('127.0.0.1', 62060) disconnected
2025-06-26 00:41:50,684 - socket_server - INFO - New client connected from ('127.0.0.1', 62075)
2025-06-26 00:41:50,684 - socket_server - INFO - Received request from ('127.0.0.1', 62075): chat
2025-06-26 00:41:50,685 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:41:50,685 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:41:53,720 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:41:53,724 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:41:54,367 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:41:54,368 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-a60fd2fc-0204-93d3-864a-8b5c37112180', 'request_id': 'a60fd2fc-0204-93d3-864a-8b5c37112180'}
2025-06-26 00:41:54,369 - socket_server - INFO - Sent response to ('127.0.0.1', 62075): error
2025-06-26 00:42:12,614 - socket_server - INFO - New client connected from ('127.0.0.1', 62086)
2025-06-26 00:42:12,615 - socket_server - INFO - Received request from ('127.0.0.1', 62086): chat
2025-06-26 00:42:12,615 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:42:12,616 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:42:15,444 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:42:15,449 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:42:16,071 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:42:16,072 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-12fc2e7d-f429-9c49-949c-e874b100aaea', 'request_id': '12fc2e7d-f429-9c49-949c-e874b100aaea'}
2025-06-26 00:42:16,073 - socket_server - INFO - Sent response to ('127.0.0.1', 62086): error
2025-06-26 00:42:20,690 - socket_server - INFO - Client ('127.0.0.1', 62075) closed connection
2025-06-26 00:42:20,691 - socket_server - INFO - Client ('127.0.0.1', 62075) disconnected
2025-06-26 00:42:42,612 - socket_server - INFO - Client ('127.0.0.1', 62086) closed connection
2025-06-26 00:42:42,613 - socket_server - INFO - Client ('127.0.0.1', 62086) disconnected
2025-06-26 00:42:48,731 - socket_server - INFO - New client connected from ('127.0.0.1', 62115)
2025-06-26 00:42:48,731 - socket_server - INFO - Received request from ('127.0.0.1', 62115): chat
2025-06-26 00:42:48,732 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:42:48,732 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:42:52,082 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:42:52,087 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:42:52,729 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:42:52,730 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-107f447c-3250-9c58-80b1-9bae5b870939', 'request_id': '107f447c-3250-9c58-80b1-9bae5b870939'}
2025-06-26 00:42:52,731 - socket_server - INFO - Sent response to ('127.0.0.1', 62115): error
2025-06-26 00:43:18,730 - socket_server - INFO - Client ('127.0.0.1', 62115) closed connection
2025-06-26 00:43:18,731 - socket_server - INFO - Client ('127.0.0.1', 62115) disconnected
2025-06-26 00:45:53,570 - socket_server - INFO - Stopping server...
2025-06-26 00:45:53,583 - socket_server - INFO - Socket Server stopped
2025-06-26 00:45:53,583 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 00:45:53,584 - socket_server - INFO - Stopping server...
2025-06-26 00:45:53,585 - socket_server - INFO - Socket Server stopped
2025-06-26 00:45:59,410 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:46:11,584 - socket_server - INFO - New client connected from ('127.0.0.1', 62232)
2025-06-26 00:46:11,585 - socket_server - INFO - Received request from ('127.0.0.1', 62232): chat
2025-06-26 00:46:11,586 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:46:11,586 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:46:15,002 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:46:15,008 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:46:16,881 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:16,885 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 00:46:16,885 - socket_server - INFO - Sent response to ('127.0.0.1', 62232): success
2025-06-26 00:46:27,161 - socket_server - INFO - New client connected from ('127.0.0.1', 62242)
2025-06-26 00:46:27,162 - socket_server - INFO - Received request from ('127.0.0.1', 62242): chat
2025-06-26 00:46:27,163 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:46:27,163 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:46:29,978 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:46:29,982 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:46:31,489 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:31,491 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 00:46:31,491 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 00:46:31,588 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 00:46:39,024 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:39,025 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 00:46:39,025 - socket_server - INFO - Sent response to ('127.0.0.1', 62242): success
2025-06-26 00:46:41,572 - socket_server - INFO - Client ('127.0.0.1', 62232) closed connection
2025-06-26 00:46:41,572 - socket_server - INFO - Client ('127.0.0.1', 62232) disconnected
2025-06-26 00:46:57,168 - socket_server - INFO - Client ('127.0.0.1', 62242) closed connection
2025-06-26 00:46:57,169 - socket_server - INFO - Client ('127.0.0.1', 62242) disconnected
2025-06-26 00:47:10,113 - socket_server - INFO - New client connected from ('127.0.0.1', 62263)
2025-06-26 00:47:10,113 - socket_server - INFO - Received request from ('127.0.0.1', 62263): chat
2025-06-26 00:47:10,114 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:47:10,115 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:47:13,038 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:47:13,042 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:47:15,112 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:47:15,113 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:47:15,113 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'sakila'}
2025-06-26 00:47:15,113 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/sakila
2025-06-26 00:47:15,123 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:47:15,123 - __main__ - ERROR - Tool call error: Database 'sakila' not found or has no tables
2025-06-26 00:47:15,124 - socket_server - INFO - Sent response to ('127.0.0.1', 62263): error
2025-06-26 00:47:33,686 - socket_server - INFO - New client connected from ('127.0.0.1', 62280)
2025-06-26 00:47:33,687 - socket_server - INFO - Received request from ('127.0.0.1', 62280): chat
2025-06-26 00:47:33,688 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:47:33,688 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:47:36,701 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:47:36,705 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:47:37,320 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:47:37,321 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[9].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-deb0a76c-44f5-91af-8b9b-b1fcf6b955b2', 'request_id': 'deb0a76c-44f5-91af-8b9b-b1fcf6b955b2'}
2025-06-26 00:47:37,322 - socket_server - INFO - Sent response to ('127.0.0.1', 62280): error
2025-06-26 00:47:40,118 - socket_server - INFO - Client ('127.0.0.1', 62263) closed connection
2025-06-26 00:47:40,118 - socket_server - INFO - Client ('127.0.0.1', 62263) disconnected
2025-06-26 00:48:03,695 - socket_server - INFO - Client ('127.0.0.1', 62280) closed connection
2025-06-26 00:48:03,695 - socket_server - INFO - Client ('127.0.0.1', 62280) disconnected
2025-06-26 00:48:40,405 - socket_server - INFO - Stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Socket Server stopped
2025-06-26 00:48:40,406 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Socket Server stopped
2025-06-26 00:48:44,526 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:49:08,220 - socket_server - INFO - New client connected from ('127.0.0.1', 62311)
2025-06-26 00:49:08,220 - socket_server - INFO - Received request from ('127.0.0.1', 62311): chat
2025-06-26 00:49:08,221 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:49:08,222 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:49:11,101 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:49:11,107 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:49:13,758 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:49:13,761 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:49:13,761 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 00:49:13,761 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 00:49:13,768 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:49:36,883 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:49:36,884 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 00:49:36,885 - socket_server - INFO - Sent response to ('127.0.0.1', 62311): success
2025-06-26 00:49:38,219 - socket_server - INFO - Client ('127.0.0.1', 62311) closed connection
2025-06-26 00:49:38,220 - socket_server - INFO - Client ('127.0.0.1', 62311) disconnected
2025-06-26 00:50:11,593 - socket_server - INFO - New client connected from ('127.0.0.1', 62335)
2025-06-26 00:50:11,594 - socket_server - INFO - Received request from ('127.0.0.1', 62335): chat
2025-06-26 00:50:11,595 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:50:11,595 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:50:14,443 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:50:14,447 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:50:16,472 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:50:16,473 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 00:50:16,474 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance'}
2025-06-26 00:50:16,482 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 00:50:46,497 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 00:50:46,498 - socket_server - INFO - Sent response to ('127.0.0.1', 62335): error
2025-06-26 00:50:46,498 - socket_server - ERROR - Error handling client ('127.0.0.1', 62335): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 00:50:46,498 - socket_server - INFO - Client ('127.0.0.1', 62335) disconnected
2025-06-26 00:58:37,857 - socket_server - INFO - New client connected from ('127.0.0.1', 62534)
2025-06-26 00:58:37,867 - socket_server - INFO - Received request from ('127.0.0.1', 62534): chat
2025-06-26 00:58:37,875 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:58:37,876 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:58:42,073 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:58:42,090 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:59:12,377 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 00:59:12,380 - socket_server - INFO - Sent response to ('127.0.0.1', 62534): error
2025-06-26 00:59:12,380 - socket_server - ERROR - Error handling client ('127.0.0.1', 62534): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 00:59:12,381 - socket_server - INFO - Client ('127.0.0.1', 62534) disconnected
2025-06-26 01:01:25,024 - socket_server - INFO - New client connected from ('127.0.0.1', 62599)
2025-06-26 01:01:25,025 - socket_server - INFO - Received request from ('127.0.0.1', 62599): chat
2025-06-26 01:01:25,027 - __main__ - INFO - Processing message for conversation 7
2025-06-26 01:01:25,027 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 01:01:27,903 - __main__ - INFO - MCP client initialized successfully
2025-06-26 01:01:27,909 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 01:01:58,264 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 01:01:58,265 - socket_server - INFO - Sent response to ('127.0.0.1', 62599): error
2025-06-26 01:01:58,265 - socket_server - ERROR - Error handling client ('127.0.0.1', 62599): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 01:01:58,265 - socket_server - INFO - Client ('127.0.0.1', 62599) disconnected
2025-06-26 01:05:28,204 - socket_server - INFO - New client connected from ('127.0.0.1', 62647)
2025-06-26 01:05:28,206 - socket_server - INFO - Received request from ('127.0.0.1', 62647): chat
2025-06-26 01:05:28,208 - __main__ - INFO - Processing message for conversation 7
2025-06-26 01:05:28,209 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 01:05:32,041 - __main__ - INFO - MCP client initialized successfully
2025-06-26 01:05:32,053 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 01:06:02,454 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 01:06:02,456 - socket_server - INFO - Sent response to ('127.0.0.1', 62647): error
2025-06-26 01:06:02,456 - socket_server - ERROR - Error handling client ('127.0.0.1', 62647): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 01:06:02,456 - socket_server - INFO - Client ('127.0.0.1', 62647) disconnected
2025-06-26 08:59:56,922 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 09:02:26,016 - socket_server - INFO - New client connected from ('127.0.0.1', 64487)
2025-06-26 09:02:26,017 - socket_server - INFO - Received request from ('127.0.0.1', 64487): chat
2025-06-26 09:02:26,018 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:02:26,018 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:02:29,486 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:02:29,492 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:02:33,567 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:02:33,582 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 09:02:33,582 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:02:33,582 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 09:02:33,628 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 09:02:35,482 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:02:35,484 - socket_server - INFO - Sent response to ('127.0.0.1', 64487): error
2025-06-26 09:02:56,020 - socket_server - INFO - Client ('127.0.0.1', 64487) closed connection
2025-06-26 09:02:56,020 - socket_server - INFO - Client ('127.0.0.1', 64487) disconnected
2025-06-26 09:03:41,103 - socket_server - INFO - New client connected from ('127.0.0.1', 64754)
2025-06-26 09:03:41,121 - socket_server - INFO - Received request from ('127.0.0.1', 64754): chat
2025-06-26 09:03:41,147 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:03:41,150 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:03:45,583 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:03:45,604 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:03:48,829 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:03:48,838 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:03:48,839 - socket_server - INFO - Sent response to ('127.0.0.1', 64754): success
2025-06-26 09:03:56,486 - socket_server - INFO - New client connected from ('127.0.0.1', 64775)
2025-06-26 09:03:56,486 - socket_server - INFO - Received request from ('127.0.0.1', 64775): chat
2025-06-26 09:03:56,487 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:03:56,487 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:03:59,362 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:03:59,367 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:04:01,369 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:04:01,371 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 09:04:01,371 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:04:01,371 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 09:04:01,511 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 09:04:03,333 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:04:03,335 - socket_server - INFO - Sent response to ('127.0.0.1', 64775): error
2025-06-26 09:04:11,037 - socket_server - INFO - Client ('127.0.0.1', 64754) closed connection
2025-06-26 09:04:11,038 - socket_server - INFO - Client ('127.0.0.1', 64754) disconnected
2025-06-26 09:04:26,497 - socket_server - INFO - Client ('127.0.0.1', 64775) closed connection
2025-06-26 09:04:26,498 - socket_server - INFO - Client ('127.0.0.1', 64775) disconnected
2025-06-26 09:05:05,587 - socket_server - INFO - New client connected from ('127.0.0.1', 64808)
2025-06-26 09:05:05,587 - socket_server - INFO - Received request from ('127.0.0.1', 64808): chat
2025-06-26 09:05:05,589 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:05:05,590 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:05:09,033 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:05:09,039 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:05:11,128 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:05:11,130 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 09:05:11,130 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:05:11,130 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 09:05:11,158 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 09:05:23,824 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:05:23,825 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 09:05:23,826 - socket_server - INFO - Sent response to ('127.0.0.1', 64808): success
2025-06-26 09:05:35,588 - socket_server - INFO - Client ('127.0.0.1', 64808) closed connection
2025-06-26 09:05:35,588 - socket_server - INFO - Client ('127.0.0.1', 64808) disconnected
2025-06-26 09:06:19,940 - socket_server - INFO - New client connected from ('127.0.0.1', 64818)
2025-06-26 09:06:19,940 - socket_server - INFO - Received request from ('127.0.0.1', 64818): chat
2025-06-26 09:06:19,941 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:06:19,942 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:06:22,769 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:06:22,774 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:06:23,132 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:23,176 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:23,181 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:32,352 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:06:32,354 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:06:32,355 - socket_server - INFO - Sent response to ('127.0.0.1', 64818): success
2025-06-26 09:06:49,944 - socket_server - INFO - Client ('127.0.0.1', 64818) closed connection
2025-06-26 09:06:49,945 - socket_server - INFO - Client ('127.0.0.1', 64818) disconnected
2025-06-26 09:07:46,931 - socket_server - INFO - New client connected from ('127.0.0.1', 64834)
2025-06-26 09:07:46,932 - socket_server - INFO - Received request from ('127.0.0.1', 64834): chat
2025-06-26 09:07:46,933 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:07:46,934 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:07:49,912 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:07:49,917 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:08:11,388 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:08:11,389 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:08:11,390 - socket_server - INFO - Sent response to ('127.0.0.1', 64834): success
2025-06-26 09:08:16,938 - socket_server - INFO - Client ('127.0.0.1', 64834) closed connection
2025-06-26 09:08:16,938 - socket_server - INFO - Client ('127.0.0.1', 64834) disconnected
2025-06-26 09:21:17,922 - socket_server - INFO - New client connected from ('127.0.0.1', 65291)
2025-06-26 09:21:17,943 - socket_server - INFO - Received request from ('127.0.0.1', 65291): chat
2025-06-26 09:21:17,964 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:21:17,967 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:21:23,093 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:21:23,100 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:21:27,562 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:21:27,566 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:21:27,566 - socket_server - INFO - Sent response to ('127.0.0.1', 65291): success
2025-06-26 09:21:35,802 - socket_server - INFO - New client connected from ('127.0.0.1', 65301)
2025-06-26 09:21:35,804 - socket_server - INFO - Received request from ('127.0.0.1', 65301): chat
2025-06-26 09:21:35,805 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:21:35,805 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:21:38,821 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:21:38,826 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:21:44,036 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:21:44,038 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:21:44,038 - socket_server - INFO - Sent response to ('127.0.0.1', 65301): success
2025-06-26 09:21:47,844 - socket_server - INFO - Client ('127.0.0.1', 65291) closed connection
2025-06-26 09:21:47,844 - socket_server - INFO - Client ('127.0.0.1', 65291) disconnected
2025-06-26 09:22:05,809 - socket_server - INFO - Client ('127.0.0.1', 65301) closed connection
2025-06-26 09:22:05,809 - socket_server - INFO - Client ('127.0.0.1', 65301) disconnected
2025-06-26 09:24:41,595 - socket_server - INFO - New client connected from ('127.0.0.1', 65438)
2025-06-26 09:24:41,596 - socket_server - INFO - Received request from ('127.0.0.1', 65438): chat
2025-06-26 09:24:41,597 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:24:41,598 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:24:44,663 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:24:44,669 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:24:47,961 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:24:47,963 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 09:24:47,963 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance LIMIT 10;'}
2025-06-26 09:24:48,161 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 09:25:18,178 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 09:25:18,179 - socket_server - INFO - Sent response to ('127.0.0.1', 65438): error
2025-06-26 09:25:18,180 - socket_server - ERROR - Error handling client ('127.0.0.1', 65438): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:25:18,180 - socket_server - INFO - Client ('127.0.0.1', 65438) disconnected
2025-06-26 09:29:27,866 - socket_server - INFO - New client connected from ('127.0.0.1', 49222)
2025-06-26 09:29:27,870 - socket_server - INFO - Received request from ('127.0.0.1', 49222): chat
2025-06-26 09:29:27,881 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:29:27,882 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:29:32,201 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:29:32,254 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-44' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,290 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-45' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,301 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-46' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,322 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:30:02,587 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:30:02,589 - socket_server - INFO - Sent response to ('127.0.0.1', 49222): error
2025-06-26 09:30:02,589 - socket_server - ERROR - Error handling client ('127.0.0.1', 49222): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:30:02,589 - socket_server - INFO - Client ('127.0.0.1', 49222) disconnected
2025-06-26 09:30:58,717 - socket_server - INFO - New client connected from ('127.0.0.1', 49268)
2025-06-26 09:30:58,718 - socket_server - INFO - Received request from ('127.0.0.1', 49268): chat
2025-06-26 09:30:58,719 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:30:58,720 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:31:02,607 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:31:02,613 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:31:32,999 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:31:33,000 - socket_server - INFO - Sent response to ('127.0.0.1', 49268): error
2025-06-26 09:31:33,001 - socket_server - ERROR - Error handling client ('127.0.0.1', 49268): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:31:33,001 - socket_server - INFO - Client ('127.0.0.1', 49268) disconnected
2025-06-26 09:35:48,935 - socket_server - INFO - New client connected from ('127.0.0.1', 49386)
2025-06-26 09:35:48,937 - socket_server - INFO - Received request from ('127.0.0.1', 49386): chat
2025-06-26 09:35:48,942 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:35:48,943 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:35:52,960 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:35:52,974 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:36:23,294 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:36:23,296 - socket_server - INFO - Sent response to ('127.0.0.1', 49386): error
2025-06-26 09:36:23,297 - socket_server - ERROR - Error handling client ('127.0.0.1', 49386): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:36:23,297 - socket_server - INFO - Client ('127.0.0.1', 49386) disconnected
2025-06-26 09:38:50,022 - socket_server - INFO - New client connected from ('127.0.0.1', 49720)
2025-06-26 09:38:50,022 - socket_server - INFO - Received request from ('127.0.0.1', 49720): chat
2025-06-26 09:38:50,024 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:38:50,025 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:38:53,965 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:38:53,970 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:39:24,378 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:39:24,387 - socket_server - INFO - Sent response to ('127.0.0.1', 49720): error
2025-06-26 09:39:24,388 - socket_server - ERROR - Error handling client ('127.0.0.1', 49720): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:39:24,388 - socket_server - INFO - Client ('127.0.0.1', 49720) disconnected
2025-06-26 09:39:42,879 - socket_server - INFO - New client connected from ('127.0.0.1', 49754)
2025-06-26 09:39:42,880 - socket_server - INFO - Received request from ('127.0.0.1', 49754): chat
2025-06-26 09:39:42,881 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:39:42,881 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:39:46,074 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:39:46,080 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:40:16,479 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:40:16,481 - socket_server - INFO - Sent response to ('127.0.0.1', 49754): error
2025-06-26 09:40:16,481 - socket_server - ERROR - Error handling client ('127.0.0.1', 49754): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:40:16,481 - socket_server - INFO - Client ('127.0.0.1', 49754) disconnected
2025-06-26 09:40:28,027 - socket_server - INFO - New client connected from ('127.0.0.1', 49774)
2025-06-26 09:45:40,705 - socket_server - INFO - New client connected from ('127.0.0.1', 50080)
2025-06-26 09:46:16,885 - socket_server - INFO - Received request from ('127.0.0.1', 49774): chat
2025-06-26 09:46:16,885 - socket_server - INFO - Received request from ('127.0.0.1', 50080): chat
2025-06-26 09:46:16,899 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:16,900 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:16,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:16,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:17,054 - socket_server - INFO - Stopping server...
2025-06-26 09:46:17,055 - socket_server - INFO - Socket Server stopped
2025-06-26 09:46:17,056 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 09:46:17,056 - socket_server - INFO - Stopping server...
2025-06-26 09:46:17,056 - socket_server - INFO - Socket Server stopped
2025-06-26 09:46:27,048 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 09:46:29,783 - socket_server - INFO - New client connected from ('127.0.0.1', 50101)
2025-06-26 09:46:29,783 - socket_server - INFO - Received request from ('127.0.0.1', 50101): chat
2025-06-26 09:46:29,784 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:29,784 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:33,092 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:46:33,098 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:46:36,375 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:46:36,380 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 09:46:36,380 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `exam`.`categories` LIMIT 50'}
2025-06-26 09:46:36,388 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 09:46:39,030 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:46:39,032 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 09:46:39,033 - socket_server - INFO - Sent response to ('127.0.0.1', 50101): success
2025-06-26 09:46:59,784 - socket_server - INFO - Client ('127.0.0.1', 50101) closed connection
2025-06-26 09:46:59,785 - socket_server - INFO - Client ('127.0.0.1', 50101) disconnected
2025-06-26 09:59:18,141 - socket_server - INFO - New client connected from ('127.0.0.1', 50433)
2025-06-26 09:59:18,144 - socket_server - INFO - Received request from ('127.0.0.1', 50433): chat
2025-06-26 09:59:18,149 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:59:18,151 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:59:22,061 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:59:22,070 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:59:26,028 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:59:26,030 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 09:59:26,030 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 09:59:26,037 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 09:59:28,037 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:59:28,038 - socket_server - INFO - Sent response to ('127.0.0.1', 50433): error
2025-06-26 09:59:48,148 - socket_server - INFO - Client ('127.0.0.1', 50433) closed connection
2025-06-26 09:59:48,149 - socket_server - INFO - Client ('127.0.0.1', 50433) disconnected
2025-06-26 10:00:08,147 - socket_server - INFO - New client connected from ('127.0.0.1', 50461)
2025-06-26 10:00:08,148 - socket_server - INFO - Received request from ('127.0.0.1', 50461): chat
2025-06-26 10:00:08,149 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:00:08,149 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:00:11,685 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:00:11,691 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:00:27,420 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:00:27,422 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 10:00:27,422 - __main__ - INFO - Final LLM answer: To provide you with the product that has the highest price, I'll need to know which database and table to look into. From the list of databases available, could you specify which database contains the products information?

Here is the list of databases available:

- abc
- authentic
- chat_socket
- chatbot
- chatbot_ai
- chatbotdb
- company
- customer
- duanmau
- exam
- exam1
- hoaphat2024
- laravel-gpt
- laravel_vuejs
- mvc_oop
- php-oop2
- php3_wd19314
- sakila
- test_chatbot
- web2014_database_asm01
- web2014_database_demo02
- web2014_database_lab03x04
- web2014_database_lab05x06
- web2014_database_lab07x08
- web2014_demo_mvc_database01
- web2014_demo_mvc_database02
- web2014_demo_opp_buoi1
- xaydungweb
- xdweb2

Please indicate which one should be used for retrieving the product information. If you're not sure, let me know the approximate details or characteristics of the products, and I might help identify the correct database.
2025-06-26 10:00:27,423 - socket_server - INFO - Sent response to ('127.0.0.1', 50461): success
2025-06-26 10:00:38,154 - socket_server - INFO - Client ('127.0.0.1', 50461) closed connection
2025-06-26 10:00:38,155 - socket_server - INFO - Client ('127.0.0.1', 50461) disconnected
2025-06-26 10:01:14,306 - socket_server - INFO - New client connected from ('127.0.0.1', 50511)
2025-06-26 10:01:14,307 - socket_server - INFO - Received request from ('127.0.0.1', 50511): chat
2025-06-26 10:01:14,308 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:01:14,309 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:01:17,527 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:01:17,532 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:01:19,920 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:19,921 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:01:19,922 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:01:19,924 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 10:01:19,931 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:01:22,588 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:22,590 - socket_server - INFO - Sent response to ('127.0.0.1', 50511): error
2025-06-26 10:01:44,313 - socket_server - INFO - Client ('127.0.0.1', 50511) closed connection
2025-06-26 10:01:44,314 - socket_server - INFO - Client ('127.0.0.1', 50511) disconnected
2025-06-26 10:01:48,081 - socket_server - INFO - New client connected from ('127.0.0.1', 50531)
2025-06-26 10:01:48,081 - socket_server - INFO - Received request from ('127.0.0.1', 50531): chat
2025-06-26 10:01:48,082 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:01:48,083 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:01:51,315 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:01:51,320 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:01:51,709 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:51,746 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:51,750 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:54,103 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:54,106 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:01:54,107 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:01:54,107 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:01:54,118 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:01:56,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:56,412 - socket_server - INFO - Sent response to ('127.0.0.1', 50531): error
2025-06-26 10:02:18,079 - socket_server - INFO - Client ('127.0.0.1', 50531) closed connection
2025-06-26 10:02:18,080 - socket_server - INFO - Client ('127.0.0.1', 50531) disconnected
2025-06-26 10:04:41,591 - socket_server - INFO - New client connected from ('127.0.0.1', 50659)
2025-06-26 10:04:41,591 - socket_server - INFO - Received request from ('127.0.0.1', 50659): chat
2025-06-26 10:04:41,592 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:04:41,593 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:04:54,021 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:04:54,026 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:04:56,463 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:04:56,465 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:04:56,465 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `php3_wd19314`.`categories` LIMIT 50'}
2025-06-26 10:04:56,533 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:05:26,548 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 10:05:26,548 - socket_server - INFO - Sent response to ('127.0.0.1', 50659): error
2025-06-26 10:05:26,550 - socket_server - ERROR - Error handling client ('127.0.0.1', 50659): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 10:05:26,550 - socket_server - INFO - Client ('127.0.0.1', 50659) disconnected
2025-06-26 10:07:18,123 - socket_server - INFO - New client connected from ('127.0.0.1', 50764)
2025-06-26 10:07:18,123 - socket_server - INFO - Received request from ('127.0.0.1', 50764): chat
2025-06-26 10:07:18,125 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:07:18,125 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:07:21,734 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:07:21,743 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:07:52,431 - openai._base_client - INFO - Retrying request to /chat/completions in 0.378377 seconds
2025-06-26 10:08:22,099 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:08:22,101 - socket_server - INFO - Sent response to ('127.0.0.1', 50764): error
2025-06-26 10:08:48,122 - socket_server - INFO - Client ('127.0.0.1', 50764) closed connection
2025-06-26 10:08:48,122 - socket_server - INFO - Client ('127.0.0.1', 50764) disconnected
2025-06-26 10:10:27,275 - socket_server - INFO - New client connected from ('127.0.0.1', 50850)
2025-06-26 10:10:27,275 - socket_server - INFO - Received request from ('127.0.0.1', 50850): chat
2025-06-26 10:10:27,276 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:10:27,276 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:10:30,257 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:10:30,262 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:11:00,844 - openai._base_client - INFO - Retrying request to /chat/completions in 0.406044 seconds
2025-06-26 10:11:30,592 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:11:30,594 - socket_server - INFO - Sent response to ('127.0.0.1', 50850): error
2025-06-26 10:11:57,282 - socket_server - INFO - Client ('127.0.0.1', 50850) closed connection
2025-06-26 10:11:57,282 - socket_server - INFO - Client ('127.0.0.1', 50850) disconnected
2025-06-26 10:14:13,830 - socket_server - INFO - New client connected from ('127.0.0.1', 50975)
2025-06-26 10:14:13,831 - socket_server - INFO - Received request from ('127.0.0.1', 50975): chat
2025-06-26 10:14:13,834 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:14:13,834 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:14:17,434 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:14:17,441 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:14:48,159 - openai._base_client - INFO - Retrying request to /chat/completions in 0.449149 seconds
2025-06-26 10:15:17,808 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:15:17,810 - socket_server - INFO - Sent response to ('127.0.0.1', 50975): error
2025-06-26 10:15:43,828 - socket_server - INFO - Client ('127.0.0.1', 50975) closed connection
2025-06-26 10:15:43,828 - socket_server - INFO - Client ('127.0.0.1', 50975) disconnected
2025-06-26 10:19:07,466 - socket_server - INFO - New client connected from ('127.0.0.1', 51132)
2025-06-26 10:19:07,471 - socket_server - INFO - Received request from ('127.0.0.1', 51132): chat
2025-06-26 10:19:07,476 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:19:07,477 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:19:11,499 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:19:11,520 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:19:43,117 - openai._base_client - INFO - Retrying request to /chat/completions in 0.410184 seconds
2025-06-26 10:20:11,886 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:20:11,888 - socket_server - INFO - Sent response to ('127.0.0.1', 51132): error
2025-06-26 10:20:37,452 - socket_server - INFO - Client ('127.0.0.1', 51132) closed connection
2025-06-26 10:20:37,453 - socket_server - INFO - Client ('127.0.0.1', 51132) disconnected
2025-06-26 10:22:41,531 - socket_server - INFO - New client connected from ('127.0.0.1', 51231)
2025-06-26 10:22:41,532 - socket_server - INFO - Received request from ('127.0.0.1', 51231): chat
2025-06-26 10:22:41,534 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:22:41,535 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:22:45,097 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:22:45,103 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:22:48,506 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:22:48,515 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:22:48,516 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:22:48,597 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:23:01,861 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:23:01,862 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:23:01,863 - socket_server - INFO - Sent response to ('127.0.0.1', 51231): success
2025-06-26 10:24:01,867 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51231)
2025-06-26 10:24:01,868 - socket_server - INFO - Client ('127.0.0.1', 51231) disconnected
2025-06-26 10:24:24,292 - socket_server - INFO - New client connected from ('127.0.0.1', 51311)
2025-06-26 10:24:24,292 - socket_server - INFO - Received request from ('127.0.0.1', 51311): chat
2025-06-26 10:24:24,293 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:24:24,293 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:24:27,014 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:24:27,018 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:24:29,884 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:24:29,885 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:24:29,885 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:24:29,886 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 10:24:29,891 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:24:32,756 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:24:32,757 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:24:32,757 - socket_server - INFO - Sent response to ('127.0.0.1', 51311): success
2025-06-26 10:24:55,372 - socket_server - INFO - New client connected from ('127.0.0.1', 51322)
2025-06-26 10:24:55,373 - socket_server - INFO - Received request from ('127.0.0.1', 51322): chat
2025-06-26 10:24:55,374 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:24:55,375 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:24:58,451 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:24:58,455 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:24:58,851 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-60' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:24:58,865 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-61' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:25:00,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:00,564 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:25:00,564 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:25:00,564 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:25:00,573 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:25:02,356 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:02,357 - socket_server - INFO - Sent response to ('127.0.0.1', 51322): error
2025-06-26 10:25:32,759 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51311)
2025-06-26 10:25:32,759 - socket_server - INFO - Client ('127.0.0.1', 51311) disconnected
2025-06-26 10:25:35,474 - socket_server - INFO - New client connected from ('127.0.0.1', 51339)
2025-06-26 10:25:35,474 - socket_server - INFO - Received request from ('127.0.0.1', 51339): chat
2025-06-26 10:25:35,475 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:25:35,475 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:25:38,180 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:25:38,184 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:25:43,617 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:43,618 - __main__ - INFO - Generated answer for conversation 9
2025-06-26 10:25:43,643 - socket_server - INFO - Sent response to ('127.0.0.1', 51339): success
2025-06-26 10:26:02,363 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51322)
2025-06-26 10:26:02,363 - socket_server - INFO - Client ('127.0.0.1', 51322) disconnected
2025-06-26 10:26:30,253 - socket_server - INFO - New client connected from ('127.0.0.1', 51581)
2025-06-26 10:26:30,254 - socket_server - INFO - Received request from ('127.0.0.1', 51581): chat
2025-06-26 10:26:30,255 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:26:30,255 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:26:33,028 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:26:33,032 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:26:36,006 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:26:36,007 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:26:36,007 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `subsidiaries`;'}
2025-06-26 10:26:36,014 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:26:36,014 - __main__ - ERROR - Tool call error: 1046 (3D000): No database selected
2025-06-26 10:26:36,015 - socket_server - INFO - Sent response to ('127.0.0.1', 51581): error
2025-06-26 10:26:43,649 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51339)
2025-06-26 10:26:43,650 - socket_server - INFO - Client ('127.0.0.1', 51339) disconnected
2025-06-26 10:27:05,291 - socket_server - INFO - New client connected from ('127.0.0.1', 51595)
2025-06-26 10:27:05,292 - socket_server - INFO - Received request from ('127.0.0.1', 51595): chat
2025-06-26 10:27:05,293 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:27:05,294 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:27:08,213 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:27:08,217 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:27:11,813 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 10:27:11,829 - __main__ - ERROR - Error processing message for conversation 9: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[16].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-709e69b1-eea6-9f0d-9ddd-4fe370a9d826', 'request_id': '709e69b1-eea6-9f0d-9ddd-4fe370a9d826'}
2025-06-26 10:27:11,830 - socket_server - INFO - Sent response to ('127.0.0.1', 51595): error
2025-06-26 10:27:19,426 - socket_server - INFO - Stopping server...
2025-06-26 10:27:19,426 - socket_server - INFO - Socket Server stopped
2025-06-26 10:27:19,427 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:27:19,427 - socket_server - INFO - Stopping server...
2025-06-26 10:27:19,427 - socket_server - INFO - Socket Server stopped
2025-06-26 10:27:26,504 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:28:04,087 - socket_server - INFO - New client connected from ('127.0.0.1', 51605)
2025-06-26 10:28:04,087 - socket_server - INFO - Received request from ('127.0.0.1', 51605): chat
2025-06-26 10:28:04,088 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:28:04,088 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:28:06,869 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:28:06,874 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:28:07,168 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:28:13,212 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:28:13,214 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:28:13,214 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:28:13,214 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:28:13,219 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:28:13,219 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:28:13,220 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:28:14,790 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:28:14,791 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:28:14,792 - socket_server - INFO - Sent response to ('127.0.0.1', 51605): error
2025-06-26 10:28:58,096 - socket_server - INFO - New client connected from ('127.0.0.1', 51661)
2025-06-26 10:28:58,097 - socket_server - INFO - Received request from ('127.0.0.1', 51661): chat
2025-06-26 10:28:58,098 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:28:58,098 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:29:00,781 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:29:00,785 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:29:01,104 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:29:03,144 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:29:03,145 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:29:03,145 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:29:03,145 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'company'}
2025-06-26 10:29:03,146 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/company
2025-06-26 10:29:03,152 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:29:03,152 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:29:03,153 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:29:05,368 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:29:05,369 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:29:05,370 - socket_server - INFO - Sent response to ('127.0.0.1', 51661): error
2025-06-26 10:29:34,085 - socket_server - INFO - Client ('127.0.0.1', 51605) closed connection
2025-06-26 10:29:34,085 - socket_server - INFO - Client ('127.0.0.1', 51605) disconnected
2025-06-26 10:30:28,098 - socket_server - INFO - Client ('127.0.0.1', 51661) closed connection
2025-06-26 10:30:28,098 - socket_server - INFO - Client ('127.0.0.1', 51661) disconnected
2025-06-26 10:30:30,889 - socket_server - INFO - New client connected from ('127.0.0.1', 51830)
2025-06-26 10:30:30,889 - socket_server - INFO - Received request from ('127.0.0.1', 51830): chat
2025-06-26 10:30:30,890 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:30:30,890 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:30:33,860 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:30:33,864 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:30:34,247 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:30:35,987 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:30:35,988 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:30:35,988 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:30:35,988 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'company'}
2025-06-26 10:30:35,988 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/company
2025-06-26 10:30:35,997 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:30:35,997 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:30:35,997 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:30:39,633 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:30:39,635 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:30:39,635 - socket_server - INFO - Sent response to ('127.0.0.1', 51830): success
2025-06-26 10:31:03,309 - socket_server - INFO - New client connected from ('127.0.0.1', 51854)
2025-06-26 10:31:03,309 - socket_server - INFO - Received request from ('127.0.0.1', 51854): chat
2025-06-26 10:31:03,310 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:31:03,311 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:31:06,157 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:31:06,161 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:31:06,513 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:31:09,306 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:31:09,307 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:31:09,307 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:31:09,307 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:31:09,307 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 10:31:09,325 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:31:09,325 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:31:09,325 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:31:10,980 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:31:10,981 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:31:10,982 - socket_server - INFO - Sent response to ('127.0.0.1', 51854): error
2025-06-26 10:32:00,891 - socket_server - INFO - Client ('127.0.0.1', 51830) closed connection
2025-06-26 10:32:00,892 - socket_server - INFO - Client ('127.0.0.1', 51830) disconnected
2025-06-26 10:32:33,313 - socket_server - INFO - Client ('127.0.0.1', 51854) closed connection
2025-06-26 10:32:33,313 - socket_server - INFO - Client ('127.0.0.1', 51854) disconnected
2025-06-26 10:32:43,021 - socket_server - INFO - New client connected from ('127.0.0.1', 51918)
2025-06-26 10:32:43,021 - socket_server - INFO - Received request from ('127.0.0.1', 51918): chat
2025-06-26 10:32:43,024 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:32:43,024 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:32:45,983 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:32:45,987 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:32:46,251 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:32:46,261 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:46,284 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:46,288 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:49,677 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:32:49,679 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:32:49,680 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:32:49,680 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:32:49,680 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:32:49,687 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:32:49,688 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:32:49,688 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:32:51,746 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:32:51,747 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:32:51,748 - socket_server - INFO - Sent response to ('127.0.0.1', 51918): error
2025-06-26 10:34:13,031 - socket_server - INFO - Client ('127.0.0.1', 51918) closed connection
2025-06-26 10:34:13,031 - socket_server - INFO - Client ('127.0.0.1', 51918) disconnected
2025-06-26 10:36:00,670 - socket_server - INFO - New client connected from ('127.0.0.1', 52003)
2025-06-26 10:36:00,670 - socket_server - INFO - Received request from ('127.0.0.1', 52003): chat
2025-06-26 10:36:00,674 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:36:00,675 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:36:04,359 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:36:04,366 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:36:04,618 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:36:07,311 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:36:07,314 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:36:07,314 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:36:07,314 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.subsidiaries;'}
2025-06-26 10:36:07,370 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:36:07,370 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:36:07,371 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:36:31,661 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:36:31,663 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:36:31,664 - socket_server - INFO - Sent response to ('127.0.0.1', 52003): success
2025-06-26 10:37:30,673 - socket_server - INFO - Client ('127.0.0.1', 52003) closed connection
2025-06-26 10:37:30,674 - socket_server - INFO - Client ('127.0.0.1', 52003) disconnected
2025-06-26 10:37:40,264 - socket_server - INFO - New client connected from ('127.0.0.1', 52024)
2025-06-26 10:37:40,265 - socket_server - INFO - Received request from ('127.0.0.1', 52024): chat
2025-06-26 10:37:40,266 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:37:40,266 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:37:43,673 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:37:43,678 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:37:43,930 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:37:46,531 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:37:46,532 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:37:46,532 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:37:46,532 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:37:46,594 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:37:46,594 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:37:46,595 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:37:53,433 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:37:53,435 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:37:53,436 - socket_server - INFO - Sent response to ('127.0.0.1', 52024): success
2025-06-26 10:38:21,244 - socket_server - INFO - New client connected from ('127.0.0.1', 52041)
2025-06-26 10:38:21,244 - socket_server - INFO - Received request from ('127.0.0.1', 52041): chat
2025-06-26 10:38:21,245 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:38:21,246 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:38:24,171 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:38:24,176 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:38:24,434 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:38:29,285 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:38:29,287 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:38:29,287 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:38:29,287 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:38:29,287 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 10:38:29,322 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:38:29,323 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:38:29,323 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:38:31,860 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:38:31,861 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:38:31,862 - socket_server - INFO - Sent response to ('127.0.0.1', 52041): error
2025-06-26 10:38:55,533 - socket_server - INFO - New client connected from ('127.0.0.1', 52051)
2025-06-26 10:38:55,534 - socket_server - INFO - Received request from ('127.0.0.1', 52051): chat
2025-06-26 10:38:55,535 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:38:55,535 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:38:58,281 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:38:58,285 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:38:58,542 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:38:58,551 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:38:58,557 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:38:58,561 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:39:01,009 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:39:01,010 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:39:01,010 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:39:01,010 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:39:01,010 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:39:01,023 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:39:01,024 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:39:01,024 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:39:05,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:39:05,152 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:39:05,152 - socket_server - INFO - Sent response to ('127.0.0.1', 52051): error
2025-06-26 10:39:10,275 - socket_server - INFO - Client ('127.0.0.1', 52024) closed connection
2025-06-26 10:39:10,275 - socket_server - INFO - Client ('127.0.0.1', 52024) disconnected
2025-06-26 10:39:51,253 - socket_server - INFO - Client ('127.0.0.1', 52041) closed connection
2025-06-26 10:39:51,253 - socket_server - INFO - Client ('127.0.0.1', 52041) disconnected
2025-06-26 10:40:25,533 - socket_server - INFO - Client ('127.0.0.1', 52051) closed connection
2025-06-26 10:40:25,533 - socket_server - INFO - Client ('127.0.0.1', 52051) disconnected
2025-06-26 10:40:45,400 - socket_server - INFO - Stopping server...
2025-06-26 10:40:45,401 - socket_server - INFO - Socket Server stopped
2025-06-26 10:40:45,401 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:40:45,401 - socket_server - INFO - Stopping server...
2025-06-26 10:40:45,402 - socket_server - INFO - Socket Server stopped
2025-06-26 10:40:50,283 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:41:03,017 - socket_server - INFO - New client connected from ('127.0.0.1', 52110)
2025-06-26 10:41:03,017 - socket_server - INFO - Received request from ('127.0.0.1', 52110): chat
2025-06-26 10:41:03,018 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:41:03,019 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:41:05,899 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:41:05,904 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:41:08,478 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:41:08,480 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:41:08,481 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:41:08,481 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:41:08,481 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:41:08,489 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:41:10,777 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:41:10,778 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:41:10,778 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:41:10,778 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `products` ORDER BY `gia` DESC LIMIT 20;'}
2025-06-26 10:41:10,782 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:41:10,782 - __main__ - ERROR - Tool call error: 1046 (3D000): No database selected
2025-06-26 10:41:10,783 - socket_server - INFO - Sent response to ('127.0.0.1', 52110): error
2025-06-26 10:42:18,112 - socket_server - INFO - New client connected from ('127.0.0.1', 52139)
2025-06-26 10:42:18,113 - socket_server - INFO - Received request from ('127.0.0.1', 52139): chat
2025-06-26 10:42:18,113 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:42:18,114 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:42:20,937 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:42:20,941 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:42:21,642 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 10:42:21,643 - __main__ - ERROR - Error processing message for conversation 9: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[5].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-70d64a7a-8f9e-9b7e-94e0-5cc86483a852', 'request_id': '70d64a7a-8f9e-9b7e-94e0-5cc86483a852'}
2025-06-26 10:42:21,643 - socket_server - INFO - Sent response to ('127.0.0.1', 52139): error
2025-06-26 10:42:33,015 - socket_server - INFO - Client ('127.0.0.1', 52110) closed connection
2025-06-26 10:42:33,016 - socket_server - INFO - Client ('127.0.0.1', 52110) disconnected
2025-06-26 10:42:34,195 - socket_server - INFO - Stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Socket Server stopped
2025-06-26 10:42:34,195 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Socket Server stopped
2025-06-26 10:42:38,705 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:42:41,283 - socket_server - INFO - New client connected from ('127.0.0.1', 52151)
2025-06-26 10:42:41,283 - socket_server - INFO - Received request from ('127.0.0.1', 52151): chat
2025-06-26 10:42:41,284 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:42:41,284 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:42:44,122 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:42:44,126 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:42:44,410 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:42:47,524 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:42:47,526 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:42:47,527 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:42:47,527 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:42:47,527 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:42:47,527 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:42:47,537 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:42:47,537 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:42:55,828 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:42:55,829 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:42:55,830 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:42:55,830 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:42:55,830 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ma_san_pham, ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 10:42:55,838 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:42:55,838 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:43:19,119 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:43:19,120 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:43:19,120 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:43:19,121 - socket_server - INFO - Sent response to ('127.0.0.1', 52151): success
2025-06-26 10:44:11,291 - socket_server - INFO - Client ('127.0.0.1', 52151) closed connection
2025-06-26 10:44:11,292 - socket_server - INFO - Client ('127.0.0.1', 52151) disconnected
2025-06-26 10:46:49,905 - socket_server - INFO - New client connected from ('127.0.0.1', 52239)
2025-06-26 10:46:49,909 - socket_server - INFO - Received request from ('127.0.0.1', 52239): chat
2025-06-26 10:46:49,920 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:46:49,921 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:46:53,433 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:46:53,446 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:46:53,829 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:46:56,659 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:46:56,668 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:46:56,668 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:46:56,668 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:46:56,668 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT id, ho_ten, email, so_dien_thoai FROM php3_wd19314.customers LIMIT 20;'}
2025-06-26 10:46:56,678 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:46:56,679 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:47:23,389 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:47:23,391 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:47:23,391 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:47:23,393 - socket_server - INFO - Sent response to ('127.0.0.1', 52239): success
2025-06-26 10:48:19,894 - socket_server - INFO - Client ('127.0.0.1', 52239) closed connection
2025-06-26 10:48:19,895 - socket_server - INFO - Client ('127.0.0.1', 52239) disconnected
2025-06-26 10:52:52,604 - socket_server - INFO - New client connected from ('127.0.0.1', 52376)
2025-06-26 10:52:52,611 - socket_server - INFO - Received request from ('127.0.0.1', 52376): chat
2025-06-26 10:52:52,621 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:52:52,622 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:52:56,532 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:52:56,546 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:52:56,890 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:53:00,623 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:00,625 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:53:00,625 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:53:00,625 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:53:00,626 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:53:00,627 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:53:00,712 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:53:00,713 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:53:03,635 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:03,636 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:53:03,636 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:53:03,636 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:53:03,637 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT id, name, email, role FROM php3_wd19314.users WHERE role = 'admin';"}
2025-06-26 10:53:03,651 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:53:03,652 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:53:10,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:10,016 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:53:10,017 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:53:10,017 - socket_server - INFO - Sent response to ('127.0.0.1', 52376): success
2025-06-26 10:54:22,577 - socket_server - INFO - Client ('127.0.0.1', 52376) closed connection
2025-06-26 10:54:22,577 - socket_server - INFO - Client ('127.0.0.1', 52376) disconnected
2025-06-26 10:54:34,192 - socket_server - INFO - New client connected from ('127.0.0.1', 52410)
2025-06-26 10:54:34,192 - socket_server - INFO - Received request from ('127.0.0.1', 52410): chat
2025-06-26 10:54:34,193 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:54:34,193 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:54:37,044 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:54:37,048 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:54:37,316 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:54:41,996 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:54:41,997 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:54:41,997 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:54:41,997 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:54:41,997 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:54:41,998 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:54:42,012 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:54:42,012 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:54:53,011 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:54:53,012 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:54:53,012 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:54:53,013 - socket_server - INFO - Sent response to ('127.0.0.1', 52410): success
2025-06-26 10:55:07,062 - socket_server - INFO - New client connected from ('127.0.0.1', 52420)
2025-06-26 10:55:07,062 - socket_server - INFO - Received request from ('127.0.0.1', 52420): chat
2025-06-26 10:55:07,063 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:55:07,063 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:55:10,041 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:55:10,060 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,092 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,095 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,103 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:55:10,358 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:55:12,055 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:12,057 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:12,058 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:12,058 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 10:55:12,058 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:55:12,070 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:55:12,071 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:55:14,507 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:14,508 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:14,509 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:14,509 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:55:14,509 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:55:14,509 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:55:14,516 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:55:14,517 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:55:17,106 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:17,107 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:17,107 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:17,107 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:55:17,107 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.highlights_2024;'}
2025-06-26 10:55:17,112 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:55:17,113 - __main__ - INFO - LLM iteration 4/10
2025-06-26 10:55:40,568 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:40,569 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:55:40,569 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:55:40,570 - socket_server - INFO - Sent response to ('127.0.0.1', 52420): success
2025-06-26 10:56:04,203 - socket_server - INFO - Client ('127.0.0.1', 52410) closed connection
2025-06-26 10:56:04,203 - socket_server - INFO - Client ('127.0.0.1', 52410) disconnected
2025-06-26 10:56:37,063 - socket_server - INFO - Client ('127.0.0.1', 52420) closed connection
2025-06-26 10:56:37,063 - socket_server - INFO - Client ('127.0.0.1', 52420) disconnected
2025-06-26 10:59:36,329 - socket_server - INFO - New client connected from ('127.0.0.1', 52546)
2025-06-26 10:59:36,330 - socket_server - INFO - Received request from ('127.0.0.1', 52546): chat
2025-06-26 10:59:36,333 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:59:36,334 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:59:39,599 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:59:39,604 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:59:39,858 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:59:46,408 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:59:46,409 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:59:46,410 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:59:46,410 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:59:46,410 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:59:46,410 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:59:46,428 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:59:46,429 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:59:50,600 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:59:50,601 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:59:50,601 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:59:50,601 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:59:50,602 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT id, ma_khach_hang, ma_san_pham, so_luong, gia, gia_khuyen_mai FROM php3_wd19314.carts;'}
2025-06-26 10:59:50,614 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:59:50,614 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:00:00,360 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:00,363 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:00:00,364 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:00:00,365 - socket_server - INFO - Sent response to ('127.0.0.1', 52546): success
2025-06-26 11:00:21,991 - socket_server - INFO - New client connected from ('127.0.0.1', 52567)
2025-06-26 11:00:21,991 - socket_server - INFO - Received request from ('127.0.0.1', 52567): chat
2025-06-26 11:00:21,993 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:00:21,993 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:00:24,949 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:00:24,955 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:00:25,214 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:00:29,164 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:29,165 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:00:29,165 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:00:29,165 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 11:00:29,166 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 11:00:29,166 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 11:00:29,183 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 11:00:29,183 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:00:45,832 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:45,833 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:00:45,833 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:00:45,834 - socket_server - INFO - Sent response to ('127.0.0.1', 52567): success
2025-06-26 11:01:06,338 - socket_server - INFO - Client ('127.0.0.1', 52546) closed connection
2025-06-26 11:01:06,339 - socket_server - INFO - Client ('127.0.0.1', 52546) disconnected
2025-06-26 11:01:51,997 - socket_server - INFO - Client ('127.0.0.1', 52567) closed connection
2025-06-26 11:01:51,997 - socket_server - INFO - Client ('127.0.0.1', 52567) disconnected
2025-06-26 11:18:29,333 - socket_server - INFO - New client connected from ('127.0.0.1', 52814)
2025-06-26 11:18:29,348 - socket_server - INFO - Received request from ('127.0.0.1', 52814): chat
2025-06-26 11:18:29,369 - __main__ - INFO - Processing message for conversation 11
2025-06-26 11:18:29,372 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:18:33,736 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:18:33,752 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:18:34,028 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:18:37,564 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:37,572 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:18:37,572 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:18:37,572 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 11:18:37,573 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 11:18:37,767 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 11:18:37,767 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:18:39,043 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:39,044 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:18:39,044 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:18:39,045 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 11:18:39,831 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 11:18:39,831 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:18:57,102 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:57,104 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:18:57,104 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 11:18:57,106 - socket_server - INFO - Sent response to ('127.0.0.1', 52814): success
2025-06-26 11:19:05,713 - socket_server - INFO - New client connected from ('127.0.0.1', 52831)
2025-06-26 11:19:05,713 - socket_server - INFO - Received request from ('127.0.0.1', 52831): chat
2025-06-26 11:19:05,715 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:19:05,715 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:19:05,743 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,765 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,773 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,779 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-43' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:08,662 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:19:08,667 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:19:08,911 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:19:20,273 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:20,288 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:19:20,288 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:19:20,288 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 11:19:20,289 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 11:19:20,289 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 11:19:20,394 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 11:19:20,394 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:19:27,639 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:27,640 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:19:27,640 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:19:27,640 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 11:19:27,640 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT SubsidiaryName, OwnershipPercentage FROM hoaphat2024.subsidiaries;'}
2025-06-26 11:19:27,669 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 11:19:27,669 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:19:53,685 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:53,686 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:19:53,686 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:19:53,687 - socket_server - INFO - Sent response to ('127.0.0.1', 52831): success
2025-06-26 11:19:59,282 - socket_server - INFO - Client ('127.0.0.1', 52814) closed connection
2025-06-26 11:19:59,283 - socket_server - INFO - Client ('127.0.0.1', 52814) disconnected
2025-06-26 11:20:35,720 - socket_server - INFO - Client ('127.0.0.1', 52831) closed connection
2025-06-26 11:20:35,721 - socket_server - INFO - Client ('127.0.0.1', 52831) disconnected
2025-06-26 11:27:22,512 - socket_server - INFO - New client connected from ('127.0.0.1', 52885)
2025-06-26 11:27:22,512 - socket_server - INFO - Received request from ('127.0.0.1', 52885): chat
2025-06-26 11:27:22,513 - __main__ - INFO - Processing message for conversation 11
2025-06-26 11:27:22,514 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:27:25,385 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:27:25,390 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:27:25,634 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:27:28,971 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:28,972 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:27:28,973 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:27:28,973 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 11:27:28,973 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 11:27:29,062 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 11:27:29,063 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:27:30,531 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:30,533 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:27:30,533 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:27:30,533 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 11:27:30,533 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'technical improvement initiatives summary'}
2025-06-26 11:27:31,056 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 11:27:31,056 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:27:44,596 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:44,598 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:27:44,598 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 11:27:44,599 - socket_server - INFO - Sent response to ('127.0.0.1', 52885): success
2025-06-26 11:28:52,520 - socket_server - INFO - Client ('127.0.0.1', 52885) closed connection
2025-06-26 11:28:52,520 - socket_server - INFO - Client ('127.0.0.1', 52885) disconnected
2025-06-26 11:42:22,045 - socket_server - INFO - New client connected from ('127.0.0.1', 53445)
2025-06-26 11:42:22,093 - socket_server - INFO - Received request from ('127.0.0.1', 53445): chat
2025-06-26 11:42:22,118 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:42:22,120 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:42:26,412 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:42:26,423 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:42:26,720 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:42:34,373 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:42:34,380 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:42:34,380 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:42:34,383 - socket_server - INFO - Sent response to ('127.0.0.1', 53445): success
2025-06-26 11:42:43,545 - socket_server - INFO - New client connected from ('127.0.0.1', 53475)
2025-06-26 11:42:43,545 - socket_server - INFO - Received request from ('127.0.0.1', 53475): chat
2025-06-26 11:42:43,546 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:42:43,547 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:42:46,570 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:42:46,574 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:42:46,886 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:42:50,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:42:50,152 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:42:50,152 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:42:50,153 - socket_server - INFO - Sent response to ('127.0.0.1', 53475): success
2025-06-26 11:43:51,977 - socket_server - INFO - Client ('127.0.0.1', 53445) closed connection
2025-06-26 11:43:51,978 - socket_server - INFO - Client ('127.0.0.1', 53445) disconnected
2025-06-26 11:44:13,558 - socket_server - INFO - Client ('127.0.0.1', 53475) closed connection
2025-06-26 11:44:13,558 - socket_server - INFO - Client ('127.0.0.1', 53475) disconnected
2025-06-26 11:46:04,920 - socket_server - INFO - New client connected from ('127.0.0.1', 53626)
2025-06-26 11:46:04,923 - socket_server - INFO - Received request from ('127.0.0.1', 53626): chat
2025-06-26 11:46:04,929 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:46:04,929 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:46:08,398 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:46:08,409 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:46:08,791 - socket_server - INFO - New client connected from ('127.0.0.1', 53635)
2025-06-26 11:46:08,792 - socket_server - INFO - Received request from ('127.0.0.1', 53635): chat
2025-06-26 11:46:08,793 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:46:08,793 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:46:08,815 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:46:08,846 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-64' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,866 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-65' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,875 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-66' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,883 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-67' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:11,589 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:46:11,594 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:46:11,771 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:46:11,773 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:46:11,774 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:46:11,774 - socket_server - INFO - Sent response to ('127.0.0.1', 53626): success
2025-06-26 11:46:11,926 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:46:27,524 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:46:27,526 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:46:27,527 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:46:27,527 - socket_server - INFO - Sent response to ('127.0.0.1', 53635): success
2025-06-26 11:47:34,917 - socket_server - INFO - Client ('127.0.0.1', 53626) closed connection
2025-06-26 11:47:34,918 - socket_server - INFO - Client ('127.0.0.1', 53626) disconnected
2025-06-26 11:47:38,797 - socket_server - INFO - Client ('127.0.0.1', 53635) closed connection
2025-06-26 11:47:38,797 - socket_server - INFO - Client ('127.0.0.1', 53635) disconnected
2025-06-26 12:11:11,432 - socket_server - INFO - New client connected from ('127.0.0.1', 54893)
2025-06-26 12:11:11,447 - socket_server - INFO - Received request from ('127.0.0.1', 54893): chat
2025-06-26 12:11:11,468 - __main__ - INFO - Processing message for conversation 11
2025-06-26 12:11:11,472 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:11:15,706 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:11:15,716 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:11:16,104 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:11:18,553 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:18,559 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:11:18,559 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:11:18,560 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 12:11:18,560 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 12:11:18,686 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 12:11:18,687 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:11:20,664 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:20,665 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:11:20,665 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:11:20,666 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 12:11:22,428 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 12:11:22,429 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:11:40,507 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:40,512 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:11:40,512 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 12:11:40,514 - socket_server - INFO - Sent response to ('127.0.0.1', 54893): success
2025-06-26 12:12:41,376 - socket_server - INFO - Client ('127.0.0.1', 54893) closed connection
2025-06-26 12:12:41,376 - socket_server - INFO - Client ('127.0.0.1', 54893) disconnected
2025-06-26 12:13:18,423 - socket_server - INFO - New client connected from ('127.0.0.1', 55013)
2025-06-26 12:13:18,423 - socket_server - INFO - Received request from ('127.0.0.1', 55013): chat
2025-06-26 12:13:18,424 - __main__ - INFO - Processing message for conversation 11
2025-06-26 12:13:18,425 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:13:21,724 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:13:21,729 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:13:22,074 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:13:24,460 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:24,462 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:13:24,462 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:13:24,462 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 12:13:24,462 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 12:13:24,564 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 12:13:24,564 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:13:26,347 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:26,348 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:13:26,348 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:13:26,348 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 12:13:26,929 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 12:13:26,929 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:13:34,276 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:34,277 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:13:34,277 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 12:13:34,278 - socket_server - INFO - Sent response to ('127.0.0.1', 55013): success
2025-06-26 12:13:54,707 - socket_server - INFO - New client connected from ('127.0.0.1', 55028)
2025-06-26 12:13:54,720 - socket_server - INFO - Received request from ('127.0.0.1', 55028): chat
2025-06-26 12:13:54,769 - __main__ - INFO - Processing message for conversation 12
2025-06-26 12:13:54,795 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:13:59,102 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:13:59,107 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:13:59,392 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:14:00,945 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:00,947 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:00,947 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:00,947 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 12:14:00,947 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 12:14:01,038 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 12:14:01,038 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:14:02,859 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:02,860 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:02,860 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:02,860 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 12:14:02,860 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 12:14:02,860 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 12:14:02,890 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 12:14:02,890 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:14:05,308 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:05,309 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:05,309 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:05,309 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 12:14:05,309 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 12:14:05,333 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 12:14:05,333 - __main__ - INFO - LLM iteration 4/10
2025-06-26 12:14:19,154 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:19,155 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:14:19,155 - __main__ - INFO - Generated final answer for conversation 12
2025-06-26 12:14:19,156 - socket_server - INFO - Sent response to ('127.0.0.1', 55028): success
2025-06-26 12:14:48,432 - socket_server - INFO - Client ('127.0.0.1', 55013) closed connection
2025-06-26 12:14:48,433 - socket_server - INFO - Client ('127.0.0.1', 55013) disconnected
2025-06-26 13:19:27,424 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:21:13,829 - socket_server - INFO - New client connected from ('127.0.0.1', 55972)
2025-06-26 13:21:13,848 - socket_server - INFO - Received request from ('127.0.0.1', 55972): chat
2025-06-26 13:21:13,926 - __main__ - INFO - Processing message for conversation 7
2025-06-26 13:21:13,931 - __main__ - INFO - New database context established: php3_wd19314
2025-06-26 13:21:13,931 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:21:24,195 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:21:24,201 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:21:24,516 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:21:27,672 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:27,691 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:27,692 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:27,692 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:21:27,692 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:21:27,692 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 13:21:28,235 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:21:28,235 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:21:30,331 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:30,332 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:30,332 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:30,332 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:21:30,332 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:21:30,333 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:21:30,459 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:21:30,459 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:21:32,549 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:32,550 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:32,550 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:32,550 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:21:32,550 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:21:32,569 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:21:32,569 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:22:10,718 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:10,719 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:22:10,720 - __main__ - INFO - Generated final answer for conversation 7
2025-06-26 13:22:10,721 - socket_server - INFO - Sent response to ('127.0.0.1', 55972): success
2025-06-26 13:22:36,405 - socket_server - INFO - New client connected from ('127.0.0.1', 55999)
2025-06-26 13:22:36,405 - socket_server - INFO - Received request from ('127.0.0.1', 55999): chat
2025-06-26 13:22:36,406 - __main__ - INFO - Processing message for conversation 10
2025-06-26 13:22:36,406 - __main__ - INFO - New database context established: php3_wd1931
2025-06-26 13:22:36,407 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:22:39,091 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:22:39,095 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:22:39,437 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:22:41,230 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:41,232 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:41,232 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:41,232 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:22:41,233 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd1931'}
2025-06-26 13:22:41,233 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd1931
2025-06-26 13:22:41,237 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:22:41,237 - __main__ - WARNING - Tool call returned error: 1049 (42000): Unknown database 'php3_wd1931'
2025-06-26 13:22:41,237 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:22:42,640 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:42,641 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:42,642 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:42,642 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:22:42,642 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:22:42,652 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:22:42,652 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:22:43,813 - socket_server - INFO - Client ('127.0.0.1', 55972) closed connection
2025-06-26 13:22:43,813 - socket_server - INFO - Client ('127.0.0.1', 55972) disconnected
2025-06-26 13:22:44,512 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:44,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:44,514 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:44,514 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:22:44,514 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:22:44,514 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:22:44,521 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:22:44,521 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:22:46,659 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:46,660 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:46,660 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:46,660 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:22:46,660 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:22:46,664 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:22:46,664 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:23:24,491 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:23:24,492 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:23:24,492 - __main__ - INFO - Generated final answer for conversation 10
2025-06-26 13:23:24,493 - socket_server - INFO - Sent response to ('127.0.0.1', 55999): success
2025-06-26 13:24:06,413 - socket_server - INFO - Client ('127.0.0.1', 55999) closed connection
2025-06-26 13:24:06,413 - socket_server - INFO - Client ('127.0.0.1', 55999) disconnected
2025-06-26 13:27:14,287 - socket_server - INFO - New client connected from ('127.0.0.1', 56091)
2025-06-26 13:27:14,289 - socket_server - INFO - Received request from ('127.0.0.1', 56091): chat
2025-06-26 13:27:14,296 - __main__ - INFO - Processing message for conversation 13
2025-06-26 13:27:14,298 - __main__ - INFO - New database context established: php3_wd1931
2025-06-26 13:27:14,298 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:27:17,792 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:27:17,799 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:27:18,122 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:27:20,919 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:20,922 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:20,922 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:20,922 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:27:20,923 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd1931'}
2025-06-26 13:27:20,923 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd1931
2025-06-26 13:27:20,963 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:27:20,963 - __main__ - WARNING - Tool call returned error: 1049 (42000): Unknown database 'php3_wd1931'
2025-06-26 13:27:20,963 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:27:22,103 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:22,104 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:22,104 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:22,104 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:27:22,104 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:27:22,123 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:27:22,123 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:27:23,833 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:23,834 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:23,834 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:23,834 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:27:23,835 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:27:23,835 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 13:27:23,847 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:27:23,847 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:27:27,576 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:27,577 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:27,577 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:27,577 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:27:27,577 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:27:27,578 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:27:27,588 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:27:27,588 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:27:29,919 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:29,920 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:29,920 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:29,920 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:27:29,921 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:27:29,926 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:27:29,927 - __main__ - INFO - LLM iteration 6/10
2025-06-26 13:27:29,935 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-13' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:28:33,461 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:28:33,462 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:28:33,462 - __main__ - INFO - Generated final answer for conversation 13
2025-06-26 13:28:33,463 - socket_server - INFO - Sent response to ('127.0.0.1', 56091): success
2025-06-26 13:28:44,293 - socket_server - INFO - Client ('127.0.0.1', 56091) closed connection
2025-06-26 13:28:44,293 - socket_server - INFO - Client ('127.0.0.1', 56091) disconnected
2025-06-26 13:31:12,385 - socket_server - INFO - Stopping server...
2025-06-26 13:31:12,385 - socket_server - INFO - Socket Server stopped
2025-06-26 13:31:12,386 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:31:12,386 - socket_server - INFO - Stopping server...
2025-06-26 13:31:12,386 - socket_server - INFO - Socket Server stopped
2025-06-26 13:31:17,296 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:31:45,479 - socket_server - INFO - New client connected from ('127.0.0.1', 56174)
2025-06-26 13:31:45,480 - socket_server - INFO - Received request from ('127.0.0.1', 56174): chat
2025-06-26 13:31:45,481 - __main__ - INFO - Processing message for conversation 14
2025-06-26 13:31:45,481 - __main__ - INFO - New database context established: php3_wd19314
2025-06-26 13:31:48,408 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:31:48,409 - __main__ - INFO - Refreshing tools cache
2025-06-26 13:31:48,413 - __main__ - INFO - Tools cache updated. Available tools: 6
2025-06-26 13:31:51,381 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:31:56,038 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:31:59,991 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:33:00,007 - __main__ - ERROR - LLM timeout
2025-06-26 13:33:00,007 - socket_server - INFO - Sent response to ('127.0.0.1', 56174): error
2025-06-26 13:33:15,408 - socket_server - INFO - Stopping server...
2025-06-26 13:33:15,408 - socket_server - INFO - Socket Server stopped
2025-06-26 13:33:15,408 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:33:15,410 - socket_server - INFO - Stopping server...
2025-06-26 13:33:15,410 - socket_server - INFO - Socket Server stopped
2025-06-26 13:33:15,457 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-2' coro=<Client._session_runner() running at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:316> wait_for=<Future finished result=True>>
2025-06-26 13:33:29,397 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:35:31,245 - socket_server - INFO - New client connected from ('127.0.0.1', 56329)
2025-06-26 13:35:31,246 - socket_server - INFO - Received request from ('127.0.0.1', 56329): chat
2025-06-26 13:35:31,250 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:35:31,251 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:35:34,610 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:35:34,615 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:35:34,902 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:35:44,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:35:44,764 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:35:44,764 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:35:44,765 - socket_server - INFO - Sent response to ('127.0.0.1', 56329): success
2025-06-26 13:36:39,223 - socket_server - INFO - New client connected from ('127.0.0.1', 56343)
2025-06-26 13:36:39,224 - socket_server - INFO - Received request from ('127.0.0.1', 56343): chat
2025-06-26 13:36:39,224 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:36:39,225 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:36:41,842 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:36:41,846 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:36:42,112 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:36:43,310 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:36:43,312 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:36:43,312 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:36:43,312 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 13:36:43,948 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 13:36:43,948 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:37:01,244 - socket_server - INFO - Client ('127.0.0.1', 56329) closed connection
2025-06-26 13:37:01,245 - socket_server - INFO - Client ('127.0.0.1', 56329) disconnected
2025-06-26 13:37:03,477 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:37:03,478 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:37:03,478 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:37:03,479 - socket_server - INFO - Sent response to ('127.0.0.1', 56343): success
2025-06-26 13:38:09,227 - socket_server - INFO - Client ('127.0.0.1', 56343) closed connection
2025-06-26 13:38:09,228 - socket_server - INFO - Client ('127.0.0.1', 56343) disconnected
2025-06-26 13:40:24,308 - socket_server - INFO - Stopping server...
2025-06-26 13:40:24,308 - socket_server - INFO - Socket Server stopped
2025-06-26 13:40:24,308 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:40:24,308 - socket_server - INFO - Stopping server...
2025-06-26 13:40:24,309 - socket_server - INFO - Socket Server stopped
2025-06-26 13:40:28,317 - __main__ - ERROR - Unexpected error in main: 'SocketServer' object has no attribute 'start_server'
2025-06-26 13:48:09,557 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:48:25,050 - socket_server - INFO - New client connected from ('127.0.0.1', 56529)
2025-06-26 13:48:25,051 - socket_server - INFO - Received request from ('127.0.0.1', 56529): chat
2025-06-26 13:48:25,052 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:48:25,053 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:48:27,906 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:48:27,911 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:48:28,296 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:48:41,963 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:41,965 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:41,965 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:41,966 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:48:41,966 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:48:42,211 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:48:42,212 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:48:43,951 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:43,952 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:43,952 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:43,952 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:48:43,952 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 13:48:43,952 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 13:48:43,962 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:48:43,962 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:48:46,311 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:46,312 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:46,312 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:46,312 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:48:46,312 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2023 AND (Month BETWEEN 1 AND 3) LIMIT 1;'}
2025-06-26 13:48:46,374 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:48:46,374 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Month' in 'where clause'
2025-06-26 13:48:46,374 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:48:48,246 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:48,247 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:48,247 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:48,248 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:48:48,248 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2023 LIMIT 1;'}
2025-06-26 13:48:48,254 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:48:48,254 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:48:52,678 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:52,679 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:48:52,680 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:48:52,680 - socket_server - INFO - Sent response to ('127.0.0.1', 56529): success
2025-06-26 13:49:22,986 - socket_server - INFO - New client connected from ('127.0.0.1', 56570)
2025-06-26 13:49:22,986 - socket_server - INFO - Received request from ('127.0.0.1', 56570): chat
2025-06-26 13:49:22,987 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:49:22,987 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:49:25,685 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:49:25,689 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:49:25,950 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:49:37,820 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:37,821 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:37,821 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:37,821 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:49:37,821 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:49:37,835 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:49:37,835 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:49:39,376 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:39,378 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:39,378 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:39,378 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:49:39,378 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 13:49:39,378 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 13:49:39,386 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:49:39,386 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:49:43,287 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:43,288 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:43,288 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:43,288 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:43,288 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND (MONTH(QuarterStartDate) IN (1, 2, 3)) OR (MONTH(QuarterEndDate) IN (1, 2, 3));'}
2025-06-26 13:49:43,296 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:43,296 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'QuarterStartDate' in 'where clause'
2025-06-26 13:49:43,297 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:49:48,366 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:48,368 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:48,368 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:48,368 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:48,368 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND Quarter IN ('Q1');"}
2025-06-26 13:49:48,370 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:48,370 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Quarter' in 'where clause'
2025-06-26 13:49:48,371 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:49:50,671 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:50,672 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:50,672 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:50,672 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:50,672 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND Quarter IN ('Q1');"}
2025-06-26 13:49:50,675 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:50,675 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Quarter' in 'where clause'
2025-06-26 13:49:50,675 - __main__ - INFO - LLM iteration 6/10
2025-06-26 13:49:54,012 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:54,013 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:54,013 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:54,013 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:54,013 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024;'}
2025-06-26 13:49:54,016 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:54,016 - __main__ - INFO - LLM iteration 7/10
2025-06-26 13:49:55,056 - socket_server - INFO - Client ('127.0.0.1', 56529) closed connection
2025-06-26 13:49:55,057 - socket_server - INFO - Client ('127.0.0.1', 56529) disconnected
2025-06-26 13:49:57,984 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:57,985 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:49:57,985 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:49:57,986 - socket_server - INFO - Sent response to ('127.0.0.1', 56570): success
2025-06-26 13:50:52,987 - socket_server - INFO - Client ('127.0.0.1', 56570) closed connection
2025-06-26 13:50:52,987 - socket_server - INFO - Client ('127.0.0.1', 56570) disconnected
2025-06-26 13:54:25,173 - socket_server - INFO - New client connected from ('127.0.0.1', 56656)
2025-06-26 13:54:25,174 - socket_server - INFO - Received request from ('127.0.0.1', 56656): chat
2025-06-26 13:54:25,175 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:54:25,175 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:54:27,863 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:54:27,867 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:54:28,117 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:54:31,005 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:54:31,007 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:54:31,007 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:54:31,007 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:54:31,008 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024;'}
2025-06-26 13:54:31,014 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:54:31,014 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:54:39,762 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:54:39,763 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:54:39,764 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:54:39,764 - socket_server - INFO - Sent response to ('127.0.0.1', 56656): success
2025-06-26 13:55:55,185 - socket_server - INFO - Client ('127.0.0.1', 56656) closed connection
2025-06-26 13:55:55,185 - socket_server - INFO - Client ('127.0.0.1', 56656) disconnected
2025-06-26 13:59:42,116 - socket_server - INFO - New client connected from ('127.0.0.1', 56751)
2025-06-26 13:59:42,116 - socket_server - INFO - Received request from ('127.0.0.1', 56751): chat
2025-06-26 13:59:42,117 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:59:42,117 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:59:45,194 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:59:45,199 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:59:45,215 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:59:45,221 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:59:45,475 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:59:47,122 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:47,123 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:59:47,123 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:59:47,123 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 13:59:47,123 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 13:59:47,258 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 13:59:47,258 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:59:50,399 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:50,400 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:59:50,400 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:59:50,401 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 13:59:50,958 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 13:59:50,958 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:59:59,949 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:59,950 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:59:59,950 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:59:59,951 - socket_server - INFO - Sent response to ('127.0.0.1', 56751): success
2025-06-26 14:01:12,127 - socket_server - INFO - Client ('127.0.0.1', 56751) closed connection
2025-06-26 14:01:12,127 - socket_server - INFO - Client ('127.0.0.1', 56751) disconnected
2025-06-26 14:15:24,674 - socket_server - INFO - New client connected from ('127.0.0.1', 56901)
2025-06-26 14:15:24,675 - socket_server - INFO - Received request from ('127.0.0.1', 56901): chat
2025-06-26 14:15:24,680 - __main__ - INFO - Processing message for conversation 16
2025-06-26 14:15:24,681 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:15:28,003 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:15:28,008 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:15:28,261 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:15:35,946 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:35,948 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:35,948 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:35,948 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:15:35,949 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:15:36,016 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:15:36,017 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:15:38,488 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:38,489 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:38,489 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:38,490 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:15:38,490 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:15:38,490 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:15:38,507 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:15:38,507 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:15:41,642 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:41,643 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:41,643 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:41,643 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:15:41,643 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue FROM hoaphat2024.financial_performance ORDER BY Year;'}
2025-06-26 14:15:41,647 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:15:41,648 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:15:53,591 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:53,593 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:15:53,593 - __main__ - INFO - Generated final answer for conversation 16
2025-06-26 14:15:53,594 - socket_server - INFO - Sent response to ('127.0.0.1', 56901): success
2025-06-26 14:16:54,672 - socket_server - INFO - Client ('127.0.0.1', 56901) closed connection
2025-06-26 14:16:54,672 - socket_server - INFO - Client ('127.0.0.1', 56901) disconnected
2025-06-26 14:19:39,207 - socket_server - INFO - New client connected from ('127.0.0.1', 56986)
2025-06-26 14:19:39,207 - socket_server - INFO - Received request from ('127.0.0.1', 56986): chat
2025-06-26 14:19:39,209 - __main__ - INFO - Processing message for conversation 17
2025-06-26 14:19:39,210 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:19:41,972 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:19:41,976 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:19:42,277 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:19:56,743 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:19:56,744 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:19:56,744 - __main__ - INFO - Generated final answer for conversation 17
2025-06-26 14:19:56,746 - socket_server - INFO - Sent response to ('127.0.0.1', 56986): success
2025-06-26 14:21:09,217 - socket_server - INFO - Client ('127.0.0.1', 56986) closed connection
2025-06-26 14:21:09,217 - socket_server - INFO - Client ('127.0.0.1', 56986) disconnected
2025-06-26 14:21:43,938 - socket_server - INFO - New client connected from ('127.0.0.1', 57032)
2025-06-26 14:21:43,939 - socket_server - INFO - Received request from ('127.0.0.1', 57032): chat
2025-06-26 14:21:43,940 - __main__ - INFO - Processing message for conversation 18
2025-06-26 14:21:43,940 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:21:46,629 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:21:46,633 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:21:46,879 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:21:52,942 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:21:52,943 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:21:52,943 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:21:52,943 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 14:21:52,944 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 14:21:53,066 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 14:21:53,066 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:21:54,493 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:21:54,494 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:21:54,494 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:21:54,494 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:21:55,092 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:21:55,092 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:22:15,097 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:22:15,099 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:22:15,099 - __main__ - INFO - Generated final answer for conversation 18
2025-06-26 14:22:15,099 - socket_server - INFO - Sent response to ('127.0.0.1', 57032): success
2025-06-26 14:23:13,944 - socket_server - INFO - Client ('127.0.0.1', 57032) closed connection
2025-06-26 14:23:13,944 - socket_server - INFO - Client ('127.0.0.1', 57032) disconnected
2025-06-26 14:28:20,362 - socket_server - INFO - New client connected from ('127.0.0.1', 57146)
2025-06-26 14:28:20,363 - socket_server - INFO - Received request from ('127.0.0.1', 57146): chat
2025-06-26 14:28:20,364 - __main__ - INFO - Processing message for conversation 19
2025-06-26 14:28:20,365 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:28:23,711 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:28:23,716 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:28:24,074 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:28:24,098 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-35' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,117 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-36' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,124 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-37' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,130 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-38' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:25,407 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:25,409 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:25,409 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:25,409 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:28:25,409 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:28:25,457 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:28:25,457 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:28:27,546 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:27,547 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:27,547 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:27,547 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:28:27,547 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:28:27,548 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:28:27,556 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:28:27,556 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:28:29,853 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:29,854 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:29,854 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:29,854 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:28:29,854 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.products ORDER BY Price DESC LIMIT 20;'}
2025-06-26 14:28:29,876 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:28:29,877 - __main__ - WARNING - Tool call returned error: 1146 (42S02): Table 'hoaphat2024.products' doesn't exist
2025-06-26 14:28:29,877 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:28:33,295 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:33,296 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:28:33,296 - __main__ - INFO - Generated final answer for conversation 19
2025-06-26 14:28:33,297 - socket_server - INFO - Sent response to ('127.0.0.1', 57146): success
2025-06-26 14:29:50,366 - socket_server - INFO - Client ('127.0.0.1', 57146) closed connection
2025-06-26 14:29:50,366 - socket_server - INFO - Client ('127.0.0.1', 57146) disconnected
2025-06-26 14:30:17,964 - socket_server - INFO - New client connected from ('127.0.0.1', 57196)
2025-06-26 14:30:17,964 - socket_server - INFO - Received request from ('127.0.0.1', 57196): chat
2025-06-26 14:30:17,965 - __main__ - INFO - Processing message for conversation 20
2025-06-26 14:30:17,965 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:30:21,175 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:30:21,179 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:30:21,471 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:30:29,662 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:30:29,664 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:30:29,664 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:30:29,664 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:30:30,643 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:30:30,647 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:30:44,130 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:30:44,132 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:30:44,132 - __main__ - INFO - Generated final answer for conversation 20
2025-06-26 14:30:44,132 - socket_server - INFO - Sent response to ('127.0.0.1', 57196): success
2025-06-26 14:31:47,966 - socket_server - INFO - Client ('127.0.0.1', 57196) closed connection
2025-06-26 14:31:47,966 - socket_server - INFO - Client ('127.0.0.1', 57196) disconnected
2025-06-26 14:32:00,807 - socket_server - INFO - Stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Socket Server stopped
2025-06-26 14:32:00,809 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Socket Server stopped
2025-06-26 14:33:33,968 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:33:55,654 - socket_server - INFO - New client connected from ('127.0.0.1', 57272)
2025-06-26 14:33:55,654 - socket_server - INFO - Received request from ('127.0.0.1', 57272): chat
2025-06-26 14:33:55,658 - __main__ - INFO - Processing message for conversation 21
2025-06-26 14:33:55,658 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:33:59,020 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:33:59,026 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:33:59,314 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 14:33:59,314 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:33:59,315 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:34:01,098 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:01,102 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:01,102 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:01,102 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:34:01,102 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:34:01,193 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:34:01,194 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:34:02,783 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:02,784 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:02,784 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:02,784 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:34:02,784 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:34:02,784 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:34:02,807 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:34:02,807 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:34:04,610 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:04,612 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:04,612 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:04,613 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:34:04,613 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:34:04,613 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:34:04,638 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:34:04,639 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:34:06,825 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:06,826 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:06,826 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:06,827 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:34:06,827 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue, NetRevenue, GrossProfit, NetProfit FROM hoaphat2024.financial_performance ORDER BY Year;'}
2025-06-26 14:34:06,837 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:34:06,837 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:34:22,853 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:22,854 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:34:22,855 - __main__ - INFO - Generated final answer for conversation 21
2025-06-26 14:34:22,859 - socket_server - INFO - Sent response to ('127.0.0.1', 57272): success
2025-06-26 14:34:34,999 - socket_server - INFO - Stopping server...
2025-06-26 14:34:34,999 - socket_server - INFO - Socket Server stopped
2025-06-26 14:34:35,000 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:34:35,000 - socket_server - INFO - Stopping server...
2025-06-26 14:34:35,000 - socket_server - INFO - Socket Server stopped
2025-06-26 14:34:41,964 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:35:03,886 - socket_server - INFO - New client connected from ('127.0.0.1', 57312)
2025-06-26 14:35:03,886 - socket_server - INFO - Received request from ('127.0.0.1', 57312): chat
2025-06-26 14:35:03,888 - __main__ - INFO - Processing message for conversation 22
2025-06-26 14:35:03,888 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:35:06,838 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:35:06,843 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:35:07,263 - __main__ - INFO - User message: phân tích doanh thu hòa phát qua các năm
2025-06-26 14:35:07,263 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:35:07,264 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:35:09,138 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:09,140 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:09,141 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:09,141 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:35:09,141 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:35:09,148 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:35:09,148 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:35:11,089 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:11,090 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:11,090 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:11,090 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:35:11,090 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:35:11,091 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:35:11,097 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:35:11,097 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:35:13,354 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:13,355 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:13,355 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:13,355 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:35:13,355 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:35:13,355 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:35:13,363 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:35:13,363 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:35:15,336 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:15,337 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:15,338 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:15,338 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:35:15,338 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue FROM hoaphat2024.financial_performance ORDER BY Year'}
2025-06-26 14:35:15,343 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:35:15,344 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:35:31,752 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:31,753 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:35:31,753 - __main__ - INFO - Generated final answer for conversation 22
2025-06-26 14:35:31,757 - socket_server - INFO - Sent response to ('127.0.0.1', 57312): success
2025-06-26 14:36:33,886 - socket_server - INFO - Client ('127.0.0.1', 57312) closed connection
2025-06-26 14:36:33,887 - socket_server - INFO - Client ('127.0.0.1', 57312) disconnected
2025-06-26 14:38:12,305 - socket_server - INFO - Stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Socket Server stopped
2025-06-26 14:38:12,306 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Socket Server stopped
2025-06-26 14:39:13,599 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:39:25,291 - socket_server - INFO - New client connected from ('127.0.0.1', 57408)
2025-06-26 14:39:25,292 - socket_server - INFO - Received request from ('127.0.0.1', 57408): chat
2025-06-26 14:39:25,293 - __main__ - INFO - Processing message for conversation 23
2025-06-26 14:39:25,294 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:39:28,048 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:39:28,054 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:39:28,333 - __main__ - INFO - User message: phân tích doanh thu hòa phát năm 2023
2025-06-26 14:39:28,334 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:39:28,334 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:39:31,280 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:31,284 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:31,284 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:31,284 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:39:31,284 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:39:31,297 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:39:31,297 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:39:33,465 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:33,466 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:33,466 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:33,466 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:39:33,466 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:39:33,467 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:39:33,473 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:39:33,473 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:39:35,478 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:35,479 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:35,480 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:35,480 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:39:35,480 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:39:35,480 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:39:35,489 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:39:35,489 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:39:37,610 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:37,611 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:37,612 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:37,612 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:39:37,612 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance WHERE Year = 2023'}
2025-06-26 14:39:37,620 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:39:37,620 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:39:55,748 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:55,749 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:39:55,749 - __main__ - INFO - Generated final answer for conversation 23
2025-06-26 14:39:55,754 - socket_server - INFO - Sent response to ('127.0.0.1', 57408): success
2025-06-26 14:40:55,292 - socket_server - INFO - Client ('127.0.0.1', 57408) closed connection
2025-06-26 14:40:55,293 - socket_server - INFO - Client ('127.0.0.1', 57408) disconnected
2025-06-26 14:56:06,123 - socket_server - INFO - Stopping server...
2025-06-26 14:56:06,125 - socket_server - INFO - Socket Server stopped
2025-06-26 14:56:06,126 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:56:06,127 - socket_server - INFO - Stopping server...
2025-06-26 14:56:06,127 - socket_server - INFO - Socket Server stopped
2025-06-26 14:56:11,726 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:56:21,097 - socket_server - INFO - New client connected from ('127.0.0.1', 57597)
2025-06-26 14:56:21,098 - socket_server - INFO - Received request from ('127.0.0.1', 57597): chat
2025-06-26 14:56:21,099 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:56:21,099 - __main__ - INFO - New context established: rag:general
2025-06-26 14:56:21,100 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:56:24,461 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:56:24,466 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:56:24,772 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 14:56:24,772 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:56:24,772 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:56:26,965 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:56:26,967 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:56:26,967 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:56:26,968 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:56:26,968 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 14:56:27,609 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:56:27,609 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:56:41,485 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:56:41,486 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:56:41,487 - __main__ - INFO - Generated final answer for conversation 24
2025-06-26 14:56:41,490 - socket_server - INFO - Sent response to ('127.0.0.1', 57597): success
2025-06-26 14:57:20,736 - socket_server - INFO - New client connected from ('127.0.0.1', 57608)
2025-06-26 14:57:20,736 - socket_server - INFO - Received request from ('127.0.0.1', 57608): chat
2025-06-26 14:57:20,737 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:57:20,738 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:57:23,437 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:57:23,441 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:57:23,689 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 14:57:23,689 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:57:23,689 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:57:28,050 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:28,051 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:28,051 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:28,051 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:57:28,051 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 14:57:28,052 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 14:57:28,069 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:57:28,069 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:57:29,798 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:29,799 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:29,799 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:29,799 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:57:29,799 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 14:57:29,799 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 14:57:29,808 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:57:29,808 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:57:32,397 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:32,398 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:32,398 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:32,398 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:57:32,398 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `php3_wd19314`.`products` LIMIT 20;'}
2025-06-26 14:57:32,407 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:57:32,407 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:57:51,094 - socket_server - INFO - Client ('127.0.0.1', 57597) closed connection
2025-06-26 14:57:51,094 - socket_server - INFO - Client ('127.0.0.1', 57597) disconnected
2025-06-26 14:58:58,253 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:58:58,254 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:58:58,254 - __main__ - INFO - Generated final answer for conversation 24
2025-06-26 14:58:58,258 - socket_server - INFO - Sent response to ('127.0.0.1', 57608): success
2025-06-26 14:58:58,258 - socket_server - ERROR - Error handling client ('127.0.0.1', 57608): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 14:58:58,259 - socket_server - INFO - Client ('127.0.0.1', 57608) disconnected
2025-06-26 14:59:54,824 - socket_server - INFO - New client connected from ('127.0.0.1', 57648)
2025-06-26 14:59:54,825 - socket_server - INFO - Received request from ('127.0.0.1', 57648): chat
2025-06-26 14:59:54,826 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:59:54,826 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:59:57,804 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:59:57,810 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:59:58,079 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 14:59:58,079 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:59:58,079 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:00:35,172 - socket_server - INFO - Stopping server...
2025-06-26 15:00:35,172 - socket_server - INFO - Socket Server stopped
2025-06-26 15:00:35,173 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:00:35,173 - socket_server - INFO - Stopping server...
2025-06-26 15:00:35,173 - socket_server - INFO - Socket Server stopped
2025-06-26 15:01:26,741 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:01:44,739 - socket_server - INFO - New client connected from ('127.0.0.1', 57697)
2025-06-26 15:01:44,740 - socket_server - INFO - Received request from ('127.0.0.1', 57697): chat
2025-06-26 15:01:44,741 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:01:44,741 - __main__ - INFO - New context established: rag:general
2025-06-26 15:01:44,741 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:01:47,473 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:01:47,477 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:01:47,772 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:01:47,772 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:01:47,772 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:01:49,842 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:01:49,844 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:01:49,844 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:01:49,845 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:01:49,845 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:01:50,359 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:01:50,359 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:02:06,823 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:02:06,824 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:02:06,824 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:02:06,829 - socket_server - INFO - Sent response to ('127.0.0.1', 57697): success
2025-06-26 15:02:57,238 - socket_server - INFO - New client connected from ('127.0.0.1', 57714)
2025-06-26 15:02:57,238 - socket_server - INFO - Received request from ('127.0.0.1', 57714): chat
2025-06-26 15:02:57,239 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:02:57,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:02:59,868 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:02:59,873 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:03:00,129 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:03:00,129 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:03:00,129 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:03:02,167 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:02,167 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:02,168 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:02,168 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:03:02,168 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:03:03,818 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:03,819 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:03,819 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:03,819 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:03:03,819 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:03,820 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:03:03,820 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:03,820 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:03:05,117 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:05,118 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:05,118 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:05,119 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 15:03:05,119 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:03:06,262 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:06,263 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:06,263 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:06,263 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 15:03:06,264 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 15:03:06,278 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 15:03:06,279 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:03:09,366 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:09,367 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:09,367 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:09,367 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:03:09,367 - __main__ - INFO - LLM iteration 6/10
2025-06-26 15:03:11,211 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:11,212 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:11,212 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:11,212 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:03:11,212 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:11,212 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:03:11,212 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:11,212 - __main__ - INFO - LLM iteration 7/10
2025-06-26 15:03:13,023 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:13,024 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:13,025 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:13,025 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 15:03:13,025 - __main__ - INFO - LLM iteration 8/10
2025-06-26 15:03:14,744 - socket_server - INFO - Client ('127.0.0.1', 57697) closed connection
2025-06-26 15:03:14,745 - socket_server - INFO - Client ('127.0.0.1', 57697) disconnected
2025-06-26 15:03:14,846 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:14,847 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:14,847 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:14,847 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 15:03:14,848 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:14,848 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/schema/{db_name*}: name 're' is not defined
2025-06-26 15:03:14,848 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:14,848 - __main__ - INFO - LLM iteration 9/10
2025-06-26 15:03:16,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:16,564 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:16,564 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:16,564 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:03:16,565 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:03:16,571 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:03:16,571 - __main__ - INFO - LLM iteration 10/10
2025-06-26 15:04:14,014 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:04:14,015 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:04:14,015 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:04:14,018 - socket_server - INFO - Sent response to ('127.0.0.1', 57714): success
2025-06-26 15:04:27,248 - socket_server - INFO - Client ('127.0.0.1', 57714) closed connection
2025-06-26 15:04:27,249 - socket_server - INFO - Client ('127.0.0.1', 57714) disconnected
2025-06-26 15:05:10,354 - socket_server - INFO - New client connected from ('127.0.0.1', 57747)
2025-06-26 15:05:10,354 - socket_server - INFO - Received request from ('127.0.0.1', 57747): chat
2025-06-26 15:05:10,355 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:05:10,355 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:05:13,118 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:05:13,122 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:05:13,380 - __main__ - INFO - User message: doanh thu quý 1 là bao nhiêu
2025-06-26 15:05:13,380 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:05:13,380 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:05:13,448 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-13' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:05:15,441 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:05:15,442 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:05:15,442 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:05:15,442 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:05:15,443 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu quý 1 là bao nhiêu'}
2025-06-26 15:05:16,086 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:05:16,086 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:05:24,738 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:05:24,739 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:05:24,739 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:05:24,743 - socket_server - INFO - Sent response to ('127.0.0.1', 57747): success
2025-06-26 15:06:40,366 - socket_server - INFO - Client ('127.0.0.1', 57747) closed connection
2025-06-26 15:06:40,367 - socket_server - INFO - Client ('127.0.0.1', 57747) disconnected
2025-06-26 15:20:18,507 - socket_server - INFO - New client connected from ('127.0.0.1', 57938)
2025-06-26 15:20:18,509 - socket_server - INFO - Received request from ('127.0.0.1', 57938): chat
2025-06-26 15:20:18,514 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:20:18,515 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:20:22,389 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:20:22,399 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:20:22,701 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:20:22,701 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:20:22,701 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:21:13,505 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:21:13,508 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:21:13,508 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:21:13,512 - socket_server - INFO - Sent response to ('127.0.0.1', 57938): success
2025-06-26 15:21:48,512 - socket_server - INFO - Client ('127.0.0.1', 57938) closed connection
2025-06-26 15:21:48,512 - socket_server - INFO - Client ('127.0.0.1', 57938) disconnected
2025-06-26 15:23:13,368 - socket_server - INFO - New client connected from ('127.0.0.1', 58018)
2025-06-26 15:23:13,368 - socket_server - INFO - Received request from ('127.0.0.1', 58018): chat
2025-06-26 15:23:13,369 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:23:13,369 - __main__ - INFO - New context established: rag:general
2025-06-26 15:23:13,370 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:23:16,060 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:23:16,065 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:23:16,314 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:23:16,314 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:23:16,314 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:23:18,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:23:18,017 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:23:18,017 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:23:18,017 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:23:18,018 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:23:18,734 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:23:18,734 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:23:34,750 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:23:34,752 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:23:34,752 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:23:34,755 - socket_server - INFO - Sent response to ('127.0.0.1', 58018): success
2025-06-26 15:24:03,667 - socket_server - INFO - New client connected from ('127.0.0.1', 58042)
2025-06-26 15:24:03,667 - socket_server - INFO - Received request from ('127.0.0.1', 58042): chat
2025-06-26 15:24:03,668 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:24:03,668 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:24:06,328 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:24:06,332 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:24:06,581 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:24:06,581 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:24:06,581 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:24:08,513 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:08,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:08,515 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:08,515 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:08,515 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:24:10,023 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:10,024 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:10,024 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:10,024 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 15:24:10,024 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:24:12,405 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:12,406 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:12,406 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:12,406 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:12,406 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:24:20,282 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:20,283 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:20,284 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:20,284 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:20,284 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:24:26,800 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:26,801 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:24:26,801 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:24:26,804 - socket_server - INFO - Sent response to ('127.0.0.1', 58042): success
2025-06-26 15:24:43,369 - socket_server - INFO - Client ('127.0.0.1', 58018) closed connection
2025-06-26 15:24:43,370 - socket_server - INFO - Client ('127.0.0.1', 58018) disconnected
2025-06-26 15:25:33,675 - socket_server - INFO - Client ('127.0.0.1', 58042) closed connection
2025-06-26 15:25:33,676 - socket_server - INFO - Client ('127.0.0.1', 58042) disconnected
2025-06-26 15:27:12,641 - socket_server - INFO - New client connected from ('127.0.0.1', 58088)
2025-06-26 15:27:12,641 - socket_server - INFO - Received request from ('127.0.0.1', 58088): chat
2025-06-26 15:27:12,642 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:27:12,642 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:27:15,318 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:27:15,322 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:27:15,579 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:27:15,579 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:27:15,580 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:27:15,589 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-30' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:15,593 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-31' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:15,597 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-32' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:17,710 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:17,711 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:17,711 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:17,711 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:27:17,711 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:27:19,843 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:19,843 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:19,843 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:19,844 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:27:19,844 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT table_name FROM information_schema.tables WHERE table_schema = 'php3_wd19314' LIMIT 20;"}
2025-06-26 15:27:19,896 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:27:19,896 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:27:21,813 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:21,814 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:21,814 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:21,815 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:27:21,815 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:27:21,821 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:27:21,822 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:28:01,194 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:28:01,195 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:28:01,196 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:28:01,199 - socket_server - INFO - Sent response to ('127.0.0.1', 58088): success
2025-06-26 15:28:42,653 - socket_server - INFO - Client ('127.0.0.1', 58088) closed connection
2025-06-26 15:28:42,654 - socket_server - INFO - Client ('127.0.0.1', 58088) disconnected
2025-06-26 15:30:51,820 - socket_server - INFO - Stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Socket Server stopped
2025-06-26 15:30:51,821 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Socket Server stopped
2025-06-26 15:30:58,081 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:31:11,817 - socket_server - INFO - New client connected from ('127.0.0.1', 58148)
2025-06-26 15:31:11,817 - socket_server - INFO - Received request from ('127.0.0.1', 58148): chat
2025-06-26 15:31:11,818 - __main__ - INFO - Processing message for conversation 27
2025-06-26 15:31:11,818 - __main__ - INFO - New context established: rag:general
2025-06-26 15:31:11,819 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:31:14,419 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:31:14,422 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:31:14,716 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:31:14,716 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:31:14,716 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:31:17,139 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:17,141 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:17,141 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:17,141 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:31:17,141 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:31:17,704 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:31:17,704 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:31:39,126 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:39,127 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:31:39,127 - __main__ - INFO - Generated final answer for conversation 27
2025-06-26 15:31:39,131 - socket_server - INFO - Sent response to ('127.0.0.1', 58148): success
2025-06-26 15:31:46,904 - socket_server - INFO - New client connected from ('127.0.0.1', 58160)
2025-06-26 15:31:46,905 - socket_server - INFO - Received request from ('127.0.0.1', 58160): chat
2025-06-26 15:31:46,906 - __main__ - INFO - Processing message for conversation 27
2025-06-26 15:31:46,907 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:31:49,567 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:31:49,570 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:31:49,827 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:31:49,827 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:31:49,827 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:31:53,308 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:53,309 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:53,309 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:53,309 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:31:53,309 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:31:58,634 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:58,635 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:58,635 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:58,635 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:31:58,635 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:31:58,635 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:31:58,635 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:31:58,636 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:32:00,519 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:32:00,520 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:32:00,520 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:32:00,521 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:32:00,521 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:32:00,521 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:32:00,521 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:32:00,521 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:32:07,670 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:32:07,671 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:32:07,671 - __main__ - INFO - Generated final answer for conversation 27
2025-06-26 15:32:07,675 - socket_server - INFO - Sent response to ('127.0.0.1', 58160): success
2025-06-26 15:32:35,299 - socket_server - INFO - Stopping server...
2025-06-26 15:32:35,299 - socket_server - INFO - Socket Server stopped
2025-06-26 15:32:35,300 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:32:35,300 - socket_server - INFO - Stopping server...
2025-06-26 15:32:35,300 - socket_server - INFO - Socket Server stopped
2025-06-26 15:32:41,742 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:32:58,180 - socket_server - INFO - New client connected from ('127.0.0.1', 58183)
2025-06-26 15:32:58,181 - socket_server - INFO - Received request from ('127.0.0.1', 58183): chat
2025-06-26 15:32:58,182 - __main__ - INFO - Processing message for conversation 28
2025-06-26 15:32:58,182 - __main__ - INFO - New context established: rag:general
2025-06-26 15:32:58,182 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:33:00,778 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:33:00,782 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:33:01,131 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:33:01,131 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:33:01,131 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:33:02,955 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:02,957 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:02,958 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:02,958 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:33:02,958 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:33:03,454 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:33:03,454 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:33:23,948 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:23,949 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:33:23,949 - __main__ - INFO - Generated final answer for conversation 28
2025-06-26 15:33:23,953 - socket_server - INFO - Sent response to ('127.0.0.1', 58183): success
2025-06-26 15:33:36,457 - socket_server - INFO - New client connected from ('127.0.0.1', 58213)
2025-06-26 15:33:36,457 - socket_server - INFO - Received request from ('127.0.0.1', 58213): chat
2025-06-26 15:33:36,458 - __main__ - INFO - Processing message for conversation 28
2025-06-26 15:33:36,458 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:33:39,086 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:33:39,090 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:33:39,340 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:33:39,340 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:33:39,340 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:33:41,756 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:41,757 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:41,757 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:41,757 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:33:41,757 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:33:48,432 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:48,433 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:48,433 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:48,433 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 15:33:48,434 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 15:33:48,456 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 15:33:48,457 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:33:50,605 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:50,606 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:50,606 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:50,606 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:33:50,606 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:33:52,983 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:52,984 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:52,984 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:52,984 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 15:33:52,985 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:33:54,785 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:54,785 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:54,786 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:54,786 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:33:54,786 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:33:54,790 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:33:54,790 - __main__ - INFO - LLM iteration 6/10
2025-06-26 15:34:28,178 - socket_server - INFO - Client ('127.0.0.1', 58183) closed connection
2025-06-26 15:34:28,179 - socket_server - INFO - Client ('127.0.0.1', 58183) disconnected
2025-06-26 15:35:06,372 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:35:06,373 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:35:06,373 - __main__ - INFO - Generated final answer for conversation 28
2025-06-26 15:35:06,376 - socket_server - INFO - Sent response to ('127.0.0.1', 58213): success
2025-06-26 15:35:06,468 - socket_server - INFO - Client ('127.0.0.1', 58213) closed connection
2025-06-26 15:35:06,469 - socket_server - INFO - Client ('127.0.0.1', 58213) disconnected
2025-06-26 15:39:20,856 - socket_server - INFO - New client connected from ('127.0.0.1', 58309)
2025-06-26 15:39:20,857 - socket_server - INFO - Received request from ('127.0.0.1', 58309): chat
2025-06-26 15:39:20,858 - __main__ - INFO - Processing message for conversation 29
2025-06-26 15:39:20,858 - __main__ - INFO - New context established: rag:general
2025-06-26 15:39:20,858 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:39:23,531 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:39:23,534 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:39:23,789 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:39:23,789 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:39:23,789 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:39:25,549 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:39:25,550 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:39:25,550 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:39:25,550 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:39:25,551 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:39:26,130 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:39:26,131 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:39:38,348 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:39:38,350 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:39:38,350 - __main__ - INFO - Generated final answer for conversation 29
2025-06-26 15:39:38,354 - socket_server - INFO - Sent response to ('127.0.0.1', 58309): success
2025-06-26 15:40:25,314 - socket_server - INFO - New client connected from ('127.0.0.1', 58349)
2025-06-26 15:40:25,315 - socket_server - INFO - Received request from ('127.0.0.1', 58349): chat
2025-06-26 15:40:25,315 - __main__ - INFO - Processing message for conversation 30
2025-06-26 15:40:25,315 - __main__ - INFO - New context established: rag:general
2025-06-26 15:40:25,316 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:40:28,019 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:40:28,022 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:40:28,266 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:40:28,266 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT:40:52,033 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:52,033 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:40:52,033 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:40:54,385 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:54,386 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:40:54,386 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:54,386 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:40:54,386 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:40:54,392 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:40:54,392 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:41:55,321 - socket_server - INFO - Client ('127.0.0.1', 58349) closed connection
2025-06-26 15:41:55,322 - socket_server - INFO - Client ('127.0.0.1', 58349) disconnected
2025-06-26 15:42:07,581 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:42:07,583 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:42:07,583 - __main__ - INFO - Generated final answer for conversation 30
2025-06-26 15:42:07,586 - socket_server - INFO - Sent response to ('127.0.0.1', 58361): success
2025-06-26 15:42:17,040 - socket_server - INFO - Client ('127.0.0.1', 58361) closed connection
2025-06-26 15:42:17,041 - socket_server - INFO - Client ('127.0.0.1', 58361) disconnected You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:40:28,267 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:40:28,269 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:40:28,279 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:40:30,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:30,017 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:40:30,017 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:30,017 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:40:30,017 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:40:30,571 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:40:30,571 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:40:43,467 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:43,468 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:40:43,468 - __main__ - INFO - Generated final answer for conversation 30
2025-06-26 15:40:43,472 - socket_server - INFO - Sent response to ('127.0.0.1', 58349): success
2025-06-26 15:40:47,029 - socket_server - INFO - New client connected from ('127.0.0.1', 58361)
2025-06-26 15:40:47,029 - socket_server - INFO - Received request from ('127.0.0.1', 58361): chat
2025-06-26 15:40:47,030 - __main__ - INFO - Processing message for conversation 30
2025-06-26 15:40:47,030 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:40:49,719 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:40:49,722 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:40:49,966 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:40:49,966 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:40:49,966 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:40:50,864 - socket_server - INFO - Client ('127.0.0.1', 58309) closed connection
2025-06-26 15:40:50,864 - socket_server - INFO - Client ('127.0.0.1', 58309) disconnected
2025-06-26 15:40:52,032 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:52,033 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:
2025-06-26 15:52:33,691 - socket_server - INFO - Stopping server...
2025-06-26 15:52:33,693 - socket_server - INFO - Socket Server stopped
2025-06-26 15:52:33,694 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:52:33,694 - socket_server - INFO - Stopping server...
2025-06-26 15:52:33,694 - socket_server - INFO - Socket Server stopped
2025-06-26 15:52:39,067 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:53:01,237 - socket_server - INFO - New client connected from ('127.0.0.1', 58618)
2025-06-26 15:53:01,238 - socket_server - INFO - Received request from ('127.0.0.1', 58618): chat
2025-06-26 15:53:01,239 - __main__ - INFO - Processing message for conversation 31
2025-06-26 15:53:01,239 - __main__ - INFO - New context established: rag:general
2025-06-26 15:53:01,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:53:03,843 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:53:03,847 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:53:04,204 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:53:04,204 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:53:04,204 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:53:06,700 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:06,702 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:06,702 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:06,702 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:53:06,703 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:53:07,288 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:53:07,288 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:53:24,000 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:24,001 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:53:24,002 - __main__ - INFO - Generated final answer for conversation 31
2025-06-26 15:53:24,006 - socket_server - INFO - Sent response to ('127.0.0.1', 58618): success
2025-06-26 15:53:28,857 - socket_server - INFO - New client connected from ('127.0.0.1', 58630)
2025-06-26 15:53:28,858 - socket_server - INFO - Received request from ('127.0.0.1', 58630): chat
2025-06-26 15:53:28,859 - __main__ - INFO - Processing message for conversation 31
2025-06-26 15:53:28,859 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:53:31,478 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:53:31,482 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:53:31,727 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:53:31,727 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:53:31,727 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:53:34,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:34,152 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:34,152 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:34,152 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:53:34,152 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:53:37,803 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:37,804 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:37,804 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:37,804 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:53:37,805 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:53:37,855 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:53:37,855 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:54:24,013 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 58618)
2025-06-26 15:54:24,013 - socket_server - INFO - Client ('127.0.0.1', 58618) disconnected
2025-06-26 15:54:47,550 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:54:47,551 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:54:47,551 - __main__ - INFO - Generated final answer for conversation 31
2025-06-26 15:54:47,555 - socket_server - INFO - Sent response to ('127.0.0.1', 58630): success
2025-06-26 15:54:58,858 - socket_server - INFO - Client ('127.0.0.1', 58630) closed connection
2025-06-26 15:54:58,858 - socket_server - INFO - Client ('127.0.0.1', 58630) disconnected
2025-06-26 16:01:18,823 - socket_server - INFO - New client connected from ('127.0.0.1', 58726)
2025-06-26 16:01:18,823 - socket_server - INFO - Received request from ('127.0.0.1', 58726): chat
2025-06-26 16:01:18,824 - __main__ - INFO - Processing message for conversation 32
2025-06-26 16:01:18,824 - __main__ - INFO - New context established: rag:general
2025-06-26 16:01:18,825 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:01:21,526 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:01:21,530 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:01:21,780 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 16:01:21,780 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:01:21,780 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:01:23,510 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:23,511 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:23,512 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:23,512 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:01:23,512 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 16:01:24,072 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:01:24,072 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:01:36,742 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:36,743 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:01:36,743 - __main__ - INFO - Generated final answer for conversation 32
2025-06-26 16:01:36,746 - socket_server - INFO - Sent response to ('127.0.0.1', 58726): success
2025-06-26 16:01:41,705 - socket_server - INFO - New client connected from ('127.0.0.1', 58755)
2025-06-26 16:01:41,705 - socket_server - INFO - Received request from ('127.0.0.1', 58755): chat
2025-06-26 16:01:41,707 - __main__ - INFO - Processing message for conversation 32
2025-06-26 16:01:41,707 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:01:44,330 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:01:44,334 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:01:44,583 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 16:01:44,583 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:01:44,583 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:01:47,799 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:47,800 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:47,800 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:47,800 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:01:47,800 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:01:49,617 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:49,618 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:49,618 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:49,619 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:01:49,619 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 16:01:49,624 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:01:49,624 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:01:49,628 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:01:49,639 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:02:36,748 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 58726)
2025-06-26 16:02:36,748 - socket_server - INFO - Client ('127.0.0.1', 58726) disconnected
2025-06-26 16:02:45,299 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:02:45,300 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:02:45,300 - __main__ - INFO - Generated final answer for conversation 32
2025-06-26 16:02:45,303 - socket_server - INFO - Sent response to ('127.0.0.1', 58755): success
2025-06-26 16:03:11,717 - socket_server - INFO - Client ('127.0.0.1', 58755) closed connection
2025-06-26 16:03:11,717 - socket_server - INFO - Client ('127.0.0.1', 58755) disconnected
2025-06-26 16:14:13,592 - socket_server - INFO - New client connected from ('127.0.0.1', 59000)
2025-06-26 16:14:13,606 - socket_server - INFO - Received request from ('127.0.0.1', 59000): chat
2025-06-26 16:14:13,618 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:14:13,618 - __main__ - INFO - New context established: rag:general
2025-06-26 16:14:13,620 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:14:17,796 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:14:17,802 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:14:18,164 - __main__ - INFO - User message: hello
2025-06-26 16:14:18,167 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:14:18,172 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:14:20,956 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:20,961 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:14:20,961 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:14:20,965 - socket_server - INFO - Sent response to ('127.0.0.1', 59000): success
2025-06-26 16:14:30,878 - socket_server - INFO - New client connected from ('127.0.0.1', 59018)
2025-06-26 16:14:30,879 - socket_server - INFO - Received request from ('127.0.0.1', 59018): chat
2025-06-26 16:14:30,880 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:14:30,880 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:14:33,607 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:14:33,611 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:14:33,933 - __main__ - INFO - User message: doanh thu quý 1 là bao nhiêu
2025-06-26 16:14:33,934 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:14:33,934 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:14:36,313 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:36,314 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:14:36,315 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:14:36,315 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:14:36,315 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu quý 1'}
2025-06-26 16:14:37,014 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:14:37,014 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:14:42,129 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:42,131 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:14:42,131 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:14:42,135 - socket_server - INFO - Sent response to ('127.0.0.1', 59018): success
2025-06-26 16:15:08,256 - socket_server - INFO - New client connected from ('127.0.0.1', 59032)
2025-06-26 16:15:08,257 - socket_server - INFO - Received request from ('127.0.0.1', 59032): chat
2025-06-26 16:15:08,258 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:15:08,258 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:15:10,914 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:15:10,917 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:15:11,168 - __main__ - INFO - User message: cho tôi 20 sản phẩm có giá cao nhất
2025-06-26 16:15:11,168 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:15:11,168 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:15:13,121 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:13,122 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:13,123 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:13,123 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:15:13,123 - __main__ - INFO - Executing tool: rag_query with args: {'query': '20 sản phẩm có giá cao nhất'}
2025-06-26 16:15:13,673 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:15:13,673 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:15:20,977 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59000)
2025-06-26 16:15:20,978 - socket_server - INFO - Client ('127.0.0.1', 59000) disconnected
2025-06-26 16:15:23,858 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:23,859 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:23,859 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:23,859 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:15:23,860 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT product_name, price FROM products ORDER BY price DESC LIMIT 20'}
2025-06-26 16:15:23,874 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:15:23,874 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-06-26 16:15:23,874 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:15:25,646 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:25,647 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:25,647 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:25,647 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 16:15:25,647 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:15:26,830 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:26,831 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:26,831 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:26,831 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 16:15:26,831 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 16:15:26,949 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 16:15:26,949 - __main__ - INFO - LLM iteration 5/10
2025-06-26 16:15:29,422 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:29,423 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:29,424 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:29,424 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 16:15:29,424 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 16:15:29,428 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 16:15:29,447 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 16:15:29,447 - __main__ - INFO - LLM iteration 6/10
2025-06-26 16:15:31,262 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:31,264 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:31,264 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:31,264 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:15:31,264 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 16:15:31,264 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 16:15:31,282 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:15:31,282 - __main__ - INFO - LLM iteration 7/10
2025-06-26 16:15:31,292 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-31' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:15:31,299 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-32' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:15:33,513 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:33,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:33,515 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:33,515 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:15:33,515 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT product_name, price FROM hoaphat2024.products ORDER BY price DESC LIMIT 20'}
2025-06-26 16:15:33,532 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:15:33,533 - __main__ - WARNING - Tool call returned error: 1146 (42S02): Table 'hoaphat2024.products' doesn't exist
2025-06-26 16:15:33,533 - __main__ - INFO - LLM iteration 8/10
2025-06-26 16:15:42,146 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59018)
2025-06-26 16:15:42,146 - socket_server - INFO - Client ('127.0.0.1', 59018) disconnected
2025-06-26 16:15:43,292 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:43,293 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:15:43,293 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:15:43,298 - socket_server - INFO - Sent response to ('127.0.0.1', 59032): success
2025-06-26 16:16:08,749 - socket_server - INFO - New client connected from ('127.0.0.1', 59045)
2025-06-26 16:16:08,750 - socket_server - INFO - Received request from ('127.0.0.1', 59045): chat
2025-06-26 16:16:08,751 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:16:08,751 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:16:11,391 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:16:11,394 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:16:11,641 - __main__ - INFO - User message: cho tôi 20 sản phẩm có giá cao nhất php3_wd19314
2025-06-26 16:16:11,641 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:16:11,642 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:16:13,892 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:13,893 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:13,893 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:13,893 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 16:16:13,893 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:16:13,893 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:16:13,905 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 16:16:13,905 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:16:16,185 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:16,186 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:16,187 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:16,187 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:16:16,187 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:16:16,187 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 16:16:16,196 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:16:16,197 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:16:19,807 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:19,808 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:19,809 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:19,809 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:16:19,809 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20'}
2025-06-26 16:16:19,815 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:16:19,815 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:16:38,260 - socket_server - INFO - Client ('127.0.0.1', 59032) closed connection
2025-06-26 16:16:38,261 - socket_server - INFO - Client ('127.0.0.1', 59032) disconnected
2025-06-26 16:16:46,282 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:46,283 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:16:46,283 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:16:46,286 - socket_server - INFO - Sent response to ('127.0.0.1', 59045): success
2025-06-26 16:17:38,759 - socket_server - INFO - Client ('127.0.0.1', 59045) closed connection
2025-06-26 16:17:38,759 - socket_server - INFO - Client ('127.0.0.1', 59045) disconnected
2025-06-26 16:18:49,733 - socket_server - INFO - New client connected from ('127.0.0.1', 59105)
2025-06-26 16:18:49,734 - socket_server - INFO - Received request from ('127.0.0.1', 59105): chat
2025-06-26 16:18:49,734 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:18:49,735 - __main__ - INFO - New context established: rag:general
2025-06-26 16:18:49,735 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:18:52,558 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:18:52,562 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:18:52,957 - __main__ - INFO - User message: phân tích doanh thu các năm của hòa phát
2025-06-26 16:18:52,957 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:18:52,957 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:18:54,643 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:18:54,644 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:18:54,644 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:18:54,645 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:18:54,645 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu các năm của hòa phát'}
2025-06-26 16:18:55,312 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:18:55,313 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:19:09,801 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:09,802 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:19:09,802 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:19:09,806 - socket_server - INFO - Sent response to ('127.0.0.1', 59105): success
2025-06-26 16:19:12,214 - socket_server - INFO - New client connected from ('127.0.0.1', 59150)
2025-06-26 16:19:12,214 - socket_server - INFO - Received request from ('127.0.0.1', 59150): chat
2025-06-26 16:19:12,215 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:19:12,215 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:19:15,530 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:19:15,534 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:19:15,888 - __main__ - INFO - User message: liệt kê 20 sản phẩm có giá cao nhất trong php3_wd19314
2025-06-26 16:19:15,888 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:19:15,888 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:19:18,393 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:18,394 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:19:18,394 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:19:18,394 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:19:18,394 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY price DESC LIMIT 20;'}
2025-06-26 16:19:18,402 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:19:18,402 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'price' in 'order clause'
2025-06-26 16:19:18,402 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:19:27,988 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:27,990 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:19:27,990 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:19:27,993 - socket_server - INFO - Sent response to ('127.0.0.1', 59150): success
2025-06-26 16:20:09,818 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59105)
2025-06-26 16:20:09,818 - socket_server - INFO - Client ('127.0.0.1', 59105) disconnected
2025-06-26 16:20:19,203 - socket_server - INFO - New client connected from ('127.0.0.1', 59218)
2025-06-26 16:20:19,203 - socket_server - INFO - Received request from ('127.0.0.1', 59218): chat
2025-06-26 16:20:19,204 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:20:19,204 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:20:27,038 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:20:27,065 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:20:27,505 - __main__ - INFO - User message: có
2025-06-26 16:20:27,505 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:20:27,506 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:20:27,640 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-49' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,694 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-50' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,698 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-51' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,997 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59150)
2025-06-26 16:20:27,997 - socket_server - INFO - Client ('127.0.0.1', 59150) disconnected
2025-06-26 16:20:30,038 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:20:30,039 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:20:30,039 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:20:30,039 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:20:30,039 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:20:30,039 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 16:20:30,047 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:20:30,047 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:20:37,437 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:20:37,438 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:20:37,439 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:20:37,439 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:20:37,439 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ma_san_pham, ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 16:20:37,443 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:20:37,443 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:21:16,141 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:21:16,142 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:21:16,142 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:21:16,146 - socket_server - INFO - Sent response to ('127.0.0.1', 59218): success
2025-06-26 16:21:49,207 - socket_server - INFO - Client ('127.0.0.1', 59218) closed connection
2025-06-26 16:21:49,207 - socket_server - INFO - Client ('127.0.0.1', 59218) disconnected
2025-06-26 16:25:46,581 - socket_server - INFO - New client connected from ('127.0.0.1', 59342)
2025-06-26 16:25:46,581 - socket_server - INFO - Received request from ('127.0.0.1', 59342): chat
2025-06-26 16:25:46,582 - __main__ - INFO - Processing message for conversation 35
2025-06-26 16:25:46,582 - __main__ - INFO - New context established: rag:general
2025-06-26 16:25:46,582 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:25:49,285 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:25:49,288 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:25:49,548 - __main__ - INFO - User message: cho tôi xem 20 sản phẩm có giá cao nhất database php3_wd19314
2025-06-26 16:25:49,548 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:25:49,548 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:25:51,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:51,762 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:51,762 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:51,762 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:25:51,762 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY price DESC LIMIT 20;'}
2025-06-26 16:25:51,765 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:25:51,765 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'price' in 'order clause'
2025-06-26 16:25:51,765 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:25:56,394 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:56,395 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:56,395 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:56,395 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 16:25:56,395 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:25:58,672 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:58,673 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:58,673 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:58,674 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:25:58,674 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:25:59,897 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:59,898 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:59,898 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:59,898 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 16:25:59,898 - __main__ - INFO - LLM iteration 5/10
2025-06-26 16:26:01,944 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:01,946 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:01,946 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:01,946 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:01,947 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SHOW TABLES FROM php3_wd19314;'}
2025-06-26 16:26:01,951 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:01,951 - __main__ - INFO - LLM iteration 6/10
2025-06-26 16:26:03,903 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:03,905 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:03,905 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:03,905 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:03,905 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'DESCRIBE php3_wd19314.products;'}
2025-06-26 16:26:03,909 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:03,909 - __main__ - INFO - LLM iteration 7/10
2025-06-26 16:26:06,170 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:06,171 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:06,171 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:06,171 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:06,171 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 16:26:06,178 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:06,178 - __main__ - INFO - LLM iteration 8/10
2025-06-26 16:26:41,637 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:41,638 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:26:41,639 - __main__ - INFO - Generated final answer for conversation 35
2025-06-26 16:26:41,643 - socket_server - INFO - Sent response to ('127.0.0.1', 59342): success
2025-06-26 16:27:16,587 - socket_server - INFO - Client ('127.0.0.1', 59342) closed connection
2025-06-26 16:27:16,587 - socket_server - INFO - Client ('127.0.0.1', 59342) disconnected
2025-06-26 16:29:58,014 - socket_server - INFO - Stopping server...
2025-06-26 16:29:58,015 - socket_server - INFO - Socket Server stopped
2025-06-26 16:29:58,016 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 16:29:58,016 - socket_server - INFO - Stopping server...
2025-06-26 16:29:58,016 - socket_server - INFO - Socket Server stopped
