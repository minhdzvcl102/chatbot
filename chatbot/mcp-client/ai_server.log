2025-06-23 14:21:58,712 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:22:16,540 - __main__ - INFO - New client connected from ('127.0.0.1', 53397)
2025-06-23 14:22:16,541 - __main__ - INFO - Received request from ('127.0.0.1', 53397): chat
2025-06-23 14:22:16,542 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:22:16,542 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:22:22,178 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,504 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,505 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:22:27,506 - __main__ - INFO - Sent response to ('127.0.0.1', 53397): success
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) closed connection
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) disconnected
2025-06-23 14:23:57,066 - __main__ - INFO - New client connected from ('127.0.0.1', 53434)
2025-06-23 14:23:57,067 - __main__ - INFO - Received request from ('127.0.0.1', 53434): chat
2025-06-23 14:23:57,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:23:57,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:24:02,106 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,348 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,349 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:24:04,350 - __main__ - INFO - Sent response to ('127.0.0.1', 53434): success
2025-06-23 14:24:27,067 - __main__ - INFO - Client ('127.0.0.1', 53434) closed connection
2025-06-23 14:24:27,068 - __main__ - INFO - Client ('127.0.0.1', 53434) disconnected
2025-06-23 14:35:44,091 - __main__ - INFO - New client connected from ('127.0.0.1', 53627)
2025-06-23 14:35:44,108 - __main__ - INFO - Received request from ('127.0.0.1', 53627): chat
2025-06-23 14:35:44,133 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:35:44,136 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:35:51,416 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,150 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,151 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:36:12,153 - __main__ - INFO - Sent response to ('127.0.0.1', 53627): success
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) closed connection
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) disconnected
2025-06-23 14:52:19,674 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:52:31,065 - __main__ - INFO - New client connected from ('127.0.0.1', 53954)
2025-06-23 14:52:31,066 - __main__ - INFO - Received request from ('127.0.0.1', 53954): chat
2025-06-23 14:52:31,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:52:31,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:52:37,041 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,619 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,620 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:52:42,621 - __main__ - INFO - Sent response to ('127.0.0.1', 53954): success
2025-06-23 14:53:01,045 - __main__ - INFO - Client ('127.0.0.1', 53954) closed connection
2025-06-23 14:53:01,046 - __main__ - INFO - Client ('127.0.0.1', 53954) disconnected
2025-06-23 14:55:18,665 - __main__ - INFO - New client connected from ('127.0.0.1', 54018)
2025-06-23 14:55:18,665 - __main__ - INFO - Received request from ('127.0.0.1', 54018): chat
2025-06-23 14:55:18,666 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:18,667 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:23,301 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:31,925 - __main__ - INFO - New client connected from ('127.0.0.1', 54029)
2025-06-23 14:55:31,926 - __main__ - INFO - Received request from ('127.0.0.1', 54029): chat
2025-06-23 14:55:31,927 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:31,927 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:32,873 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:32,874 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:32,875 - __main__ - INFO - Sent response to ('127.0.0.1', 54018): success
2025-06-23 14:55:36,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:47,299 - __main__ - INFO - New client connected from ('127.0.0.1', 54040)
2025-06-23 14:55:47,300 - __main__ - INFO - Received request from ('127.0.0.1', 54040): chat
2025-06-23 14:55:47,301 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:47,301 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) closed connection
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) disconnected
2025-06-23 14:55:58,999 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:59,000 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:59,001 - __main__ - INFO - Sent response to ('127.0.0.1', 54029): success
2025-06-23 14:56:01,928 - __main__ - INFO - Client ('127.0.0.1', 54029) closed connection
2025-06-23 14:56:01,929 - __main__ - INFO - Client ('127.0.0.1', 54029) disconnected
2025-06-23 14:56:02,858 - __main__ - INFO - New client connected from ('127.0.0.1', 54052)
2025-06-23 14:56:02,858 - __main__ - INFO - Received request from ('127.0.0.1', 54052): chat
2025-06-23 14:56:02,859 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:56:02,859 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:56:02,863 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:02,877 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:07,268 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,872 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,873 - __main__ - INFO - Generated answer for conversation 6
2025-06-23 14:56:10,873 - __main__ - INFO - Sent response to ('127.0.0.1', 54040): success
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) closed connection
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) disconnected
2025-06-23 14:56:20,437 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:20,438 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:56:20,439 - __main__ - INFO - Sent response to ('127.0.0.1', 54052): success
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) closed connection
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) disconnected
2025-06-23 14:57:19,260 - __main__ - INFO - New client connected from ('127.0.0.1', 54121)
2025-06-23 14:57:19,261 - __main__ - INFO - Received request from ('127.0.0.1', 54121): chat
2025-06-23 14:57:19,262 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:57:19,262 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:57:24,110 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,412 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:57:37,413 - __main__ - INFO - Sent response to ('127.0.0.1', 54121): success
2025-06-23 14:57:49,265 - __main__ - INFO - Client ('127.0.0.1', 54121) closed connection
2025-06-23 14:57:49,266 - __main__ - INFO - Client ('127.0.0.1', 54121) disconnected
2025-06-23 14:59:27,754 - __main__ - INFO - New client connected from ('127.0.0.1', 54171)
2025-06-23 14:59:27,755 - __main__ - INFO - Received request from ('127.0.0.1', 54171): chat
2025-06-23 14:59:27,756 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:59:27,757 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:59:33,606 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,204 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,205 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:59:44,206 - __main__ - INFO - Sent response to ('127.0.0.1', 54171): success
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) closed connection
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) disconnected
2025-06-23 15:00:18,958 - __main__ - INFO - New client connected from ('127.0.0.1', 54182)
2025-06-23 15:00:18,961 - __main__ - INFO - Received request from ('127.0.0.1', 54182): chat
2025-06-23 15:00:18,962 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:00:18,962 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:00:23,733 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,882 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,883 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:00:34,884 - __main__ - INFO - Sent response to ('127.0.0.1', 54182): success
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) closed connection
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) disconnected
2025-06-23 15:01:53,236 - __main__ - INFO - New client connected from ('127.0.0.1', 54193)
2025-06-23 15:01:53,237 - __main__ - INFO - Received request from ('127.0.0.1', 54193): chat
2025-06-23 15:01:53,238 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:01:53,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:01:55,971 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-39' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,980 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,983 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,987 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:57,842 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,974 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,975 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:02:10,976 - __main__ - INFO - Sent response to ('127.0.0.1', 54193): success
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) closed connection
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) disconnected
2025-06-23 16:18:05,129 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:19:32,380 - __main__ - INFO - New client connected from ('127.0.0.1', 55113)
2025-06-23 16:19:32,380 - __main__ - INFO - Received request from ('127.0.0.1', 55113): chat
2025-06-23 16:19:32,382 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:19:32,383 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:19:38,307 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,360 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,361 - __main__ - INFO - Sent response to ('127.0.0.1', 55113): error
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) closed connection
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) disconnected
2025-06-23 16:21:50,133 - __main__ - INFO - New client connected from ('127.0.0.1', 55149)
2025-06-23 16:21:50,134 - __main__ - INFO - Received request from ('127.0.0.1', 55149): chat
2025-06-23 16:21:50,135 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:21:50,135 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:21:54,453 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:21:54,458 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:21:54,458 - __main__ - INFO - Sent response to ('127.0.0.1', 55149): error
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) closed connection
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) disconnected
2025-06-23 16:27:04,088 - __main__ - INFO - New client connected from ('127.0.0.1', 55218)
2025-06-23 16:27:04,089 - __main__ - INFO - Received request from ('127.0.0.1', 55218): chat
2025-06-23 16:27:04,089 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:04,090 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:10,517 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:10,520 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:10,521 - __main__ - INFO - Sent response to ('127.0.0.1', 55218): error
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) reset connection
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) disconnected
2025-06-23 16:27:38,357 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:38,358 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:43,655 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:27:47,047 - __main__ - INFO - New client connected from ('127.0.0.1', 55236)
2025-06-23 16:27:47,047 - __main__ - INFO - Received request from ('127.0.0.1', 55236): chat
2025-06-23 16:27:47,048 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:47,048 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:51,474 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:51,479 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:51,480 - __main__ - INFO - Sent response to ('127.0.0.1', 55236): error
2025-06-23 16:27:57,819 - __main__ - INFO - New client connected from ('127.0.0.1', 55258)
2025-06-23 16:27:57,819 - __main__ - INFO - Received request from ('127.0.0.1', 55258): chat
2025-06-23 16:27:57,820 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:57,821 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:28:01,811 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:28:01,814 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:28:01,815 - __main__ - INFO - Sent response to ('127.0.0.1', 55258): error
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) closed connection
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) disconnected
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) closed connection
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) disconnected
2025-06-23 16:29:47,965 - __main__ - INFO - New client connected from ('127.0.0.1', 55282)
2025-06-23 16:29:47,966 - __main__ - INFO - Received request from ('127.0.0.1', 55282): chat
2025-06-23 16:29:47,967 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:29:47,967 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:29:56,848 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,534 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,535 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 16:30:08,536 - __main__ - INFO - Sent response to ('127.0.0.1', 55282): success
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) closed connection
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) disconnected
2025-06-23 16:48:03,525 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:48:31,914 - __main__ - INFO - New client connected from ('127.0.0.1', 55696)
2025-06-23 16:48:31,915 - __main__ - INFO - Received request from ('127.0.0.1', 55696): chat
2025-06-23 16:48:31,919 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:48:31,919 - __main__ - ERROR - Error processing message for conversation 7: 'NoneType' object has no attribute 'list_resources'
2025-06-23 16:48:31,920 - __main__ - INFO - Sent response to ('127.0.0.1', 55696): error
2025-06-23 16:49:01,916 - __main__ - INFO - Client ('127.0.0.1', 55696) closed connection
2025-06-23 16:49:01,917 - __main__ - INFO - Client ('127.0.0.1', 55696) disconnected
2025-06-24 17:02:30,694 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 17:03:51,582 - __main__ - INFO - New client connected from ('127.0.0.1', 58883)
2025-06-24 17:03:51,584 - __main__ - INFO - Received request from ('127.0.0.1', 58883): chat
2025-06-24 17:03:51,588 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:03:51,588 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:03:57,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,436 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,437 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:04:02,438 - __main__ - INFO - Sent response to ('127.0.0.1', 58883): success
2025-06-24 17:04:21,588 - __main__ - INFO - Client ('127.0.0.1', 58883) closed connection
2025-06-24 17:04:21,589 - __main__ - INFO - Client ('127.0.0.1', 58883) disconnected
2025-06-24 17:04:35,833 - __main__ - INFO - New client connected from ('127.0.0.1', 58895)
2025-06-24 17:04:35,833 - __main__ - INFO - Received request from ('127.0.0.1', 58895): chat
2025-06-24 17:04:35,834 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:04:35,835 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:04:40,058 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:40,062 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-24 17:04:40,063 - __main__ - INFO - Sent response to ('127.0.0.1', 58895): error
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) closed connection
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) disconnected
2025-06-24 17:07:51,797 - __main__ - INFO - New client connected from ('127.0.0.1', 58951)
2025-06-24 17:07:51,801 - __main__ - INFO - Received request from ('127.0.0.1', 58951): chat
2025-06-24 17:07:51,812 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:07:51,813 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:07:59,254 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,592 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,593 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:08:15,594 - __main__ - INFO - Sent response to ('127.0.0.1', 58951): success
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) closed connection
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) disconnected
2025-06-24 17:08:52,083 - __main__ - INFO - New client connected from ('127.0.0.1', 58968)
2025-06-24 17:08:52,083 - __main__ - INFO - Received request from ('127.0.0.1', 58968): chat
2025-06-24 17:08:52,084 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:08:52,084 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:08:56,953 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,125 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,126 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:09:05,127 - __main__ - INFO - Sent response to ('127.0.0.1', 58968): success
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) closed connection
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) disconnected
2025-06-24 17:32:01,194 - __main__ - INFO - New client connected from ('127.0.0.1', 59416)
2025-06-24 17:32:01,212 - __main__ - INFO - Received request from ('127.0.0.1', 59416): chat
2025-06-24 17:32:01,227 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:32:01,229 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:32:06,212 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,298 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,304 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:08,320 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,858 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,860 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:32:27,862 - __main__ - INFO - Sent response to ('127.0.0.1', 59416): success
2025-06-24 17:32:31,134 - __main__ - INFO - Client ('127.0.0.1', 59416) closed connection
2025-06-24 17:32:31,135 - __main__ - INFO - Client ('127.0.0.1', 59416) disconnected
2025-06-24 17:48:50,942 - __main__ - INFO - New client connected from ('127.0.0.1', 59632)
2025-06-24 17:48:50,961 - __main__ - INFO - Received request from ('127.0.0.1', 59632): chat
2025-06-24 17:48:50,979 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:48:50,981 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:48:58,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,019 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:17,020 - __main__ - INFO - Sent response to ('127.0.0.1', 59632): success
2025-06-24 17:49:20,867 - __main__ - INFO - Client ('127.0.0.1', 59632) closed connection
2025-06-24 17:49:20,868 - __main__ - INFO - Client ('127.0.0.1', 59632) disconnected
2025-06-24 17:49:36,492 - __main__ - INFO - New client connected from ('127.0.0.1', 59667)
2025-06-24 17:49:36,492 - __main__ - INFO - Received request from ('127.0.0.1', 59667): chat
2025-06-24 17:49:36,493 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:49:36,494 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:49:42,650 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,465 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,466 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:45,467 - __main__ - INFO - Sent response to ('127.0.0.1', 59667): success
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) closed connection
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) disconnected
2025-06-24 18:12:40,183 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:23:15,801 - __main__ - INFO - New client connected from ('127.0.0.1', 50874)
2025-06-24 18:23:15,807 - __main__ - INFO - Received request from ('127.0.0.1', 50874): chat
2025-06-24 18:23:15,814 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:23:15,815 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:23:19,861 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:23:19,873 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:23:23,302 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:23:23,306 - __main__ - INFO - Executing tool call 1/1: rag_query_for_chart
2025-06-24 18:23:23,322 - __main__ - INFO - Tool rag_query_for_chart executed successfully
2025-06-24 18:23:23,323 - __main__ - ERROR - Tool call error: Expected where to have exactly one operator, got {'chart_suitable': True, 'suggested_chart_type': 'line_chart'} in query.
2025-06-24 18:23:23,324 - __main__ - INFO - Sent response to ('127.0.0.1', 50874): error
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) closed connection
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) disconnected
2025-06-24 18:27:18,568 - __main__ - INFO - New client connected from ('127.0.0.1', 50980)
2025-06-24 18:27:18,569 - __main__ - INFO - Received request from ('127.0.0.1', 50980): chat
2025-06-24 18:27:18,570 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:27:18,570 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:27:21,697 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:27:21,703 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:27:22,316 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:27:22,317 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-0f97311b-268a-9e55-9a1f-9ef6b6f99f37', 'request_id': '0f97311b-268a-9e55-9a1f-9ef6b6f99f37'}
2025-06-24 18:27:22,318 - __main__ - INFO - Sent response to ('127.0.0.1', 50980): error
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) closed connection
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) disconnected
2025-06-24 18:28:38,594 - __main__ - INFO - New client connected from ('127.0.0.1', 51014)
2025-06-24 18:28:38,594 - __main__ - INFO - Received request from ('127.0.0.1', 51014): chat
2025-06-24 18:28:38,595 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:28:38,595 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:28:41,276 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:28:41,281 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:28:41,959 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:28:41,959 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-6a2b416e-b393-9865-af78-c1197c2c40ae', 'request_id': '6a2b416e-b393-9865-af78-c1197c2c40ae'}
2025-06-24 18:28:41,960 - __main__ - INFO - Sent response to ('127.0.0.1', 51014): error
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) closed connection
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) disconnected
2025-06-24 18:29:54,164 - __main__ - INFO - New client connected from ('127.0.0.1', 51100)
2025-06-24 18:29:54,165 - __main__ - INFO - Received request from ('127.0.0.1', 51100): chat
2025-06-24 18:29:54,166 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:29:54,166 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:29:57,040 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:29:57,046 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:29:57,803 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:29:57,804 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-9ebf87b0-ea87-9c78-8eee-de142363422c', 'request_id': '9ebf87b0-ea87-9c78-8eee-de142363422c'}
2025-06-24 18:29:57,805 - __main__ - INFO - Sent response to ('127.0.0.1', 51100): error
2025-06-24 18:30:22,452 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:22,453 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:28,423 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:30:36,268 - __main__ - INFO - New client connected from ('127.0.0.1', 51126)
2025-06-24 18:30:36,268 - __main__ - INFO - Received request from ('127.0.0.1', 51126): chat
2025-06-24 18:30:36,269 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:30:36,269 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:30:38,817 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:30:38,821 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:30:41,462 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:30:41,464 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-24 18:30:42,119 - __main__ - INFO - Tool rag_query executed successfully
2025-06-24 18:31:05,970 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:05,971 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:05,972 - __main__ - INFO - Sent response to ('127.0.0.1', 51126): success
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) closed connection
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) disconnected
2025-06-24 18:31:38,187 - __main__ - INFO - New client connected from ('127.0.0.1', 51144)
2025-06-24 18:31:38,187 - __main__ - INFO - Received request from ('127.0.0.1', 51144): chat
2025-06-24 18:31:38,188 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:31:38,189 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:31:40,794 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:31:40,799 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:31:42,291 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:42,292 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-24 18:31:42,293 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-24 18:31:42,400 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-24 18:31:51,545 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:51,546 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:51,546 - __main__ - INFO - Sent response to ('127.0.0.1', 51144): success
2025-06-24 18:32:08,187 - __main__ - INFO - Client ('127.0.0.1', 51144) closed connection
2025-06-24 18:32:08,188 - __main__ - INFO - Client ('127.0.0.1', 51144) disconnected
2025-06-25 02:30:57,431 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-25 02:31:41,275 - __main__ - INFO - New client connected from ('127.0.0.1', 53921)
2025-06-25 02:31:41,276 - __main__ - INFO - Received request from ('127.0.0.1', 53921): chat
2025-06-25 02:31:41,278 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:31:41,278 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:31:43,948 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:31:43,954 - __main__ - ERROR - Error processing message for conversation 7: 'required'
2025-06-25 02:31:43,955 - __main__ - INFO - Sent response to ('127.0.0.1', 53921): error
2025-06-25 02:32:11,277 - __main__ - INFO - Client ('127.0.0.1', 53921) closed connection
2025-06-25 02:32:11,277 - __main__ - INFO - Client ('127.0.0.1', 53921) disconnected
2025-06-25 02:35:40,893 - __main__ - INFO - New client connected from ('127.0.0.1', 54011)
2025-06-25 02:35:40,894 - __main__ - INFO - Received request from ('127.0.0.1', 54011): chat
2025-06-25 02:35:40,896 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:35:40,896 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:35:44,646 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:35:44,652 - __main__ - ERROR - Error processing message for conversation 7: 'required'
2025-06-25 02:35:44,653 - __main__ - INFO - Sent response to ('127.0.0.1', 54011): error
2025-06-25 02:36:10,891 - __main__ - INFO - Client ('127.0.0.1', 54011) closed connection
2025-06-25 02:36:10,892 - __main__ - INFO - Client ('127.0.0.1', 54011) disconnected
2025-06-25 02:36:58,588 - __main__ - INFO - New client connected from ('127.0.0.1', 54049)
2025-06-25 02:36:58,589 - __main__ - INFO - Received request from ('127.0.0.1', 54049): chat
2025-06-25 02:36:58,591 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:36:58,592 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:37:01,591 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:37:01,597 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:37:04,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:37:04,021 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:37:04,720 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:37:16,008 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:37:16,010 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:37:16,011 - __main__ - INFO - Sent response to ('127.0.0.1', 54049): success
2025-06-25 02:37:28,587 - __main__ - INFO - Client ('127.0.0.1', 54049) closed connection
2025-06-25 02:37:28,588 - __main__ - INFO - Client ('127.0.0.1', 54049) disconnected
2025-06-25 02:40:11,015 - __main__ - INFO - New client connected from ('127.0.0.1', 54131)
2025-06-25 02:40:11,016 - __main__ - INFO - Received request from ('127.0.0.1', 54131): chat
2025-06-25 02:40:11,017 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:40:11,018 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:40:14,501 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:40:14,506 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:40:16,375 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:40:16,376 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:40:17,060 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:40:32,768 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:40:32,769 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:40:32,770 - __main__ - INFO - Sent response to ('127.0.0.1', 54131): success
2025-06-25 02:40:41,025 - __main__ - INFO - Client ('127.0.0.1', 54131) closed connection
2025-06-25 02:40:41,026 - __main__ - INFO - Client ('127.0.0.1', 54131) disconnected
2025-06-25 02:42:13,119 - __main__ - INFO - Stopping server...
2025-06-25 02:42:13,119 - __main__ - INFO - AI Socket Server stopped
2025-06-25 02:42:13,119 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-25 02:42:13,119 - __main__ - INFO - Stopping server...
2025-06-25 02:42:13,120 - __main__ - INFO - AI Socket Server stopped
2025-06-25 02:42:19,640 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-25 02:42:29,916 - __main__ - INFO - New client connected from ('127.0.0.1', 54201)
2025-06-25 02:42:29,917 - __main__ - INFO - Received request from ('127.0.0.1', 54201): chat
2025-06-25 02:42:29,919 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:42:29,919 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:42:32,955 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:42:32,961 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:42:34,945 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:34,948 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-25 02:42:34,948 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-25 02:42:35,106 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-25 02:42:43,014 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:43,016 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:42:43,017 - __main__ - INFO - Sent response to ('127.0.0.1', 54201): success
2025-06-25 02:42:51,398 - __main__ - INFO - New client connected from ('127.0.0.1', 54218)
2025-06-25 02:42:51,398 - __main__ - INFO - Received request from ('127.0.0.1', 54218): chat
2025-06-25 02:42:51,399 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:42:51,399 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:42:54,237 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:42:54,242 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:42:56,045 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:42:56,046 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 02:42:56,046 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'hoaphat2024 doanh thu c�c n�m'}
2025-06-25 02:42:56,687 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 02:42:59,925 - __main__ - INFO - Client ('127.0.0.1', 54201) closed connection
2025-06-25 02:42:59,926 - __main__ - INFO - Client ('127.0.0.1', 54201) disconnected
2025-06-25 02:43:06,206 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:43:06,207 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 02:43:06,208 - __main__ - INFO - Sent response to ('127.0.0.1', 54218): success
2025-06-25 02:43:21,410 - __main__ - INFO - Client ('127.0.0.1', 54218) closed connection
2025-06-25 02:43:21,410 - __main__ - INFO - Client ('127.0.0.1', 54218) disconnected
2025-06-25 02:46:30,594 - __main__ - INFO - New client connected from ('127.0.0.1', 54278)
2025-06-25 02:46:30,596 - __main__ - INFO - Received request from ('127.0.0.1', 54278): chat
2025-06-25 02:46:30,598 - __main__ - INFO - Processing message for conversation 7
2025-06-25 02:46:30,598 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 02:46:33,676 - __main__ - INFO - MCP client initialized successfully
2025-06-25 02:46:33,682 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 02:46:34,865 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 02:46:34,866 - __main__ - INFO - Generated answer for conversation 7
2025-06-25 02:46:34,867 - __main__ - INFO - Sent response to ('127.0.0.1', 54278): success
2025-06-25 02:47:00,597 - __main__ - INFO - Client ('127.0.0.1', 54278) closed connection
2025-06-25 02:47:00,598 - __main__ - INFO - Client ('127.0.0.1', 54278) disconnected
2025-06-25 03:28:53,405 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-25 03:31:33,897 - socket_server - INFO - New client connected from ('127.0.0.1', 56958)
2025-06-25 03:31:33,898 - socket_server - INFO - Received request from ('127.0.0.1', 56958): chat
2025-06-25 03:31:33,901 - __main__ - INFO - Processing message for conversation 7
2025-06-25 03:31:33,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-25 03:31:37,456 - __main__ - INFO - MCP client initialized successfully
2025-06-25 03:31:37,473 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-25 03:31:39,429 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 03:31:39,431 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-25 03:31:39,832 - __main__ - INFO - Tool rag_query executed successfully
2025-06-25 03:31:53,372 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-25 03:31:53,374 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-25 03:31:53,375 - socket_server - INFO - Sent response to ('127.0.0.1', 56958): success
2025-06-25 03:32:03,889 - socket_server - INFO - Client ('127.0.0.1', 56958) closed connection
2025-06-25 03:32:03,890 - socket_server - INFO - Client ('127.0.0.1', 56958) disconnected
2025-06-25 18:36:22,893 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:38:45,495 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:40:22,486 - socket_server - INFO - New client connected from ('127.0.0.1', 62046)
2025-06-26 00:40:22,486 - socket_server - INFO - Received request from ('127.0.0.1', 62046): chat
2025-06-26 00:40:22,488 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:40:22,489 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:40:26,112 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:40:26,118 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:40:28,883 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:40:28,887 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:40:28,887 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'financial_performance'}
2025-06-26 00:40:28,888 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/financial_performance
2025-06-26 00:40:28,895 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:40:28,895 - __main__ - ERROR - Tool call error: Database 'financial_performance' not found or has no tables
2025-06-26 00:40:28,896 - socket_server - INFO - Sent response to ('127.0.0.1', 62046): error
2025-06-26 00:40:52,491 - socket_server - INFO - Client ('127.0.0.1', 62046) closed connection
2025-06-26 00:40:52,491 - socket_server - INFO - Client ('127.0.0.1', 62046) disconnected
2025-06-26 00:41:11,792 - socket_server - INFO - New client connected from ('127.0.0.1', 62060)
2025-06-26 00:41:11,792 - socket_server - INFO - Received request from ('127.0.0.1', 62060): chat
2025-06-26 00:41:11,793 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:41:11,794 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:41:14,752 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:41:14,757 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:41:15,385 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:41:15,386 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-d705aeaa-7b1c-97fe-b4e3-d9929f193d2f', 'request_id': 'd705aeaa-7b1c-97fe-b4e3-d9929f193d2f'}
2025-06-26 00:41:15,387 - socket_server - INFO - Sent response to ('127.0.0.1', 62060): error
2025-06-26 00:41:41,801 - socket_server - INFO - Client ('127.0.0.1', 62060) closed connection
2025-06-26 00:41:41,802 - socket_server - INFO - Client ('127.0.0.1', 62060) disconnected
2025-06-26 00:41:50,684 - socket_server - INFO - New client connected from ('127.0.0.1', 62075)
2025-06-26 00:41:50,684 - socket_server - INFO - Received request from ('127.0.0.1', 62075): chat
2025-06-26 00:41:50,685 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:41:50,685 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:41:53,720 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:41:53,724 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:41:54,367 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:41:54,368 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-a60fd2fc-0204-93d3-864a-8b5c37112180', 'request_id': 'a60fd2fc-0204-93d3-864a-8b5c37112180'}
2025-06-26 00:41:54,369 - socket_server - INFO - Sent response to ('127.0.0.1', 62075): error
2025-06-26 00:42:12,614 - socket_server - INFO - New client connected from ('127.0.0.1', 62086)
2025-06-26 00:42:12,615 - socket_server - INFO - Received request from ('127.0.0.1', 62086): chat
2025-06-26 00:42:12,615 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:42:12,616 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:42:15,444 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:42:15,449 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:42:16,071 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:42:16,072 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-12fc2e7d-f429-9c49-949c-e874b100aaea', 'request_id': '12fc2e7d-f429-9c49-949c-e874b100aaea'}
2025-06-26 00:42:16,073 - socket_server - INFO - Sent response to ('127.0.0.1', 62086): error
2025-06-26 00:42:20,690 - socket_server - INFO - Client ('127.0.0.1', 62075) closed connection
2025-06-26 00:42:20,691 - socket_server - INFO - Client ('127.0.0.1', 62075) disconnected
2025-06-26 00:42:42,612 - socket_server - INFO - Client ('127.0.0.1', 62086) closed connection
2025-06-26 00:42:42,613 - socket_server - INFO - Client ('127.0.0.1', 62086) disconnected
2025-06-26 00:42:48,731 - socket_server - INFO - New client connected from ('127.0.0.1', 62115)
2025-06-26 00:42:48,731 - socket_server - INFO - Received request from ('127.0.0.1', 62115): chat
2025-06-26 00:42:48,732 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:42:48,732 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:42:52,082 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:42:52,087 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:42:52,729 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:42:52,730 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-107f447c-3250-9c58-80b1-9bae5b870939', 'request_id': '107f447c-3250-9c58-80b1-9bae5b870939'}
2025-06-26 00:42:52,731 - socket_server - INFO - Sent response to ('127.0.0.1', 62115): error
2025-06-26 00:43:18,730 - socket_server - INFO - Client ('127.0.0.1', 62115) closed connection
2025-06-26 00:43:18,731 - socket_server - INFO - Client ('127.0.0.1', 62115) disconnected
2025-06-26 00:45:53,570 - socket_server - INFO - Stopping server...
2025-06-26 00:45:53,583 - socket_server - INFO - Socket Server stopped
2025-06-26 00:45:53,583 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 00:45:53,584 - socket_server - INFO - Stopping server...
2025-06-26 00:45:53,585 - socket_server - INFO - Socket Server stopped
2025-06-26 00:45:59,410 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:46:11,584 - socket_server - INFO - New client connected from ('127.0.0.1', 62232)
2025-06-26 00:46:11,585 - socket_server - INFO - Received request from ('127.0.0.1', 62232): chat
2025-06-26 00:46:11,586 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:46:11,586 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:46:15,002 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:46:15,008 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:46:16,881 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:16,885 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 00:46:16,885 - socket_server - INFO - Sent response to ('127.0.0.1', 62232): success
2025-06-26 00:46:27,161 - socket_server - INFO - New client connected from ('127.0.0.1', 62242)
2025-06-26 00:46:27,162 - socket_server - INFO - Received request from ('127.0.0.1', 62242): chat
2025-06-26 00:46:27,163 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:46:27,163 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:46:29,978 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:46:29,982 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:46:31,489 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:31,491 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 00:46:31,491 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 00:46:31,588 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 00:46:39,024 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:46:39,025 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 00:46:39,025 - socket_server - INFO - Sent response to ('127.0.0.1', 62242): success
2025-06-26 00:46:41,572 - socket_server - INFO - Client ('127.0.0.1', 62232) closed connection
2025-06-26 00:46:41,572 - socket_server - INFO - Client ('127.0.0.1', 62232) disconnected
2025-06-26 00:46:57,168 - socket_server - INFO - Client ('127.0.0.1', 62242) closed connection
2025-06-26 00:46:57,169 - socket_server - INFO - Client ('127.0.0.1', 62242) disconnected
2025-06-26 00:47:10,113 - socket_server - INFO - New client connected from ('127.0.0.1', 62263)
2025-06-26 00:47:10,113 - socket_server - INFO - Received request from ('127.0.0.1', 62263): chat
2025-06-26 00:47:10,114 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:47:10,115 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:47:13,038 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:47:13,042 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:47:15,112 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:47:15,113 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:47:15,113 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'sakila'}
2025-06-26 00:47:15,113 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/sakila
2025-06-26 00:47:15,123 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:47:15,123 - __main__ - ERROR - Tool call error: Database 'sakila' not found or has no tables
2025-06-26 00:47:15,124 - socket_server - INFO - Sent response to ('127.0.0.1', 62263): error
2025-06-26 00:47:33,686 - socket_server - INFO - New client connected from ('127.0.0.1', 62280)
2025-06-26 00:47:33,687 - socket_server - INFO - Received request from ('127.0.0.1', 62280): chat
2025-06-26 00:47:33,688 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:47:33,688 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:47:36,701 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:47:36,705 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:47:37,320 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 00:47:37,321 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[9].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-deb0a76c-44f5-91af-8b9b-b1fcf6b955b2', 'request_id': 'deb0a76c-44f5-91af-8b9b-b1fcf6b955b2'}
2025-06-26 00:47:37,322 - socket_server - INFO - Sent response to ('127.0.0.1', 62280): error
2025-06-26 00:47:40,118 - socket_server - INFO - Client ('127.0.0.1', 62263) closed connection
2025-06-26 00:47:40,118 - socket_server - INFO - Client ('127.0.0.1', 62263) disconnected
2025-06-26 00:48:03,695 - socket_server - INFO - Client ('127.0.0.1', 62280) closed connection
2025-06-26 00:48:03,695 - socket_server - INFO - Client ('127.0.0.1', 62280) disconnected
2025-06-26 00:48:40,405 - socket_server - INFO - Stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Socket Server stopped
2025-06-26 00:48:40,406 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Stopping server...
2025-06-26 00:48:40,406 - socket_server - INFO - Socket Server stopped
2025-06-26 00:48:44,526 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 00:49:08,220 - socket_server - INFO - New client connected from ('127.0.0.1', 62311)
2025-06-26 00:49:08,220 - socket_server - INFO - Received request from ('127.0.0.1', 62311): chat
2025-06-26 00:49:08,221 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:49:08,222 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:49:11,101 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:49:11,107 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:49:13,758 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:49:13,761 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 00:49:13,761 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 00:49:13,761 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 00:49:13,768 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 00:49:36,883 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:49:36,884 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 00:49:36,885 - socket_server - INFO - Sent response to ('127.0.0.1', 62311): success
2025-06-26 00:49:38,219 - socket_server - INFO - Client ('127.0.0.1', 62311) closed connection
2025-06-26 00:49:38,220 - socket_server - INFO - Client ('127.0.0.1', 62311) disconnected
2025-06-26 00:50:11,593 - socket_server - INFO - New client connected from ('127.0.0.1', 62335)
2025-06-26 00:50:11,594 - socket_server - INFO - Received request from ('127.0.0.1', 62335): chat
2025-06-26 00:50:11,595 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:50:11,595 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:50:14,443 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:50:14,447 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:50:16,472 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 00:50:16,473 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 00:50:16,474 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance'}
2025-06-26 00:50:16,482 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 00:50:46,497 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 00:50:46,498 - socket_server - INFO - Sent response to ('127.0.0.1', 62335): error
2025-06-26 00:50:46,498 - socket_server - ERROR - Error handling client ('127.0.0.1', 62335): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 00:50:46,498 - socket_server - INFO - Client ('127.0.0.1', 62335) disconnected
2025-06-26 00:58:37,857 - socket_server - INFO - New client connected from ('127.0.0.1', 62534)
2025-06-26 00:58:37,867 - socket_server - INFO - Received request from ('127.0.0.1', 62534): chat
2025-06-26 00:58:37,875 - __main__ - INFO - Processing message for conversation 7
2025-06-26 00:58:37,876 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 00:58:42,073 - __main__ - INFO - MCP client initialized successfully
2025-06-26 00:58:42,090 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 00:59:12,377 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 00:59:12,380 - socket_server - INFO - Sent response to ('127.0.0.1', 62534): error
2025-06-26 00:59:12,380 - socket_server - ERROR - Error handling client ('127.0.0.1', 62534): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 00:59:12,381 - socket_server - INFO - Client ('127.0.0.1', 62534) disconnected
2025-06-26 01:01:25,024 - socket_server - INFO - New client connected from ('127.0.0.1', 62599)
2025-06-26 01:01:25,025 - socket_server - INFO - Received request from ('127.0.0.1', 62599): chat
2025-06-26 01:01:25,027 - __main__ - INFO - Processing message for conversation 7
2025-06-26 01:01:25,027 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 01:01:27,903 - __main__ - INFO - MCP client initialized successfully
2025-06-26 01:01:27,909 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 01:01:58,264 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 01:01:58,265 - socket_server - INFO - Sent response to ('127.0.0.1', 62599): error
2025-06-26 01:01:58,265 - socket_server - ERROR - Error handling client ('127.0.0.1', 62599): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 01:01:58,265 - socket_server - INFO - Client ('127.0.0.1', 62599) disconnected
2025-06-26 01:05:28,204 - socket_server - INFO - New client connected from ('127.0.0.1', 62647)
2025-06-26 01:05:28,206 - socket_server - INFO - Received request from ('127.0.0.1', 62647): chat
2025-06-26 01:05:28,208 - __main__ - INFO - Processing message for conversation 7
2025-06-26 01:05:28,209 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 01:05:32,041 - __main__ - INFO - MCP client initialized successfully
2025-06-26 01:05:32,053 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 01:06:02,454 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 01:06:02,456 - socket_server - INFO - Sent response to ('127.0.0.1', 62647): error
2025-06-26 01:06:02,456 - socket_server - ERROR - Error handling client ('127.0.0.1', 62647): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 01:06:02,456 - socket_server - INFO - Client ('127.0.0.1', 62647) disconnected
2025-06-26 08:59:56,922 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 09:02:26,016 - socket_server - INFO - New client connected from ('127.0.0.1', 64487)
2025-06-26 09:02:26,017 - socket_server - INFO - Received request from ('127.0.0.1', 64487): chat
2025-06-26 09:02:26,018 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:02:26,018 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:02:29,486 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:02:29,492 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:02:33,567 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:02:33,582 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 09:02:33,582 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:02:33,582 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 09:02:33,628 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 09:02:35,482 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:02:35,484 - socket_server - INFO - Sent response to ('127.0.0.1', 64487): error
2025-06-26 09:02:56,020 - socket_server - INFO - Client ('127.0.0.1', 64487) closed connection
2025-06-26 09:02:56,020 - socket_server - INFO - Client ('127.0.0.1', 64487) disconnected
2025-06-26 09:03:41,103 - socket_server - INFO - New client connected from ('127.0.0.1', 64754)
2025-06-26 09:03:41,121 - socket_server - INFO - Received request from ('127.0.0.1', 64754): chat
2025-06-26 09:03:41,147 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:03:41,150 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:03:45,583 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:03:45,604 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:03:48,829 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:03:48,838 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:03:48,839 - socket_server - INFO - Sent response to ('127.0.0.1', 64754): success
2025-06-26 09:03:56,486 - socket_server - INFO - New client connected from ('127.0.0.1', 64775)
2025-06-26 09:03:56,486 - socket_server - INFO - Received request from ('127.0.0.1', 64775): chat
2025-06-26 09:03:56,487 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:03:56,487 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:03:59,362 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:03:59,367 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:04:01,369 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:04:01,371 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 09:04:01,371 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:04:01,371 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 09:04:01,511 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 09:04:03,333 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:04:03,335 - socket_server - INFO - Sent response to ('127.0.0.1', 64775): error
2025-06-26 09:04:11,037 - socket_server - INFO - Client ('127.0.0.1', 64754) closed connection
2025-06-26 09:04:11,038 - socket_server - INFO - Client ('127.0.0.1', 64754) disconnected
2025-06-26 09:04:26,497 - socket_server - INFO - Client ('127.0.0.1', 64775) closed connection
2025-06-26 09:04:26,498 - socket_server - INFO - Client ('127.0.0.1', 64775) disconnected
2025-06-26 09:05:05,587 - socket_server - INFO - New client connected from ('127.0.0.1', 64808)
2025-06-26 09:05:05,587 - socket_server - INFO - Received request from ('127.0.0.1', 64808): chat
2025-06-26 09:05:05,589 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:05:05,590 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:05:09,033 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:05:09,039 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:05:11,128 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:05:11,130 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 09:05:11,130 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 09:05:11,130 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 09:05:11,158 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 09:05:23,824 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:05:23,825 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 09:05:23,826 - socket_server - INFO - Sent response to ('127.0.0.1', 64808): success
2025-06-26 09:05:35,588 - socket_server - INFO - Client ('127.0.0.1', 64808) closed connection
2025-06-26 09:05:35,588 - socket_server - INFO - Client ('127.0.0.1', 64808) disconnected
2025-06-26 09:06:19,940 - socket_server - INFO - New client connected from ('127.0.0.1', 64818)
2025-06-26 09:06:19,940 - socket_server - INFO - Received request from ('127.0.0.1', 64818): chat
2025-06-26 09:06:19,941 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:06:19,942 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:06:22,769 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:06:22,774 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:06:23,132 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:23,176 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:23,181 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:06:32,352 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:06:32,354 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:06:32,355 - socket_server - INFO - Sent response to ('127.0.0.1', 64818): success
2025-06-26 09:06:49,944 - socket_server - INFO - Client ('127.0.0.1', 64818) closed connection
2025-06-26 09:06:49,945 - socket_server - INFO - Client ('127.0.0.1', 64818) disconnected
2025-06-26 09:07:46,931 - socket_server - INFO - New client connected from ('127.0.0.1', 64834)
2025-06-26 09:07:46,932 - socket_server - INFO - Received request from ('127.0.0.1', 64834): chat
2025-06-26 09:07:46,933 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:07:46,934 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:07:49,912 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:07:49,917 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:08:11,388 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:08:11,389 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:08:11,390 - socket_server - INFO - Sent response to ('127.0.0.1', 64834): success
2025-06-26 09:08:16,938 - socket_server - INFO - Client ('127.0.0.1', 64834) closed connection
2025-06-26 09:08:16,938 - socket_server - INFO - Client ('127.0.0.1', 64834) disconnected
2025-06-26 09:21:17,922 - socket_server - INFO - New client connected from ('127.0.0.1', 65291)
2025-06-26 09:21:17,943 - socket_server - INFO - Received request from ('127.0.0.1', 65291): chat
2025-06-26 09:21:17,964 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:21:17,967 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:21:23,093 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:21:23,100 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:21:27,562 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:21:27,566 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:21:27,566 - socket_server - INFO - Sent response to ('127.0.0.1', 65291): success
2025-06-26 09:21:35,802 - socket_server - INFO - New client connected from ('127.0.0.1', 65301)
2025-06-26 09:21:35,804 - socket_server - INFO - Received request from ('127.0.0.1', 65301): chat
2025-06-26 09:21:35,805 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:21:35,805 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:21:38,821 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:21:38,826 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:21:44,036 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:21:44,038 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 09:21:44,038 - socket_server - INFO - Sent response to ('127.0.0.1', 65301): success
2025-06-26 09:21:47,844 - socket_server - INFO - Client ('127.0.0.1', 65291) closed connection
2025-06-26 09:21:47,844 - socket_server - INFO - Client ('127.0.0.1', 65291) disconnected
2025-06-26 09:22:05,809 - socket_server - INFO - Client ('127.0.0.1', 65301) closed connection
2025-06-26 09:22:05,809 - socket_server - INFO - Client ('127.0.0.1', 65301) disconnected
2025-06-26 09:24:41,595 - socket_server - INFO - New client connected from ('127.0.0.1', 65438)
2025-06-26 09:24:41,596 - socket_server - INFO - Received request from ('127.0.0.1', 65438): chat
2025-06-26 09:24:41,597 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:24:41,598 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:24:44,663 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:24:44,669 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:24:47,961 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:24:47,963 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 09:24:47,963 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance LIMIT 10;'}
2025-06-26 09:24:48,161 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 09:25:18,178 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 09:25:18,179 - socket_server - INFO - Sent response to ('127.0.0.1', 65438): error
2025-06-26 09:25:18,180 - socket_server - ERROR - Error handling client ('127.0.0.1', 65438): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:25:18,180 - socket_server - INFO - Client ('127.0.0.1', 65438) disconnected
2025-06-26 09:29:27,866 - socket_server - INFO - New client connected from ('127.0.0.1', 49222)
2025-06-26 09:29:27,870 - socket_server - INFO - Received request from ('127.0.0.1', 49222): chat
2025-06-26 09:29:27,881 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:29:27,882 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:29:32,201 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:29:32,254 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-44' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,290 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-45' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,301 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-46' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 09:29:32,322 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:30:02,587 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:30:02,589 - socket_server - INFO - Sent response to ('127.0.0.1', 49222): error
2025-06-26 09:30:02,589 - socket_server - ERROR - Error handling client ('127.0.0.1', 49222): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:30:02,589 - socket_server - INFO - Client ('127.0.0.1', 49222) disconnected
2025-06-26 09:30:58,717 - socket_server - INFO - New client connected from ('127.0.0.1', 49268)
2025-06-26 09:30:58,718 - socket_server - INFO - Received request from ('127.0.0.1', 49268): chat
2025-06-26 09:30:58,719 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:30:58,720 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:31:02,607 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:31:02,613 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:31:32,999 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:31:33,000 - socket_server - INFO - Sent response to ('127.0.0.1', 49268): error
2025-06-26 09:31:33,001 - socket_server - ERROR - Error handling client ('127.0.0.1', 49268): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:31:33,001 - socket_server - INFO - Client ('127.0.0.1', 49268) disconnected
2025-06-26 09:35:48,935 - socket_server - INFO - New client connected from ('127.0.0.1', 49386)
2025-06-26 09:35:48,937 - socket_server - INFO - Received request from ('127.0.0.1', 49386): chat
2025-06-26 09:35:48,942 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:35:48,943 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:35:52,960 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:35:52,974 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:36:23,294 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:36:23,296 - socket_server - INFO - Sent response to ('127.0.0.1', 49386): error
2025-06-26 09:36:23,297 - socket_server - ERROR - Error handling client ('127.0.0.1', 49386): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:36:23,297 - socket_server - INFO - Client ('127.0.0.1', 49386) disconnected
2025-06-26 09:38:50,022 - socket_server - INFO - New client connected from ('127.0.0.1', 49720)
2025-06-26 09:38:50,022 - socket_server - INFO - Received request from ('127.0.0.1', 49720): chat
2025-06-26 09:38:50,024 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:38:50,025 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:38:53,965 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:38:53,970 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:39:24,378 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:39:24,387 - socket_server - INFO - Sent response to ('127.0.0.1', 49720): error
2025-06-26 09:39:24,388 - socket_server - ERROR - Error handling client ('127.0.0.1', 49720): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:39:24,388 - socket_server - INFO - Client ('127.0.0.1', 49720) disconnected
2025-06-26 09:39:42,879 - socket_server - INFO - New client connected from ('127.0.0.1', 49754)
2025-06-26 09:39:42,880 - socket_server - INFO - Received request from ('127.0.0.1', 49754): chat
2025-06-26 09:39:42,881 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:39:42,881 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:39:46,074 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:39:46,080 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:40:16,479 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 09:40:16,481 - socket_server - INFO - Sent response to ('127.0.0.1', 49754): error
2025-06-26 09:40:16,481 - socket_server - ERROR - Error handling client ('127.0.0.1', 49754): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 09:40:16,481 - socket_server - INFO - Client ('127.0.0.1', 49754) disconnected
2025-06-26 09:40:28,027 - socket_server - INFO - New client connected from ('127.0.0.1', 49774)
2025-06-26 09:45:40,705 - socket_server - INFO - New client connected from ('127.0.0.1', 50080)
2025-06-26 09:46:16,885 - socket_server - INFO - Received request from ('127.0.0.1', 49774): chat
2025-06-26 09:46:16,885 - socket_server - INFO - Received request from ('127.0.0.1', 50080): chat
2025-06-26 09:46:16,899 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:16,900 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:16,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:16,901 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:17,054 - socket_server - INFO - Stopping server...
2025-06-26 09:46:17,055 - socket_server - INFO - Socket Server stopped
2025-06-26 09:46:17,056 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 09:46:17,056 - socket_server - INFO - Stopping server...
2025-06-26 09:46:17,056 - socket_server - INFO - Socket Server stopped
2025-06-26 09:46:27,048 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 09:46:29,783 - socket_server - INFO - New client connected from ('127.0.0.1', 50101)
2025-06-26 09:46:29,783 - socket_server - INFO - Received request from ('127.0.0.1', 50101): chat
2025-06-26 09:46:29,784 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:46:29,784 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:46:33,092 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:46:33,098 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:46:36,375 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:46:36,380 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 09:46:36,380 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `exam`.`categories` LIMIT 50'}
2025-06-26 09:46:36,388 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 09:46:39,030 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:46:39,032 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-26 09:46:39,033 - socket_server - INFO - Sent response to ('127.0.0.1', 50101): success
2025-06-26 09:46:59,784 - socket_server - INFO - Client ('127.0.0.1', 50101) closed connection
2025-06-26 09:46:59,785 - socket_server - INFO - Client ('127.0.0.1', 50101) disconnected
2025-06-26 09:59:18,141 - socket_server - INFO - New client connected from ('127.0.0.1', 50433)
2025-06-26 09:59:18,144 - socket_server - INFO - Received request from ('127.0.0.1', 50433): chat
2025-06-26 09:59:18,149 - __main__ - INFO - Processing message for conversation 7
2025-06-26 09:59:18,151 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 09:59:22,061 - __main__ - INFO - MCP client initialized successfully
2025-06-26 09:59:22,070 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 09:59:26,028 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:59:26,030 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 09:59:26,030 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 09:59:26,037 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 09:59:28,037 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 09:59:28,038 - socket_server - INFO - Sent response to ('127.0.0.1', 50433): error
2025-06-26 09:59:48,148 - socket_server - INFO - Client ('127.0.0.1', 50433) closed connection
2025-06-26 09:59:48,149 - socket_server - INFO - Client ('127.0.0.1', 50433) disconnected
2025-06-26 10:00:08,147 - socket_server - INFO - New client connected from ('127.0.0.1', 50461)
2025-06-26 10:00:08,148 - socket_server - INFO - Received request from ('127.0.0.1', 50461): chat
2025-06-26 10:00:08,149 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:00:08,149 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:00:11,685 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:00:11,691 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:00:27,420 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:00:27,422 - __main__ - INFO - Generated answer for conversation 7
2025-06-26 10:00:27,422 - __main__ - INFO - Final LLM answer: To provide you with the product that has the highest price, I'll need to know which database and table to look into. From the list of databases available, could you specify which database contains the products information?

Here is the list of databases available:

- abc
- authentic
- chat_socket
- chatbot
- chatbot_ai
- chatbotdb
- company
- customer
- duanmau
- exam
- exam1
- hoaphat2024
- laravel-gpt
- laravel_vuejs
- mvc_oop
- php-oop2
- php3_wd19314
- sakila
- test_chatbot
- web2014_database_asm01
- web2014_database_demo02
- web2014_database_lab03x04
- web2014_database_lab05x06
- web2014_database_lab07x08
- web2014_demo_mvc_database01
- web2014_demo_mvc_database02
- web2014_demo_opp_buoi1
- xaydungweb
- xdweb2

Please indicate which one should be used for retrieving the product information. If you're not sure, let me know the approximate details or characteristics of the products, and I might help identify the correct database.
2025-06-26 10:00:27,423 - socket_server - INFO - Sent response to ('127.0.0.1', 50461): success
2025-06-26 10:00:38,154 - socket_server - INFO - Client ('127.0.0.1', 50461) closed connection
2025-06-26 10:00:38,155 - socket_server - INFO - Client ('127.0.0.1', 50461) disconnected
2025-06-26 10:01:14,306 - socket_server - INFO - New client connected from ('127.0.0.1', 50511)
2025-06-26 10:01:14,307 - socket_server - INFO - Received request from ('127.0.0.1', 50511): chat
2025-06-26 10:01:14,308 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:01:14,309 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:01:17,527 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:01:17,532 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:01:19,920 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:19,921 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:01:19,922 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:01:19,924 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 10:01:19,931 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:01:22,588 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:22,590 - socket_server - INFO - Sent response to ('127.0.0.1', 50511): error
2025-06-26 10:01:44,313 - socket_server - INFO - Client ('127.0.0.1', 50511) closed connection
2025-06-26 10:01:44,314 - socket_server - INFO - Client ('127.0.0.1', 50511) disconnected
2025-06-26 10:01:48,081 - socket_server - INFO - New client connected from ('127.0.0.1', 50531)
2025-06-26 10:01:48,081 - socket_server - INFO - Received request from ('127.0.0.1', 50531): chat
2025-06-26 10:01:48,082 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:01:48,083 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:01:51,315 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:01:51,320 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:01:51,709 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:51,746 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:51,750 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:01:54,103 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:54,106 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:01:54,107 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:01:54,107 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:01:54,118 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:01:56,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:01:56,412 - socket_server - INFO - Sent response to ('127.0.0.1', 50531): error
2025-06-26 10:02:18,079 - socket_server - INFO - Client ('127.0.0.1', 50531) closed connection
2025-06-26 10:02:18,080 - socket_server - INFO - Client ('127.0.0.1', 50531) disconnected
2025-06-26 10:04:41,591 - socket_server - INFO - New client connected from ('127.0.0.1', 50659)
2025-06-26 10:04:41,591 - socket_server - INFO - Received request from ('127.0.0.1', 50659): chat
2025-06-26 10:04:41,592 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:04:41,593 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:04:54,021 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:04:54,026 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:04:56,463 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:04:56,465 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:04:56,465 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `php3_wd19314`.`categories` LIMIT 50'}
2025-06-26 10:04:56,533 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:05:26,548 - __main__ - ERROR - LLM timeout after tool calls
2025-06-26 10:05:26,548 - socket_server - INFO - Sent response to ('127.0.0.1', 50659): error
2025-06-26 10:05:26,550 - socket_server - ERROR - Error handling client ('127.0.0.1', 50659): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 10:05:26,550 - socket_server - INFO - Client ('127.0.0.1', 50659) disconnected
2025-06-26 10:07:18,123 - socket_server - INFO - New client connected from ('127.0.0.1', 50764)
2025-06-26 10:07:18,123 - socket_server - INFO - Received request from ('127.0.0.1', 50764): chat
2025-06-26 10:07:18,125 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:07:18,125 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:07:21,734 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:07:21,743 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:07:52,431 - openai._base_client - INFO - Retrying request to /chat/completions in 0.378377 seconds
2025-06-26 10:08:22,099 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:08:22,101 - socket_server - INFO - Sent response to ('127.0.0.1', 50764): error
2025-06-26 10:08:48,122 - socket_server - INFO - Client ('127.0.0.1', 50764) closed connection
2025-06-26 10:08:48,122 - socket_server - INFO - Client ('127.0.0.1', 50764) disconnected
2025-06-26 10:10:27,275 - socket_server - INFO - New client connected from ('127.0.0.1', 50850)
2025-06-26 10:10:27,275 - socket_server - INFO - Received request from ('127.0.0.1', 50850): chat
2025-06-26 10:10:27,276 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:10:27,276 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:10:30,257 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:10:30,262 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:11:00,844 - openai._base_client - INFO - Retrying request to /chat/completions in 0.406044 seconds
2025-06-26 10:11:30,592 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:11:30,594 - socket_server - INFO - Sent response to ('127.0.0.1', 50850): error
2025-06-26 10:11:57,282 - socket_server - INFO - Client ('127.0.0.1', 50850) closed connection
2025-06-26 10:11:57,282 - socket_server - INFO - Client ('127.0.0.1', 50850) disconnected
2025-06-26 10:14:13,830 - socket_server - INFO - New client connected from ('127.0.0.1', 50975)
2025-06-26 10:14:13,831 - socket_server - INFO - Received request from ('127.0.0.1', 50975): chat
2025-06-26 10:14:13,834 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:14:13,834 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:14:17,434 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:14:17,441 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:14:48,159 - openai._base_client - INFO - Retrying request to /chat/completions in 0.449149 seconds
2025-06-26 10:15:17,808 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:15:17,810 - socket_server - INFO - Sent response to ('127.0.0.1', 50975): error
2025-06-26 10:15:43,828 - socket_server - INFO - Client ('127.0.0.1', 50975) closed connection
2025-06-26 10:15:43,828 - socket_server - INFO - Client ('127.0.0.1', 50975) disconnected
2025-06-26 10:19:07,466 - socket_server - INFO - New client connected from ('127.0.0.1', 51132)
2025-06-26 10:19:07,471 - socket_server - INFO - Received request from ('127.0.0.1', 51132): chat
2025-06-26 10:19:07,476 - __main__ - INFO - Processing message for conversation 7
2025-06-26 10:19:07,477 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:19:11,499 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:19:11,520 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:19:43,117 - openai._base_client - INFO - Retrying request to /chat/completions in 0.410184 seconds
2025-06-26 10:20:11,886 - __main__ - ERROR - Timeout processing message for conversation 7
2025-06-26 10:20:11,888 - socket_server - INFO - Sent response to ('127.0.0.1', 51132): error
2025-06-26 10:20:37,452 - socket_server - INFO - Client ('127.0.0.1', 51132) closed connection
2025-06-26 10:20:37,453 - socket_server - INFO - Client ('127.0.0.1', 51132) disconnected
2025-06-26 10:22:41,531 - socket_server - INFO - New client connected from ('127.0.0.1', 51231)
2025-06-26 10:22:41,532 - socket_server - INFO - Received request from ('127.0.0.1', 51231): chat
2025-06-26 10:22:41,534 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:22:41,535 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:22:45,097 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:22:45,103 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:22:48,506 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:22:48,515 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:22:48,516 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:22:48,597 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:23:01,861 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:23:01,862 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:23:01,863 - socket_server - INFO - Sent response to ('127.0.0.1', 51231): success
2025-06-26 10:24:01,867 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51231)
2025-06-26 10:24:01,868 - socket_server - INFO - Client ('127.0.0.1', 51231) disconnected
2025-06-26 10:24:24,292 - socket_server - INFO - New client connected from ('127.0.0.1', 51311)
2025-06-26 10:24:24,292 - socket_server - INFO - Received request from ('127.0.0.1', 51311): chat
2025-06-26 10:24:24,293 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:24:24,293 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:24:27,014 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:24:27,018 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:24:29,884 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:24:29,885 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:24:29,885 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:24:29,886 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 10:24:29,891 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:24:32,756 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:24:32,757 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:24:32,757 - socket_server - INFO - Sent response to ('127.0.0.1', 51311): success
2025-06-26 10:24:55,372 - socket_server - INFO - New client connected from ('127.0.0.1', 51322)
2025-06-26 10:24:55,373 - socket_server - INFO - Received request from ('127.0.0.1', 51322): chat
2025-06-26 10:24:55,374 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:24:55,375 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:24:58,451 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:24:58,455 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:24:58,851 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-60' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:24:58,865 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-61' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:25:00,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:00,564 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:25:00,564 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:25:00,564 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:25:00,573 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:25:02,356 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:02,357 - socket_server - INFO - Sent response to ('127.0.0.1', 51322): error
2025-06-26 10:25:32,759 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51311)
2025-06-26 10:25:32,759 - socket_server - INFO - Client ('127.0.0.1', 51311) disconnected
2025-06-26 10:25:35,474 - socket_server - INFO - New client connected from ('127.0.0.1', 51339)
2025-06-26 10:25:35,474 - socket_server - INFO - Received request from ('127.0.0.1', 51339): chat
2025-06-26 10:25:35,475 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:25:35,475 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:25:38,180 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:25:38,184 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:25:43,617 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:25:43,618 - __main__ - INFO - Generated answer for conversation 9
2025-06-26 10:25:43,643 - socket_server - INFO - Sent response to ('127.0.0.1', 51339): success
2025-06-26 10:26:02,363 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51322)
2025-06-26 10:26:02,363 - socket_server - INFO - Client ('127.0.0.1', 51322) disconnected
2025-06-26 10:26:30,253 - socket_server - INFO - New client connected from ('127.0.0.1', 51581)
2025-06-26 10:26:30,254 - socket_server - INFO - Received request from ('127.0.0.1', 51581): chat
2025-06-26 10:26:30,255 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:26:30,255 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:26:33,028 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:26:33,032 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:26:36,006 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:26:36,007 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:26:36,007 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `subsidiaries`;'}
2025-06-26 10:26:36,014 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:26:36,014 - __main__ - ERROR - Tool call error: 1046 (3D000): No database selected
2025-06-26 10:26:36,015 - socket_server - INFO - Sent response to ('127.0.0.1', 51581): error
2025-06-26 10:26:43,649 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 51339)
2025-06-26 10:26:43,650 - socket_server - INFO - Client ('127.0.0.1', 51339) disconnected
2025-06-26 10:27:05,291 - socket_server - INFO - New client connected from ('127.0.0.1', 51595)
2025-06-26 10:27:05,292 - socket_server - INFO - Received request from ('127.0.0.1', 51595): chat
2025-06-26 10:27:05,293 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:27:05,294 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:27:08,213 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:27:08,217 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:27:11,813 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 10:27:11,829 - __main__ - ERROR - Error processing message for conversation 9: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[16].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-709e69b1-eea6-9f0d-9ddd-4fe370a9d826', 'request_id': '709e69b1-eea6-9f0d-9ddd-4fe370a9d826'}
2025-06-26 10:27:11,830 - socket_server - INFO - Sent response to ('127.0.0.1', 51595): error
2025-06-26 10:27:19,426 - socket_server - INFO - Stopping server...
2025-06-26 10:27:19,426 - socket_server - INFO - Socket Server stopped
2025-06-26 10:27:19,427 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:27:19,427 - socket_server - INFO - Stopping server...
2025-06-26 10:27:19,427 - socket_server - INFO - Socket Server stopped
2025-06-26 10:27:26,504 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:28:04,087 - socket_server - INFO - New client connected from ('127.0.0.1', 51605)
2025-06-26 10:28:04,087 - socket_server - INFO - Received request from ('127.0.0.1', 51605): chat
2025-06-26 10:28:04,088 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:28:04,088 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:28:06,869 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:28:06,874 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:28:07,168 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:28:13,212 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:28:13,214 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:28:13,214 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:28:13,214 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:28:13,219 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:28:13,219 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:28:13,220 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:28:14,790 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:28:14,791 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:28:14,792 - socket_server - INFO - Sent response to ('127.0.0.1', 51605): error
2025-06-26 10:28:58,096 - socket_server - INFO - New client connected from ('127.0.0.1', 51661)
2025-06-26 10:28:58,097 - socket_server - INFO - Received request from ('127.0.0.1', 51661): chat
2025-06-26 10:28:58,098 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:28:58,098 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:29:00,781 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:29:00,785 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:29:01,104 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:29:03,144 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:29:03,145 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:29:03,145 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:29:03,145 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'company'}
2025-06-26 10:29:03,146 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/company
2025-06-26 10:29:03,152 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:29:03,152 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:29:03,153 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:29:05,368 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:29:05,369 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:29:05,370 - socket_server - INFO - Sent response to ('127.0.0.1', 51661): error
2025-06-26 10:29:34,085 - socket_server - INFO - Client ('127.0.0.1', 51605) closed connection
2025-06-26 10:29:34,085 - socket_server - INFO - Client ('127.0.0.1', 51605) disconnected
2025-06-26 10:30:28,098 - socket_server - INFO - Client ('127.0.0.1', 51661) closed connection
2025-06-26 10:30:28,098 - socket_server - INFO - Client ('127.0.0.1', 51661) disconnected
2025-06-26 10:30:30,889 - socket_server - INFO - New client connected from ('127.0.0.1', 51830)
2025-06-26 10:30:30,889 - socket_server - INFO - Received request from ('127.0.0.1', 51830): chat
2025-06-26 10:30:30,890 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:30:30,890 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:30:33,860 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:30:33,864 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:30:34,247 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:30:35,987 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:30:35,988 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:30:35,988 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:30:35,988 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'company'}
2025-06-26 10:30:35,988 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/company
2025-06-26 10:30:35,997 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:30:35,997 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:30:35,997 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:30:39,633 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:30:39,635 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:30:39,635 - socket_server - INFO - Sent response to ('127.0.0.1', 51830): success
2025-06-26 10:31:03,309 - socket_server - INFO - New client connected from ('127.0.0.1', 51854)
2025-06-26 10:31:03,309 - socket_server - INFO - Received request from ('127.0.0.1', 51854): chat
2025-06-26 10:31:03,310 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:31:03,311 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:31:06,157 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:31:06,161 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:31:06,513 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:31:09,306 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:31:09,307 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:31:09,307 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:31:09,307 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:31:09,307 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 10:31:09,325 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:31:09,325 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:31:09,325 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:31:10,980 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:31:10,981 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:31:10,982 - socket_server - INFO - Sent response to ('127.0.0.1', 51854): error
2025-06-26 10:32:00,891 - socket_server - INFO - Client ('127.0.0.1', 51830) closed connection
2025-06-26 10:32:00,892 - socket_server - INFO - Client ('127.0.0.1', 51830) disconnected
2025-06-26 10:32:33,313 - socket_server - INFO - Client ('127.0.0.1', 51854) closed connection
2025-06-26 10:32:33,313 - socket_server - INFO - Client ('127.0.0.1', 51854) disconnected
2025-06-26 10:32:43,021 - socket_server - INFO - New client connected from ('127.0.0.1', 51918)
2025-06-26 10:32:43,021 - socket_server - INFO - Received request from ('127.0.0.1', 51918): chat
2025-06-26 10:32:43,024 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:32:43,024 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:32:45,983 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:32:45,987 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:32:46,251 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:32:46,261 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:46,284 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:46,288 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:32:49,677 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:32:49,679 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:32:49,680 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:32:49,680 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:32:49,680 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:32:49,687 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:32:49,688 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:32:49,688 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:32:51,746 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:32:51,747 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:32:51,748 - socket_server - INFO - Sent response to ('127.0.0.1', 51918): error
2025-06-26 10:34:13,031 - socket_server - INFO - Client ('127.0.0.1', 51918) closed connection
2025-06-26 10:34:13,031 - socket_server - INFO - Client ('127.0.0.1', 51918) disconnected
2025-06-26 10:36:00,670 - socket_server - INFO - New client connected from ('127.0.0.1', 52003)
2025-06-26 10:36:00,670 - socket_server - INFO - Received request from ('127.0.0.1', 52003): chat
2025-06-26 10:36:00,674 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:36:00,675 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:36:04,359 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:36:04,366 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:36:04,618 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:36:07,311 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:36:07,314 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:36:07,314 - __main__ - INFO - Executing tool call 1/1: sql_query_db
2025-06-26 10:36:07,314 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.subsidiaries;'}
2025-06-26 10:36:07,370 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:36:07,370 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:36:07,371 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:36:31,661 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:36:31,663 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:36:31,664 - socket_server - INFO - Sent response to ('127.0.0.1', 52003): success
2025-06-26 10:37:30,673 - socket_server - INFO - Client ('127.0.0.1', 52003) closed connection
2025-06-26 10:37:30,674 - socket_server - INFO - Client ('127.0.0.1', 52003) disconnected
2025-06-26 10:37:40,264 - socket_server - INFO - New client connected from ('127.0.0.1', 52024)
2025-06-26 10:37:40,265 - socket_server - INFO - Received request from ('127.0.0.1', 52024): chat
2025-06-26 10:37:40,266 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:37:40,266 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:37:43,673 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:37:43,678 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:37:43,930 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:37:46,531 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:37:46,532 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:37:46,532 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-26 10:37:46,532 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:37:46,594 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:37:46,594 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:37:46,595 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:37:53,433 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:37:53,435 - __main__ - INFO - Generated answer after tool call for conversation 9
2025-06-26 10:37:53,436 - socket_server - INFO - Sent response to ('127.0.0.1', 52024): success
2025-06-26 10:38:21,244 - socket_server - INFO - New client connected from ('127.0.0.1', 52041)
2025-06-26 10:38:21,244 - socket_server - INFO - Received request from ('127.0.0.1', 52041): chat
2025-06-26 10:38:21,245 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:38:21,246 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:38:24,171 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:38:24,176 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:38:24,434 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:38:29,285 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:38:29,287 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:38:29,287 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_tables/{db_name*}
2025-06-26 10:38:29,287 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:38:29,287 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 10:38:29,322 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 10:38:29,323 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:38:29,323 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:38:31,860 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:38:31,861 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:38:31,862 - socket_server - INFO - Sent response to ('127.0.0.1', 52041): error
2025-06-26 10:38:55,533 - socket_server - INFO - New client connected from ('127.0.0.1', 52051)
2025-06-26 10:38:55,534 - socket_server - INFO - Received request from ('127.0.0.1', 52051): chat
2025-06-26 10:38:55,535 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:38:55,535 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:38:58,281 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:38:58,285 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:38:58,542 - __main__ - INFO - Making initial LLM call...
2025-06-26 10:38:58,551 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:38:58,557 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:38:58,561 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:39:01,009 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:39:01,010 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:39:01,010 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/schema/{db_name*}
2025-06-26 10:39:01,010 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:39:01,010 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:39:01,023 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:39:01,024 - __main__ - INFO - Tool call 1 completed successfully
2025-06-26 10:39:01,024 - __main__ - INFO - Making final LLM call after tool execution...
2025-06-26 10:39:05,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:39:05,152 - __main__ - WARNING - Unexpected finish reason after tool calls: tool_calls
2025-06-26 10:39:05,152 - socket_server - INFO - Sent response to ('127.0.0.1', 52051): error
2025-06-26 10:39:10,275 - socket_server - INFO - Client ('127.0.0.1', 52024) closed connection
2025-06-26 10:39:10,275 - socket_server - INFO - Client ('127.0.0.1', 52024) disconnected
2025-06-26 10:39:51,253 - socket_server - INFO - Client ('127.0.0.1', 52041) closed connection
2025-06-26 10:39:51,253 - socket_server - INFO - Client ('127.0.0.1', 52041) disconnected
2025-06-26 10:40:25,533 - socket_server - INFO - Client ('127.0.0.1', 52051) closed connection
2025-06-26 10:40:25,533 - socket_server - INFO - Client ('127.0.0.1', 52051) disconnected
2025-06-26 10:40:45,400 - socket_server - INFO - Stopping server...
2025-06-26 10:40:45,401 - socket_server - INFO - Socket Server stopped
2025-06-26 10:40:45,401 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:40:45,401 - socket_server - INFO - Stopping server...
2025-06-26 10:40:45,402 - socket_server - INFO - Socket Server stopped
2025-06-26 10:40:50,283 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:41:03,017 - socket_server - INFO - New client connected from ('127.0.0.1', 52110)
2025-06-26 10:41:03,017 - socket_server - INFO - Received request from ('127.0.0.1', 52110): chat
2025-06-26 10:41:03,018 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:41:03,019 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:41:05,899 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:41:05,904 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:41:08,478 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:41:08,480 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:41:08,481 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:41:08,481 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:41:08,481 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:41:08,489 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:41:10,777 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:41:10,778 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:41:10,778 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:41:10,778 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `products` ORDER BY `gia` DESC LIMIT 20;'}
2025-06-26 10:41:10,782 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:41:10,782 - __main__ - ERROR - Tool call error: 1046 (3D000): No database selected
2025-06-26 10:41:10,783 - socket_server - INFO - Sent response to ('127.0.0.1', 52110): error
2025-06-26 10:42:18,112 - socket_server - INFO - New client connected from ('127.0.0.1', 52139)
2025-06-26 10:42:18,113 - socket_server - INFO - Received request from ('127.0.0.1', 52139): chat
2025-06-26 10:42:18,113 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:42:18,114 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:42:20,937 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:42:20,941 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:42:21,642 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-26 10:42:21,643 - __main__ - ERROR - Error processing message for conversation 9: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[5].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-70d64a7a-8f9e-9b7e-94e0-5cc86483a852', 'request_id': '70d64a7a-8f9e-9b7e-94e0-5cc86483a852'}
2025-06-26 10:42:21,643 - socket_server - INFO - Sent response to ('127.0.0.1', 52139): error
2025-06-26 10:42:33,015 - socket_server - INFO - Client ('127.0.0.1', 52110) closed connection
2025-06-26 10:42:33,016 - socket_server - INFO - Client ('127.0.0.1', 52110) disconnected
2025-06-26 10:42:34,195 - socket_server - INFO - Stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Socket Server stopped
2025-06-26 10:42:34,195 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Stopping server...
2025-06-26 10:42:34,195 - socket_server - INFO - Socket Server stopped
2025-06-26 10:42:38,705 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 10:42:41,283 - socket_server - INFO - New client connected from ('127.0.0.1', 52151)
2025-06-26 10:42:41,283 - socket_server - INFO - Received request from ('127.0.0.1', 52151): chat
2025-06-26 10:42:41,284 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:42:41,284 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:42:44,122 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:42:44,126 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:42:44,410 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:42:47,524 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:42:47,526 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:42:47,527 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:42:47,527 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:42:47,527 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:42:47,527 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:42:47,537 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:42:47,537 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:42:55,828 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:42:55,829 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:42:55,830 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:42:55,830 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:42:55,830 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ma_san_pham, ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 10:42:55,838 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:42:55,838 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:43:19,119 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:43:19,120 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:43:19,120 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:43:19,121 - socket_server - INFO - Sent response to ('127.0.0.1', 52151): success
2025-06-26 10:44:11,291 - socket_server - INFO - Client ('127.0.0.1', 52151) closed connection
2025-06-26 10:44:11,292 - socket_server - INFO - Client ('127.0.0.1', 52151) disconnected
2025-06-26 10:46:49,905 - socket_server - INFO - New client connected from ('127.0.0.1', 52239)
2025-06-26 10:46:49,909 - socket_server - INFO - Received request from ('127.0.0.1', 52239): chat
2025-06-26 10:46:49,920 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:46:49,921 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:46:53,433 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:46:53,446 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:46:53,829 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:46:56,659 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:46:56,668 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:46:56,668 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:46:56,668 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:46:56,668 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT id, ho_ten, email, so_dien_thoai FROM php3_wd19314.customers LIMIT 20;'}
2025-06-26 10:46:56,678 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:46:56,679 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:47:23,389 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:47:23,391 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:47:23,391 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:47:23,393 - socket_server - INFO - Sent response to ('127.0.0.1', 52239): success
2025-06-26 10:48:19,894 - socket_server - INFO - Client ('127.0.0.1', 52239) closed connection
2025-06-26 10:48:19,895 - socket_server - INFO - Client ('127.0.0.1', 52239) disconnected
2025-06-26 10:52:52,604 - socket_server - INFO - New client connected from ('127.0.0.1', 52376)
2025-06-26 10:52:52,611 - socket_server - INFO - Received request from ('127.0.0.1', 52376): chat
2025-06-26 10:52:52,621 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:52:52,622 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:52:56,532 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:52:56,546 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:52:56,890 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:53:00,623 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:00,625 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:53:00,625 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:53:00,625 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:53:00,626 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:53:00,627 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:53:00,712 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:53:00,713 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:53:03,635 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:03,636 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:53:03,636 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:53:03,636 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:53:03,637 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT id, name, email, role FROM php3_wd19314.users WHERE role = 'admin';"}
2025-06-26 10:53:03,651 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:53:03,652 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:53:10,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:53:10,016 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:53:10,017 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:53:10,017 - socket_server - INFO - Sent response to ('127.0.0.1', 52376): success
2025-06-26 10:54:22,577 - socket_server - INFO - Client ('127.0.0.1', 52376) closed connection
2025-06-26 10:54:22,577 - socket_server - INFO - Client ('127.0.0.1', 52376) disconnected
2025-06-26 10:54:34,192 - socket_server - INFO - New client connected from ('127.0.0.1', 52410)
2025-06-26 10:54:34,192 - socket_server - INFO - Received request from ('127.0.0.1', 52410): chat
2025-06-26 10:54:34,193 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:54:34,193 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:54:37,044 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:54:37,048 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:54:37,316 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:54:41,996 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:54:41,997 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:54:41,997 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:54:41,997 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:54:41,997 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:54:41,998 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:54:42,012 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:54:42,012 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:54:53,011 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:54:53,012 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:54:53,012 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:54:53,013 - socket_server - INFO - Sent response to ('127.0.0.1', 52410): success
2025-06-26 10:55:07,062 - socket_server - INFO - New client connected from ('127.0.0.1', 52420)
2025-06-26 10:55:07,062 - socket_server - INFO - Received request from ('127.0.0.1', 52420): chat
2025-06-26 10:55:07,063 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:55:07,063 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:55:10,041 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:55:10,060 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,092 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,095 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 10:55:10,103 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:55:10,358 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:55:12,055 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:12,057 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:12,058 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:12,058 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 10:55:12,058 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 10:55:12,070 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 10:55:12,071 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:55:14,507 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:14,508 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:14,509 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:14,509 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:55:14,509 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 10:55:14,509 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 10:55:14,516 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:55:14,517 - __main__ - INFO - LLM iteration 3/10
2025-06-26 10:55:17,106 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:17,107 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:55:17,107 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:55:17,107 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:55:17,107 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.highlights_2024;'}
2025-06-26 10:55:17,112 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:55:17,113 - __main__ - INFO - LLM iteration 4/10
2025-06-26 10:55:40,568 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:55:40,569 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 10:55:40,569 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 10:55:40,570 - socket_server - INFO - Sent response to ('127.0.0.1', 52420): success
2025-06-26 10:56:04,203 - socket_server - INFO - Client ('127.0.0.1', 52410) closed connection
2025-06-26 10:56:04,203 - socket_server - INFO - Client ('127.0.0.1', 52410) disconnected
2025-06-26 10:56:37,063 - socket_server - INFO - Client ('127.0.0.1', 52420) closed connection
2025-06-26 10:56:37,063 - socket_server - INFO - Client ('127.0.0.1', 52420) disconnected
2025-06-26 10:59:36,329 - socket_server - INFO - New client connected from ('127.0.0.1', 52546)
2025-06-26 10:59:36,330 - socket_server - INFO - Received request from ('127.0.0.1', 52546): chat
2025-06-26 10:59:36,333 - __main__ - INFO - Processing message for conversation 9
2025-06-26 10:59:36,334 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 10:59:39,599 - __main__ - INFO - MCP client initialized successfully
2025-06-26 10:59:39,604 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 10:59:39,858 - __main__ - INFO - LLM iteration 1/10
2025-06-26 10:59:46,408 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:59:46,409 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:59:46,410 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:59:46,410 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 10:59:46,410 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 10:59:46,410 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 10:59:46,428 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 10:59:46,429 - __main__ - INFO - LLM iteration 2/10
2025-06-26 10:59:50,600 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 10:59:50,601 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 10:59:50,601 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 10:59:50,601 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 10:59:50,602 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT id, ma_khach_hang, ma_san_pham, so_luong, gia, gia_khuyen_mai FROM php3_wd19314.carts;'}
2025-06-26 10:59:50,614 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 10:59:50,614 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:00:00,360 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:00,363 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:00:00,364 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:00:00,365 - socket_server - INFO - Sent response to ('127.0.0.1', 52546): success
2025-06-26 11:00:21,991 - socket_server - INFO - New client connected from ('127.0.0.1', 52567)
2025-06-26 11:00:21,991 - socket_server - INFO - Received request from ('127.0.0.1', 52567): chat
2025-06-26 11:00:21,993 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:00:21,993 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:00:24,949 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:00:24,955 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:00:25,214 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:00:29,164 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:29,165 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:00:29,165 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:00:29,165 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 11:00:29,166 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 11:00:29,166 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 11:00:29,183 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 11:00:29,183 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:00:45,832 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:00:45,833 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:00:45,833 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:00:45,834 - socket_server - INFO - Sent response to ('127.0.0.1', 52567): success
2025-06-26 11:01:06,338 - socket_server - INFO - Client ('127.0.0.1', 52546) closed connection
2025-06-26 11:01:06,339 - socket_server - INFO - Client ('127.0.0.1', 52546) disconnected
2025-06-26 11:01:51,997 - socket_server - INFO - Client ('127.0.0.1', 52567) closed connection
2025-06-26 11:01:51,997 - socket_server - INFO - Client ('127.0.0.1', 52567) disconnected
2025-06-26 11:18:29,333 - socket_server - INFO - New client connected from ('127.0.0.1', 52814)
2025-06-26 11:18:29,348 - socket_server - INFO - Received request from ('127.0.0.1', 52814): chat
2025-06-26 11:18:29,369 - __main__ - INFO - Processing message for conversation 11
2025-06-26 11:18:29,372 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:18:33,736 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:18:33,752 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:18:34,028 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:18:37,564 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:37,572 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:18:37,572 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:18:37,572 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 11:18:37,573 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 11:18:37,767 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 11:18:37,767 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:18:39,043 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:39,044 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:18:39,044 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:18:39,045 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 11:18:39,831 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 11:18:39,831 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:18:57,102 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:18:57,104 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:18:57,104 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 11:18:57,106 - socket_server - INFO - Sent response to ('127.0.0.1', 52814): success
2025-06-26 11:19:05,713 - socket_server - INFO - New client connected from ('127.0.0.1', 52831)
2025-06-26 11:19:05,713 - socket_server - INFO - Received request from ('127.0.0.1', 52831): chat
2025-06-26 11:19:05,715 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:19:05,715 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:19:05,743 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,765 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,773 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:05,779 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-43' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:19:08,662 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:19:08,667 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:19:08,911 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:19:20,273 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:20,288 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:19:20,288 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:19:20,288 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 11:19:20,289 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 11:19:20,289 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 11:19:20,394 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 11:19:20,394 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:19:27,639 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:27,640 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:19:27,640 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:19:27,640 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 11:19:27,640 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT SubsidiaryName, OwnershipPercentage FROM hoaphat2024.subsidiaries;'}
2025-06-26 11:19:27,669 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 11:19:27,669 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:19:53,685 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:19:53,686 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:19:53,686 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:19:53,687 - socket_server - INFO - Sent response to ('127.0.0.1', 52831): success
2025-06-26 11:19:59,282 - socket_server - INFO - Client ('127.0.0.1', 52814) closed connection
2025-06-26 11:19:59,283 - socket_server - INFO - Client ('127.0.0.1', 52814) disconnected
2025-06-26 11:20:35,720 - socket_server - INFO - Client ('127.0.0.1', 52831) closed connection
2025-06-26 11:20:35,721 - socket_server - INFO - Client ('127.0.0.1', 52831) disconnected
2025-06-26 11:27:22,512 - socket_server - INFO - New client connected from ('127.0.0.1', 52885)
2025-06-26 11:27:22,512 - socket_server - INFO - Received request from ('127.0.0.1', 52885): chat
2025-06-26 11:27:22,513 - __main__ - INFO - Processing message for conversation 11
2025-06-26 11:27:22,514 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:27:25,385 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:27:25,390 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:27:25,634 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:27:28,971 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:28,972 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:27:28,973 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:27:28,973 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 11:27:28,973 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 11:27:29,062 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 11:27:29,063 - __main__ - INFO - LLM iteration 2/10
2025-06-26 11:27:30,531 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:30,533 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 11:27:30,533 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 11:27:30,533 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 11:27:30,533 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'technical improvement initiatives summary'}
2025-06-26 11:27:31,056 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 11:27:31,056 - __main__ - INFO - LLM iteration 3/10
2025-06-26 11:27:44,596 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:27:44,598 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:27:44,598 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 11:27:44,599 - socket_server - INFO - Sent response to ('127.0.0.1', 52885): success
2025-06-26 11:28:52,520 - socket_server - INFO - Client ('127.0.0.1', 52885) closed connection
2025-06-26 11:28:52,520 - socket_server - INFO - Client ('127.0.0.1', 52885) disconnected
2025-06-26 11:42:22,045 - socket_server - INFO - New client connected from ('127.0.0.1', 53445)
2025-06-26 11:42:22,093 - socket_server - INFO - Received request from ('127.0.0.1', 53445): chat
2025-06-26 11:42:22,118 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:42:22,120 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:42:26,412 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:42:26,423 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:42:26,720 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:42:34,373 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:42:34,380 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:42:34,380 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:42:34,383 - socket_server - INFO - Sent response to ('127.0.0.1', 53445): success
2025-06-26 11:42:43,545 - socket_server - INFO - New client connected from ('127.0.0.1', 53475)
2025-06-26 11:42:43,545 - socket_server - INFO - Received request from ('127.0.0.1', 53475): chat
2025-06-26 11:42:43,546 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:42:43,547 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:42:46,570 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:42:46,574 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:42:46,886 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:42:50,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:42:50,152 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:42:50,152 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:42:50,153 - socket_server - INFO - Sent response to ('127.0.0.1', 53475): success
2025-06-26 11:43:51,977 - socket_server - INFO - Client ('127.0.0.1', 53445) closed connection
2025-06-26 11:43:51,978 - socket_server - INFO - Client ('127.0.0.1', 53445) disconnected
2025-06-26 11:44:13,558 - socket_server - INFO - Client ('127.0.0.1', 53475) closed connection
2025-06-26 11:44:13,558 - socket_server - INFO - Client ('127.0.0.1', 53475) disconnected
2025-06-26 11:46:04,920 - socket_server - INFO - New client connected from ('127.0.0.1', 53626)
2025-06-26 11:46:04,923 - socket_server - INFO - Received request from ('127.0.0.1', 53626): chat
2025-06-26 11:46:04,929 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:46:04,929 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:46:08,398 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:46:08,409 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:46:08,791 - socket_server - INFO - New client connected from ('127.0.0.1', 53635)
2025-06-26 11:46:08,792 - socket_server - INFO - Received request from ('127.0.0.1', 53635): chat
2025-06-26 11:46:08,793 - __main__ - INFO - Processing message for conversation 9
2025-06-26 11:46:08,793 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 11:46:08,815 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:46:08,846 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-64' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,866 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-65' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,875 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-66' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:08,883 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-67' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 11:46:11,589 - __main__ - INFO - MCP client initialized successfully
2025-06-26 11:46:11,594 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 11:46:11,771 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:46:11,773 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:46:11,774 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:46:11,774 - socket_server - INFO - Sent response to ('127.0.0.1', 53626): success
2025-06-26 11:46:11,926 - __main__ - INFO - LLM iteration 1/10
2025-06-26 11:46:27,524 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 11:46:27,526 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 11:46:27,527 - __main__ - INFO - Generated final answer for conversation 9
2025-06-26 11:46:27,527 - socket_server - INFO - Sent response to ('127.0.0.1', 53635): success
2025-06-26 11:47:34,917 - socket_server - INFO - Client ('127.0.0.1', 53626) closed connection
2025-06-26 11:47:34,918 - socket_server - INFO - Client ('127.0.0.1', 53626) disconnected
2025-06-26 11:47:38,797 - socket_server - INFO - Client ('127.0.0.1', 53635) closed connection
2025-06-26 11:47:38,797 - socket_server - INFO - Client ('127.0.0.1', 53635) disconnected
2025-06-26 12:11:11,432 - socket_server - INFO - New client connected from ('127.0.0.1', 54893)
2025-06-26 12:11:11,447 - socket_server - INFO - Received request from ('127.0.0.1', 54893): chat
2025-06-26 12:11:11,468 - __main__ - INFO - Processing message for conversation 11
2025-06-26 12:11:11,472 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:11:15,706 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:11:15,716 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:11:16,104 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:11:18,553 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:18,559 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:11:18,559 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:11:18,560 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 12:11:18,560 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 12:11:18,686 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 12:11:18,687 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:11:20,664 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:20,665 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:11:20,665 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:11:20,666 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 12:11:22,428 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 12:11:22,429 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:11:40,507 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:11:40,512 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:11:40,512 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 12:11:40,514 - socket_server - INFO - Sent response to ('127.0.0.1', 54893): success
2025-06-26 12:12:41,376 - socket_server - INFO - Client ('127.0.0.1', 54893) closed connection
2025-06-26 12:12:41,376 - socket_server - INFO - Client ('127.0.0.1', 54893) disconnected
2025-06-26 12:13:18,423 - socket_server - INFO - New client connected from ('127.0.0.1', 55013)
2025-06-26 12:13:18,423 - socket_server - INFO - Received request from ('127.0.0.1', 55013): chat
2025-06-26 12:13:18,424 - __main__ - INFO - Processing message for conversation 11
2025-06-26 12:13:18,425 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:13:21,724 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:13:21,729 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:13:22,074 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:13:24,460 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:24,462 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:13:24,462 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:13:24,462 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 12:13:24,462 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 12:13:24,564 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 12:13:24,564 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:13:26,347 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:26,348 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:13:26,348 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:13:26,348 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 12:13:26,929 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 12:13:26,929 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:13:34,276 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:13:34,277 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:13:34,277 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 12:13:34,278 - socket_server - INFO - Sent response to ('127.0.0.1', 55013): success
2025-06-26 12:13:54,707 - socket_server - INFO - New client connected from ('127.0.0.1', 55028)
2025-06-26 12:13:54,720 - socket_server - INFO - Received request from ('127.0.0.1', 55028): chat
2025-06-26 12:13:54,769 - __main__ - INFO - Processing message for conversation 12
2025-06-26 12:13:54,795 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 12:13:59,102 - __main__ - INFO - MCP client initialized successfully
2025-06-26 12:13:59,107 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 12:13:59,392 - __main__ - INFO - LLM iteration 1/10
2025-06-26 12:14:00,945 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:00,947 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:00,947 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:00,947 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 12:14:00,947 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 12:14:01,038 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 12:14:01,038 - __main__ - INFO - LLM iteration 2/10
2025-06-26 12:14:02,859 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:02,860 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:02,860 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:02,860 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 12:14:02,860 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 12:14:02,860 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 12:14:02,890 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 12:14:02,890 - __main__ - INFO - LLM iteration 3/10
2025-06-26 12:14:05,308 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:05,309 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 12:14:05,309 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 12:14:05,309 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 12:14:05,309 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 12:14:05,333 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 12:14:05,333 - __main__ - INFO - LLM iteration 4/10
2025-06-26 12:14:19,154 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 12:14:19,155 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 12:14:19,155 - __main__ - INFO - Generated final answer for conversation 12
2025-06-26 12:14:19,156 - socket_server - INFO - Sent response to ('127.0.0.1', 55028): success
2025-06-26 12:14:48,432 - socket_server - INFO - Client ('127.0.0.1', 55013) closed connection
2025-06-26 12:14:48,433 - socket_server - INFO - Client ('127.0.0.1', 55013) disconnected
2025-06-26 13:19:27,424 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:21:13,829 - socket_server - INFO - New client connected from ('127.0.0.1', 55972)
2025-06-26 13:21:13,848 - socket_server - INFO - Received request from ('127.0.0.1', 55972): chat
2025-06-26 13:21:13,926 - __main__ - INFO - Processing message for conversation 7
2025-06-26 13:21:13,931 - __main__ - INFO - New database context established: php3_wd19314
2025-06-26 13:21:13,931 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:21:24,195 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:21:24,201 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:21:24,516 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:21:27,672 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:27,691 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:27,692 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:27,692 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:21:27,692 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:21:27,692 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 13:21:28,235 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:21:28,235 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:21:30,331 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:30,332 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:30,332 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:30,332 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:21:30,332 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:21:30,333 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:21:30,459 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:21:30,459 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:21:32,549 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:21:32,550 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:21:32,550 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:21:32,550 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:21:32,550 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:21:32,569 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:21:32,569 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:22:10,718 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:10,719 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:22:10,720 - __main__ - INFO - Generated final answer for conversation 7
2025-06-26 13:22:10,721 - socket_server - INFO - Sent response to ('127.0.0.1', 55972): success
2025-06-26 13:22:36,405 - socket_server - INFO - New client connected from ('127.0.0.1', 55999)
2025-06-26 13:22:36,405 - socket_server - INFO - Received request from ('127.0.0.1', 55999): chat
2025-06-26 13:22:36,406 - __main__ - INFO - Processing message for conversation 10
2025-06-26 13:22:36,406 - __main__ - INFO - New database context established: php3_wd1931
2025-06-26 13:22:36,407 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:22:39,091 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:22:39,095 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:22:39,437 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:22:41,230 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:41,232 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:41,232 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:41,232 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:22:41,233 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd1931'}
2025-06-26 13:22:41,233 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd1931
2025-06-26 13:22:41,237 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:22:41,237 - __main__ - WARNING - Tool call returned error: 1049 (42000): Unknown database 'php3_wd1931'
2025-06-26 13:22:41,237 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:22:42,640 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:42,641 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:42,642 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:42,642 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:22:42,642 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:22:42,652 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:22:42,652 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:22:43,813 - socket_server - INFO - Client ('127.0.0.1', 55972) closed connection
2025-06-26 13:22:43,813 - socket_server - INFO - Client ('127.0.0.1', 55972) disconnected
2025-06-26 13:22:44,512 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:44,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:44,514 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:44,514 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:22:44,514 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:22:44,514 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:22:44,521 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:22:44,521 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:22:46,659 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:22:46,660 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:22:46,660 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:22:46,660 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:22:46,660 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:22:46,664 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:22:46,664 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:23:24,491 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:23:24,492 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:23:24,492 - __main__ - INFO - Generated final answer for conversation 10
2025-06-26 13:23:24,493 - socket_server - INFO - Sent response to ('127.0.0.1', 55999): success
2025-06-26 13:24:06,413 - socket_server - INFO - Client ('127.0.0.1', 55999) closed connection
2025-06-26 13:24:06,413 - socket_server - INFO - Client ('127.0.0.1', 55999) disconnected
2025-06-26 13:27:14,287 - socket_server - INFO - New client connected from ('127.0.0.1', 56091)
2025-06-26 13:27:14,289 - socket_server - INFO - Received request from ('127.0.0.1', 56091): chat
2025-06-26 13:27:14,296 - __main__ - INFO - Processing message for conversation 13
2025-06-26 13:27:14,298 - __main__ - INFO - New database context established: php3_wd1931
2025-06-26 13:27:14,298 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:27:17,792 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:27:17,799 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:27:18,122 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:27:20,919 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:20,922 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:20,922 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:20,922 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:27:20,923 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd1931'}
2025-06-26 13:27:20,923 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd1931
2025-06-26 13:27:20,963 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:27:20,963 - __main__ - WARNING - Tool call returned error: 1049 (42000): Unknown database 'php3_wd1931'
2025-06-26 13:27:20,963 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:27:22,103 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:22,104 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:22,104 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:22,104 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:27:22,104 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:27:22,123 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:27:22,123 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:27:23,833 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:23,834 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:23,834 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:23,834 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 13:27:23,835 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:27:23,835 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 13:27:23,847 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 13:27:23,847 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:27:27,576 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:27,577 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:27,577 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:27,577 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:27:27,577 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 13:27:27,578 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 13:27:27,588 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:27:27,588 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:27:29,919 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:27:29,920 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:27:29,920 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:27:29,920 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:27:29,921 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products'}
2025-06-26 13:27:29,926 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:27:29,927 - __main__ - INFO - LLM iteration 6/10
2025-06-26 13:27:29,935 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-13' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:28:33,461 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:28:33,462 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:28:33,462 - __main__ - INFO - Generated final answer for conversation 13
2025-06-26 13:28:33,463 - socket_server - INFO - Sent response to ('127.0.0.1', 56091): success
2025-06-26 13:28:44,293 - socket_server - INFO - Client ('127.0.0.1', 56091) closed connection
2025-06-26 13:28:44,293 - socket_server - INFO - Client ('127.0.0.1', 56091) disconnected
2025-06-26 13:31:12,385 - socket_server - INFO - Stopping server...
2025-06-26 13:31:12,385 - socket_server - INFO - Socket Server stopped
2025-06-26 13:31:12,386 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:31:12,386 - socket_server - INFO - Stopping server...
2025-06-26 13:31:12,386 - socket_server - INFO - Socket Server stopped
2025-06-26 13:31:17,296 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:31:45,479 - socket_server - INFO - New client connected from ('127.0.0.1', 56174)
2025-06-26 13:31:45,480 - socket_server - INFO - Received request from ('127.0.0.1', 56174): chat
2025-06-26 13:31:45,481 - __main__ - INFO - Processing message for conversation 14
2025-06-26 13:31:45,481 - __main__ - INFO - New database context established: php3_wd19314
2025-06-26 13:31:48,408 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:31:48,409 - __main__ - INFO - Refreshing tools cache
2025-06-26 13:31:48,413 - __main__ - INFO - Tools cache updated. Available tools: 6
2025-06-26 13:31:51,381 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:31:56,038 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:31:59,991 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:33:00,007 - __main__ - ERROR - LLM timeout
2025-06-26 13:33:00,007 - socket_server - INFO - Sent response to ('127.0.0.1', 56174): error
2025-06-26 13:33:15,408 - socket_server - INFO - Stopping server...
2025-06-26 13:33:15,408 - socket_server - INFO - Socket Server stopped
2025-06-26 13:33:15,408 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:33:15,410 - socket_server - INFO - Stopping server...
2025-06-26 13:33:15,410 - socket_server - INFO - Socket Server stopped
2025-06-26 13:33:15,457 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-2' coro=<Client._session_runner() running at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:316> wait_for=<Future finished result=True>>
2025-06-26 13:33:29,397 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:35:31,245 - socket_server - INFO - New client connected from ('127.0.0.1', 56329)
2025-06-26 13:35:31,246 - socket_server - INFO - Received request from ('127.0.0.1', 56329): chat
2025-06-26 13:35:31,250 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:35:31,251 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:35:34,610 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:35:34,615 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:35:34,902 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:35:44,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:35:44,764 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:35:44,764 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:35:44,765 - socket_server - INFO - Sent response to ('127.0.0.1', 56329): success
2025-06-26 13:36:39,223 - socket_server - INFO - New client connected from ('127.0.0.1', 56343)
2025-06-26 13:36:39,224 - socket_server - INFO - Received request from ('127.0.0.1', 56343): chat
2025-06-26 13:36:39,224 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:36:39,225 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:36:41,842 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:36:41,846 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:36:42,112 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:36:43,310 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:36:43,312 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:36:43,312 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:36:43,312 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 13:36:43,948 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 13:36:43,948 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:37:01,244 - socket_server - INFO - Client ('127.0.0.1', 56329) closed connection
2025-06-26 13:37:01,245 - socket_server - INFO - Client ('127.0.0.1', 56329) disconnected
2025-06-26 13:37:03,477 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:37:03,478 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:37:03,478 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:37:03,479 - socket_server - INFO - Sent response to ('127.0.0.1', 56343): success
2025-06-26 13:38:09,227 - socket_server - INFO - Client ('127.0.0.1', 56343) closed connection
2025-06-26 13:38:09,228 - socket_server - INFO - Client ('127.0.0.1', 56343) disconnected
2025-06-26 13:40:24,308 - socket_server - INFO - Stopping server...
2025-06-26 13:40:24,308 - socket_server - INFO - Socket Server stopped
2025-06-26 13:40:24,308 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 13:40:24,308 - socket_server - INFO - Stopping server...
2025-06-26 13:40:24,309 - socket_server - INFO - Socket Server stopped
2025-06-26 13:40:28,317 - __main__ - ERROR - Unexpected error in main: 'SocketServer' object has no attribute 'start_server'
2025-06-26 13:48:09,557 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 13:48:25,050 - socket_server - INFO - New client connected from ('127.0.0.1', 56529)
2025-06-26 13:48:25,051 - socket_server - INFO - Received request from ('127.0.0.1', 56529): chat
2025-06-26 13:48:25,052 - __main__ - INFO - Processing message for conversation 11
2025-06-26 13:48:25,053 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:48:27,906 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:48:27,911 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:48:28,296 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:48:41,963 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:41,965 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:41,965 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:41,966 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:48:41,966 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:48:42,211 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:48:42,212 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:48:43,951 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:43,952 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:43,952 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:43,952 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:48:43,952 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 13:48:43,952 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 13:48:43,962 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:48:43,962 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:48:46,311 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:46,312 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:46,312 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:46,312 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:48:46,312 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2023 AND (Month BETWEEN 1 AND 3) LIMIT 1;'}
2025-06-26 13:48:46,374 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:48:46,374 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Month' in 'where clause'
2025-06-26 13:48:46,374 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:48:48,246 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:48,247 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:48:48,247 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:48:48,248 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:48:48,248 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2023 LIMIT 1;'}
2025-06-26 13:48:48,254 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:48:48,254 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:48:52,678 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:48:52,679 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:48:52,680 - __main__ - INFO - Generated final answer for conversation 11
2025-06-26 13:48:52,680 - socket_server - INFO - Sent response to ('127.0.0.1', 56529): success
2025-06-26 13:49:22,986 - socket_server - INFO - New client connected from ('127.0.0.1', 56570)
2025-06-26 13:49:22,986 - socket_server - INFO - Received request from ('127.0.0.1', 56570): chat
2025-06-26 13:49:22,987 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:49:22,987 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:49:25,685 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:49:25,689 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:49:25,950 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:49:37,820 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:37,821 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:37,821 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:37,821 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 13:49:37,821 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 13:49:37,835 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 13:49:37,835 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:49:39,376 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:39,378 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:39,378 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:39,378 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 13:49:39,378 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 13:49:39,378 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 13:49:39,386 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 13:49:39,386 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:49:43,287 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:43,288 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:43,288 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:43,288 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:43,288 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND (MONTH(QuarterStartDate) IN (1, 2, 3)) OR (MONTH(QuarterEndDate) IN (1, 2, 3));'}
2025-06-26 13:49:43,296 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:43,296 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'QuarterStartDate' in 'where clause'
2025-06-26 13:49:43,297 - __main__ - INFO - LLM iteration 4/10
2025-06-26 13:49:48,366 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:48,368 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:48,368 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:48,368 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:48,368 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND Quarter IN ('Q1');"}
2025-06-26 13:49:48,370 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:48,370 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Quarter' in 'where clause'
2025-06-26 13:49:48,371 - __main__ - INFO - LLM iteration 5/10
2025-06-26 13:49:50,671 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:50,672 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:50,672 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:50,672 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:50,672 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024 AND Quarter IN ('Q1');"}
2025-06-26 13:49:50,675 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:50,675 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'Quarter' in 'where clause'
2025-06-26 13:49:50,675 - __main__ - INFO - LLM iteration 6/10
2025-06-26 13:49:54,012 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:54,013 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:49:54,013 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:49:54,013 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:49:54,013 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024;'}
2025-06-26 13:49:54,016 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:49:54,016 - __main__ - INFO - LLM iteration 7/10
2025-06-26 13:49:55,056 - socket_server - INFO - Client ('127.0.0.1', 56529) closed connection
2025-06-26 13:49:55,057 - socket_server - INFO - Client ('127.0.0.1', 56529) disconnected
2025-06-26 13:49:57,984 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:49:57,985 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:49:57,985 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:49:57,986 - socket_server - INFO - Sent response to ('127.0.0.1', 56570): success
2025-06-26 13:50:52,987 - socket_server - INFO - Client ('127.0.0.1', 56570) closed connection
2025-06-26 13:50:52,987 - socket_server - INFO - Client ('127.0.0.1', 56570) disconnected
2025-06-26 13:54:25,173 - socket_server - INFO - New client connected from ('127.0.0.1', 56656)
2025-06-26 13:54:25,174 - socket_server - INFO - Received request from ('127.0.0.1', 56656): chat
2025-06-26 13:54:25,175 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:54:25,175 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:54:27,863 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:54:27,867 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:54:28,117 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:54:31,005 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:54:31,007 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:54:31,007 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:54:31,007 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 13:54:31,008 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Revenue FROM hoaphat2024.financial_performance WHERE Year = 2024;'}
2025-06-26 13:54:31,014 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 13:54:31,014 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:54:39,762 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:54:39,763 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:54:39,764 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:54:39,764 - socket_server - INFO - Sent response to ('127.0.0.1', 56656): success
2025-06-26 13:55:55,185 - socket_server - INFO - Client ('127.0.0.1', 56656) closed connection
2025-06-26 13:55:55,185 - socket_server - INFO - Client ('127.0.0.1', 56656) disconnected
2025-06-26 13:59:42,116 - socket_server - INFO - New client connected from ('127.0.0.1', 56751)
2025-06-26 13:59:42,116 - socket_server - INFO - Received request from ('127.0.0.1', 56751): chat
2025-06-26 13:59:42,117 - __main__ - INFO - Processing message for conversation 15
2025-06-26 13:59:42,117 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 13:59:45,194 - __main__ - INFO - MCP client initialized successfully
2025-06-26 13:59:45,199 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:59:45,215 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 13:59:45,221 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 13:59:45,475 - __main__ - INFO - LLM iteration 1/10
2025-06-26 13:59:47,122 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:47,123 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:59:47,123 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:59:47,123 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 13:59:47,123 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 13:59:47,258 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 13:59:47,258 - __main__ - INFO - LLM iteration 2/10
2025-06-26 13:59:50,399 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:50,400 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 13:59:50,400 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 13:59:50,401 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 13:59:50,958 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 13:59:50,958 - __main__ - INFO - LLM iteration 3/10
2025-06-26 13:59:59,949 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 13:59:59,950 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 13:59:59,950 - __main__ - INFO - Generated final answer for conversation 15
2025-06-26 13:59:59,951 - socket_server - INFO - Sent response to ('127.0.0.1', 56751): success
2025-06-26 14:01:12,127 - socket_server - INFO - Client ('127.0.0.1', 56751) closed connection
2025-06-26 14:01:12,127 - socket_server - INFO - Client ('127.0.0.1', 56751) disconnected
2025-06-26 14:15:24,674 - socket_server - INFO - New client connected from ('127.0.0.1', 56901)
2025-06-26 14:15:24,675 - socket_server - INFO - Received request from ('127.0.0.1', 56901): chat
2025-06-26 14:15:24,680 - __main__ - INFO - Processing message for conversation 16
2025-06-26 14:15:24,681 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:15:28,003 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:15:28,008 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:15:28,261 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:15:35,946 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:35,948 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:35,948 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:35,948 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:15:35,949 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:15:36,016 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:15:36,017 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:15:38,488 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:38,489 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:38,489 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:38,490 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:15:38,490 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:15:38,490 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:15:38,507 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:15:38,507 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:15:41,642 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:41,643 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:15:41,643 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:15:41,643 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:15:41,643 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue FROM hoaphat2024.financial_performance ORDER BY Year;'}
2025-06-26 14:15:41,647 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:15:41,648 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:15:53,591 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:15:53,593 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:15:53,593 - __main__ - INFO - Generated final answer for conversation 16
2025-06-26 14:15:53,594 - socket_server - INFO - Sent response to ('127.0.0.1', 56901): success
2025-06-26 14:16:54,672 - socket_server - INFO - Client ('127.0.0.1', 56901) closed connection
2025-06-26 14:16:54,672 - socket_server - INFO - Client ('127.0.0.1', 56901) disconnected
2025-06-26 14:19:39,207 - socket_server - INFO - New client connected from ('127.0.0.1', 56986)
2025-06-26 14:19:39,207 - socket_server - INFO - Received request from ('127.0.0.1', 56986): chat
2025-06-26 14:19:39,209 - __main__ - INFO - Processing message for conversation 17
2025-06-26 14:19:39,210 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:19:41,972 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:19:41,976 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:19:42,277 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:19:56,743 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:19:56,744 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:19:56,744 - __main__ - INFO - Generated final answer for conversation 17
2025-06-26 14:19:56,746 - socket_server - INFO - Sent response to ('127.0.0.1', 56986): success
2025-06-26 14:21:09,217 - socket_server - INFO - Client ('127.0.0.1', 56986) closed connection
2025-06-26 14:21:09,217 - socket_server - INFO - Client ('127.0.0.1', 56986) disconnected
2025-06-26 14:21:43,938 - socket_server - INFO - New client connected from ('127.0.0.1', 57032)
2025-06-26 14:21:43,939 - socket_server - INFO - Received request from ('127.0.0.1', 57032): chat
2025-06-26 14:21:43,940 - __main__ - INFO - Processing message for conversation 18
2025-06-26 14:21:43,940 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:21:46,629 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:21:46,633 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:21:46,879 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:21:52,942 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:21:52,943 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:21:52,943 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:21:52,943 - __main__ - INFO - Executing tool call: rag_get_collection_info
2025-06-26 14:21:52,944 - __main__ - INFO - Executing tool: rag_get_collection_info with args: {}
2025-06-26 14:21:53,066 - __main__ - INFO - Tool rag_get_collection_info executed successfully
2025-06-26 14:21:53,066 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:21:54,493 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:21:54,494 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:21:54,494 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:21:54,494 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:21:55,092 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:21:55,092 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:22:15,097 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:22:15,099 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:22:15,099 - __main__ - INFO - Generated final answer for conversation 18
2025-06-26 14:22:15,099 - socket_server - INFO - Sent response to ('127.0.0.1', 57032): success
2025-06-26 14:23:13,944 - socket_server - INFO - Client ('127.0.0.1', 57032) closed connection
2025-06-26 14:23:13,944 - socket_server - INFO - Client ('127.0.0.1', 57032) disconnected
2025-06-26 14:28:20,362 - socket_server - INFO - New client connected from ('127.0.0.1', 57146)
2025-06-26 14:28:20,363 - socket_server - INFO - Received request from ('127.0.0.1', 57146): chat
2025-06-26 14:28:20,364 - __main__ - INFO - Processing message for conversation 19
2025-06-26 14:28:20,365 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:28:23,711 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:28:23,716 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:28:24,074 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:28:24,098 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-35' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,117 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-36' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,124 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-37' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:24,130 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-38' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\socket_server.py", line 54, in handle_client
    username = request.get('username', 'User')
                       ~~~^^^^^^^^^^^^^^^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 14:28:25,407 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:25,409 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:25,409 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:25,409 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:28:25,409 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:28:25,457 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:28:25,457 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:28:27,546 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:27,547 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:27,547 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:27,547 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:28:27,547 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:28:27,548 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:28:27,556 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:28:27,556 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:28:29,853 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:29,854 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:28:29,854 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:28:29,854 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:28:29,854 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.products ORDER BY Price DESC LIMIT 20;'}
2025-06-26 14:28:29,876 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:28:29,877 - __main__ - WARNING - Tool call returned error: 1146 (42S02): Table 'hoaphat2024.products' doesn't exist
2025-06-26 14:28:29,877 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:28:33,295 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:28:33,296 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:28:33,296 - __main__ - INFO - Generated final answer for conversation 19
2025-06-26 14:28:33,297 - socket_server - INFO - Sent response to ('127.0.0.1', 57146): success
2025-06-26 14:29:50,366 - socket_server - INFO - Client ('127.0.0.1', 57146) closed connection
2025-06-26 14:29:50,366 - socket_server - INFO - Client ('127.0.0.1', 57146) disconnected
2025-06-26 14:30:17,964 - socket_server - INFO - New client connected from ('127.0.0.1', 57196)
2025-06-26 14:30:17,964 - socket_server - INFO - Received request from ('127.0.0.1', 57196): chat
2025-06-26 14:30:17,965 - __main__ - INFO - Processing message for conversation 20
2025-06-26 14:30:17,965 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:30:21,175 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:30:21,179 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:30:21,471 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:30:29,662 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:30:29,664 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:30:29,664 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:30:29,664 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:30:30,643 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:30:30,647 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:30:44,130 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:30:44,132 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:30:44,132 - __main__ - INFO - Generated final answer for conversation 20
2025-06-26 14:30:44,132 - socket_server - INFO - Sent response to ('127.0.0.1', 57196): success
2025-06-26 14:31:47,966 - socket_server - INFO - Client ('127.0.0.1', 57196) closed connection
2025-06-26 14:31:47,966 - socket_server - INFO - Client ('127.0.0.1', 57196) disconnected
2025-06-26 14:32:00,807 - socket_server - INFO - Stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Socket Server stopped
2025-06-26 14:32:00,809 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Stopping server...
2025-06-26 14:32:00,809 - socket_server - INFO - Socket Server stopped
2025-06-26 14:33:33,968 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:33:55,654 - socket_server - INFO - New client connected from ('127.0.0.1', 57272)
2025-06-26 14:33:55,654 - socket_server - INFO - Received request from ('127.0.0.1', 57272): chat
2025-06-26 14:33:55,658 - __main__ - INFO - Processing message for conversation 21
2025-06-26 14:33:55,658 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:33:59,020 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:33:59,026 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:33:59,314 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 14:33:59,314 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:33:59,315 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:34:01,098 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:01,102 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:01,102 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:01,102 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:34:01,102 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:34:01,193 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:34:01,194 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:34:02,783 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:02,784 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:02,784 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:02,784 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:34:02,784 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:34:02,784 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:34:02,807 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:34:02,807 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:34:04,610 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:04,612 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:04,612 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:04,613 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:34:04,613 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:34:04,613 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:34:04,638 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:34:04,639 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:34:06,825 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:06,826 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:34:06,826 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:34:06,827 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:34:06,827 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue, NetRevenue, GrossProfit, NetProfit FROM hoaphat2024.financial_performance ORDER BY Year;'}
2025-06-26 14:34:06,837 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:34:06,837 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:34:22,853 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:34:22,854 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:34:22,855 - __main__ - INFO - Generated final answer for conversation 21
2025-06-26 14:34:22,859 - socket_server - INFO - Sent response to ('127.0.0.1', 57272): success
2025-06-26 14:34:34,999 - socket_server - INFO - Stopping server...
2025-06-26 14:34:34,999 - socket_server - INFO - Socket Server stopped
2025-06-26 14:34:35,000 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:34:35,000 - socket_server - INFO - Stopping server...
2025-06-26 14:34:35,000 - socket_server - INFO - Socket Server stopped
2025-06-26 14:34:41,964 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:35:03,886 - socket_server - INFO - New client connected from ('127.0.0.1', 57312)
2025-06-26 14:35:03,886 - socket_server - INFO - Received request from ('127.0.0.1', 57312): chat
2025-06-26 14:35:03,888 - __main__ - INFO - Processing message for conversation 22
2025-06-26 14:35:03,888 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:35:06,838 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:35:06,843 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:35:07,263 - __main__ - INFO - User message: phân tích doanh thu hòa phát qua các năm
2025-06-26 14:35:07,263 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:35:07,264 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:35:09,138 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:09,140 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:09,141 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:09,141 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:35:09,141 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:35:09,148 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:35:09,148 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:35:11,089 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:11,090 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:11,090 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:11,090 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:35:11,090 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:35:11,091 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:35:11,097 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:35:11,097 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:35:13,354 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:13,355 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:13,355 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:13,355 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:35:13,355 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:35:13,355 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:35:13,363 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:35:13,363 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:35:15,336 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:15,337 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:35:15,338 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:35:15,338 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:35:15,338 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT Year, Revenue FROM hoaphat2024.financial_performance ORDER BY Year'}
2025-06-26 14:35:15,343 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:35:15,344 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:35:31,752 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:35:31,753 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:35:31,753 - __main__ - INFO - Generated final answer for conversation 22
2025-06-26 14:35:31,757 - socket_server - INFO - Sent response to ('127.0.0.1', 57312): success
2025-06-26 14:36:33,886 - socket_server - INFO - Client ('127.0.0.1', 57312) closed connection
2025-06-26 14:36:33,887 - socket_server - INFO - Client ('127.0.0.1', 57312) disconnected
2025-06-26 14:38:12,305 - socket_server - INFO - Stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Socket Server stopped
2025-06-26 14:38:12,306 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Stopping server...
2025-06-26 14:38:12,306 - socket_server - INFO - Socket Server stopped
2025-06-26 14:39:13,599 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:39:25,291 - socket_server - INFO - New client connected from ('127.0.0.1', 57408)
2025-06-26 14:39:25,292 - socket_server - INFO - Received request from ('127.0.0.1', 57408): chat
2025-06-26 14:39:25,293 - __main__ - INFO - Processing message for conversation 23
2025-06-26 14:39:25,294 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:39:28,048 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:39:28,054 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:39:28,333 - __main__ - INFO - User message: phân tích doanh thu hòa phát năm 2023
2025-06-26 14:39:28,334 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:39:28,334 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:39:31,280 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:31,284 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:31,284 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:31,284 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 14:39:31,284 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 14:39:31,297 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 14:39:31,297 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:39:33,465 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:33,466 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:33,466 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:33,466 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:39:33,466 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:39:33,467 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 14:39:33,473 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:39:33,473 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:39:35,478 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:35,479 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:35,480 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:35,480 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:39:35,480 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 14:39:35,480 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 14:39:35,489 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:39:35,489 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:39:37,610 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:37,611 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:39:37,612 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:39:37,612 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:39:37,612 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM hoaphat2024.financial_performance WHERE Year = 2023'}
2025-06-26 14:39:37,620 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:39:37,620 - __main__ - INFO - LLM iteration 5/10
2025-06-26 14:39:55,748 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:39:55,749 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:39:55,749 - __main__ - INFO - Generated final answer for conversation 23
2025-06-26 14:39:55,754 - socket_server - INFO - Sent response to ('127.0.0.1', 57408): success
2025-06-26 14:40:55,292 - socket_server - INFO - Client ('127.0.0.1', 57408) closed connection
2025-06-26 14:40:55,293 - socket_server - INFO - Client ('127.0.0.1', 57408) disconnected
2025-06-26 14:56:06,123 - socket_server - INFO - Stopping server...
2025-06-26 14:56:06,125 - socket_server - INFO - Socket Server stopped
2025-06-26 14:56:06,126 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 14:56:06,127 - socket_server - INFO - Stopping server...
2025-06-26 14:56:06,127 - socket_server - INFO - Socket Server stopped
2025-06-26 14:56:11,726 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 14:56:21,097 - socket_server - INFO - New client connected from ('127.0.0.1', 57597)
2025-06-26 14:56:21,098 - socket_server - INFO - Received request from ('127.0.0.1', 57597): chat
2025-06-26 14:56:21,099 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:56:21,099 - __main__ - INFO - New context established: rag:general
2025-06-26 14:56:21,100 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:56:24,461 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:56:24,466 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:56:24,772 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 14:56:24,772 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:56:24,772 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:56:26,965 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:56:26,967 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:56:26,967 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:56:26,968 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 14:56:26,968 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 14:56:27,609 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 14:56:27,609 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:56:41,485 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:56:41,486 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:56:41,487 - __main__ - INFO - Generated final answer for conversation 24
2025-06-26 14:56:41,490 - socket_server - INFO - Sent response to ('127.0.0.1', 57597): success
2025-06-26 14:57:20,736 - socket_server - INFO - New client connected from ('127.0.0.1', 57608)
2025-06-26 14:57:20,736 - socket_server - INFO - Received request from ('127.0.0.1', 57608): chat
2025-06-26 14:57:20,737 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:57:20,738 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:57:23,437 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:57:23,441 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:57:23,689 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 14:57:23,689 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:57:23,689 - __main__ - INFO - LLM iteration 1/10
2025-06-26 14:57:28,050 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:28,051 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:28,051 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:28,051 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 14:57:28,051 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 14:57:28,052 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 14:57:28,069 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 14:57:28,069 - __main__ - INFO - LLM iteration 2/10
2025-06-26 14:57:29,798 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:29,799 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:29,799 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:29,799 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 14:57:29,799 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 14:57:29,799 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 14:57:29,808 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 14:57:29,808 - __main__ - INFO - LLM iteration 3/10
2025-06-26 14:57:32,397 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:57:32,398 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 14:57:32,398 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 14:57:32,398 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 14:57:32,398 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM `php3_wd19314`.`products` LIMIT 20;'}
2025-06-26 14:57:32,407 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 14:57:32,407 - __main__ - INFO - LLM iteration 4/10
2025-06-26 14:57:51,094 - socket_server - INFO - Client ('127.0.0.1', 57597) closed connection
2025-06-26 14:57:51,094 - socket_server - INFO - Client ('127.0.0.1', 57597) disconnected
2025-06-26 14:58:58,253 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 14:58:58,254 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 14:58:58,254 - __main__ - INFO - Generated final answer for conversation 24
2025-06-26 14:58:58,258 - socket_server - INFO - Sent response to ('127.0.0.1', 57608): success
2025-06-26 14:58:58,258 - socket_server - ERROR - Error handling client ('127.0.0.1', 57608): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-26 14:58:58,259 - socket_server - INFO - Client ('127.0.0.1', 57608) disconnected
2025-06-26 14:59:54,824 - socket_server - INFO - New client connected from ('127.0.0.1', 57648)
2025-06-26 14:59:54,825 - socket_server - INFO - Received request from ('127.0.0.1', 57648): chat
2025-06-26 14:59:54,826 - __main__ - INFO - Processing message for conversation 24
2025-06-26 14:59:54,826 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 14:59:57,804 - __main__ - INFO - MCP client initialized successfully
2025-06-26 14:59:57,810 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 14:59:58,079 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 14:59:58,079 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 14:59:58,079 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:00:35,172 - socket_server - INFO - Stopping server...
2025-06-26 15:00:35,172 - socket_server - INFO - Socket Server stopped
2025-06-26 15:00:35,173 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:00:35,173 - socket_server - INFO - Stopping server...
2025-06-26 15:00:35,173 - socket_server - INFO - Socket Server stopped
2025-06-26 15:01:26,741 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:01:44,739 - socket_server - INFO - New client connected from ('127.0.0.1', 57697)
2025-06-26 15:01:44,740 - socket_server - INFO - Received request from ('127.0.0.1', 57697): chat
2025-06-26 15:01:44,741 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:01:44,741 - __main__ - INFO - New context established: rag:general
2025-06-26 15:01:44,741 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:01:47,473 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:01:47,477 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:01:47,772 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:01:47,772 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:01:47,772 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:01:49,842 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:01:49,844 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:01:49,844 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:01:49,845 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:01:49,845 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:01:50,359 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:01:50,359 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:02:06,823 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:02:06,824 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:02:06,824 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:02:06,829 - socket_server - INFO - Sent response to ('127.0.0.1', 57697): success
2025-06-26 15:02:57,238 - socket_server - INFO - New client connected from ('127.0.0.1', 57714)
2025-06-26 15:02:57,238 - socket_server - INFO - Received request from ('127.0.0.1', 57714): chat
2025-06-26 15:02:57,239 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:02:57,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:02:59,868 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:02:59,873 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:03:00,129 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:03:00,129 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:03:00,129 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:03:02,167 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:02,167 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:02,168 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:02,168 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:03:02,168 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:03:03,818 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:03,819 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:03,819 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:03,819 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:03:03,819 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:03,820 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:03:03,820 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:03,820 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:03:05,117 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:05,118 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:05,118 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:05,119 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 15:03:05,119 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:03:06,262 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:06,263 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:06,263 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:06,263 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 15:03:06,264 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 15:03:06,278 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 15:03:06,279 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:03:09,366 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:09,367 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:09,367 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:09,367 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:03:09,367 - __main__ - INFO - LLM iteration 6/10
2025-06-26 15:03:11,211 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:11,212 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:11,212 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:11,212 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:03:11,212 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:11,212 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:03:11,212 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:11,212 - __main__ - INFO - LLM iteration 7/10
2025-06-26 15:03:13,023 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:13,024 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:13,025 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:13,025 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 15:03:13,025 - __main__ - INFO - LLM iteration 8/10
2025-06-26 15:03:14,744 - socket_server - INFO - Client ('127.0.0.1', 57697) closed connection
2025-06-26 15:03:14,745 - socket_server - INFO - Client ('127.0.0.1', 57697) disconnected
2025-06-26 15:03:14,846 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:14,847 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:14,847 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:14,847 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 15:03:14,848 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:03:14,848 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/schema/{db_name*}: name 're' is not defined
2025-06-26 15:03:14,848 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:03:14,848 - __main__ - INFO - LLM iteration 9/10
2025-06-26 15:03:16,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:03:16,564 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:03:16,564 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:03:16,564 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:03:16,565 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:03:16,571 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:03:16,571 - __main__ - INFO - LLM iteration 10/10
2025-06-26 15:04:14,014 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:04:14,015 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:04:14,015 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:04:14,018 - socket_server - INFO - Sent response to ('127.0.0.1', 57714): success
2025-06-26 15:04:27,248 - socket_server - INFO - Client ('127.0.0.1', 57714) closed connection
2025-06-26 15:04:27,249 - socket_server - INFO - Client ('127.0.0.1', 57714) disconnected
2025-06-26 15:05:10,354 - socket_server - INFO - New client connected from ('127.0.0.1', 57747)
2025-06-26 15:05:10,354 - socket_server - INFO - Received request from ('127.0.0.1', 57747): chat
2025-06-26 15:05:10,355 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:05:10,355 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:05:13,118 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:05:13,122 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:05:13,380 - __main__ - INFO - User message: doanh thu quý 1 là bao nhiêu
2025-06-26 15:05:13,380 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:05:13,380 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:05:13,448 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-13' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:05:15,441 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:05:15,442 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:05:15,442 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:05:15,442 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:05:15,443 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu quý 1 là bao nhiêu'}
2025-06-26 15:05:16,086 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:05:16,086 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:05:24,738 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:05:24,739 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:05:24,739 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:05:24,743 - socket_server - INFO - Sent response to ('127.0.0.1', 57747): success
2025-06-26 15:06:40,366 - socket_server - INFO - Client ('127.0.0.1', 57747) closed connection
2025-06-26 15:06:40,367 - socket_server - INFO - Client ('127.0.0.1', 57747) disconnected
2025-06-26 15:20:18,507 - socket_server - INFO - New client connected from ('127.0.0.1', 57938)
2025-06-26 15:20:18,509 - socket_server - INFO - Received request from ('127.0.0.1', 57938): chat
2025-06-26 15:20:18,514 - __main__ - INFO - Processing message for conversation 25
2025-06-26 15:20:18,515 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:20:22,389 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:20:22,399 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:20:22,701 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:20:22,701 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:20:22,701 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:21:13,505 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:21:13,508 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:21:13,508 - __main__ - INFO - Generated final answer for conversation 25
2025-06-26 15:21:13,512 - socket_server - INFO - Sent response to ('127.0.0.1', 57938): success
2025-06-26 15:21:48,512 - socket_server - INFO - Client ('127.0.0.1', 57938) closed connection
2025-06-26 15:21:48,512 - socket_server - INFO - Client ('127.0.0.1', 57938) disconnected
2025-06-26 15:23:13,368 - socket_server - INFO - New client connected from ('127.0.0.1', 58018)
2025-06-26 15:23:13,368 - socket_server - INFO - Received request from ('127.0.0.1', 58018): chat
2025-06-26 15:23:13,369 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:23:13,369 - __main__ - INFO - New context established: rag:general
2025-06-26 15:23:13,370 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:23:16,060 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:23:16,065 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:23:16,314 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:23:16,314 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:23:16,314 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:23:18,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:23:18,017 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:23:18,017 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:23:18,017 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:23:18,018 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:23:18,734 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:23:18,734 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:23:34,750 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:23:34,752 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:23:34,752 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:23:34,755 - socket_server - INFO - Sent response to ('127.0.0.1', 58018): success
2025-06-26 15:24:03,667 - socket_server - INFO - New client connected from ('127.0.0.1', 58042)
2025-06-26 15:24:03,667 - socket_server - INFO - Received request from ('127.0.0.1', 58042): chat
2025-06-26 15:24:03,668 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:24:03,668 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:24:06,328 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:24:06,332 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:24:06,581 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:24:06,581 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:24:06,581 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:24:08,513 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:08,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:08,515 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:08,515 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:08,515 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:24:10,023 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:10,024 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:10,024 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:10,024 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 15:24:10,024 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:24:12,405 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:12,406 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:12,406 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:12,406 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:12,406 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:24:20,282 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:20,283 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:24:20,284 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:24:20,284 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:24:20,284 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:24:26,800 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:24:26,801 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:24:26,801 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:24:26,804 - socket_server - INFO - Sent response to ('127.0.0.1', 58042): success
2025-06-26 15:24:43,369 - socket_server - INFO - Client ('127.0.0.1', 58018) closed connection
2025-06-26 15:24:43,370 - socket_server - INFO - Client ('127.0.0.1', 58018) disconnected
2025-06-26 15:25:33,675 - socket_server - INFO - Client ('127.0.0.1', 58042) closed connection
2025-06-26 15:25:33,676 - socket_server - INFO - Client ('127.0.0.1', 58042) disconnected
2025-06-26 15:27:12,641 - socket_server - INFO - New client connected from ('127.0.0.1', 58088)
2025-06-26 15:27:12,641 - socket_server - INFO - Received request from ('127.0.0.1', 58088): chat
2025-06-26 15:27:12,642 - __main__ - INFO - Processing message for conversation 26
2025-06-26 15:27:12,642 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:27:15,318 - __main__ - INFO - MCP client initialized successfully
2025-06-26 15:27:15,322 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:27:15,579 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:27:15,579 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:27:15,580 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:27:15,589 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-30' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:15,593 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-31' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:15,597 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-32' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:27:17,710 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:17,711 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:17,711 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:17,711 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:27:17,711 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:27:19,843 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:19,843 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:19,843 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:19,844 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:27:19,844 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': "SELECT table_name FROM information_schema.tables WHERE table_schema = 'php3_wd19314' LIMIT 20;"}
2025-06-26 15:27:19,896 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:27:19,896 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:27:21,813 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:27:21,814 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:27:21,814 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:27:21,815 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:27:21,815 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:27:21,821 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:27:21,822 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:28:01,194 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:28:01,195 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:28:01,196 - __main__ - INFO - Generated final answer for conversation 26
2025-06-26 15:28:01,199 - socket_server - INFO - Sent response to ('127.0.0.1', 58088): success
2025-06-26 15:28:42,653 - socket_server - INFO - Client ('127.0.0.1', 58088) closed connection
2025-06-26 15:28:42,654 - socket_server - INFO - Client ('127.0.0.1', 58088) disconnected
2025-06-26 15:30:51,820 - socket_server - INFO - Stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Socket Server stopped
2025-06-26 15:30:51,821 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Stopping server...
2025-06-26 15:30:51,821 - socket_server - INFO - Socket Server stopped
2025-06-26 15:30:58,081 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:31:11,817 - socket_server - INFO - New client connected from ('127.0.0.1', 58148)
2025-06-26 15:31:11,817 - socket_server - INFO - Received request from ('127.0.0.1', 58148): chat
2025-06-26 15:31:11,818 - __main__ - INFO - Processing message for conversation 27
2025-06-26 15:31:11,818 - __main__ - INFO - New context established: rag:general
2025-06-26 15:31:11,819 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:31:14,419 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:31:14,422 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:31:14,716 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:31:14,716 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:31:14,716 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:31:17,139 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:17,141 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:17,141 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:17,141 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:31:17,141 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:31:17,704 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:31:17,704 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:31:39,126 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:39,127 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:31:39,127 - __main__ - INFO - Generated final answer for conversation 27
2025-06-26 15:31:39,131 - socket_server - INFO - Sent response to ('127.0.0.1', 58148): success
2025-06-26 15:31:46,904 - socket_server - INFO - New client connected from ('127.0.0.1', 58160)
2025-06-26 15:31:46,905 - socket_server - INFO - Received request from ('127.0.0.1', 58160): chat
2025-06-26 15:31:46,906 - __main__ - INFO - Processing message for conversation 27
2025-06-26 15:31:46,907 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:31:49,567 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:31:49,570 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:31:49,827 - __main__ - INFO - User message: liệt kê 20 sản phẩm trong php3_wd19314
2025-06-26 15:31:49,827 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:31:49,827 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:31:53,308 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:53,309 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:53,309 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:53,309 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:31:53,309 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:31:58,634 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:31:58,635 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:31:58,635 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:31:58,635 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:31:58,635 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:31:58,635 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:31:58,635 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:31:58,636 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:32:00,519 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:32:00,520 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:32:00,520 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:32:00,521 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 15:32:00,521 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 15:32:00,521 - __main__ - ERROR - Error in mcpCall for tool sql+db://sql/list_tables/{db_name*}: name 're' is not defined
2025-06-26 15:32:00,521 - __main__ - WARNING - Tool call returned error: name 're' is not defined
2025-06-26 15:32:00,521 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:32:07,670 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:32:07,671 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:32:07,671 - __main__ - INFO - Generated final answer for conversation 27
2025-06-26 15:32:07,675 - socket_server - INFO - Sent response to ('127.0.0.1', 58160): success
2025-06-26 15:32:35,299 - socket_server - INFO - Stopping server...
2025-06-26 15:32:35,299 - socket_server - INFO - Socket Server stopped
2025-06-26 15:32:35,300 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:32:35,300 - socket_server - INFO - Stopping server...
2025-06-26 15:32:35,300 - socket_server - INFO - Socket Server stopped
2025-06-26 15:32:41,742 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:32:58,180 - socket_server - INFO - New client connected from ('127.0.0.1', 58183)
2025-06-26 15:32:58,181 - socket_server - INFO - Received request from ('127.0.0.1', 58183): chat
2025-06-26 15:32:58,182 - __main__ - INFO - Processing message for conversation 28
2025-06-26 15:32:58,182 - __main__ - INFO - New context established: rag:general
2025-06-26 15:32:58,182 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:33:00,778 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:33:00,782 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:33:01,131 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:33:01,131 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:33:01,131 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:33:02,955 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:02,957 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:02,958 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:02,958 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:33:02,958 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:33:03,454 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:33:03,454 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:33:23,948 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:23,949 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:33:23,949 - __main__ - INFO - Generated final answer for conversation 28
2025-06-26 15:33:23,953 - socket_server - INFO - Sent response to ('127.0.0.1', 58183): success
2025-06-26 15:33:36,457 - socket_server - INFO - New client connected from ('127.0.0.1', 58213)
2025-06-26 15:33:36,457 - socket_server - INFO - Received request from ('127.0.0.1', 58213): chat
2025-06-26 15:33:36,458 - __main__ - INFO - Processing message for conversation 28
2025-06-26 15:33:36,458 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:33:39,086 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:33:39,090 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:33:39,340 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:33:39,340 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:33:39,340 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:33:41,756 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:41,757 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:41,757 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:41,757 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:33:41,757 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:33:48,432 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:48,433 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:48,433 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:48,433 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 15:33:48,434 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 15:33:48,456 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 15:33:48,457 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:33:50,605 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:50,606 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:50,606 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:50,606 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:33:50,606 - __main__ - INFO - LLM iteration 4/10
2025-06-26 15:33:52,983 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:52,984 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:52,984 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:52,984 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 15:33:52,985 - __main__ - INFO - LLM iteration 5/10
2025-06-26 15:33:54,785 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:33:54,785 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:33:54,786 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:33:54,786 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:33:54,786 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:33:54,790 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:33:54,790 - __main__ - INFO - LLM iteration 6/10
2025-06-26 15:34:28,178 - socket_server - INFO - Client ('127.0.0.1', 58183) closed connection
2025-06-26 15:34:28,179 - socket_server - INFO - Client ('127.0.0.1', 58183) disconnected
2025-06-26 15:35:06,372 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:35:06,373 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:35:06,373 - __main__ - INFO - Generated final answer for conversation 28
2025-06-26 15:35:06,376 - socket_server - INFO - Sent response to ('127.0.0.1', 58213): success
2025-06-26 15:35:06,468 - socket_server - INFO - Client ('127.0.0.1', 58213) closed connection
2025-06-26 15:35:06,469 - socket_server - INFO - Client ('127.0.0.1', 58213) disconnected
2025-06-26 15:39:20,856 - socket_server - INFO - New client connected from ('127.0.0.1', 58309)
2025-06-26 15:39:20,857 - socket_server - INFO - Received request from ('127.0.0.1', 58309): chat
2025-06-26 15:39:20,858 - __main__ - INFO - Processing message for conversation 29
2025-06-26 15:39:20,858 - __main__ - INFO - New context established: rag:general
2025-06-26 15:39:20,858 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:39:23,531 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:39:23,534 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:39:23,789 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:39:23,789 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:39:23,789 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:39:25,549 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:39:25,550 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:39:25,550 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:39:25,550 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:39:25,551 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:39:26,130 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:39:26,131 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:39:38,348 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:39:38,350 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:39:38,350 - __main__ - INFO - Generated final answer for conversation 29
2025-06-26 15:39:38,354 - socket_server - INFO - Sent response to ('127.0.0.1', 58309): success
2025-06-26 15:40:25,314 - socket_server - INFO - New client connected from ('127.0.0.1', 58349)
2025-06-26 15:40:25,315 - socket_server - INFO - Received request from ('127.0.0.1', 58349): chat
2025-06-26 15:40:25,315 - __main__ - INFO - Processing message for conversation 30
2025-06-26 15:40:25,315 - __main__ - INFO - New context established: rag:general
2025-06-26 15:40:25,316 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:40:28,019 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:40:28,022 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:40:28,266 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:40:28,266 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT:40:52,033 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:52,033 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:40:52,033 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:40:54,385 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:54,386 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:40:54,386 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:54,386 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:40:54,386 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:40:54,392 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:40:54,392 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:41:55,321 - socket_server - INFO - Client ('127.0.0.1', 58349) closed connection
2025-06-26 15:41:55,322 - socket_server - INFO - Client ('127.0.0.1', 58349) disconnected
2025-06-26 15:42:07,581 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:42:07,583 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:42:07,583 - __main__ - INFO - Generated final answer for conversation 30
2025-06-26 15:42:07,586 - socket_server - INFO - Sent response to ('127.0.0.1', 58361): success
2025-06-26 15:42:17,040 - socket_server - INFO - Client ('127.0.0.1', 58361) closed connection
2025-06-26 15:42:17,041 - socket_server - INFO - Client ('127.0.0.1', 58361) disconnected You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:40:28,267 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:40:28,269 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:40:28,279 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 15:40:30,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:30,017 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:40:30,017 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:40:30,017 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:40:30,017 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:40:30,571 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:40:30,571 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:40:43,467 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:43,468 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:40:43,468 - __main__ - INFO - Generated final answer for conversation 30
2025-06-26 15:40:43,472 - socket_server - INFO - Sent response to ('127.0.0.1', 58349): success
2025-06-26 15:40:47,029 - socket_server - INFO - New client connected from ('127.0.0.1', 58361)
2025-06-26 15:40:47,029 - socket_server - INFO - Received request from ('127.0.0.1', 58361): chat
2025-06-26 15:40:47,030 - __main__ - INFO - Processing message for conversation 30
2025-06-26 15:40:47,030 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:40:49,719 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:40:49,722 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:40:49,966 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:40:49,966 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:40:49,966 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:40:50,864 - socket_server - INFO - Client ('127.0.0.1', 58309) closed connection
2025-06-26 15:40:50,864 - socket_server - INFO - Client ('127.0.0.1', 58309) disconnected
2025-06-26 15:40:52,032 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:40:52,033 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:
2025-06-26 15:52:33,691 - socket_server - INFO - Stopping server...
2025-06-26 15:52:33,693 - socket_server - INFO - Socket Server stopped
2025-06-26 15:52:33,694 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 15:52:33,694 - socket_server - INFO - Stopping server...
2025-06-26 15:52:33,694 - socket_server - INFO - Socket Server stopped
2025-06-26 15:52:39,067 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 15:53:01,237 - socket_server - INFO - New client connected from ('127.0.0.1', 58618)
2025-06-26 15:53:01,238 - socket_server - INFO - Received request from ('127.0.0.1', 58618): chat
2025-06-26 15:53:01,239 - __main__ - INFO - Processing message for conversation 31
2025-06-26 15:53:01,239 - __main__ - INFO - New context established: rag:general
2025-06-26 15:53:01,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:53:03,843 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:53:03,847 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:53:04,204 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 15:53:04,204 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:53:04,204 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:53:06,700 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:06,702 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:06,702 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:06,702 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 15:53:06,703 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 15:53:07,288 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 15:53:07,288 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:53:24,000 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:24,001 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:53:24,002 - __main__ - INFO - Generated final answer for conversation 31
2025-06-26 15:53:24,006 - socket_server - INFO - Sent response to ('127.0.0.1', 58618): success
2025-06-26 15:53:28,857 - socket_server - INFO - New client connected from ('127.0.0.1', 58630)
2025-06-26 15:53:28,858 - socket_server - INFO - Received request from ('127.0.0.1', 58630): chat
2025-06-26 15:53:28,859 - __main__ - INFO - Processing message for conversation 31
2025-06-26 15:53:28,859 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 15:53:31,478 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 15:53:31,482 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 15:53:31,727 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 15:53:31,727 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 15:53:31,727 - __main__ - INFO - LLM iteration 1/10
2025-06-26 15:53:34,151 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:34,152 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:34,152 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:34,152 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 15:53:34,152 - __main__ - INFO - LLM iteration 2/10
2025-06-26 15:53:37,803 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:53:37,804 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 15:53:37,804 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 15:53:37,804 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 15:53:37,805 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 15:53:37,855 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 15:53:37,855 - __main__ - INFO - LLM iteration 3/10
2025-06-26 15:54:24,013 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 58618)
2025-06-26 15:54:24,013 - socket_server - INFO - Client ('127.0.0.1', 58618) disconnected
2025-06-26 15:54:47,550 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 15:54:47,551 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 15:54:47,551 - __main__ - INFO - Generated final answer for conversation 31
2025-06-26 15:54:47,555 - socket_server - INFO - Sent response to ('127.0.0.1', 58630): success
2025-06-26 15:54:58,858 - socket_server - INFO - Client ('127.0.0.1', 58630) closed connection
2025-06-26 15:54:58,858 - socket_server - INFO - Client ('127.0.0.1', 58630) disconnected
2025-06-26 16:01:18,823 - socket_server - INFO - New client connected from ('127.0.0.1', 58726)
2025-06-26 16:01:18,823 - socket_server - INFO - Received request from ('127.0.0.1', 58726): chat
2025-06-26 16:01:18,824 - __main__ - INFO - Processing message for conversation 32
2025-06-26 16:01:18,824 - __main__ - INFO - New context established: rag:general
2025-06-26 16:01:18,825 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:01:21,526 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:01:21,530 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:01:21,780 - __main__ - INFO - User message: phân tích doanh thu hòa phát các năm
2025-06-26 16:01:21,780 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:01:21,780 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:01:23,510 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:23,511 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:23,512 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:23,512 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:01:23,512 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu hòa phát các năm'}
2025-06-26 16:01:24,072 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:01:24,072 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:01:36,742 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:36,743 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:01:36,743 - __main__ - INFO - Generated final answer for conversation 32
2025-06-26 16:01:36,746 - socket_server - INFO - Sent response to ('127.0.0.1', 58726): success
2025-06-26 16:01:41,705 - socket_server - INFO - New client connected from ('127.0.0.1', 58755)
2025-06-26 16:01:41,705 - socket_server - INFO - Received request from ('127.0.0.1', 58755): chat
2025-06-26 16:01:41,707 - __main__ - INFO - Processing message for conversation 32
2025-06-26 16:01:41,707 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:01:44,330 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:01:44,334 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:01:44,583 - __main__ - INFO - User message: liệt kê 20 sản phẩm của php3_wd19314
2025-06-26 16:01:44,583 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:01:44,583 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:01:47,799 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:47,800 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:47,800 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:47,800 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:01:47,800 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:01:49,617 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:01:49,618 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:01:49,618 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:01:49,619 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:01:49,619 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products LIMIT 20;'}
2025-06-26 16:01:49,624 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:01:49,624 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:01:49,628 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:01:49,639 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-18' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:02:36,748 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 58726)
2025-06-26 16:02:36,748 - socket_server - INFO - Client ('127.0.0.1', 58726) disconnected
2025-06-26 16:02:45,299 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:02:45,300 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:02:45,300 - __main__ - INFO - Generated final answer for conversation 32
2025-06-26 16:02:45,303 - socket_server - INFO - Sent response to ('127.0.0.1', 58755): success
2025-06-26 16:03:11,717 - socket_server - INFO - Client ('127.0.0.1', 58755) closed connection
2025-06-26 16:03:11,717 - socket_server - INFO - Client ('127.0.0.1', 58755) disconnected
2025-06-26 16:14:13,592 - socket_server - INFO - New client connected from ('127.0.0.1', 59000)
2025-06-26 16:14:13,606 - socket_server - INFO - Received request from ('127.0.0.1', 59000): chat
2025-06-26 16:14:13,618 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:14:13,618 - __main__ - INFO - New context established: rag:general
2025-06-26 16:14:13,620 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:14:17,796 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:14:17,802 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:14:18,164 - __main__ - INFO - User message: hello
2025-06-26 16:14:18,167 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:14:18,172 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:14:20,956 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:20,961 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:14:20,961 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:14:20,965 - socket_server - INFO - Sent response to ('127.0.0.1', 59000): success
2025-06-26 16:14:30,878 - socket_server - INFO - New client connected from ('127.0.0.1', 59018)
2025-06-26 16:14:30,879 - socket_server - INFO - Received request from ('127.0.0.1', 59018): chat
2025-06-26 16:14:30,880 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:14:30,880 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:14:33,607 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:14:33,611 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:14:33,933 - __main__ - INFO - User message: doanh thu quý 1 là bao nhiêu
2025-06-26 16:14:33,934 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:14:33,934 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:14:36,313 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:36,314 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:14:36,315 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:14:36,315 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:14:36,315 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu quý 1'}
2025-06-26 16:14:37,014 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:14:37,014 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:14:42,129 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:14:42,131 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:14:42,131 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:14:42,135 - socket_server - INFO - Sent response to ('127.0.0.1', 59018): success
2025-06-26 16:15:08,256 - socket_server - INFO - New client connected from ('127.0.0.1', 59032)
2025-06-26 16:15:08,257 - socket_server - INFO - Received request from ('127.0.0.1', 59032): chat
2025-06-26 16:15:08,258 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:15:08,258 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:15:10,914 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:15:10,917 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:15:11,168 - __main__ - INFO - User message: cho tôi 20 sản phẩm có giá cao nhất
2025-06-26 16:15:11,168 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:15:11,168 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:15:13,121 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:13,122 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:13,123 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:13,123 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:15:13,123 - __main__ - INFO - Executing tool: rag_query with args: {'query': '20 sản phẩm có giá cao nhất'}
2025-06-26 16:15:13,673 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:15:13,673 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:15:20,977 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59000)
2025-06-26 16:15:20,978 - socket_server - INFO - Client ('127.0.0.1', 59000) disconnected
2025-06-26 16:15:23,858 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:23,859 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:23,859 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:23,859 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:15:23,860 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT product_name, price FROM products ORDER BY price DESC LIMIT 20'}
2025-06-26 16:15:23,874 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:15:23,874 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-06-26 16:15:23,874 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:15:25,646 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:25,647 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:25,647 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:25,647 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 16:15:25,647 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:15:26,830 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:26,831 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:26,831 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:26,831 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-06-26 16:15:26,831 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-26 16:15:26,949 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-26 16:15:26,949 - __main__ - INFO - LLM iteration 5/10
2025-06-26 16:15:29,422 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:29,423 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:29,424 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:29,424 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 16:15:29,424 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 16:15:29,428 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/hoaphat2024
2025-06-26 16:15:29,447 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 16:15:29,447 - __main__ - INFO - LLM iteration 6/10
2025-06-26 16:15:31,262 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:31,264 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:31,264 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:31,264 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:15:31,264 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'hoaphat2024'}
2025-06-26 16:15:31,264 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/hoaphat2024
2025-06-26 16:15:31,282 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:15:31,282 - __main__ - INFO - LLM iteration 7/10
2025-06-26 16:15:31,292 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-31' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:15:31,299 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-32' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:15:33,513 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:33,514 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:15:33,515 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:15:33,515 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:15:33,515 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT product_name, price FROM hoaphat2024.products ORDER BY price DESC LIMIT 20'}
2025-06-26 16:15:33,532 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:15:33,533 - __main__ - WARNING - Tool call returned error: 1146 (42S02): Table 'hoaphat2024.products' doesn't exist
2025-06-26 16:15:33,533 - __main__ - INFO - LLM iteration 8/10
2025-06-26 16:15:42,146 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59018)
2025-06-26 16:15:42,146 - socket_server - INFO - Client ('127.0.0.1', 59018) disconnected
2025-06-26 16:15:43,292 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:15:43,293 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:15:43,293 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:15:43,298 - socket_server - INFO - Sent response to ('127.0.0.1', 59032): success
2025-06-26 16:16:08,749 - socket_server - INFO - New client connected from ('127.0.0.1', 59045)
2025-06-26 16:16:08,750 - socket_server - INFO - Received request from ('127.0.0.1', 59045): chat
2025-06-26 16:16:08,751 - __main__ - INFO - Processing message for conversation 33
2025-06-26 16:16:08,751 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:16:11,391 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:16:11,394 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:16:11,641 - __main__ - INFO - User message: cho tôi 20 sản phẩm có giá cao nhất php3_wd19314
2025-06-26 16:16:11,641 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:16:11,642 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:16:13,892 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:13,893 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:13,893 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:13,893 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 16:16:13,893 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:16:13,893 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:16:13,905 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 16:16:13,905 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:16:16,185 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:16,186 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:16,187 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:16,187 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:16:16,187 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:16:16,187 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 16:16:16,196 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:16:16,197 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:16:19,807 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:19,808 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:16:19,809 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:16:19,809 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:16:19,809 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20'}
2025-06-26 16:16:19,815 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:16:19,815 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:16:38,260 - socket_server - INFO - Client ('127.0.0.1', 59032) closed connection
2025-06-26 16:16:38,261 - socket_server - INFO - Client ('127.0.0.1', 59032) disconnected
2025-06-26 16:16:46,282 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:16:46,283 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:16:46,283 - __main__ - INFO - Generated final answer for conversation 33
2025-06-26 16:16:46,286 - socket_server - INFO - Sent response to ('127.0.0.1', 59045): success
2025-06-26 16:17:38,759 - socket_server - INFO - Client ('127.0.0.1', 59045) closed connection
2025-06-26 16:17:38,759 - socket_server - INFO - Client ('127.0.0.1', 59045) disconnected
2025-06-26 16:18:49,733 - socket_server - INFO - New client connected from ('127.0.0.1', 59105)
2025-06-26 16:18:49,734 - socket_server - INFO - Received request from ('127.0.0.1', 59105): chat
2025-06-26 16:18:49,734 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:18:49,735 - __main__ - INFO - New context established: rag:general
2025-06-26 16:18:49,735 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:18:52,558 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:18:52,562 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:18:52,957 - __main__ - INFO - User message: phân tích doanh thu các năm của hòa phát
2025-06-26 16:18:52,957 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:18:52,957 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:18:54,643 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:18:54,644 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:18:54,644 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:18:54,645 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:18:54,645 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu các năm của hòa phát'}
2025-06-26 16:18:55,312 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:18:55,313 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:19:09,801 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:09,802 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:19:09,802 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:19:09,806 - socket_server - INFO - Sent response to ('127.0.0.1', 59105): success
2025-06-26 16:19:12,214 - socket_server - INFO - New client connected from ('127.0.0.1', 59150)
2025-06-26 16:19:12,214 - socket_server - INFO - Received request from ('127.0.0.1', 59150): chat
2025-06-26 16:19:12,215 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:19:12,215 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:19:15,530 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:19:15,534 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:19:15,888 - __main__ - INFO - User message: liệt kê 20 sản phẩm có giá cao nhất trong php3_wd19314
2025-06-26 16:19:15,888 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:19:15,888 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:19:18,393 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:18,394 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:19:18,394 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:19:18,394 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:19:18,394 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY price DESC LIMIT 20;'}
2025-06-26 16:19:18,402 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:19:18,402 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'price' in 'order clause'
2025-06-26 16:19:18,402 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:19:27,988 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:19:27,990 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:19:27,990 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:19:27,993 - socket_server - INFO - Sent response to ('127.0.0.1', 59150): success
2025-06-26 16:20:09,818 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59105)
2025-06-26 16:20:09,818 - socket_server - INFO - Client ('127.0.0.1', 59105) disconnected
2025-06-26 16:20:19,203 - socket_server - INFO - New client connected from ('127.0.0.1', 59218)
2025-06-26 16:20:19,203 - socket_server - INFO - Received request from ('127.0.0.1', 59218): chat
2025-06-26 16:20:19,204 - __main__ - INFO - Processing message for conversation 34
2025-06-26 16:20:19,204 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:20:27,038 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:20:27,065 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:20:27,505 - __main__ - INFO - User message: có
2025-06-26 16:20:27,505 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:20:27,506 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:20:27,640 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-49' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,694 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-50' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,698 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-51' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-26 16:20:27,997 - socket_server - WARNING - Socket timeout for client ('127.0.0.1', 59150)
2025-06-26 16:20:27,997 - socket_server - INFO - Client ('127.0.0.1', 59150) disconnected
2025-06-26 16:20:30,038 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:20:30,039 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:20:30,039 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:20:30,039 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:20:30,039 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:20:30,039 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 16:20:30,047 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:20:30,047 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:20:37,437 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:20:37,438 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:20:37,439 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:20:37,439 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:20:37,439 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT ma_san_pham, ten_san_pham, gia FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 16:20:37,443 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:20:37,443 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:21:16,141 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:21:16,142 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:21:16,142 - __main__ - INFO - Generated final answer for conversation 34
2025-06-26 16:21:16,146 - socket_server - INFO - Sent response to ('127.0.0.1', 59218): success
2025-06-26 16:21:49,207 - socket_server - INFO - Client ('127.0.0.1', 59218) closed connection
2025-06-26 16:21:49,207 - socket_server - INFO - Client ('127.0.0.1', 59218) disconnected
2025-06-26 16:25:46,581 - socket_server - INFO - New client connected from ('127.0.0.1', 59342)
2025-06-26 16:25:46,581 - socket_server - INFO - Received request from ('127.0.0.1', 59342): chat
2025-06-26 16:25:46,582 - __main__ - INFO - Processing message for conversation 35
2025-06-26 16:25:46,582 - __main__ - INFO - New context established: rag:general
2025-06-26 16:25:46,582 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:25:49,285 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:25:49,288 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:25:49,548 - __main__ - INFO - User message: cho tôi xem 20 sản phẩm có giá cao nhất database php3_wd19314
2025-06-26 16:25:49,548 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:25:49,548 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:25:51,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:51,762 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:51,762 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:51,762 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:25:51,762 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY price DESC LIMIT 20;'}
2025-06-26 16:25:51,765 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:25:51,765 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'price' in 'order clause'
2025-06-26 16:25:51,765 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:25:56,394 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:56,395 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:56,395 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:56,395 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/php3_wd19314
2025-06-26 16:25:56,395 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:25:58,672 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:58,673 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:58,673 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:58,674 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:25:58,674 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:25:59,897 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:25:59,898 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:25:59,898 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:25:59,898 - __main__ - ERROR - Unknown tool name: list_databases
2025-06-26 16:25:59,898 - __main__ - INFO - LLM iteration 5/10
2025-06-26 16:26:01,944 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:01,946 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:01,946 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:01,946 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:01,947 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SHOW TABLES FROM php3_wd19314;'}
2025-06-26 16:26:01,951 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:01,951 - __main__ - INFO - LLM iteration 6/10
2025-06-26 16:26:03,903 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:03,905 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:03,905 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:03,905 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:03,905 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'DESCRIBE php3_wd19314.products;'}
2025-06-26 16:26:03,909 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:03,909 - __main__ - INFO - LLM iteration 7/10
2025-06-26 16:26:06,170 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:06,171 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:26:06,171 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:26:06,171 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:26:06,171 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 16:26:06,178 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:26:06,178 - __main__ - INFO - LLM iteration 8/10
2025-06-26 16:26:41,637 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:26:41,638 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:26:41,639 - __main__ - INFO - Generated final answer for conversation 35
2025-06-26 16:26:41,643 - socket_server - INFO - Sent response to ('127.0.0.1', 59342): success
2025-06-26 16:27:16,587 - socket_server - INFO - Client ('127.0.0.1', 59342) closed connection
2025-06-26 16:27:16,587 - socket_server - INFO - Client ('127.0.0.1', 59342) disconnected
2025-06-26 16:29:58,014 - socket_server - INFO - Stopping server...
2025-06-26 16:29:58,015 - socket_server - INFO - Socket Server stopped
2025-06-26 16:29:58,016 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-26 16:29:58,016 - socket_server - INFO - Stopping server...
2025-06-26 16:29:58,016 - socket_server - INFO - Socket Server stopped
2025-06-26 16:30:05,748 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-26 16:30:47,989 - socket_server - INFO - New client connected from ('127.0.0.1', 59438)
2025-06-26 16:30:47,990 - socket_server - INFO - Received request from ('127.0.0.1', 59438): chat
2025-06-26 16:30:47,993 - __main__ - INFO - Processing message for conversation 36
2025-06-26 16:30:47,994 - __main__ - INFO - New context established: rag:general
2025-06-26 16:30:47,994 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:30:50,922 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:30:50,926 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:30:51,209 - __main__ - INFO - User message: phân tích doanh thu các năm của hòa phát
2025-06-26 16:30:51,209 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:30:51,209 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:30:53,276 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:30:53,279 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:30:53,279 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:30:53,279 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-06-26 16:30:53,280 - __main__ - INFO - Executing tool call: rag_query
2025-06-26 16:30:53,280 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu các năm của hòa phát'}
2025-06-26 16:30:53,998 - __main__ - INFO - Tool rag_query executed successfully
2025-06-26 16:30:53,998 - __main__ - INFO - Parallel tool execution completed in 0.72 seconds
2025-06-26 16:30:53,999 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:31:07,168 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:31:07,169 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:31:07,169 - __main__ - INFO - Generated final answer for conversation 36
2025-06-26 16:31:07,172 - socket_server - INFO - Sent response to ('127.0.0.1', 59438): success
2025-06-26 16:31:14,194 - socket_server - INFO - New client connected from ('127.0.0.1', 59457)
2025-06-26 16:31:14,194 - socket_server - INFO - Received request from ('127.0.0.1', 59457): chat
2025-06-26 16:31:14,195 - __main__ - INFO - Processing message for conversation 36
2025-06-26 16:31:14,195 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-26 16:31:16,821 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-26 16:31:16,824 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-26 16:31:17,084 - __main__ - INFO - User message: cho tôi xem 20 sản phẩm có giá cao nhất database php3_wd19314
2025-06-26 16:31:17,084 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-26 16:31:17,084 - __main__ - INFO - LLM iteration 1/10
2025-06-26 16:31:19,382 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:31:19,383 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:31:19,383 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:31:19,383 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-06-26 16:31:19,383 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-06-26 16:31:19,383 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:31:19,383 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/php3_wd19314
2025-06-26 16:31:19,393 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-06-26 16:31:19,394 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-06-26 16:31:19,394 - __main__ - INFO - LLM iteration 2/10
2025-06-26 16:31:21,696 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:31:21,697 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:31:21,697 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:31:21,697 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-06-26 16:31:21,698 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:31:21,698 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY price DESC LIMIT 20;'}
2025-06-26 16:31:21,701 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:31:21,701 - __main__ - WARNING - Tool call returned error: 1054 (42S22): Unknown column 'price' in 'order clause'
2025-06-26 16:31:21,701 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-06-26 16:31:21,701 - __main__ - INFO - LLM iteration 3/10
2025-06-26 16:31:23,832 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:31:23,833 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:31:23,833 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:31:23,834 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-06-26 16:31:23,834 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-06-26 16:31:23,834 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'php3_wd19314'}
2025-06-26 16:31:23,834 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/php3_wd19314
2025-06-26 16:31:23,842 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-06-26 16:31:23,842 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-06-26 16:31:23,842 - __main__ - INFO - LLM iteration 4/10
2025-06-26 16:31:26,290 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:31:26,291 - __main__ - INFO - LLM finish_reason: tool_calls
2025-06-26 16:31:26,291 - __main__ - INFO - LLM requested 1 tool calls
2025-06-26 16:31:26,291 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-06-26 16:31:26,292 - __main__ - INFO - Executing tool call: sql_query_db
2025-06-26 16:31:26,292 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM php3_wd19314.products ORDER BY gia DESC LIMIT 20;'}
2025-06-26 16:31:26,296 - __main__ - INFO - Tool sql_query_db executed successfully
2025-06-26 16:31:26,296 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-06-26 16:31:26,296 - __main__ - INFO - LLM iteration 5/10
2025-06-26 16:32:17,997 - socket_server - INFO - Client ('127.0.0.1', 59438) closed connection
2025-06-26 16:32:17,997 - socket_server - INFO - Client ('127.0.0.1', 59438) disconnected
2025-06-26 16:32:29,013 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-26 16:32:29,014 - __main__ - INFO - LLM finish_reason: stop
2025-06-26 16:32:29,014 - __main__ - INFO - Generated final answer for conversation 36
2025-06-26 16:32:29,018 - socket_server - INFO - Sent response to ('127.0.0.1', 59457): success
2025-06-26 16:32:44,199 - socket_server - INFO - Client ('127.0.0.1', 59457) closed connection
2025-06-26 16:32:44,200 - socket_server - INFO - Client ('127.0.0.1', 59457) disconnected
2025-06-30 15:13:43,736 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-30 15:14:30,805 - socket_server - INFO - New client connected from ('127.0.0.1', 56050)
2025-06-30 15:14:30,806 - socket_server - INFO - Received request from ('127.0.0.1', 56050): chat
2025-06-30 15:14:30,807 - __main__ - INFO - Processing message for conversation 11
2025-06-30 15:14:30,807 - __main__ - INFO - New context established: rag:general
2025-06-30 15:14:30,807 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-30 15:14:36,339 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-06-30 15:14:36,345 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-30 15:14:36,785 - __main__ - INFO - User message: xion chao
2025-06-30 15:14:36,786 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-06-30 15:14:36,787 - __main__ - INFO - LLM iteration 1/10
2025-06-30 15:14:45,426 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-30 15:14:45,428 - __main__ - INFO - LLM finish_reason: stop
2025-06-30 15:14:45,428 - __main__ - INFO - Generated final answer for conversation 11
2025-06-30 15:14:45,432 - socket_server - INFO - Sent response to ('127.0.0.1', 56050): success
2025-06-30 15:14:56,975 - socket_server - INFO - Stopping server...
2025-06-30 15:14:56,976 - socket_server - INFO - Socket Server stopped
2025-06-30 15:14:56,977 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-30 15:14:56,977 - socket_server - INFO - Stopping server...
2025-06-30 15:14:56,977 - socket_server - INFO - Socket Server stopped
2025-06-30 21:30:35,852 - __main__ - INFO - Socket server thread started.
2025-06-30 21:30:35,852 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-30 21:30:35,858 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-30 21:30:45,735 - __main__ - INFO - MCP client and tools ready after 1 attempt(s)
2025-06-30 21:30:45,735 - __main__ - INFO - MCP client successfully initialized.
2025-06-30 21:31:11,809 - socket_server - INFO - New client connected from ('127.0.0.1', 58338)
2025-06-30 21:31:11,810 - socket_server - INFO - Received request from ('127.0.0.1', 58338): chat
2025-06-30 21:31:11,810 - __main__ - INFO - Processing message for conversation 11
2025-06-30 21:31:11,810 - __main__ - INFO - New context established: rag:general
2025-06-30 21:31:49,320 - __main__ - INFO - Main loop cancelled.
2025-06-30 21:31:49,320 - __main__ - INFO - Stopping AI server...
2025-06-30 21:31:49,321 - socket_server - INFO - Stopping server...
2025-06-30 21:31:49,321 - socket_server - INFO - Socket Server stopped
2025-06-30 21:31:49,321 - __main__ - INFO - Closing MCP client...
2025-06-30 21:31:49,321 - socket_server - INFO - Stopping server...
2025-06-30 21:31:49,322 - __main__ - INFO - AI server stopped.
2025-06-30 21:31:49,322 - socket_server - INFO - Socket Server stopped
2025-06-30 21:31:54,154 - __main__ - INFO - Socket server thread started.
2025-06-30 21:31:54,155 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-30 21:31:54,159 - socket_server - INFO - Socket Server started on localhost:8888
2025-06-30 21:32:00,777 - __main__ - INFO - MCP client and tools ready after 1 attempt(s)
2025-06-30 21:32:00,778 - __main__ - INFO - MCP client successfully initialized.
2025-06-30 21:32:26,136 - socket_server - INFO - New client connected from ('127.0.0.1', 58383)
2025-06-30 21:32:26,137 - socket_server - INFO - Received request from ('127.0.0.1', 58383): chat
2025-06-30 21:32:26,138 - __main__ - INFO - Processing message for conversation 37
2025-06-30 21:32:26,139 - __main__ - INFO - New context established: rag:general
2025-06-30 21:34:10,194 - socket_server - INFO - New client connected from ('127.0.0.1', 58419)
2025-06-30 21:34:10,195 - socket_server - INFO - Received request from ('127.0.0.1', 58419): chat
2025-06-30 21:34:10,198 - __main__ - INFO - Processing message for conversation 37
2025-06-30 21:34:26,155 - __main__ - ERROR - Timeout processing message for conversation 37
2025-06-30 21:34:26,155 - socket_server - INFO - Sent response to ('127.0.0.1', 58383): error
2025-06-30 21:34:26,156 - socket_server - ERROR - Error handling client ('127.0.0.1', 58383): [WinError 10053] An established connection was aborted by the software in your host machine
2025-06-30 21:34:26,156 - socket_server - INFO - Client ('127.0.0.1', 58383) disconnected
2025-06-30 21:35:10,804 - __main__ - INFO - Main loop cancelled.
2025-06-30 21:35:10,805 - __main__ - INFO - Stopping AI server...
2025-06-30 21:35:10,805 - socket_server - INFO - Stopping server...
2025-06-30 21:35:10,805 - socket_server - INFO - Stopping server...
2025-06-30 21:35:10,805 - socket_server - INFO - Socket Server stopped
2025-06-30 21:35:10,805 - socket_server - INFO - Socket Server stopped
2025-06-30 21:35:10,805 - __main__ - INFO - Closing MCP client...
2025-06-30 21:35:10,806 - __main__ - INFO - AI server stopped.
2025-07-01 08:47:16,082 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 08:47:57,521 - socket_server - INFO - New client connected from ('127.0.0.1', 50968)
2025-07-01 08:47:57,522 - socket_server - INFO - Received request from ('127.0.0.1', 50968): chat
2025-07-01 08:47:57,526 - __main__ - INFO - Processing message for conversation 37
2025-07-01 08:47:57,527 - __main__ - INFO - New context established: rag:general
2025-07-01 08:47:57,527 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 08:48:02,730 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 08:48:02,733 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 08:48:03,055 - __main__ - INFO - User message: liệt kê cho tôi database
2025-07-01 08:48:03,057 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 08:48:03,057 - __main__ - INFO - LLM iteration 1/10
2025-07-01 08:48:05,286 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 08:48:05,306 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 08:48:05,307 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 08:48:05,308 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 08:48:05,309 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 08:48:05,310 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 08:48:05,381 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 08:48:05,381 - __main__ - INFO - Parallel tool execution completed in 0.07 seconds
2025-07-01 08:48:05,382 - __main__ - INFO - LLM iteration 2/10
2025-07-01 08:48:08,065 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 08:48:08,067 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 08:48:08,067 - __main__ - INFO - Generated final answer for conversation 37
2025-07-01 08:48:08,072 - socket_server - INFO - Sent response to ('127.0.0.1', 50968): success
2025-07-01 08:49:27,520 - socket_server - INFO - Client ('127.0.0.1', 50968) closed connection
2025-07-01 08:49:27,521 - socket_server - INFO - Client ('127.0.0.1', 50968) disconnected
2025-07-01 09:05:47,019 - socket_server - INFO - Stopping server...
2025-07-01 09:05:47,020 - socket_server - INFO - Socket Server stopped
2025-07-01 09:05:47,020 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-07-01 09:05:47,020 - socket_server - INFO - Stopping server...
2025-07-01 09:05:47,020 - socket_server - INFO - Socket Server stopped
2025-07-01 09:05:50,288 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:05:52,616 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:05:52,621 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:06:12,872 - socket_server - INFO - New client connected from ('127.0.0.1', 51284)
2025-07-01 09:06:12,873 - socket_server - INFO - Received request from ('127.0.0.1', 51284): chat
2025-07-01 09:06:12,875 - __main__ - INFO - Processing message for conversation 37
2025-07-01 09:06:12,876 - __main__ - INFO - New context established: rag:general
2025-07-01 09:06:12,876 - __main__ - ERROR - Error processing message for conversation 37: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:06:12,877 - socket_server - INFO - Sent response to ('127.0.0.1', 51284): error
2025-07-01 09:07:42,871 - socket_server - INFO - Client ('127.0.0.1', 51284) closed connection
2025-07-01 09:07:42,872 - socket_server - INFO - Client ('127.0.0.1', 51284) disconnected
2025-07-01 09:09:06,873 - socket_server - INFO - Stopping server...
2025-07-01 09:09:06,877 - socket_server - INFO - Socket Server stopped
2025-07-01 09:09:06,878 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-07-01 09:09:06,879 - socket_server - INFO - Stopping server...
2025-07-01 09:09:06,880 - socket_server - INFO - Socket Server stopped
2025-07-01 09:09:06,884 - __main__ - WARNING - Error closing MCP client during server shutdown: There is no current event loop in thread 'MainThread'.
2025-07-01 09:09:10,144 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:09:12,381 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:09:12,383 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:09:28,556 - socket_server - INFO - New client connected from ('127.0.0.1', 51382)
2025-07-01 09:09:28,556 - socket_server - INFO - Received request from ('127.0.0.1', 51382): chat
2025-07-01 09:09:28,557 - __main__ - INFO - Processing message for conversation 37
2025-07-01 09:09:28,557 - __main__ - INFO - New context established: rag:general
2025-07-01 09:11:28,560 - __main__ - ERROR - Timeout processing message for conversation 37
2025-07-01 09:11:28,561 - socket_server - INFO - Sent response to ('127.0.0.1', 51382): error
2025-07-01 09:11:28,561 - socket_server - ERROR - Error handling client ('127.0.0.1', 51382): [WinError 10053] An established connection was aborted by the software in your host machine
2025-07-01 09:11:28,562 - socket_server - INFO - Client ('127.0.0.1', 51382) disconnected
2025-07-01 09:14:28,355 - socket_server - INFO - Stopping server...
2025-07-01 09:14:28,357 - socket_server - INFO - Socket Server stopped
2025-07-01 09:14:28,363 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-07-01 09:14:31,953 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:14:34,292 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:14:34,298 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:14:49,938 - socket_server - INFO - New client connected from ('127.0.0.1', 51482)
2025-07-01 09:14:49,939 - socket_server - INFO - Received request from ('127.0.0.1', 51482): chat
2025-07-01 09:14:49,942 - __main__ - INFO - Processing message for conversation 37
2025-07-01 09:14:49,942 - __main__ - INFO - New context established: rag:general
2025-07-01 09:14:49,942 - __main__ - ERROR - Error processing message for conversation 37: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:14:49,944 - socket_server - INFO - Sent response to ('127.0.0.1', 51482): error
2025-07-01 09:16:16,441 - socket_server - INFO - Client ('127.0.0.1', 51482) reset connection
2025-07-01 09:16:16,442 - socket_server - INFO - Client ('127.0.0.1', 51482) disconnected
2025-07-01 09:16:42,564 - socket_server - INFO - New client connected from ('127.0.0.1', 51516)
2025-07-01 09:16:42,564 - socket_server - INFO - Received request from ('127.0.0.1', 51516): chat
2025-07-01 09:16:42,567 - __main__ - INFO - Processing message for conversation 37
2025-07-01 09:16:42,567 - __main__ - ERROR - Error processing message for conversation 37: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:16:42,569 - socket_server - INFO - Sent response to ('127.0.0.1', 51516): error
2025-07-01 09:17:26,860 - socket_server - INFO - Stopping server...
2025-07-01 09:17:26,861 - socket_server - INFO - Socket Server stopped
2025-07-01 09:17:26,862 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-07-01 09:17:26,862 - socket_server - INFO - Stopping server...
2025-07-01 09:17:26,863 - socket_server - INFO - Socket Server stopped
2025-07-01 09:17:26,863 - __main__ - WARNING - Error closing MCP client during server shutdown: There is no current event loop in thread 'MainThread'.
2025-07-01 09:17:30,455 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:20:34,929 - socket_server - INFO - New client connected from ('127.0.0.1', 52029)
2025-07-01 09:20:34,929 - socket_server - INFO - Received request from ('127.0.0.1', 52029): chat
2025-07-01 09:20:34,933 - __main__ - INFO - Processing message for conversation 38
2025-07-01 09:20:34,934 - __main__ - INFO - New context established: rag:general
2025-07-01 09:20:34,934 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:20:37,471 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:20:37,477 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 09:20:37,879 - __main__ - INFO - User message: liệt kê database
2025-07-01 09:20:37,880 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 09:20:37,881 - __main__ - INFO - LLM iteration 1/10
2025-07-01 09:20:38,281 - openai._base_client - INFO - Retrying request to /chat/completions in 0.404839 seconds
2025-07-01 09:20:38,693 - openai._base_client - INFO - Retrying request to /chat/completions in 0.855543 seconds
2025-07-01 09:20:39,554 - __main__ - ERROR - Error processing message for conversation 38: Connection error.
2025-07-01 09:20:39,562 - socket_server - INFO - Sent response to ('127.0.0.1', 52029): error
2025-07-01 09:22:04,929 - socket_server - INFO - Client ('127.0.0.1', 52029) closed connection
2025-07-01 09:22:04,930 - socket_server - INFO - Client ('127.0.0.1', 52029) disconnected
2025-07-01 09:24:52,705 - socket_server - INFO - New client connected from ('127.0.0.1', 52109)
2025-07-01 09:24:52,706 - socket_server - INFO - Received request from ('127.0.0.1', 52109): chat
2025-07-01 09:24:52,707 - __main__ - INFO - Processing message for conversation 38
2025-07-01 09:24:52,707 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:24:55,111 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:24:55,115 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 09:24:55,272 - __main__ - INFO - User message: liệt kê database
2025-07-01 09:24:55,273 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 09:24:55,273 - __main__ - INFO - LLM iteration 1/10
2025-07-01 09:24:56,907 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 09:24:56,909 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 09:24:56,910 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 09:24:56,910 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 09:24:56,910 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 09:24:56,910 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 09:24:56,917 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 09:24:56,918 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 09:24:56,918 - __main__ - INFO - LLM iteration 2/10
2025-07-01 09:24:59,846 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 09:24:59,848 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 09:24:59,848 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 09:24:59,854 - socket_server - INFO - Sent response to ('127.0.0.1', 52109): success
2025-07-01 09:25:20,479 - socket_server - INFO - New client connected from ('127.0.0.1', 52121)
2025-07-01 09:25:20,479 - socket_server - INFO - Received request from ('127.0.0.1', 52121): chat
2025-07-01 09:25:20,481 - __main__ - INFO - Processing message for conversation 38
2025-07-01 09:25:20,482 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:25:20,490 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-14' coro=<AsyncClient.aclose() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-07-01 09:25:22,852 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:25:22,857 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 09:25:23,007 - __main__ - INFO - User message: phân tích db man_time
2025-07-01 09:25:23,007 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 09:25:23,007 - __main__ - INFO - LLM iteration 1/10
2025-07-01 09:25:24,119 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 09:25:24,121 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 09:25:24,121 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 09:25:24,121 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 09:25:24,121 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 09:25:24,121 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 09:25:24,121 - __main__ - INFO - LLM iteration 2/10
2025-07-01 09:25:25,891 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 09:25:25,894 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 09:25:25,894 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 09:25:25,901 - socket_server - INFO - Sent response to ('127.0.0.1', 52121): success
2025-07-01 09:26:22,718 - socket_server - INFO - Client ('127.0.0.1', 52109) closed connection
2025-07-01 09:26:22,718 - socket_server - INFO - Client ('127.0.0.1', 52109) disconnected
2025-07-01 09:26:50,488 - socket_server - INFO - Client ('127.0.0.1', 52121) closed connection
2025-07-01 09:26:50,490 - socket_server - INFO - Client ('127.0.0.1', 52121) disconnected
2025-07-01 09:47:03,957 - socket_server - INFO - Stopping server...
2025-07-01 09:47:03,958 - socket_server - INFO - Socket Server stopped
2025-07-01 09:47:03,959 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-07-01 09:47:03,959 - socket_server - INFO - Stopping server...
2025-07-01 09:47:03,960 - socket_server - INFO - Socket Server stopped
2025-07-01 09:47:08,744 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:47:11,234 - __main__ - WARNING - MCP client initialization attempt 1 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:47:12,240 - __main__ - INFO - Attempting to initialize MCP client (attempt 2/3)
2025-07-01 09:47:14,672 - __main__ - WARNING - MCP client initialization attempt 2 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:47:15,683 - __main__ - INFO - Attempting to initialize MCP client (attempt 3/3)
2025-07-01 09:47:18,049 - __main__ - WARNING - MCP client initialization attempt 3 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:47:18,050 - __main__ - ERROR - Error during server startup: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:47:18,050 - __main__ - INFO - Stopping server...
2025-07-01 09:47:18,050 - socket_server - INFO - Stopping server...
2025-07-01 09:47:18,050 - __main__ - WARNING - Error closing MCP client during server shutdown: This event loop is already running
2025-07-01 09:47:18,072 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-2' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=McpError('Connection closed')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    |     self._initialize_result = await self._session.initialize()
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    |     result = await self.send_request(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<15 lines>...
    |     )
    |     ^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    |     raise McpError(response_or_error.error)
    | mcp.shared.exceptions.McpError: Connection closed
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    self._initialize_result = await self._session.initialize()
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    result = await self.send_request(
             ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<15 lines>...
    )
    ^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    raise McpError(response_or_error.error)
mcp.shared.exceptions.McpError: Connection closed
2025-07-01 09:47:18,122 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-5' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=McpError('Connection closed')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    |     self._initialize_result = await self._session.initialize()
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    |     result = await self.send_request(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<15 lines>...
    |     )
    |     ^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    |     raise McpError(response_or_error.error)
    | mcp.shared.exceptions.McpError: Connection closed
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    self._initialize_result = await self._session.initialize()
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    result = await self.send_request(
             ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<15 lines>...
    )
    ^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    raise McpError(response_or_error.error)
mcp.shared.exceptions.McpError: Connection closed
2025-07-01 09:47:18,124 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-8' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=McpError('Connection closed')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    |     self._initialize_result = await self._session.initialize()
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    |     result = await self.send_request(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<15 lines>...
    |     )
    |     ^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    |     raise McpError(response_or_error.error)
    | mcp.shared.exceptions.McpError: Connection closed
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    self._initialize_result = await self._session.initialize()
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    result = await self.send_request(
             ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<15 lines>...
    )
    ^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    raise McpError(response_or_error.error)
mcp.shared.exceptions.McpError: Connection closed
2025-07-01 09:51:19,754 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:51:22,335 - __main__ - WARNING - MCP client initialization attempt 1 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:51:23,351 - __main__ - INFO - Attempting to initialize MCP client (attempt 2/3)
2025-07-01 09:51:23,352 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-2' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=McpError('Connection closed')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    |     self._initialize_result = await self._session.initialize()
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    |     result = await self.send_request(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<15 lines>...
    |     )
    |     ^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    |     raise McpError(response_or_error.error)
    | mcp.shared.exceptions.McpError: Connection closed
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 249, in _context_manager
    self._initialize_result = await self._session.initialize()
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\client\session.py", line 123, in initialize
    result = await self.send_request(
             ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<15 lines>...
    )
    ^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\mcp\shared\session.py", line 286, in send_request
    raise McpError(response_or_error.error)
mcp.shared.exceptions.McpError: Connection closed
2025-07-01 09:51:23,360 - __main__ - WARNING - MCP client initialization attempt 2 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:51:24,361 - __main__ - INFO - Attempting to initialize MCP client (attempt 3/3)
2025-07-01 09:51:24,362 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-5' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=RuntimeError('Server session was closed unexpectedly')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    |     raise RuntimeError("Server session was closed unexpectedly")
    | RuntimeError: Server session was closed unexpectedly
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    raise RuntimeError("Server session was closed unexpectedly")
RuntimeError: Server session was closed unexpectedly
2025-07-01 09:51:24,367 - __main__ - WARNING - MCP client initialization attempt 3 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:51:24,367 - __main__ - ERROR - Error in start_and_serve main loop: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:51:24,367 - __main__ - INFO - Stopping server...
2025-07-01 09:51:24,368 - __main__ - WARNING - Error closing MCP client during server shutdown: This event loop is already running
2025-07-01 09:51:24,375 - __main__ - INFO - Stopping server...
2025-07-01 09:51:24,415 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-6' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=RuntimeError('Server session was closed unexpectedly')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    |     raise RuntimeError("Server session was closed unexpectedly")
    | RuntimeError: Server session was closed unexpectedly
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    raise RuntimeError("Server session was closed unexpectedly")
RuntimeError: Server session was closed unexpectedly
2025-07-01 09:52:07,900 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:52:10,315 - __main__ - WARNING - MCP client initialization attempt 1 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:52:10,315 - __main__ - WARNING - Error during failed client setup cleanup: Connection closed
2025-07-01 09:52:11,319 - __main__ - INFO - Attempting to initialize MCP client (attempt 2/3)
2025-07-01 09:52:11,320 - __main__ - WARNING - MCP client initialization attempt 2 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:52:11,320 - __main__ - WARNING - Error during failed client setup cleanup: Server session was closed unexpectedly
2025-07-01 09:52:12,333 - __main__ - INFO - Attempting to initialize MCP client (attempt 3/3)
2025-07-01 09:52:12,335 - __main__ - WARNING - MCP client initialization attempt 3 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:52:12,336 - __main__ - ERROR - Error during server startup in start_and_serve: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 09:52:12,336 - __main__ - INFO - Stopping server...
2025-07-01 09:52:12,337 - __main__ - WARNING - Error closing MCP client during server shutdown: This event loop is already running
2025-07-01 09:52:12,347 - __main__ - INFO - Stopping server...
2025-07-01 09:52:12,383 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-6' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=RuntimeError('Server session was closed unexpectedly')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    |     raise RuntimeError("Server session was closed unexpectedly")
    | RuntimeError: Server session was closed unexpectedly
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    raise RuntimeError("Server session was closed unexpectedly")
RuntimeError: Server session was closed unexpectedly
2025-07-01 09:55:26,984 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:55:29,682 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:55:29,683 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 09:55:29,683 - __main__ - INFO - Message processor task started.
2025-07-01 09:55:29,686 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:55:44,300 - socket_server - INFO - New client connected from ('127.0.0.1', 52725)
2025-07-01 09:55:44,301 - socket_server - INFO - Received request from ('127.0.0.1', 52725): chat
2025-07-01 09:55:44,301 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 09:55:44,302 - __main__ - ERROR - Failed to enqueue message: There is no current event loop in thread 'Client-127.0.0.1:52725'.
2025-07-01 09:55:44,302 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 09:55:44,303 - socket_server - ERROR - Error during async processing result retrieval: Failed to enqueue message: There is no current event loop in thread 'Client-127.0.0.1:52725'.
2025-07-01 09:55:44,304 - socket_server - INFO - Sent response to ('127.0.0.1', 52725): error
2025-07-01 09:57:14,312 - socket_server - INFO - Client ('127.0.0.1', 52725) closed connection
2025-07-01 09:57:14,314 - socket_server - INFO - Client ('127.0.0.1', 52725) disconnected
2025-07-01 09:57:33,675 - __main__ - INFO - Server tasks cancelled.
2025-07-01 09:57:33,680 - __main__ - INFO - Stopping server...
2025-07-01 09:57:33,680 - socket_server - INFO - Stopping server...
2025-07-01 09:57:33,680 - socket_server - INFO - Stopping server...
2025-07-01 09:57:33,680 - socket_server - INFO - Socket Server stopped
2025-07-01 09:57:33,681 - socket_server - INFO - Socket Server stopped
2025-07-01 09:57:33,681 - __main__ - WARNING - Error cancelling processor task: There is no current event loop in thread 'MainThread'.
2025-07-01 09:57:36,305 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 09:57:39,005 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 09:57:39,006 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 09:57:39,006 - __main__ - INFO - Message processor task started.
2025-07-01 09:57:39,009 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 09:58:02,583 - socket_server - INFO - New client connected from ('127.0.0.1', 52790)
2025-07-01 09:58:02,585 - socket_server - INFO - Received request from ('127.0.0.1', 52790): chat
2025-07-01 09:58:02,585 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 09:58:02,586 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 09:58:02,586 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 09:58:02,586 - __main__ - ERROR - Error processing dequeued message for 38: 'AISocketServer' object has no attribute '_process_message_async'
2025-07-01 09:58:02,586 - __main__ - INFO - Processing complete for 38. Status: error
2025-07-01 09:58:02,587 - socket_server - ERROR - Error during async processing result retrieval: 'AISocketServer' object has no attribute '_process_message_async'
2025-07-01 09:58:02,588 - socket_server - INFO - Sent response to ('127.0.0.1', 52790): error
2025-07-01 09:59:32,584 - socket_server - INFO - Client ('127.0.0.1', 52790) closed connection
2025-07-01 09:59:32,584 - socket_server - INFO - Client ('127.0.0.1', 52790) disconnected
2025-07-01 10:00:22,219 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:00:22,232 - __main__ - INFO - Stopping server...
2025-07-01 10:00:22,236 - socket_server - INFO - Stopping server...
2025-07-01 10:00:22,237 - socket_server - INFO - Stopping server...
2025-07-01 10:00:22,237 - socket_server - INFO - Socket Server stopped
2025-07-01 10:00:22,238 - socket_server - INFO - Socket Server stopped
2025-07-01 10:00:22,238 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:00:28,545 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:00:31,256 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:00:31,257 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:00:31,257 - __main__ - INFO - Message processor task started.
2025-07-01 10:00:31,259 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:00:49,212 - socket_server - INFO - New client connected from ('127.0.0.1', 52825)
2025-07-01 10:00:49,212 - socket_server - INFO - Received request from ('127.0.0.1', 52825): chat
2025-07-01 10:00:49,213 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:00:49,213 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:00:49,214 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:00:49,214 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:00:49,214 - __main__ - INFO - New context established: rag:general
2025-07-01 10:00:49,227 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:00:49,745 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:00:49,747 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:00:49,748 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:00:51,628 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:00:51,631 - __main__ - INFO - LLM call completed in 1.88 seconds
2025-07-01 10:00:51,632 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:00:51,632 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:00:51,632 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:00:51,633 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:00:51,636 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:00:51,651 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:00:51,652 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:00:51,653 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:00:51,654 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:00:55,007 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:00:55,009 - __main__ - INFO - LLM call completed in 3.35 seconds
2025-07-01 10:00:55,009 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:00:55,009 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:00:55,010 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:00:55,010 - socket_server - INFO - Received result for 10.
2025-07-01 10:00:55,010 - socket_server - INFO - Sent response to ('127.0.0.1', 52825): success
2025-07-01 10:01:04,103 - socket_server - INFO - New client connected from ('127.0.0.1', 52832)
2025-07-01 10:01:04,103 - socket_server - INFO - Received request from ('127.0.0.1', 52832): chat
2025-07-01 10:01:04,103 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:01:04,103 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:01:04,103 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:01:04,104 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:01:04,109 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:01:04,261 - __main__ - INFO - User message: man_time
2025-07-01 10:01:04,262 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:01:04,262 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:01:05,549 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:01:05,551 - __main__ - INFO - LLM call completed in 1.29 seconds
2025-07-01 10:01:05,552 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:01:05,553 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:01:05,553 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:01:05,554 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 10:01:05,554 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:01:05,555 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 10:01:05,555 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:01:08,757 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:01:08,759 - __main__ - INFO - LLM call completed in 3.20 seconds
2025-07-01 10:01:08,760 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:01:08,760 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:01:08,761 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:01:08,761 - socket_server - INFO - Received result for 10.
2025-07-01 10:01:08,762 - socket_server - INFO - Sent response to ('127.0.0.1', 52832): success
2025-07-01 10:01:58,244 - socket_server - INFO - New client connected from ('127.0.0.1', 52841)
2025-07-01 10:01:58,245 - socket_server - INFO - Received request from ('127.0.0.1', 52841): chat
2025-07-01 10:01:58,245 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:01:58,245 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:01:58,245 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:01:58,245 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:01:58,252 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:01:58,400 - __main__ - INFO - User message: cho tôi xem doanh thu
2025-07-01 10:01:58,401 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:01:58,401 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:01:59,695 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:01:59,697 - __main__ - INFO - LLM call completed in 1.30 seconds
2025-07-01 10:01:59,697 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:01:59,697 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:01:59,697 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:01:59,697 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 10:01:59,698 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu'}
2025-07-01 10:02:00,381 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 10:02:00,381 - __main__ - INFO - Parallel tool execution completed in 0.68 seconds
2025-07-01 10:02:00,381 - __main__ - INFO - Tool execution completed in 0.68 seconds
2025-07-01 10:02:00,381 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:02:12,992 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:02:12,994 - __main__ - INFO - LLM call completed in 12.61 seconds
2025-07-01 10:02:12,994 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:02:12,994 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:02:12,994 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:02:12,994 - socket_server - INFO - Received result for 10.
2025-07-01 10:02:12,995 - socket_server - INFO - Sent response to ('127.0.0.1', 52841): success
2025-07-01 10:02:19,221 - socket_server - INFO - Client ('127.0.0.1', 52825) closed connection
2025-07-01 10:02:19,223 - socket_server - INFO - Client ('127.0.0.1', 52825) disconnected
2025-07-01 10:02:33,303 - socket_server - INFO - New client connected from ('127.0.0.1', 52849)
2025-07-01 10:02:33,303 - socket_server - INFO - Received request from ('127.0.0.1', 52849): chat
2025-07-01 10:02:33,303 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:02:33,304 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:02:33,304 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:02:33,304 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:02:33,311 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:02:33,463 - __main__ - INFO - User message: vẽ biểu đồ doanh thu dạng cột
2025-07-01 10:02:33,463 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:02:33,463 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:02:34,105 - socket_server - INFO - Client ('127.0.0.1', 52832) closed connection
2025-07-01 10:02:34,106 - socket_server - INFO - Client ('127.0.0.1', 52832) disconnected
2025-07-01 10:02:46,908 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:02:46,910 - __main__ - INFO - LLM call completed in 13.45 seconds
2025-07-01 10:02:46,910 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:02:46,911 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:02:46,911 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:02:46,911 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 10:02:46,912 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Năm": "2014", "Doanh thu (tỷ đồng)": 25.852}, {"Năm": "2015", "Doanh thu (tỷ đồng)": 27.865}, {"Năm": "2016", "Doanh thu (tỷ đồng)": 33.855}, {"Năm": "2017", "Doanh thu (tỷ đồng)": 46.855}, {"Năm": "2018", "Doanh thu (tỷ đồng)": 56.58}, {"Năm": "2019", "Doanh thu (tỷ đồng)": 64.678}, {"Năm": "2020", "Doanh thu (tỷ đồng)": 91.279}, {"Năm": "2021", "Doanh thu (tỷ đồng)": 150.865}, {"Năm": "2022", "Doanh thu (tỷ đồng)": 142.771}, {"Năm": "2023", "Doanh thu (tỷ đồng)": 120.355}, {"Năm": "2024", "Doanh thu (tỷ đồng)": 140.561}]', 'title': 'Biểu đồ doanh thu qua các năm', 'x_column': 'Năm', 'x_label': 'Năm', 'y_column': 'Doanh thu (tỷ đồng)', 'y_label': 'Doanh thu (tỷ đồng)'}
2025-07-01 10:02:48,048 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 10:02:48,048 - __main__ - INFO - Parallel tool execution completed in 1.14 seconds
2025-07-01 10:02:48,048 - __main__ - INFO - Tool execution completed in 1.14 seconds
2025-07-01 10:02:48,048 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:03:28,256 - socket_server - INFO - Client ('127.0.0.1', 52841) closed connection
2025-07-01 10:03:28,257 - socket_server - INFO - Client ('127.0.0.1', 52841) disconnected
2025-07-01 10:04:48,064 - __main__ - ERROR - LLM timeout during chat completion.
2025-07-01 10:04:48,064 - __main__ - INFO - Processing complete for 10. Status: error
2025-07-01 10:04:48,065 - socket_server - INFO - Received result for 10.
2025-07-01 10:04:48,065 - socket_server - INFO - Sent response to ('127.0.0.1', 52849): error
2025-07-01 10:04:48,066 - socket_server - ERROR - Error handling client ('127.0.0.1', 52849): [WinError 10053] An established connection was aborted by the software in your host machine
2025-07-01 10:04:48,066 - socket_server - INFO - Client ('127.0.0.1', 52849) disconnected
2025-07-01 10:08:07,307 - socket_server - INFO - New client connected from ('127.0.0.1', 52919)
2025-07-01 10:08:07,308 - socket_server - INFO - Received request from ('127.0.0.1', 52919): chat
2025-07-01 10:08:07,308 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:08:07,310 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:08:07,310 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:08:07,311 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:08:07,323 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:08:07,681 - __main__ - INFO - User message: vẽ biểu đồ doanh thu dạng cột
2025-07-01 10:08:07,682 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:08:07,683 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:08:22,645 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:08:22,647 - __main__ - INFO - LLM call completed in 14.96 seconds
2025-07-01 10:08:22,648 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:08:22,648 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:08:22,649 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:08:22,649 - socket_server - INFO - Received result for 10.
2025-07-01 10:08:22,650 - socket_server - INFO - Sent response to ('127.0.0.1', 52919): success
2025-07-01 10:09:37,305 - socket_server - INFO - Client ('127.0.0.1', 52919) closed connection
2025-07-01 10:09:37,306 - socket_server - INFO - Client ('127.0.0.1', 52919) disconnected
2025-07-01 10:17:27,895 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:17:27,914 - __main__ - INFO - Stopping server...
2025-07-01 10:17:27,916 - socket_server - INFO - Stopping server...
2025-07-01 10:17:27,917 - socket_server - INFO - Stopping server...
2025-07-01 10:17:27,917 - socket_server - INFO - Socket Server stopped
2025-07-01 10:17:27,918 - socket_server - INFO - Socket Server stopped
2025-07-01 10:17:27,920 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:17:43,896 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:17:46,744 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:17:46,745 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:17:46,745 - __main__ - INFO - Message processor task started.
2025-07-01 10:17:46,748 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:18:08,554 - socket_server - INFO - New client connected from ('127.0.0.1', 53057)
2025-07-01 10:18:08,555 - socket_server - INFO - Received request from ('127.0.0.1', 53057): chat
2025-07-01 10:18:08,555 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:18:08,555 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:18:08,555 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:18:08,556 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:18:08,556 - __main__ - INFO - New context established: rag:general
2025-07-01 10:18:08,568 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:18:08,982 - __main__ - INFO - User message: heloo\\
2025-07-01 10:18:08,983 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:18:08,983 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:18:10,778 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:18:10,783 - __main__ - INFO - LLM call completed in 1.80 seconds
2025-07-01 10:18:10,783 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:18:10,784 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:18:10,784 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:18:10,785 - socket_server - INFO - Received result for 10.
2025-07-01 10:18:10,786 - socket_server - INFO - Sent response to ('127.0.0.1', 53057): success
2025-07-01 10:19:18,677 - socket_server - INFO - New client connected from ('127.0.0.1', 53067)
2025-07-01 10:19:18,677 - socket_server - INFO - Received request from ('127.0.0.1', 53067): chat
2025-07-01 10:19:18,678 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:19:18,678 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:19:18,678 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:19:18,678 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:19:18,689 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:19:19,115 - __main__ - INFO - User message: vẽ cho tôi biểu đồ doanh thu của database man_time
2025-07-01 10:19:19,116 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:19:19,116 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:19:20,225 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:20,229 - __main__ - INFO - LLM call completed in 1.11 seconds
2025-07-01 10:19:20,230 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:20,231 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:20,232 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:20,233 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:19:20,234 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:19:20,247 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:19:20,248 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:19:20,249 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:19:20,249 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:19:21,335 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:21,337 - __main__ - INFO - LLM call completed in 1.09 seconds
2025-07-01 10:19:21,337 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:21,338 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:21,338 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:21,339 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-07-01 10:19:21,339 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 10:19:21,340 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/man_time
2025-07-01 10:19:21,378 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-07-01 10:19:21,379 - __main__ - INFO - Parallel tool execution completed in 0.04 seconds
2025-07-01 10:19:21,379 - __main__ - INFO - Tool execution completed in 0.04 seconds
2025-07-01 10:19:21,379 - __main__ - INFO - LLM iteration 3/10
2025-07-01 10:19:22,434 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:22,435 - __main__ - INFO - LLM call completed in 1.06 seconds
2025-07-01 10:19:22,435 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:22,436 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:22,436 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:22,436 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-07-01 10:19:22,436 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 10:19:22,437 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/man_time
2025-07-01 10:19:22,458 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-07-01 10:19:22,458 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:19:22,459 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:19:22,459 - __main__ - INFO - LLM iteration 4/10
2025-07-01 10:19:23,735 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:23,737 - __main__ - INFO - LLM call completed in 1.28 seconds
2025-07-01 10:19:23,737 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:23,738 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:23,738 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:23,739 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:19:23,739 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MaNgay, DoanhThu FROM fact_doanhso LIMIT 20'}
2025-07-01 10:19:23,750 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:19:23,769 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 10:19:23,770 - __main__ - INFO - Parallel tool execution completed in 0.03 seconds
2025-07-01 10:19:23,771 - __main__ - INFO - Tool execution completed in 0.03 seconds
2025-07-01 10:19:23,771 - __main__ - INFO - LLM iteration 5/10
2025-07-01 10:19:25,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:25,414 - __main__ - INFO - LLM call completed in 1.64 seconds
2025-07-01 10:19:25,415 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:25,415 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:25,416 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:25,416 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:19:25,417 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT MaNgay, DoanhThu FROM fact_doanhso LIMIT 20'}
2025-07-01 10:19:25,430 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:19:25,431 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:19:25,432 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:19:25,432 - __main__ - INFO - LLM iteration 6/10
2025-07-01 10:19:27,832 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:27,835 - __main__ - INFO - LLM call completed in 2.40 seconds
2025-07-01 10:19:27,835 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:27,836 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:27,837 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:27,838 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:19:27,845 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT dim_thoigian.Nam, SUM(fact_doanhso.DoanhThu) AS TongDoanhThu FROM fact_doanhso INNER JOIN dim_thoigian ON fact_doanhso.MaNgay = dim_thoigian.MaNgay GROUP BY dim_thoigian.Nam'}
2025-07-01 10:19:27,849 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:19:27,850 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:19:27,852 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:19:27,853 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:19:27,855 - __main__ - INFO - LLM iteration 7/10
2025-07-01 10:19:30,936 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:30,937 - __main__ - INFO - LLM call completed in 3.08 seconds
2025-07-01 10:19:30,937 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:19:30,937 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:19:30,937 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:19:30,937 - socket_server - INFO - Received result for 10.
2025-07-01 10:19:30,938 - socket_server - INFO - Sent response to ('127.0.0.1', 53067): success
2025-07-01 10:19:38,560 - socket_server - INFO - Client ('127.0.0.1', 53057) closed connection
2025-07-01 10:19:38,563 - socket_server - INFO - Client ('127.0.0.1', 53057) disconnected
2025-07-01 10:19:45,296 - socket_server - INFO - New client connected from ('127.0.0.1', 53072)
2025-07-01 10:19:45,296 - socket_server - INFO - Received request from ('127.0.0.1', 53072): chat
2025-07-01 10:19:45,297 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 10:19:45,297 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 10:19:45,297 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 10:19:45,298 - __main__ - INFO - Processing message for conversation 10
2025-07-01 10:19:45,309 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:19:45,652 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:19:45,653 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:19:45,653 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:19:46,731 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:46,734 - __main__ - INFO - LLM call completed in 1.08 seconds
2025-07-01 10:19:46,734 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:19:46,734 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:19:46,735 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:19:46,735 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:19:46,736 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:19:46,742 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:19:46,747 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:19:46,747 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:19:46,748 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:19:46,748 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:19:49,095 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:19:49,099 - __main__ - INFO - LLM call completed in 2.35 seconds
2025-07-01 10:19:49,099 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:19:49,100 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 10:19:49,105 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 10:19:49,105 - socket_server - INFO - Received result for 10.
2025-07-01 10:19:49,108 - socket_server - INFO - Sent response to ('127.0.0.1', 53072): success
2025-07-01 10:20:21,107 - socket_server - INFO - New client connected from ('127.0.0.1', 53082)
2025-07-01 10:20:21,108 - socket_server - INFO - Received request from ('127.0.0.1', 53082): chat
2025-07-01 10:20:21,108 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:20:21,109 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:20:21,109 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:20:21,109 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:20:21,109 - __main__ - INFO - New context established: rag:general
2025-07-01 10:20:21,126 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:20:21,623 - __main__ - INFO - User message: liệt kê db
2025-07-01 10:20:21,625 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:20:21,625 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:20:23,559 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:20:23,561 - __main__ - INFO - LLM call completed in 1.94 seconds
2025-07-01 10:20:23,562 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:20:23,562 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:20:23,563 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:20:23,563 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:20:23,564 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:20:23,569 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:20:23,569 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:20:23,570 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:20:23,570 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:20:23,571 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:20:24,759 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:20:24,763 - __main__ - INFO - LLM call completed in 1.19 seconds
2025-07-01 10:20:24,763 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:20:24,764 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:20:24,764 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:20:24,764 - socket_server - INFO - Received result for 39.
2025-07-01 10:20:24,776 - socket_server - INFO - Sent response to ('127.0.0.1', 53082): success
2025-07-01 10:20:48,687 - socket_server - INFO - Client ('127.0.0.1', 53067) closed connection
2025-07-01 10:20:48,690 - socket_server - INFO - Client ('127.0.0.1', 53067) disconnected
2025-07-01 10:21:12,237 - socket_server - INFO - New client connected from ('127.0.0.1', 53098)
2025-07-01 10:21:12,238 - socket_server - INFO - Received request from ('127.0.0.1', 53098): chat
2025-07-01 10:21:12,238 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:21:12,239 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:21:12,240 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:21:12,240 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:21:12,252 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:21:12,528 - __main__ - INFO - User message: liệt kê db
2025-07-01 10:21:12,529 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:21:12,530 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:21:13,641 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:21:13,644 - __main__ - INFO - LLM call completed in 1.11 seconds
2025-07-01 10:21:13,645 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:21:13,646 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:21:13,647 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:21:13,654 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:21:13,655 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:21:13,660 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:21:13,663 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:21:13,664 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:21:13,665 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:21:13,665 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:21:15,231 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:21:15,233 - __main__ - INFO - LLM call completed in 1.57 seconds
2025-07-01 10:21:15,233 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:21:15,233 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:21:15,234 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:21:15,234 - socket_server - INFO - Received result for 39.
2025-07-01 10:21:15,235 - socket_server - INFO - Sent response to ('127.0.0.1', 53098): success
2025-07-01 10:21:15,295 - socket_server - INFO - Client ('127.0.0.1', 53072) closed connection
2025-07-01 10:21:15,295 - socket_server - INFO - Client ('127.0.0.1', 53072) disconnected
2025-07-01 10:21:51,108 - socket_server - INFO - Client ('127.0.0.1', 53082) closed connection
2025-07-01 10:21:51,109 - socket_server - INFO - Client ('127.0.0.1', 53082) disconnected
2025-07-01 10:22:42,240 - socket_server - INFO - Client ('127.0.0.1', 53098) closed connection
2025-07-01 10:22:42,242 - socket_server - INFO - Client ('127.0.0.1', 53098) disconnected
2025-07-01 10:23:19,137 - socket_server - INFO - New client connected from ('127.0.0.1', 53130)
2025-07-01 10:23:19,137 - socket_server - INFO - Received request from ('127.0.0.1', 53130): chat
2025-07-01 10:23:19,138 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:23:19,138 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:23:19,138 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:23:19,139 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:23:19,146 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:23:19,293 - __main__ - INFO - User message: liệt kê db
2025-07-01 10:23:19,294 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:23:19,294 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:23:21,214 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:23:21,216 - __main__ - INFO - LLM call completed in 1.92 seconds
2025-07-01 10:23:21,217 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:23:21,217 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:23:21,217 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:23:21,218 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:23:21,218 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:23:21,223 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:23:21,224 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:23:21,224 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:23:21,224 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:23:21,226 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:23:22,402 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:23:22,403 - __main__ - INFO - LLM call completed in 1.18 seconds
2025-07-01 10:23:22,404 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:23:22,404 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:23:22,404 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:23:22,405 - socket_server - INFO - Received result for 39.
2025-07-01 10:23:22,405 - socket_server - INFO - Sent response to ('127.0.0.1', 53130): success
2025-07-01 10:24:49,151 - socket_server - INFO - Client ('127.0.0.1', 53130) closed connection
2025-07-01 10:24:49,152 - socket_server - INFO - Client ('127.0.0.1', 53130) disconnected
2025-07-01 10:25:19,951 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:25:19,957 - __main__ - INFO - Stopping server...
2025-07-01 10:25:19,957 - socket_server - INFO - Stopping server...
2025-07-01 10:25:19,957 - socket_server - INFO - Stopping server...
2025-07-01 10:25:19,957 - socket_server - INFO - Socket Server stopped
2025-07-01 10:25:19,957 - socket_server - INFO - Socket Server stopped
2025-07-01 10:25:19,957 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:25:50,688 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:25:53,372 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:25:53,374 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:25:53,374 - __main__ - INFO - Message processor task started.
2025-07-01 10:25:53,377 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:26:08,266 - socket_server - INFO - New client connected from ('127.0.0.1', 53172)
2025-07-01 10:26:08,267 - socket_server - INFO - Received request from ('127.0.0.1', 53172): chat
2025-07-01 10:26:08,267 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:26:08,268 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:26:08,268 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:26:08,268 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:26:08,269 - __main__ - INFO - New context established: rag:general
2025-07-01 10:26:08,279 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:26:08,781 - __main__ - INFO - User message: liệt kê db
2025-07-01 10:26:08,782 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:26:08,782 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:26:10,927 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:10,930 - __main__ - INFO - LLM call completed in 2.15 seconds
2025-07-01 10:26:10,930 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:26:10,930 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:26:10,931 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:26:10,931 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:26:10,931 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:26:10,943 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:26:10,943 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:26:10,943 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:26:10,944 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:26:13,420 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:13,422 - __main__ - INFO - LLM call completed in 2.48 seconds
2025-07-01 10:26:13,422 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:26:13,422 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:26:13,422 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:26:13,423 - socket_server - INFO - Received result for 39.
2025-07-01 10:26:13,423 - socket_server - INFO - Sent response to ('127.0.0.1', 53172): success
2025-07-01 10:26:23,313 - socket_server - INFO - New client connected from ('127.0.0.1', 53177)
2025-07-01 10:26:23,314 - socket_server - INFO - Received request from ('127.0.0.1', 53177): chat
2025-07-01 10:26:23,314 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:26:23,314 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:26:23,314 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:26:23,314 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:26:23,319 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:26:23,476 - __main__ - INFO - User message: man_time
2025-07-01 10:26:23,476 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:26:23,477 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:26:24,930 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:24,933 - __main__ - INFO - LLM call completed in 1.46 seconds
2025-07-01 10:26:24,933 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:26:24,934 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:26:24,934 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:26:24,935 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 10:26:24,935 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:26:24,936 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 10:26:24,936 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:26:27,877 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:27,879 - __main__ - INFO - LLM call completed in 2.94 seconds
2025-07-01 10:26:27,880 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:26:27,880 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:26:27,881 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:26:27,881 - socket_server - INFO - Received result for 39.
2025-07-01 10:26:27,882 - socket_server - INFO - Sent response to ('127.0.0.1', 53177): success
2025-07-01 10:26:37,456 - socket_server - INFO - New client connected from ('127.0.0.1', 53182)
2025-07-01 10:26:37,456 - socket_server - INFO - Received request from ('127.0.0.1', 53182): chat
2025-07-01 10:26:37,456 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:26:37,457 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:26:37,457 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:26:37,457 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:26:37,461 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:26:37,611 - __main__ - INFO - User message: có
2025-07-01 10:26:37,612 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:26:37,612 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:26:38,863 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:38,865 - __main__ - INFO - LLM call completed in 1.25 seconds
2025-07-01 10:26:38,866 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:26:38,866 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:26:38,867 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:26:38,867 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 10:26:38,868 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:26:38,868 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 10:26:38,869 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:26:41,544 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:41,545 - __main__ - INFO - LLM call completed in 2.68 seconds
2025-07-01 10:26:41,546 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:26:41,546 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:26:41,546 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:26:41,546 - socket_server - INFO - Received result for 39.
2025-07-01 10:26:41,547 - socket_server - INFO - Sent response to ('127.0.0.1', 53182): success
2025-07-01 10:26:58,513 - socket_server - INFO - New client connected from ('127.0.0.1', 53187)
2025-07-01 10:26:58,513 - socket_server - INFO - Received request from ('127.0.0.1', 53187): chat
2025-07-01 10:26:58,513 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:26:58,514 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:26:58,514 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:26:58,514 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:26:58,521 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:26:58,685 - __main__ - INFO - User message: phân tích doanh thu của bảng doanh thu
2025-07-01 10:26:58,685 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:26:58,685 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:26:59,846 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:26:59,847 - __main__ - INFO - LLM call completed in 1.16 seconds
2025-07-01 10:26:59,847 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:26:59,848 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:26:59,848 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:26:59,848 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 10:26:59,848 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu của bảng doanh thu'}
2025-07-01 10:27:00,375 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 10:27:00,375 - __main__ - INFO - Parallel tool execution completed in 0.53 seconds
2025-07-01 10:27:00,376 - __main__ - INFO - Tool execution completed in 0.53 seconds
2025-07-01 10:27:00,376 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:27:09,985 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:27:09,987 - __main__ - INFO - LLM call completed in 9.61 seconds
2025-07-01 10:27:09,988 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:27:09,988 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:27:09,989 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:27:09,989 - socket_server - INFO - Received result for 39.
2025-07-01 10:27:09,990 - socket_server - INFO - Sent response to ('127.0.0.1', 53187): success
2025-07-01 10:27:24,045 - socket_server - INFO - New client connected from ('127.0.0.1', 53191)
2025-07-01 10:27:24,046 - socket_server - INFO - Received request from ('127.0.0.1', 53191): chat
2025-07-01 10:27:24,046 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:27:24,046 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:27:24,047 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:27:24,047 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:27:24,059 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}', 'create_chart']
2025-07-01 10:27:24,424 - __main__ - INFO - User message: vẽ biểu đồ
2025-07-01 10:27:24,424 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:27:24,425 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:27:30,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:27:30,572 - __main__ - INFO - LLM call completed in 6.15 seconds
2025-07-01 10:27:30,572 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:27:30,572 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:27:30,573 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:27:30,573 - __main__ - INFO - Executing tool call: create_chart
2025-07-01 10:27:30,573 - __main__ - INFO - Executing tool: create_chart with args: {'chart_type': 'line', 'data_json': '[{"year": "2020", "revenue": 15}, {"year": "2021", "revenue": 23}, {"year": "2022", "revenue": 6}, {"year": "2023", "revenue": 6}, {"year": "2024", "revenue": 9}]', 'title': 'Tăng trưởng doanh thu Hòa Phát (2020 - 2024)', 'x_column': 'year', 'x_label': 'Năm', 'y_column': 'revenue', 'y_label': 'Doanh thu (%)'}
2025-07-01 10:27:30,576 - __main__ - ERROR - Error in mcpCall for tool create_chart: Unknown tool: create_chart
2025-07-01 10:27:30,577 - __main__ - WARNING - Tool call returned error: Unknown tool: create_chart
2025-07-01 10:27:30,577 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:27:30,578 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:27:30,578 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:27:36,203 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:27:36,204 - __main__ - INFO - LLM call completed in 5.63 seconds
2025-07-01 10:27:36,204 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:27:36,205 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:27:36,205 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:27:36,205 - socket_server - INFO - Received result for 39.
2025-07-01 10:27:36,205 - socket_server - INFO - Sent response to ('127.0.0.1', 53191): success
2025-07-01 10:27:38,271 - socket_server - INFO - Client ('127.0.0.1', 53172) closed connection
2025-07-01 10:27:38,273 - socket_server - INFO - Client ('127.0.0.1', 53172) disconnected
2025-07-01 10:27:53,319 - socket_server - INFO - Client ('127.0.0.1', 53177) closed connection
2025-07-01 10:27:53,320 - socket_server - INFO - Client ('127.0.0.1', 53177) disconnected
2025-07-01 10:28:07,455 - socket_server - INFO - Client ('127.0.0.1', 53182) closed connection
2025-07-01 10:28:07,456 - socket_server - INFO - Client ('127.0.0.1', 53182) disconnected
2025-07-01 10:28:28,516 - socket_server - INFO - Client ('127.0.0.1', 53187) closed connection
2025-07-01 10:28:28,517 - socket_server - INFO - Client ('127.0.0.1', 53187) disconnected
2025-07-01 10:28:54,053 - socket_server - INFO - Client ('127.0.0.1', 53191) closed connection
2025-07-01 10:28:54,054 - socket_server - INFO - Client ('127.0.0.1', 53191) disconnected
2025-07-01 10:39:05,070 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:39:05,081 - __main__ - INFO - Stopping server...
2025-07-01 10:39:05,082 - socket_server - INFO - Stopping server...
2025-07-01 10:39:05,083 - socket_server - INFO - Stopping server...
2025-07-01 10:39:05,083 - socket_server - INFO - Socket Server stopped
2025-07-01 10:39:05,084 - socket_server - INFO - Socket Server stopped
2025-07-01 10:39:05,084 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:39:09,364 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:39:12,214 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:39:12,215 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:39:12,215 - __main__ - INFO - Message processor task started.
2025-07-01 10:39:12,218 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:39:25,181 - socket_server - INFO - New client connected from ('127.0.0.1', 53381)
2025-07-01 10:39:25,181 - socket_server - INFO - Received request from ('127.0.0.1', 53381): chat
2025-07-01 10:39:25,181 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:39:25,182 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:39:25,182 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:39:25,183 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:39:25,183 - __main__ - INFO - New context established: rag:general
2025-07-01 10:39:25,192 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:39:25,621 - __main__ - INFO - User message: vẽ biểu đồ
2025-07-01 10:39:25,622 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:39:25,622 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:39:29,954 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:39:29,957 - __main__ - INFO - LLM call completed in 4.33 seconds
2025-07-01 10:39:29,957 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:39:29,958 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:39:29,958 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:39:29,959 - socket_server - INFO - Received result for 39.
2025-07-01 10:39:29,959 - socket_server - INFO - Sent response to ('127.0.0.1', 53381): success
2025-07-01 10:39:51,666 - socket_server - INFO - New client connected from ('127.0.0.1', 53388)
2025-07-01 10:39:51,667 - socket_server - INFO - Received request from ('127.0.0.1', 53388): chat
2025-07-01 10:39:51,668 - __main__ - INFO - Enqueuing message for conversation 39
2025-07-01 10:39:51,668 - socket_server - INFO - Waiting for async processing result for 39...
2025-07-01 10:39:51,669 - __main__ - INFO - Dequeued message for conversation 39
2025-07-01 10:39:51,670 - __main__ - INFO - Processing message for conversation 39
2025-07-01 10:39:51,683 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:39:52,100 - __main__ - INFO - User message: phân tích doanh thu của bảng doanh thu và vẽ biểu đồ
2025-07-01 10:39:52,101 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:39:52,101 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:39:53,317 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:39:53,318 - __main__ - INFO - LLM call completed in 1.22 seconds
2025-07-01 10:39:53,319 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:39:53,319 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:39:53,319 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:39:53,319 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-07-01 10:39:53,319 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'doanhthu'}
2025-07-01 10:39:53,319 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/doanhthu
2025-07-01 10:39:53,323 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-07-01 10:39:53,324 - __main__ - WARNING - Tool call returned error: 1049 (42000): Unknown database 'doanhthu'
2025-07-01 10:39:53,324 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:39:53,324 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:39:53,325 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:39:56,565 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:39:56,568 - __main__ - INFO - LLM call completed in 3.24 seconds
2025-07-01 10:39:56,569 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:39:56,570 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:39:56,572 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:39:56,573 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:39:56,573 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:39:56,581 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:39:56,582 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:39:56,583 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:39:56,583 - __main__ - INFO - LLM iteration 3/10
2025-07-01 10:39:57,882 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:39:57,882 - __main__ - INFO - LLM call completed in 1.30 seconds
2025-07-01 10:39:57,883 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:39:57,883 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:39:57,883 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:39:57,883 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-07-01 10:39:57,883 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'duantotnghiep_su25'}
2025-07-01 10:39:57,883 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 10:39:57,889 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-07-01 10:39:57,889 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:39:57,890 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:39:57,890 - __main__ - INFO - LLM iteration 4/10
2025-07-01 10:39:59,137 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:39:59,139 - __main__ - INFO - LLM call completed in 1.25 seconds
2025-07-01 10:39:59,140 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:39:59,141 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:39:59,142 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:39:59,143 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-07-01 10:39:59,144 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'duantotnghiep_su25'}
2025-07-01 10:39:59,145 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/duantotnghiep_su25
2025-07-01 10:39:59,165 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-07-01 10:39:59,166 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:39:59,167 - __main__ - INFO - Tool execution completed in 0.03 seconds
2025-07-01 10:39:59,167 - __main__ - INFO - LLM iteration 5/10
2025-07-01 10:40:02,069 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:40:02,072 - __main__ - INFO - LLM call completed in 2.90 seconds
2025-07-01 10:40:02,073 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:40:02,074 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:40:02,075 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:40:02,078 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:40:02,079 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT YEAR(orders.created_at) AS year, SUM(order_details.total_price) AS total_revenue FROM orders JOIN order_details ON orders.id = order_details.order_id GROUP BY YEAR(orders.created_at) ORDER BY year;'}
2025-07-01 10:40:02,091 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:40:02,093 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 10:40:02,095 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:40:02,095 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:40:02,095 - __main__ - INFO - LLM iteration 6/10
2025-07-01 10:40:04,559 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:40:04,562 - __main__ - INFO - LLM call completed in 2.47 seconds
2025-07-01 10:40:04,564 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:40:04,581 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:40:04,582 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:40:04,583 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:40:04,584 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE duantotnghiep_su25; SELECT YEAR(orders.created_at) AS year, SUM(order_details.total_price) AS total_revenue FROM orders JOIN order_details ON orders.id = order_details.order_id GROUP BY YEAR(orders.created_at) ORDER BY year;'}
2025-07-01 10:40:04,594 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:40:04,596 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:40:04,596 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:40:04,597 - __main__ - INFO - LLM iteration 7/10
2025-07-01 10:40:06,184 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:40:06,185 - __main__ - INFO - LLM call completed in 1.59 seconds
2025-07-01 10:40:06,185 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:40:06,186 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:40:06,187 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:40:06,188 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:40:06,188 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT * FROM orders LIMIT 5;'}
2025-07-01 10:40:06,195 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:40:06,196 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:40:06,198 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:40:06,198 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:40:06,198 - __main__ - INFO - LLM iteration 8/10
2025-07-01 10:40:09,585 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:40:09,588 - __main__ - INFO - LLM call completed in 3.39 seconds
2025-07-01 10:40:09,589 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:40:09,590 - __main__ - INFO - Generated final answer for conversation 39
2025-07-01 10:40:09,591 - __main__ - INFO - Processing complete for 39. Status: success
2025-07-01 10:40:09,591 - socket_server - INFO - Received result for 39.
2025-07-01 10:40:09,605 - socket_server - INFO - Sent response to ('127.0.0.1', 53388): success
2025-07-01 10:40:55,186 - socket_server - INFO - Client ('127.0.0.1', 53381) closed connection
2025-07-01 10:40:55,187 - socket_server - INFO - Client ('127.0.0.1', 53381) disconnected
2025-07-01 10:41:10,025 - socket_server - INFO - New client connected from ('127.0.0.1', 53421)
2025-07-01 10:41:10,025 - socket_server - INFO - Received request from ('127.0.0.1', 53421): chat
2025-07-01 10:41:10,025 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:41:10,025 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:41:10,025 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:41:10,026 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:41:10,026 - __main__ - INFO - New context established: rag:general
2025-07-01 10:41:10,031 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:41:10,179 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:41:10,180 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:41:10,180 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:41:11,880 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:41:11,882 - __main__ - INFO - LLM call completed in 1.70 seconds
2025-07-01 10:41:11,883 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:41:11,883 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:41:11,884 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:41:11,884 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:41:11,885 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:41:11,889 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:41:11,890 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:41:11,890 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:41:11,891 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:41:11,891 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:41:12,994 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:41:12,997 - __main__ - INFO - LLM call completed in 1.11 seconds
2025-07-01 10:41:12,998 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:41:12,998 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:41:12,999 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:41:12,999 - socket_server - INFO - Received result for 40.
2025-07-01 10:41:13,000 - socket_server - INFO - Sent response to ('127.0.0.1', 53421): success
2025-07-01 10:41:21,670 - socket_server - INFO - Client ('127.0.0.1', 53388) closed connection
2025-07-01 10:41:21,670 - socket_server - INFO - Client ('127.0.0.1', 53388) disconnected
2025-07-01 10:41:53,884 - socket_server - INFO - New client connected from ('127.0.0.1', 53429)
2025-07-01 10:41:53,885 - socket_server - INFO - Received request from ('127.0.0.1', 53429): chat
2025-07-01 10:41:53,885 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:41:53,885 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:41:53,886 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:41:53,886 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:41:53,899 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:41:54,219 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:41:54,220 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:41:54,220 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:41:56,089 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:41:56,090 - __main__ - INFO - LLM call completed in 1.87 seconds
2025-07-01 10:41:56,091 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:41:56,091 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:41:56,092 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:41:56,093 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:41:56,093 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:41:56,101 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:41:56,103 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:41:56,104 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:41:56,104 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:41:56,105 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:41:57,885 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:41:57,887 - __main__ - INFO - LLM call completed in 1.78 seconds
2025-07-01 10:41:57,887 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:41:57,888 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:41:57,891 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:41:57,891 - socket_server - INFO - Received result for 40.
2025-07-01 10:41:57,894 - socket_server - INFO - Sent response to ('127.0.0.1', 53429): success
2025-07-01 10:42:40,024 - socket_server - INFO - Client ('127.0.0.1', 53421) closed connection
2025-07-01 10:42:40,024 - socket_server - INFO - Client ('127.0.0.1', 53421) disconnected
2025-07-01 10:43:08,740 - socket_server - INFO - New client connected from ('127.0.0.1', 53461)
2025-07-01 10:43:08,741 - socket_server - INFO - Received request from ('127.0.0.1', 53461): chat
2025-07-01 10:43:08,741 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:43:08,742 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:43:08,743 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:43:08,743 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:43:08,755 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:43:09,222 - __main__ - INFO - User message: liet ke database
2025-07-01 10:43:09,222 - __main__ - INFO - System prompt: You are a data analytics chatbot specialized in business intelligence and data interpretation.

    IMPORTANT: You MUST use tools to answer user questions about data, databases, or analytics. Do NOT a...
2025-07-01 10:43:09,223 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:43:10,272 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:43:10,274 - __main__ - INFO - LLM call completed in 1.05 seconds
2025-07-01 10:43:10,275 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:43:10,276 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:43:10,277 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:43:10,278 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:43:10,283 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:43:10,291 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:43:10,293 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:43:10,295 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:43:10,296 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:43:10,296 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:43:13,559 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:43:13,563 - __main__ - INFO - LLM call completed in 3.27 seconds
2025-07-01 10:43:13,563 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:43:13,566 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:43:13,567 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:43:13,567 - socket_server - INFO - Received result for 40.
2025-07-01 10:43:13,568 - socket_server - INFO - Sent response to ('127.0.0.1', 53461): success
2025-07-01 10:43:23,880 - socket_server - INFO - Client ('127.0.0.1', 53429) closed connection
2025-07-01 10:43:23,880 - socket_server - INFO - Client ('127.0.0.1', 53429) disconnected
2025-07-01 10:44:10,154 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:44:10,163 - __main__ - INFO - Stopping server...
2025-07-01 10:44:10,164 - socket_server - INFO - Stopping server...
2025-07-01 10:44:10,164 - socket_server - INFO - Socket Server stopped
2025-07-01 10:44:10,164 - socket_server - INFO - Stopping server...
2025-07-01 10:44:10,165 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:44:10,165 - socket_server - INFO - Socket Server stopped
2025-07-01 10:47:45,001 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:47:47,730 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:47:47,731 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:47:47,731 - __main__ - INFO - Message processor task started.
2025-07-01 10:47:47,733 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:48:03,213 - socket_server - INFO - New client connected from ('127.0.0.1', 53515)
2025-07-01 10:48:03,213 - socket_server - INFO - Received request from ('127.0.0.1', 53515): chat
2025-07-01 10:48:03,213 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:48:03,214 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:48:03,214 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:48:03,214 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:48:03,215 - __main__ - INFO - New context established: rag:general
2025-07-01 10:48:03,226 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:48:03,626 - __main__ - INFO - User message: liet ke database
2025-07-01 10:48:03,628 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:48:03,628 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:48:05,644 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:48:05,650 - __main__ - INFO - LLM call completed in 2.02 seconds
2025-07-01 10:48:05,654 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:48:05,655 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:48:05,656 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:48:05,656 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:48:05,661 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:48:05,678 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:48:05,680 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:48:05,681 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:48:05,682 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:48:09,108 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:48:09,112 - __main__ - INFO - LLM call completed in 3.43 seconds
2025-07-01 10:48:09,113 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:48:09,114 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:48:09,114 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:48:09,114 - socket_server - INFO - Received result for 40.
2025-07-01 10:48:09,118 - socket_server - INFO - Sent response to ('127.0.0.1', 53515): success
2025-07-01 10:48:26,953 - socket_server - INFO - New client connected from ('127.0.0.1', 53520)
2025-07-01 10:48:26,954 - socket_server - INFO - Received request from ('127.0.0.1', 53520): chat
2025-07-01 10:48:26,954 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:48:26,955 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:48:26,955 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:48:26,956 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:48:26,970 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:48:27,293 - __main__ - INFO - User message: "Lấy schema của `man_time`"
2025-07-01 10:48:27,295 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:48:27,296 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:48:28,510 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:48:28,512 - __main__ - INFO - LLM call completed in 1.22 seconds
2025-07-01 10:48:28,513 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:48:28,513 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:48:28,514 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:48:28,514 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-07-01 10:48:28,515 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 10:48:28,516 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/man_time
2025-07-01 10:48:28,532 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-07-01 10:48:28,532 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:48:28,533 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:48:28,534 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:48:43,361 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:48:43,364 - __main__ - INFO - LLM call completed in 14.83 seconds
2025-07-01 10:48:43,364 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:48:43,365 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:48:43,365 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:48:43,365 - socket_server - INFO - Received result for 40.
2025-07-01 10:48:43,366 - socket_server - INFO - Sent response to ('127.0.0.1', 53520): success
2025-07-01 10:48:56,893 - socket_server - INFO - New client connected from ('127.0.0.1', 53523)
2025-07-01 10:48:56,894 - socket_server - INFO - Received request from ('127.0.0.1', 53523): chat
2025-07-01 10:48:56,894 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:48:56,895 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:48:56,896 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:48:56,897 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:48:56,910 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:48:57,283 - __main__ - INFO - User message: phân tích bảng doanh số
2025-07-01 10:48:57,284 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:48:57,285 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:49:19,832 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:49:19,834 - __main__ - INFO - LLM call completed in 22.55 seconds
2025-07-01 10:49:19,835 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:49:19,835 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:49:19,836 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:49:19,836 - socket_server - INFO - Received result for 40.
2025-07-01 10:49:19,837 - socket_server - INFO - Sent response to ('127.0.0.1', 53523): success
2025-07-01 10:49:33,221 - socket_server - INFO - Client ('127.0.0.1', 53515) closed connection
2025-07-01 10:49:33,226 - socket_server - INFO - Client ('127.0.0.1', 53515) disconnected
2025-07-01 10:49:41,787 - socket_server - INFO - New client connected from ('127.0.0.1', 53532)
2025-07-01 10:49:41,787 - socket_server - INFO - Received request from ('127.0.0.1', 53532): chat
2025-07-01 10:49:41,788 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:49:41,788 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:49:41,788 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:49:41,789 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:49:41,806 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:49:42,201 - __main__ - INFO - User message: vẽ biểu đồ doanh số
2025-07-01 10:49:42,202 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:49:42,203 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:49:47,739 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:49:47,741 - __main__ - INFO - LLM call completed in 5.54 seconds
2025-07-01 10:49:47,742 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:49:47,742 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:49:47,742 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:49:47,743 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:49:47,743 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT t.Thang, t.Nam, SUM(f.DoanhThu) AS TongDoanhThu FROM fact_doanhso f JOIN dim_thoigian t ON f.MaNgay = t.MaNgay GROUP BY t.Thang, t.Nam ORDER BY t.Nam, t.Thang;'}
2025-07-01 10:49:47,754 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:49:47,754 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 10:49:47,754 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:49:47,755 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:49:47,755 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:49:51,019 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:49:51,020 - __main__ - INFO - LLM call completed in 3.27 seconds
2025-07-01 10:49:51,021 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:49:51,021 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:49:51,021 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:49:51,021 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:49:51,022 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT t.Thang, t.Nam, SUM(f.DoanhThu) AS TongDoanhThu FROM fact_doanhso f JOIN dim_thoigian t ON f.MaNgay = t.MaNgay GROUP BY t.Thang, t.Nam ORDER BY t.Nam, t.Thang;'}
2025-07-01 10:49:51,025 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:49:51,026 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:49:51,026 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 10:49:51,027 - __main__ - INFO - LLM iteration 3/10
2025-07-01 10:49:53,710 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:49:53,712 - __main__ - INFO - LLM call completed in 2.68 seconds
2025-07-01 10:49:53,712 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:49:53,713 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:49:53,713 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:49:53,713 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:49:53,713 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT COUNT(*) AS SoDong FROM fact_doanhso;'}
2025-07-01 10:49:53,717 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:49:53,717 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:49:53,718 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:49:53,718 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:49:53,718 - __main__ - INFO - LLM iteration 4/10
2025-07-01 10:49:56,966 - socket_server - INFO - Client ('127.0.0.1', 53520) closed connection
2025-07-01 10:49:56,968 - socket_server - INFO - Client ('127.0.0.1', 53520) disconnected
2025-07-01 10:49:57,408 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:49:57,410 - __main__ - INFO - LLM call completed in 3.69 seconds
2025-07-01 10:49:57,410 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:49:57,411 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:49:57,411 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:49:57,411 - socket_server - INFO - Received result for 40.
2025-07-01 10:49:57,413 - socket_server - INFO - Sent response to ('127.0.0.1', 53532): success
2025-07-01 10:50:26,903 - socket_server - INFO - Client ('127.0.0.1', 53523) closed connection
2025-07-01 10:50:26,904 - socket_server - INFO - Client ('127.0.0.1', 53523) disconnected
2025-07-01 10:51:11,799 - socket_server - INFO - Client ('127.0.0.1', 53532) closed connection
2025-07-01 10:51:11,801 - socket_server - INFO - Client ('127.0.0.1', 53532) disconnected
2025-07-01 10:51:13,535 - socket_server - INFO - New client connected from ('127.0.0.1', 53555)
2025-07-01 10:51:13,535 - socket_server - INFO - Received request from ('127.0.0.1', 53555): chat
2025-07-01 10:51:13,536 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:51:13,536 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:51:13,536 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:51:13,536 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:51:13,546 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:51:13,696 - __main__ - INFO - User message: Tổng doanh thu tháng 1 năm 2023'
2025-07-01 10:51:13,696 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:51:13,697 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:51:16,689 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:51:16,690 - __main__ - INFO - LLM call completed in 2.99 seconds
2025-07-01 10:51:16,690 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:51:16,690 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:51:16,690 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:51:16,690 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 10:51:16,691 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT SUM(f.DoanhThu) AS TongDoanhThu FROM fact_doanhso f JOIN dim_thoigian t ON f.MaNgay = t.MaNgay WHERE t.Thang = 1 AND t.Nam = 2023;'}
2025-07-01 10:51:16,692 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 10:51:16,693 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:51:16,693 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 10:51:16,693 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 10:51:16,693 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:51:20,123 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:51:20,125 - __main__ - INFO - LLM call completed in 3.43 seconds
2025-07-01 10:51:20,125 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:51:20,126 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:51:20,127 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:51:20,127 - socket_server - INFO - Received result for 40.
2025-07-01 10:51:20,128 - socket_server - INFO - Sent response to ('127.0.0.1', 53555): success
2025-07-01 10:52:43,540 - socket_server - INFO - Client ('127.0.0.1', 53555) closed connection
2025-07-01 10:52:43,549 - socket_server - INFO - Client ('127.0.0.1', 53555) disconnected
2025-07-01 10:53:30,662 - socket_server - INFO - New client connected from ('127.0.0.1', 53584)
2025-07-01 10:53:30,662 - socket_server - INFO - Received request from ('127.0.0.1', 53584): chat
2025-07-01 10:53:30,663 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:53:30,663 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:53:30,663 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:53:30,663 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:53:30,669 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:53:30,828 - __main__ - INFO - User message: Tổng doanh thu tháng 1 năm 2023'
2025-07-01 10:53:30,828 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:53:30,829 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:53:36,902 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:53:36,903 - __main__ - INFO - LLM call completed in 6.07 seconds
2025-07-01 10:53:36,903 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:53:36,903 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:53:36,904 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:53:36,904 - socket_server - INFO - Received result for 40.
2025-07-01 10:53:36,904 - socket_server - INFO - Sent response to ('127.0.0.1', 53584): success
2025-07-01 10:54:03,776 - socket_server - INFO - New client connected from ('127.0.0.1', 53595)
2025-07-01 10:54:03,777 - socket_server - INFO - Received request from ('127.0.0.1', 53595): chat
2025-07-01 10:54:03,777 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:54:03,777 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:54:03,777 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:54:03,777 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:54:03,782 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:54:03,936 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:54:03,936 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:54:03,937 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:54:05,009 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:54:05,012 - __main__ - INFO - LLM call completed in 1.07 seconds
2025-07-01 10:54:05,012 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:54:05,012 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:54:05,013 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:54:05,013 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:54:05,013 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:54:05,017 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:54:05,017 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 10:54:05,018 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 10:54:05,018 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 10:54:05,018 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:54:07,990 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:54:07,992 - __main__ - INFO - LLM call completed in 2.97 seconds
2025-07-01 10:54:07,993 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:54:07,993 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:54:07,994 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:54:07,994 - socket_server - INFO - Received result for 40.
2025-07-01 10:54:07,995 - socket_server - INFO - Sent response to ('127.0.0.1', 53595): success
2025-07-01 10:54:51,173 - __main__ - INFO - Server tasks cancelled.
2025-07-01 10:54:51,178 - __main__ - INFO - Stopping server...
2025-07-01 10:54:51,179 - socket_server - INFO - Stopping server...
2025-07-01 10:54:51,179 - socket_server - INFO - Socket Server stopped
2025-07-01 10:54:51,179 - socket_server - INFO - Stopping server...
2025-07-01 10:54:51,180 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 10:54:51,180 - socket_server - INFO - Socket Server stopped
2025-07-01 10:54:57,180 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 10:54:59,966 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 10:54:59,967 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 10:54:59,967 - __main__ - INFO - Message processor task started.
2025-07-01 10:54:59,970 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 10:55:09,816 - socket_server - INFO - New client connected from ('127.0.0.1', 53626)
2025-07-01 10:55:09,816 - socket_server - INFO - Received request from ('127.0.0.1', 53626): chat
2025-07-01 10:55:09,817 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:55:09,817 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:55:09,817 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:55:09,818 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:55:09,818 - __main__ - INFO - New context established: rag:general
2025-07-01 10:55:09,828 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:55:10,209 - __main__ - INFO - User message: liệt kê database
2025-07-01 10:55:10,210 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:55:10,210 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:55:12,538 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:55:12,546 - __main__ - INFO - LLM call completed in 2.34 seconds
2025-07-01 10:55:12,546 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:55:12,547 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:55:12,547 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:55:12,548 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 10:55:12,549 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 10:55:12,565 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 10:55:12,566 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 10:55:12,566 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 10:55:12,566 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:55:15,447 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:55:15,450 - __main__ - INFO - LLM call completed in 2.88 seconds
2025-07-01 10:55:15,450 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:55:15,451 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:55:15,453 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:55:15,453 - socket_server - INFO - Received result for 40.
2025-07-01 10:55:15,460 - socket_server - INFO - Sent response to ('127.0.0.1', 53626): success
2025-07-01 10:55:40,482 - socket_server - INFO - New client connected from ('127.0.0.1', 53642)
2025-07-01 10:55:40,482 - socket_server - INFO - Received request from ('127.0.0.1', 53642): chat
2025-07-01 10:55:40,483 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:55:40,483 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:55:40,483 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:55:40,484 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:55:40,492 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:55:40,834 - __main__ - INFO - User message: "Cho tôi biết tổng doanh thu tháng trước của man_time
2025-07-01 10:55:40,834 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:55:40,835 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:55:42,094 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:55:42,099 - __main__ - INFO - LLM call completed in 1.26 seconds
2025-07-01 10:55:42,100 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:55:42,103 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:55:42,104 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:55:42,104 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 10:55:42,106 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'tổng doanh thu tháng trước của man_time'}
2025-07-01 10:55:42,949 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 10:55:42,950 - __main__ - INFO - Parallel tool execution completed in 0.85 seconds
2025-07-01 10:55:42,950 - __main__ - INFO - Tool execution completed in 0.85 seconds
2025-07-01 10:55:42,950 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:55:45,953 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:55:45,954 - __main__ - INFO - LLM call completed in 3.00 seconds
2025-07-01 10:55:45,955 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:55:45,955 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:55:45,956 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:55:45,956 - socket_server - INFO - Received result for 40.
2025-07-01 10:55:45,957 - socket_server - INFO - Sent response to ('127.0.0.1', 53642): success
2025-07-01 10:56:11,642 - socket_server - INFO - New client connected from ('127.0.0.1', 53654)
2025-07-01 10:56:11,642 - socket_server - INFO - Received request from ('127.0.0.1', 53654): chat
2025-07-01 10:56:11,643 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:56:11,643 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:56:11,643 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:56:11,644 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:56:11,653 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:56:12,017 - __main__ - INFO - User message: So sánh doanh thu tháng 5 và tháng 6
2025-07-01 10:56:12,018 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:56:12,018 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:56:13,497 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:56:13,500 - __main__ - INFO - LLM call completed in 1.48 seconds
2025-07-01 10:56:13,501 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:56:13,501 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:56:13,502 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:56:13,502 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 10:56:13,503 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'so sánh doanh thu tháng 5 và tháng 6'}
2025-07-01 10:56:13,780 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 10:56:13,781 - __main__ - INFO - Parallel tool execution completed in 0.28 seconds
2025-07-01 10:56:13,781 - __main__ - INFO - Tool execution completed in 0.28 seconds
2025-07-01 10:56:13,782 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:56:17,904 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:56:17,907 - __main__ - INFO - LLM call completed in 4.12 seconds
2025-07-01 10:56:17,907 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:56:17,908 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:56:17,908 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:56:17,908 - socket_server - INFO - Received result for 40.
2025-07-01 10:56:17,910 - socket_server - INFO - Sent response to ('127.0.0.1', 53654): success
2025-07-01 10:56:34,960 - socket_server - INFO - New client connected from ('127.0.0.1', 53660)
2025-07-01 10:56:34,960 - socket_server - INFO - Received request from ('127.0.0.1', 53660): chat
2025-07-01 10:56:34,961 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 10:56:34,961 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 10:56:34,962 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 10:56:34,962 - __main__ - INFO - Processing message for conversation 40
2025-07-01 10:56:34,972 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 10:56:35,372 - __main__ - INFO - User message: bạn hãy vẽ biểu đồ so sánh 2 tháng
2025-07-01 10:56:35,372 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 10:56:35,372 - __main__ - INFO - LLM iteration 1/10
2025-07-01 10:56:39,740 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:56:39,742 - __main__ - INFO - LLM call completed in 4.37 seconds
2025-07-01 10:56:39,744 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 10:56:39,744 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 10:56:39,745 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 10:56:39,746 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 10:56:39,750 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Thang":"Thang 5","DoanhThu":141409000000000},{"Thang":"Thang 6","DoanhThu":142771000000000}]', 'title': 'So sánh doanh thu tháng 5 và tháng 6', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'DoanhThu', 'y_label': 'Doanh thu (VND)'}
2025-07-01 10:56:39,820 - socket_server - INFO - Client ('127.0.0.1', 53626) closed connection
2025-07-01 10:56:39,821 - socket_server - INFO - Client ('127.0.0.1', 53626) disconnected
2025-07-01 10:56:40,188 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 10:56:40,189 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 10:56:40,190 - __main__ - INFO - Parallel tool execution completed in 0.44 seconds
2025-07-01 10:56:40,190 - __main__ - INFO - Tool execution completed in 0.45 seconds
2025-07-01 10:56:40,191 - __main__ - INFO - LLM iteration 2/10
2025-07-01 10:56:44,775 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 10:56:44,778 - __main__ - INFO - LLM call completed in 4.59 seconds
2025-07-01 10:56:44,779 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 10:56:44,780 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 10:56:44,781 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 10:56:44,781 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 10:56:44,782 - socket_server - INFO - Received result for 40.
2025-07-01 10:56:44,785 - socket_server - INFO - Sent response to ('127.0.0.1', 53660): success
2025-07-01 10:57:10,481 - socket_server - INFO - Client ('127.0.0.1', 53642) closed connection
2025-07-01 10:57:10,481 - socket_server - INFO - Client ('127.0.0.1', 53642) disconnected
2025-07-01 10:57:41,651 - socket_server - INFO - Client ('127.0.0.1', 53654) closed connection
2025-07-01 10:57:41,656 - socket_server - INFO - Client ('127.0.0.1', 53654) disconnected
2025-07-01 10:58:04,960 - socket_server - INFO - Client ('127.0.0.1', 53660) closed connection
2025-07-01 10:58:04,960 - socket_server - INFO - Client ('127.0.0.1', 53660) disconnected
2025-07-01 11:11:19,402 - __main__ - INFO - Server tasks cancelled.
2025-07-01 11:11:19,408 - __main__ - INFO - Stopping server...
2025-07-01 11:11:19,408 - socket_server - INFO - Stopping server...
2025-07-01 11:11:19,408 - socket_server - INFO - Socket Server stopped
2025-07-01 11:11:19,408 - socket_server - INFO - Stopping server...
2025-07-01 11:11:19,408 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 11:11:19,409 - socket_server - INFO - Socket Server stopped
2025-07-01 11:11:21,453 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 11:11:24,357 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 11:11:24,358 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 11:11:24,358 - __main__ - INFO - Message processor task started.
2025-07-01 11:11:24,360 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 11:11:34,677 - socket_server - INFO - New client connected from ('127.0.0.1', 53983)
2025-07-01 11:11:34,678 - socket_server - INFO - Received request from ('127.0.0.1', 53983): chat
2025-07-01 11:11:34,678 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:11:34,678 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:11:34,679 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:11:34,679 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:11:34,680 - __main__ - INFO - New context established: rag:general
2025-07-01 11:11:34,692 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:11:35,084 - __main__ - INFO - User message: bạn hãy vẽ biểu đồ so sánh 2 tháng
2025-07-01 11:11:35,085 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:11:35,086 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:11:40,498 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:11:40,504 - __main__ - INFO - LLM call completed in 5.42 seconds
2025-07-01 11:11:40,504 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:11:40,505 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:11:40,506 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:11:40,506 - socket_server - INFO - Received result for 40.
2025-07-01 11:11:40,508 - socket_server - INFO - Sent response to ('127.0.0.1', 53983): success
2025-07-01 11:11:59,387 - socket_server - INFO - New client connected from ('127.0.0.1', 53990)
2025-07-01 11:11:59,387 - socket_server - INFO - Received request from ('127.0.0.1', 53990): chat
2025-07-01 11:11:59,388 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:11:59,389 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:11:59,389 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:11:59,391 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:11:59,403 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:11:59,758 - __main__ - INFO - User message: "Cho tôi biết tổng doanh thu tháng trước của man_time
2025-07-01 11:11:59,759 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:11:59,759 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:12:01,029 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:12:01,035 - __main__ - INFO - LLM call completed in 1.28 seconds
2025-07-01 11:12:01,037 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:12:01,038 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:12:01,039 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:12:01,040 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:12:01,041 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'tổng doanh thu tháng trước của man_time'}
2025-07-01 11:12:01,913 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:12:01,914 - __main__ - INFO - Parallel tool execution completed in 0.88 seconds
2025-07-01 11:12:01,914 - __main__ - INFO - Tool execution completed in 0.88 seconds
2025-07-01 11:12:01,914 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:12:07,357 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:12:07,359 - __main__ - INFO - LLM call completed in 5.44 seconds
2025-07-01 11:12:07,360 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:12:07,361 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:12:07,362 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:12:07,362 - socket_server - INFO - Received result for 40.
2025-07-01 11:12:07,365 - socket_server - INFO - Sent response to ('127.0.0.1', 53990): success
2025-07-01 11:12:38,648 - socket_server - INFO - New client connected from ('127.0.0.1', 53994)
2025-07-01 11:12:38,649 - socket_server - INFO - Received request from ('127.0.0.1', 53994): chat
2025-07-01 11:12:38,649 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:12:38,650 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:12:38,650 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:12:38,651 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:12:38,661 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:12:39,018 - __main__ - INFO - User message: bạn hãy vẽ biểu đồ so sánh 2 tháng 12 và 11
2025-07-01 11:12:39,019 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:12:39,019 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:12:41,025 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:12:41,028 - __main__ - INFO - LLM call completed in 2.01 seconds
2025-07-01 11:12:41,029 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:12:41,030 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:12:41,034 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:12:41,035 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:12:41,036 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'so sánh doanh thu tháng 12 và tháng 11'}
2025-07-01 11:12:41,297 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:12:41,300 - __main__ - INFO - Parallel tool execution completed in 0.27 seconds
2025-07-01 11:12:41,300 - __main__ - INFO - Tool execution completed in 0.27 seconds
2025-07-01 11:12:41,301 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:12:46,372 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:12:46,374 - __main__ - INFO - LLM call completed in 5.07 seconds
2025-07-01 11:12:46,374 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:12:46,376 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:12:46,377 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:12:46,377 - socket_server - INFO - Received result for 40.
2025-07-01 11:12:46,381 - socket_server - INFO - Sent response to ('127.0.0.1', 53994): success
2025-07-01 11:13:04,677 - socket_server - INFO - Client ('127.0.0.1', 53983) closed connection
2025-07-01 11:13:04,677 - socket_server - INFO - Client ('127.0.0.1', 53983) disconnected
2025-07-01 11:13:06,814 - socket_server - INFO - New client connected from ('127.0.0.1', 54008)
2025-07-01 11:13:06,814 - socket_server - INFO - Received request from ('127.0.0.1', 54008): chat
2025-07-01 11:13:06,814 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:13:06,815 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:13:06,815 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:13:06,815 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:13:06,826 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:13:07,171 - __main__ - INFO - User message: Xem doanh thu từ ngày 1/1/2024 đến 31/3/2024
2025-07-01 11:13:07,172 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:13:07,172 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:13:09,328 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:13:09,332 - __main__ - INFO - LLM call completed in 2.16 seconds
2025-07-01 11:13:09,333 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:13:09,334 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:13:09,337 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:13:09,340 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:13:09,340 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu từ ngày 1/1/2024 đến 31/3/2024'}
2025-07-01 11:13:09,613 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:13:09,614 - __main__ - INFO - Parallel tool execution completed in 0.28 seconds
2025-07-01 11:13:09,615 - __main__ - INFO - Tool execution completed in 0.28 seconds
2025-07-01 11:13:09,615 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:13:17,298 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:13:17,301 - __main__ - INFO - LLM call completed in 7.68 seconds
2025-07-01 11:13:17,301 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:13:17,301 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:13:17,302 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:13:17,302 - socket_server - INFO - Received result for 40.
2025-07-01 11:13:17,303 - socket_server - INFO - Sent response to ('127.0.0.1', 54008): success
2025-07-01 11:13:29,390 - socket_server - INFO - Client ('127.0.0.1', 53990) closed connection
2025-07-01 11:13:29,391 - socket_server - INFO - Client ('127.0.0.1', 53990) disconnected
2025-07-01 11:13:35,660 - socket_server - INFO - New client connected from ('127.0.0.1', 54016)
2025-07-01 11:13:35,661 - socket_server - INFO - Received request from ('127.0.0.1', 54016): chat
2025-07-01 11:13:35,661 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:13:35,661 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:13:35,661 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:13:35,662 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:13:35,671 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:13:36,037 - __main__ - INFO - User message: man_time
2025-07-01 11:13:36,038 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:13:36,039 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:13:37,073 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:13:37,075 - __main__ - INFO - LLM call completed in 1.04 seconds
2025-07-01 11:13:37,075 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:13:37,076 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:13:37,076 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:13:37,078 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:13:37,083 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'man_time'}
2025-07-01 11:13:37,372 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:13:37,375 - __main__ - INFO - Parallel tool execution completed in 0.30 seconds
2025-07-01 11:13:37,375 - __main__ - INFO - Tool execution completed in 0.30 seconds
2025-07-01 11:13:37,376 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:13:44,525 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:13:44,527 - __main__ - INFO - LLM call completed in 7.15 seconds
2025-07-01 11:13:44,528 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:13:44,529 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:13:44,530 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:13:44,530 - socket_server - INFO - Received result for 40.
2025-07-01 11:13:44,533 - socket_server - INFO - Sent response to ('127.0.0.1', 54016): success
2025-07-01 11:13:55,182 - socket_server - INFO - New client connected from ('127.0.0.1', 54022)
2025-07-01 11:13:55,182 - socket_server - INFO - Received request from ('127.0.0.1', 54022): chat
2025-07-01 11:13:55,183 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:13:55,184 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:13:55,184 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:13:55,184 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:13:55,194 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:13:55,525 - __main__ - INFO - User message: liệt kê database
2025-07-01 11:13:55,526 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:13:55,527 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:13:56,726 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:13:56,728 - __main__ - INFO - LLM call completed in 1.20 seconds
2025-07-01 11:13:56,728 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:13:56,729 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:13:56,729 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:13:56,731 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 11:13:56,739 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 11:13:56,759 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 11:13:56,760 - __main__ - INFO - Parallel tool execution completed in 0.03 seconds
2025-07-01 11:13:56,760 - __main__ - INFO - Tool execution completed in 0.03 seconds
2025-07-01 11:13:56,761 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:14:00,180 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:14:00,183 - __main__ - INFO - LLM call completed in 3.42 seconds
2025-07-01 11:14:00,184 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:14:00,185 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:14:00,186 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:14:00,186 - socket_server - INFO - Received result for 40.
2025-07-01 11:14:00,189 - socket_server - INFO - Sent response to ('127.0.0.1', 54022): success
2025-07-01 11:14:04,757 - socket_server - INFO - New client connected from ('127.0.0.1', 54025)
2025-07-01 11:14:04,758 - socket_server - INFO - Received request from ('127.0.0.1', 54025): chat
2025-07-01 11:14:04,758 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:14:04,759 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:14:04,759 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:14:04,759 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:14:04,769 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:14:05,172 - __main__ - INFO - User message: man_time
2025-07-01 11:14:05,173 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:14:05,173 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:14:06,339 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:14:06,342 - __main__ - INFO - LLM call completed in 1.17 seconds
2025-07-01 11:14:06,342 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:14:06,343 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:14:06,343 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:14:06,344 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 11:14:06,344 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 11:14:06,345 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 11:14:06,345 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:14:08,650 - socket_server - INFO - Client ('127.0.0.1', 53994) closed connection
2025-07-01 11:14:08,653 - socket_server - INFO - Client ('127.0.0.1', 53994) disconnected
2025-07-01 11:14:10,529 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:14:10,531 - __main__ - INFO - LLM call completed in 4.19 seconds
2025-07-01 11:14:10,532 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:14:10,532 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:14:10,533 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:14:10,533 - socket_server - INFO - Received result for 40.
2025-07-01 11:14:10,536 - socket_server - INFO - Sent response to ('127.0.0.1', 54025): success
2025-07-01 11:14:36,815 - socket_server - INFO - Client ('127.0.0.1', 54008) closed connection
2025-07-01 11:14:36,815 - socket_server - INFO - Client ('127.0.0.1', 54008) disconnected
2025-07-01 11:14:43,056 - __main__ - INFO - Server tasks cancelled.
2025-07-01 11:14:43,063 - __main__ - INFO - Stopping server...
2025-07-01 11:14:43,064 - socket_server - INFO - Stopping server...
2025-07-01 11:14:43,064 - socket_server - INFO - Socket Server stopped
2025-07-01 11:14:43,064 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 11:14:43,064 - socket_server - INFO - Stopping server...
2025-07-01 11:14:43,065 - socket_server - INFO - Socket Server stopped
2025-07-01 11:15:05,296 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 11:15:08,130 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 11:15:08,131 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 11:15:08,131 - __main__ - INFO - Message processor task started.
2025-07-01 11:15:08,133 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 11:15:23,908 - socket_server - INFO - New client connected from ('127.0.0.1', 54056)
2025-07-01 11:15:23,908 - socket_server - INFO - Received request from ('127.0.0.1', 54056): chat
2025-07-01 11:15:23,908 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:15:23,908 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:15:23,908 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:15:23,909 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:15:23,909 - __main__ - INFO - New context established: rag:general
2025-07-01 11:15:23,913 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:15:24,213 - __main__ - INFO - User message: liệt kê db
2025-07-01 11:15:24,213 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:15:24,213 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:15:25,740 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:15:25,747 - __main__ - INFO - LLM call completed in 1.53 seconds
2025-07-01 11:15:25,750 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:15:25,750 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:15:25,751 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:15:25,752 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 11:15:25,752 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 11:15:25,764 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 11:15:25,766 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 11:15:25,766 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 11:15:25,767 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:15:28,750 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:15:28,752 - __main__ - INFO - LLM call completed in 2.98 seconds
2025-07-01 11:15:28,753 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:15:28,753 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:15:28,754 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:15:28,754 - socket_server - INFO - Received result for 40.
2025-07-01 11:15:28,755 - socket_server - INFO - Sent response to ('127.0.0.1', 54056): success
2025-07-01 11:15:43,286 - socket_server - INFO - New client connected from ('127.0.0.1', 54063)
2025-07-01 11:15:43,287 - socket_server - INFO - Received request from ('127.0.0.1', 54063): chat
2025-07-01 11:15:43,287 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:15:43,287 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:15:43,288 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:15:43,288 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:15:43,297 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:15:43,757 - __main__ - INFO - User message: db man_time
2025-07-01 11:15:43,757 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:15:43,758 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:15:44,764 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:15:44,767 - __main__ - INFO - LLM call completed in 1.01 seconds
2025-07-01 11:15:44,769 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:15:44,769 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:15:44,771 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:15:44,772 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 11:15:44,773 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 11:15:44,774 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 11:15:44,774 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:15:47,114 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:15:47,118 - __main__ - INFO - LLM call completed in 2.34 seconds
2025-07-01 11:15:47,118 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:15:47,119 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:15:47,120 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:15:47,120 - socket_server - INFO - Received result for 40.
2025-07-01 11:15:47,122 - socket_server - INFO - Sent response to ('127.0.0.1', 54063): success
2025-07-01 11:15:56,480 - socket_server - INFO - New client connected from ('127.0.0.1', 54066)
2025-07-01 11:15:56,481 - socket_server - INFO - Received request from ('127.0.0.1', 54066): chat
2025-07-01 11:15:56,482 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:15:56,482 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:15:56,483 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:15:56,483 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:15:56,496 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:15:56,850 - __main__ - INFO - User message: man_time
2025-07-01 11:15:56,850 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:15:56,850 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:15:57,791 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:15:57,794 - __main__ - INFO - LLM call completed in 0.94 seconds
2025-07-01 11:15:57,795 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:15:57,796 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:15:57,800 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:15:57,800 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 11:15:57,801 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 11:15:57,801 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 11:15:57,802 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:16:01,101 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:16:01,103 - __main__ - INFO - LLM call completed in 3.30 seconds
2025-07-01 11:16:01,103 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:16:01,104 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:16:01,106 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:16:01,106 - socket_server - INFO - Received result for 40.
2025-07-01 11:16:01,110 - socket_server - INFO - Sent response to ('127.0.0.1', 54066): success
2025-07-01 11:16:22,873 - socket_server - INFO - New client connected from ('127.0.0.1', 54069)
2025-07-01 11:16:22,873 - socket_server - INFO - Received request from ('127.0.0.1', 54069): chat
2025-07-01 11:16:22,873 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:16:22,874 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:16:22,874 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:16:22,875 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:16:22,883 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:16:23,242 - __main__ - INFO - User message: truy cập man_time
2025-07-01 11:16:23,242 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:16:23,243 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:16:24,195 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:16:24,198 - __main__ - INFO - LLM call completed in 0.95 seconds
2025-07-01 11:16:24,198 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:16:24,199 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:16:24,199 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:16:24,199 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 11:16:24,200 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time'}
2025-07-01 11:16:24,216 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 11:16:24,216 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 11:16:24,217 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 11:16:24,217 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:16:28,199 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:16:28,201 - __main__ - INFO - LLM call completed in 3.98 seconds
2025-07-01 11:16:28,203 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:16:28,204 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:16:28,205 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:16:28,205 - socket_server - INFO - Received result for 40.
2025-07-01 11:16:28,213 - socket_server - INFO - Sent response to ('127.0.0.1', 54069): success
2025-07-01 11:16:53,908 - socket_server - INFO - Client ('127.0.0.1', 54056) closed connection
2025-07-01 11:16:53,911 - socket_server - INFO - Client ('127.0.0.1', 54056) disconnected
2025-07-01 11:16:54,996 - socket_server - INFO - New client connected from ('127.0.0.1', 54084)
2025-07-01 11:16:54,996 - socket_server - INFO - Received request from ('127.0.0.1', 54084): chat
2025-07-01 11:16:54,997 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:16:54,997 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:16:54,997 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:16:54,998 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:16:55,010 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:16:55,365 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 11:16:55,366 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:16:55,367 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:16:56,582 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:16:56,585 - __main__ - INFO - LLM call completed in 1.22 seconds
2025-07-01 11:16:56,585 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:16:56,586 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:16:56,586 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:16:56,586 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:16:56,587 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu theo tháng trong năm nay'}
2025-07-01 11:16:57,604 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:16:57,605 - __main__ - INFO - Parallel tool execution completed in 1.02 seconds
2025-07-01 11:16:57,605 - __main__ - INFO - Tool execution completed in 1.02 seconds
2025-07-01 11:16:57,605 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:17:05,073 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:17:05,074 - __main__ - INFO - LLM call completed in 7.47 seconds
2025-07-01 11:17:05,074 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:17:05,075 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:17:05,075 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:17:05,075 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 11:17:05,076 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"year": "2014", "revenue": 25852}, {"year": "2015", "revenue": 27865}, {"year": "2016", "revenue": 33855}, {"year": "2017", "revenue": 46855}, {"year": "2018", "revenue": 56580}, {"year": "2019", "revenue": 64678}, {"year": "2020", "revenue": 91279}, {"year": "2021", "revenue": 150865}, {"year": "2022", "revenue": 142771}, {"year": "2023", "revenue": 120355}, {"year": "2024", "revenue": 140561}]', 'title': 'Doanh thu theo năm', 'x_column': 'year', 'x_label': 'Năm', 'y_column': 'revenue', 'y_label': 'Doanh thu (tỷ đồng)'}
2025-07-01 11:17:05,640 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 11:17:05,640 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 11:17:05,640 - __main__ - INFO - Parallel tool execution completed in 0.57 seconds
2025-07-01 11:17:05,641 - __main__ - INFO - Tool execution completed in 0.57 seconds
2025-07-01 11:17:05,641 - __main__ - INFO - LLM iteration 3/10
2025-07-01 11:17:08,913 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:17:08,915 - __main__ - INFO - LLM call completed in 3.27 seconds
2025-07-01 11:17:08,916 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:17:08,917 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:17:08,918 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 11:17:08,919 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:17:08,919 - socket_server - INFO - Received result for 40.
2025-07-01 11:17:08,930 - socket_server - INFO - Sent response to ('127.0.0.1', 54084): success
2025-07-01 11:17:13,291 - socket_server - INFO - Client ('127.0.0.1', 54063) closed connection
2025-07-01 11:17:13,292 - socket_server - INFO - Client ('127.0.0.1', 54063) disconnected
2025-07-01 11:17:26,481 - socket_server - INFO - Client ('127.0.0.1', 54066) closed connection
2025-07-01 11:17:26,482 - socket_server - INFO - Client ('127.0.0.1', 54066) disconnected
2025-07-01 11:17:52,876 - socket_server - INFO - Client ('127.0.0.1', 54069) closed connection
2025-07-01 11:17:52,876 - socket_server - INFO - Client ('127.0.0.1', 54069) disconnected
2025-07-01 11:18:24,996 - socket_server - INFO - Client ('127.0.0.1', 54084) closed connection
2025-07-01 11:18:24,997 - socket_server - INFO - Client ('127.0.0.1', 54084) disconnected
2025-07-01 11:29:14,927 - socket_server - INFO - New client connected from ('127.0.0.1', 54315)
2025-07-01 11:29:14,927 - socket_server - INFO - Received request from ('127.0.0.1', 54315): chat
2025-07-01 11:29:14,928 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 11:29:14,928 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 11:29:14,928 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 11:29:14,929 - __main__ - INFO - Processing message for conversation 40
2025-07-01 11:29:14,939 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 11:29:15,353 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 11:29:15,354 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 11:29:15,354 - __main__ - INFO - LLM iteration 1/10
2025-07-01 11:29:17,734 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:29:17,736 - __main__ - INFO - LLM call completed in 2.38 seconds
2025-07-01 11:29:17,739 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 11:29:17,739 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 11:29:17,744 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 11:29:17,746 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 11:29:17,749 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu theo tháng trong năm nay'}
2025-07-01 11:29:18,040 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 11:29:18,041 - __main__ - INFO - Parallel tool execution completed in 0.30 seconds
2025-07-01 11:29:18,041 - __main__ - INFO - Tool execution completed in 0.30 seconds
2025-07-01 11:29:18,041 - __main__ - INFO - LLM iteration 2/10
2025-07-01 11:29:20,481 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 11:29:20,483 - __main__ - INFO - LLM call completed in 2.44 seconds
2025-07-01 11:29:20,484 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 11:29:20,484 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 11:29:20,485 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 11:29:20,486 - socket_server - INFO - Received result for 40.
2025-07-01 11:29:20,489 - socket_server - INFO - Sent response to ('127.0.0.1', 54315): success
2025-07-01 11:30:44,938 - socket_server - INFO - Client ('127.0.0.1', 54315) closed connection
2025-07-01 11:30:44,939 - socket_server - INFO - Client ('127.0.0.1', 54315) disconnected
2025-07-01 13:07:12,012 - __main__ - INFO - Server tasks cancelled.
2025-07-01 13:07:12,036 - __main__ - INFO - Stopping server...
2025-07-01 13:07:12,037 - socket_server - INFO - Stopping server...
2025-07-01 13:07:12,037 - socket_server - INFO - Stopping server...
2025-07-01 13:07:12,037 - socket_server - INFO - Socket Server stopped
2025-07-01 13:07:12,038 - socket_server - INFO - Socket Server stopped
2025-07-01 13:07:12,038 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 13:07:37,077 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 13:07:42,627 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 13:07:42,628 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 13:07:42,629 - __main__ - INFO - Message processor task started.
2025-07-01 13:07:42,631 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 13:08:00,573 - socket_server - INFO - New client connected from ('127.0.0.1', 56184)
2025-07-01 13:08:00,574 - socket_server - INFO - Received request from ('127.0.0.1', 56184): chat
2025-07-01 13:08:00,574 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:08:00,575 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:08:00,575 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:08:00,576 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:08:00,576 - __main__ - INFO - New context established: rag:general
2025-07-01 13:08:00,587 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:08:00,955 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:08:00,956 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:08:00,957 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:08:04,124 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:04,137 - __main__ - INFO - LLM call completed in 3.18 seconds
2025-07-01 13:08:04,140 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:04,140 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:04,141 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:04,143 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:08:04,143 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MONTH(order_date) AS month, SUM(total_amount) AS revenue FROM orders WHERE YEAR(order_date) = YEAR(CURDATE()) GROUP BY MONTH(order_date)'}
2025-07-01 13:08:04,160 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:08:04,161 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:08:04,162 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:08:04,162 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:08:04,163 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:08:05,419 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:05,422 - __main__ - INFO - LLM call completed in 1.26 seconds
2025-07-01 13:08:05,422 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:05,423 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:05,427 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:05,429 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:08:05,429 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:08:05,450 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:08:05,451 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:08:05,452 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:08:05,452 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:08:07,051 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:07,053 - __main__ - INFO - LLM call completed in 1.60 seconds
2025-07-01 13:08:07,053 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:07,053 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:07,053 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:07,054 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:08:07,054 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:08:07,054 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:08:07,054 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:08:09,347 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:09,348 - __main__ - INFO - LLM call completed in 2.29 seconds
2025-07-01 13:08:09,348 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:09,349 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:09,349 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:09,349 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/duantotnghiep_su25
2025-07-01 13:08:09,349 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:08:09,349 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:08:09,349 - __main__ - INFO - LLM iteration 5/10
2025-07-01 13:08:10,927 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:10,930 - __main__ - INFO - LLM call completed in 1.58 seconds
2025-07-01 13:08:10,931 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:10,931 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:10,931 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:10,932 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:08:10,933 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:08:10,933 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:08:10,933 - __main__ - INFO - LLM iteration 6/10
2025-07-01 13:08:14,978 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:14,980 - __main__ - INFO - LLM call completed in 4.05 seconds
2025-07-01 13:08:14,981 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:08:14,981 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:08:14,982 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:08:14,982 - socket_server - INFO - Received result for 40.
2025-07-01 13:08:14,983 - socket_server - INFO - Sent response to ('127.0.0.1', 56184): success
2025-07-01 13:08:27,254 - socket_server - INFO - New client connected from ('127.0.0.1', 56199)
2025-07-01 13:08:27,254 - socket_server - INFO - Received request from ('127.0.0.1', 56199): chat
2025-07-01 13:08:27,254 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:08:27,255 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:08:27,255 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:08:27,255 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:08:27,261 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:08:27,413 - __main__ - INFO - User message: liệt kê database
2025-07-01 13:08:27,413 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:08:27,414 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:08:28,387 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:28,389 - __main__ - INFO - LLM call completed in 0.97 seconds
2025-07-01 13:08:28,389 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:28,389 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:28,389 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:28,390 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:08:28,390 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:08:28,396 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:08:28,396 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:08:28,397 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:08:28,397 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:08:31,974 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:31,975 - __main__ - INFO - LLM call completed in 3.58 seconds
2025-07-01 13:08:31,975 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:08:31,975 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:08:31,976 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:08:31,976 - socket_server - INFO - Received result for 40.
2025-07-01 13:08:31,976 - socket_server - INFO - Sent response to ('127.0.0.1', 56199): success
2025-07-01 13:08:41,061 - socket_server - INFO - New client connected from ('127.0.0.1', 56208)
2025-07-01 13:08:41,061 - socket_server - INFO - Received request from ('127.0.0.1', 56208): chat
2025-07-01 13:08:41,061 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:08:41,061 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:08:41,061 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:08:41,062 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:08:41,066 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:08:41,215 - __main__ - INFO - User message: truy cập man_time
2025-07-01 13:08:41,215 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:08:41,215 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:08:42,701 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:42,702 - __main__ - INFO - LLM call completed in 1.49 seconds
2025-07-01 13:08:42,702 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:42,703 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:42,703 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:42,703 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 13:08:42,703 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:08:42,704 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:08:42,704 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:08:45,796 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:45,798 - __main__ - INFO - LLM call completed in 3.09 seconds
2025-07-01 13:08:45,798 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:08:45,799 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:08:45,799 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:08:45,800 - socket_server - INFO - Received result for 40.
2025-07-01 13:08:45,800 - socket_server - INFO - Sent response to ('127.0.0.1', 56208): success
2025-07-01 13:08:58,652 - socket_server - INFO - New client connected from ('127.0.0.1', 56219)
2025-07-01 13:08:58,652 - socket_server - INFO - Received request from ('127.0.0.1', 56219): chat
2025-07-01 13:08:58,653 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:08:58,653 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:08:58,653 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:08:58,653 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:08:58,658 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:08:58,815 - __main__ - INFO - User message: truy cập db man_time
2025-07-01 13:08:58,816 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:08:58,816 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:08:59,987 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:08:59,988 - __main__ - INFO - LLM call completed in 1.17 seconds
2025-07-01 13:08:59,988 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:08:59,988 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:08:59,988 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:08:59,989 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 13:08:59,989 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:08:59,989 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:08:59,989 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:09:05,650 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:09:05,651 - __main__ - INFO - LLM call completed in 5.66 seconds
2025-07-01 13:09:05,652 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:09:05,652 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:09:05,652 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:09:05,652 - socket_server - INFO - Received result for 40.
2025-07-01 13:09:05,653 - socket_server - INFO - Sent response to ('127.0.0.1', 56219): success
2025-07-01 13:09:30,580 - socket_server - INFO - Client ('127.0.0.1', 56184) closed connection
2025-07-01 13:09:30,581 - socket_server - INFO - Client ('127.0.0.1', 56184) disconnected
2025-07-01 13:09:42,813 - socket_server - INFO - New client connected from ('127.0.0.1', 56248)
2025-07-01 13:09:42,814 - socket_server - INFO - Received request from ('127.0.0.1', 56248): chat
2025-07-01 13:09:42,814 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:09:42,814 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:09:42,815 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:09:42,815 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:09:42,819 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:09:42,971 - __main__ - INFO - User message: phân tích doanh thu năm nay
2025-07-01 13:09:42,972 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:09:42,972 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:09:44,997 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:09:44,999 - __main__ - INFO - LLM call completed in 2.03 seconds
2025-07-01 13:09:45,000 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:09:45,002 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:09:45,002 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:09:45,003 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 13:09:45,004 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'phân tích doanh thu năm nay'}
2025-07-01 13:09:45,712 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 13:09:45,712 - __main__ - INFO - Parallel tool execution completed in 0.71 seconds
2025-07-01 13:09:45,712 - __main__ - INFO - Tool execution completed in 0.71 seconds
2025-07-01 13:09:45,712 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:09:56,488 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:09:56,490 - __main__ - INFO - LLM call completed in 10.78 seconds
2025-07-01 13:09:56,491 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:09:56,491 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:09:56,492 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:09:56,492 - socket_server - INFO - Received result for 40.
2025-07-01 13:09:56,494 - socket_server - INFO - Sent response to ('127.0.0.1', 56248): success
2025-07-01 13:09:57,260 - socket_server - INFO - Client ('127.0.0.1', 56199) closed connection
2025-07-01 13:09:57,260 - socket_server - INFO - Client ('127.0.0.1', 56199) disconnected
2025-07-01 13:10:11,075 - socket_server - INFO - Client ('127.0.0.1', 56208) closed connection
2025-07-01 13:10:11,078 - socket_server - INFO - Client ('127.0.0.1', 56208) disconnected
2025-07-01 13:10:13,841 - socket_server - INFO - New client connected from ('127.0.0.1', 56267)
2025-07-01 13:10:13,842 - socket_server - INFO - Received request from ('127.0.0.1', 56267): chat
2025-07-01 13:10:13,842 - __main__ - INFO - Enqueuing message for conversation 40
2025-07-01 13:10:13,842 - socket_server - INFO - Waiting for async processing result for 40...
2025-07-01 13:10:13,842 - __main__ - INFO - Dequeued message for conversation 40
2025-07-01 13:10:13,842 - __main__ - INFO - Processing message for conversation 40
2025-07-01 13:10:13,847 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:10:14,005 - __main__ - INFO - User message: vẽ biểu đồ
2025-07-01 13:10:14,005 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:10:14,005 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:10:16,942 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:10:16,944 - __main__ - INFO - LLM call completed in 2.94 seconds
2025-07-01 13:10:16,945 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:10:16,946 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:10:16,946 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:10:16,947 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:10:16,947 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"year":2024,"revenue":138855}]', 'title': 'Tổng Doanh Thu Năm 2024', 'x_column': 'year', 'x_label': 'Năm', 'y_column': 'revenue', 'y_label': 'Doanh Thu (tỷ VND)'}
2025-07-01 13:10:17,844 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:10:17,844 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:10:17,844 - __main__ - INFO - Parallel tool execution completed in 0.90 seconds
2025-07-01 13:10:17,844 - __main__ - INFO - Tool execution completed in 0.90 seconds
2025-07-01 13:10:17,844 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:10:21,152 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:10:21,154 - __main__ - INFO - LLM call completed in 3.31 seconds
2025-07-01 13:10:21,154 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:10:21,155 - __main__ - INFO - Generated final answer for conversation 40
2025-07-01 13:10:21,155 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:10:21,155 - __main__ - INFO - Processing complete for 40. Status: success
2025-07-01 13:10:21,155 - socket_server - INFO - Received result for 40.
2025-07-01 13:10:21,156 - socket_server - INFO - Sent response to ('127.0.0.1', 56267): success
2025-07-01 13:10:28,663 - socket_server - INFO - Client ('127.0.0.1', 56219) closed connection
2025-07-01 13:10:28,665 - socket_server - INFO - Client ('127.0.0.1', 56219) disconnected
2025-07-01 13:11:12,813 - socket_server - INFO - Client ('127.0.0.1', 56248) closed connection
2025-07-01 13:11:12,814 - socket_server - INFO - Client ('127.0.0.1', 56248) disconnected
2025-07-01 13:11:43,849 - socket_server - INFO - Client ('127.0.0.1', 56267) closed connection
2025-07-01 13:11:43,850 - socket_server - INFO - Client ('127.0.0.1', 56267) disconnected
2025-07-01 13:15:19,377 - socket_server - INFO - New client connected from ('127.0.0.1', 56544)
2025-07-01 13:15:19,378 - socket_server - INFO - Received request from ('127.0.0.1', 56544): chat
2025-07-01 13:15:19,379 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:15:19,379 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:15:19,380 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:15:19,381 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:15:19,381 - __main__ - INFO - New context established: rag:general
2025-07-01 13:15:19,393 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:15:19,790 - __main__ - INFO - User message: liet ke db
2025-07-01 13:15:19,791 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:15:19,791 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:15:21,116 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:15:21,118 - __main__ - INFO - LLM call completed in 1.33 seconds
2025-07-01 13:15:21,119 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:15:21,120 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:15:21,121 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:15:21,122 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:15:21,125 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:15:21,135 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:15:21,137 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:15:21,137 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:15:21,138 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:15:24,295 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:15:24,297 - __main__ - INFO - LLM call completed in 3.16 seconds
2025-07-01 13:15:24,298 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:15:24,298 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:15:24,299 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:15:24,299 - socket_server - INFO - Received result for 38.
2025-07-01 13:15:24,300 - socket_server - INFO - Sent response to ('127.0.0.1', 56544): success
2025-07-01 13:15:34,116 - socket_server - INFO - New client connected from ('127.0.0.1', 56549)
2025-07-01 13:15:34,116 - socket_server - INFO - Received request from ('127.0.0.1', 56549): chat
2025-07-01 13:15:34,117 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:15:34,117 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:15:34,117 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:15:34,118 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:15:34,131 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:15:34,626 - __main__ - INFO - User message: truy cập
2025-07-01 13:15:34,627 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:15:34,628 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:15:37,441 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:15:37,445 - __main__ - INFO - LLM call completed in 2.82 seconds
2025-07-01 13:15:37,446 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:15:37,446 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:15:37,449 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:15:37,449 - socket_server - INFO - Received result for 38.
2025-07-01 13:15:37,455 - socket_server - INFO - Sent response to ('127.0.0.1', 56549): success
2025-07-01 13:15:53,474 - socket_server - INFO - New client connected from ('127.0.0.1', 56552)
2025-07-01 13:15:53,475 - socket_server - INFO - Received request from ('127.0.0.1', 56552): chat
2025-07-01 13:15:53,476 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:15:53,477 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:15:53,478 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:15:53,480 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:15:53,501 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:15:53,902 - __main__ - INFO - User message: Tôi muốn truy cập cơ sở dữ liệu man_time".
2025-07-01 13:15:53,903 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:15:53,903 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:15:55,094 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:15:55,097 - __main__ - INFO - LLM call completed in 1.19 seconds
2025-07-01 13:15:55,097 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:15:55,099 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:15:55,100 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:15:55,100 - __main__ - INFO - Executing tool call: sql+db://sql/list_tables/{db_name*}
2025-07-01 13:15:55,103 - __main__ - INFO - Executing tool: sql+db://sql/list_tables/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 13:15:55,104 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/list_tables/man_time
2025-07-01 13:15:55,126 - __main__ - INFO - Tool sql+db://sql/list_tables/{db_name*} executed successfully
2025-07-01 13:15:55,127 - __main__ - INFO - Parallel tool execution completed in 0.03 seconds
2025-07-01 13:15:55,128 - __main__ - INFO - Tool execution completed in 0.03 seconds
2025-07-01 13:15:55,128 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:15:59,268 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:15:59,283 - __main__ - INFO - LLM call completed in 4.15 seconds
2025-07-01 13:15:59,283 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:15:59,284 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:15:59,285 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:15:59,285 - socket_server - INFO - Received result for 38.
2025-07-01 13:15:59,287 - socket_server - INFO - Sent response to ('127.0.0.1', 56552): success
2025-07-01 13:16:12,646 - socket_server - INFO - New client connected from ('127.0.0.1', 56565)
2025-07-01 13:16:12,647 - socket_server - INFO - Received request from ('127.0.0.1', 56565): chat
2025-07-01 13:16:12,647 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:16:12,647 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:16:12,647 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:16:12,647 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:16:12,652 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:16:12,809 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:16:12,809 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:16:12,809 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:16:15,039 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:15,041 - __main__ - INFO - LLM call completed in 2.23 seconds
2025-07-01 13:16:15,042 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:16:15,042 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:16:15,043 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:16:15,043 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-07-01 13:16:15,043 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 13:16:15,043 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/man_time
2025-07-01 13:16:15,056 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-07-01 13:16:15,056 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:16:15,057 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:16:15,057 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:16:17,568 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:17,569 - __main__ - INFO - LLM call completed in 2.51 seconds
2025-07-01 13:16:17,570 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:16:17,570 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:16:17,570 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:16:17,570 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:16:17,570 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT dt.Thang, dt.Nam, SUM(fds.DoanhThu) AS TongDoanhThu FROM fact_doanhso fds JOIN dim_thoigian dt ON fds.MaNgay = dt.MaNgay WHERE dt.Nam = YEAR(CURRENT_DATE()) GROUP BY dt.Thang, dt.Nam ORDER BY dt.Thang ASC'}
2025-07-01 13:16:17,573 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:16:17,573 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:16:17,573 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:16:17,574 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:16:17,574 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:16:20,980 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:20,982 - __main__ - INFO - LLM call completed in 3.41 seconds
2025-07-01 13:16:20,982 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:16:20,983 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:16:20,983 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:16:20,983 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:16:20,983 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT dt.Thang, dt.Nam, SUM(fds.DoanhThu) AS TongDoanhThu FROM fact_doanhso fds JOIN dim_thoigian dt ON fds.MaNgay = dt.MaNgay WHERE dt.Nam = YEAR(CURRENT_DATE()) GROUP BY dt.Thang, dt.Nam ORDER BY dt.Thang ASC;'}
2025-07-01 13:16:20,987 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:16:20,988 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:16:20,988 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:16:20,988 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:16:32,590 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:32,593 - __main__ - INFO - LLM call completed in 11.60 seconds
2025-07-01 13:16:32,593 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:16:32,594 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:16:32,594 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:16:32,594 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:16:32,594 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': "[{'Thang': 1, 'Nam': 2024, 'TongDoanhThu': 15000000}, {'Thang': 2, 'Nam': 2024, 'TongDoanhThu': 20000000}, {'Thang': 3, 'Nam': 2024, 'TongDoanhThu': 25000000}, {'Thang': 4, 'Nam': 2024, 'TongDoanhThu': 30000000}, {'Thang': 5, 'Nam': 2024, 'TongDoanhThu': 35000000}, {'Thang': 6, 'Nam': 2024, 'TongDoanhThu': 40000000}, {'Thang': 7, 'Nam': 2024, 'TongDoanhThu': 45000000}, {'Thang': 8, 'Nam': 2024, 'TongDoanhThu': 50000000}, {'Thang': 9, 'Nam': 2024, 'TongDoanhThu': 55000000}, {'Thang': 10, 'Nam': 2024, 'TongDoanhThu': 60000000}, {'Thang': 11, 'Nam': 2024, 'TongDoanhThu': 65000000}, {'Thang': 12, 'Nam': 2024, 'TongDoanhThu': 70000000}]", 'title': 'Doanh thu theo tháng trong năm nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng doanh thu'}
2025-07-01 13:16:32,599 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:16:32,600 - __main__ - WARNING - Tool call returned error: Invalid JSON data format.
2025-07-01 13:16:32,600 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:16:32,600 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:16:32,600 - __main__ - INFO - LLM iteration 5/10
2025-07-01 13:16:43,692 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:43,695 - __main__ - INFO - LLM call completed in 11.09 seconds
2025-07-01 13:16:43,695 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:16:43,696 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:16:43,696 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:16:43,701 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:16:43,701 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Thang": 1, "Nam": 2024, "TongDoanhThu": 15000000}, {"Thang": 2, "Nam": 2024, "TongDoanhThu": 20000000}, {"Thang": 3, "Nam": 2024, "TongDoanhThu": 25000000}, {"Thang": 4, "Nam": 2024, "TongDoanhThu": 30000000}, {"Thang": 5, "Nam": 2024, "TongDoanhThu": 35000000}, {"Thang": 6, "Nam": 2024, "TongDoanhThu": 40000000}, {"Thang": 7, "Nam": 2024, "TongDoanhThu": 45000000}, {"Thang": 8, "Nam": 2024, "TongDoanhThu": 50000000}, {"Thang": 9, "Nam": 2024, "TongDoanhThu": 55000000}, {"Thang": 10, "Nam": 2024, "TongDoanhThu": 60000000}, {"Thang": 11, "Nam": 2024, "TongDoanhThu": 65000000}, {"Thang": 12, "Nam": 2024, "TongDoanhThu": 70000000}]', 'title': 'Doanh thu theo tháng trong năm nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng doanh thu'}
2025-07-01 13:16:43,829 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:16:43,830 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:16:43,830 - __main__ - INFO - Parallel tool execution completed in 0.13 seconds
2025-07-01 13:16:43,830 - __main__ - INFO - Tool execution completed in 0.13 seconds
2025-07-01 13:16:43,830 - __main__ - INFO - LLM iteration 6/10
2025-07-01 13:16:47,039 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:16:47,040 - __main__ - INFO - LLM call completed in 3.21 seconds
2025-07-01 13:16:47,040 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:16:47,041 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:16:47,041 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:16:47,041 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:16:47,041 - socket_server - INFO - Received result for 38.
2025-07-01 13:16:47,042 - socket_server - INFO - Sent response to ('127.0.0.1', 56565): success
2025-07-01 13:16:49,378 - socket_server - INFO - Client ('127.0.0.1', 56544) closed connection
2025-07-01 13:16:49,379 - socket_server - INFO - Client ('127.0.0.1', 56544) disconnected
2025-07-01 13:17:04,114 - socket_server - INFO - Client ('127.0.0.1', 56549) closed connection
2025-07-01 13:17:04,115 - socket_server - INFO - Client ('127.0.0.1', 56549) disconnected
2025-07-01 13:17:23,471 - socket_server - INFO - Client ('127.0.0.1', 56552) closed connection
2025-07-01 13:17:23,471 - socket_server - INFO - Client ('127.0.0.1', 56552) disconnected
2025-07-01 13:17:38,321 - socket_server - INFO - New client connected from ('127.0.0.1', 56579)
2025-07-01 13:17:38,321 - socket_server - INFO - Received request from ('127.0.0.1', 56579): chat
2025-07-01 13:17:38,322 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:17:38,322 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:17:38,322 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:17:38,323 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:17:38,334 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:17:38,668 - __main__ - INFO - User message: vẽ biểu đồ
2025-07-01 13:17:38,669 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:17:38,669 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:17:42,648 - socket_server - INFO - Client ('127.0.0.1', 56565) closed connection
2025-07-01 13:17:42,648 - socket_server - INFO - Client ('127.0.0.1', 56565) disconnected
2025-07-01 13:17:50,470 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:17:50,472 - __main__ - INFO - LLM call completed in 11.80 seconds
2025-07-01 13:17:50,473 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:17:50,473 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:17:50,473 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:17:50,473 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:17:50,473 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Thang": 1, "Nam": 2024, "TongDoanhThu": 15000000}, {"Thang": 2, "Nam": 2024, "TongDoanhThu": 20000000}, {"Thang": 3, "Nam": 2024, "TongDoanhThu": 25000000}, {"Thang": 4, "Nam": 2024, "TongDoanhThu": 30000000}, {"Thang": 5, "Nam": 2024, "TongDoanhThu": 35000000}, {"Thang": 6, "Nam": 2024, "TongDoanhThu": 40000000}, {"Thang": 7, "Nam": 2024, "TongDoanhThu": 45000000}, {"Thang": 8, "Nam": 2024, "TongDoanhThu": 50000000}, {"Thang": 9, "Nam": 2024, "TongDoanhThu": 55000000}, {"Thang": 10, "Nam": 2024, "TongDoanhThu": 60000000}, {"Thang": 11, "Nam": 2024, "TongDoanhThu": 65000000}, {"Thang": 12, "Nam": 2024, "TongDoanhThu": 70000000}]', 'title': 'Doanh thu theo tháng trong năm nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng doanh thu'}
2025-07-01 13:17:50,791 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:17:50,791 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:17:50,791 - __main__ - INFO - Parallel tool execution completed in 0.32 seconds
2025-07-01 13:17:50,792 - __main__ - INFO - Tool execution completed in 0.32 seconds
2025-07-01 13:17:50,792 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:17:54,786 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:17:54,789 - __main__ - INFO - LLM call completed in 4.00 seconds
2025-07-01 13:17:54,790 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:17:54,791 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:17:54,792 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:17:54,794 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:17:54,795 - socket_server - INFO - Received result for 38.
2025-07-01 13:17:54,796 - socket_server - INFO - Sent response to ('127.0.0.1', 56579): success
2025-07-01 13:19:08,334 - socket_server - INFO - Client ('127.0.0.1', 56579) closed connection
2025-07-01 13:19:08,335 - socket_server - INFO - Client ('127.0.0.1', 56579) disconnected
2025-07-01 13:22:00,526 - __main__ - INFO - Server tasks cancelled.
2025-07-01 13:22:00,534 - __main__ - INFO - Stopping server...
2025-07-01 13:22:00,534 - socket_server - INFO - Stopping server...
2025-07-01 13:22:00,535 - socket_server - INFO - Stopping server...
2025-07-01 13:22:00,535 - socket_server - INFO - Socket Server stopped
2025-07-01 13:22:00,535 - socket_server - INFO - Socket Server stopped
2025-07-01 13:22:00,535 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 13:22:03,754 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 13:22:06,478 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 13:22:06,479 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 13:22:06,479 - __main__ - INFO - Message processor task started.
2025-07-01 13:22:06,481 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 13:23:12,347 - socket_server - INFO - New client connected from ('127.0.0.1', 56757)
2025-07-01 13:23:12,348 - socket_server - INFO - Received request from ('127.0.0.1', 56757): chat
2025-07-01 13:23:12,348 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:23:12,349 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:23:12,349 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:23:12,349 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:23:12,350 - __main__ - INFO - New context established: rag:general
2025-07-01 13:23:12,356 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:23:12,552 - __main__ - INFO - User message: ádfsad
2025-07-01 13:23:12,552 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:23:12,552 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:23:14,894 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:14,898 - __main__ - INFO - LLM call completed in 2.35 seconds
2025-07-01 13:23:14,898 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:23:14,899 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:23:14,899 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:23:14,900 - socket_server - INFO - Received result for 38.
2025-07-01 13:23:14,900 - socket_server - INFO - Sent response to ('127.0.0.1', 56757): success
2025-07-01 13:23:22,638 - socket_server - INFO - New client connected from ('127.0.0.1', 56763)
2025-07-01 13:23:22,638 - socket_server - INFO - Received request from ('127.0.0.1', 56763): chat
2025-07-01 13:23:22,639 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:23:22,640 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:23:22,640 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:23:22,640 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:23:22,648 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:23:22,805 - __main__ - INFO - User message: liệt kê db
2025-07-01 13:23:22,805 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:23:22,806 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:23:23,995 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:23,996 - __main__ - INFO - LLM call completed in 1.19 seconds
2025-07-01 13:23:23,997 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:23:23,997 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:23:23,997 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:23:23,997 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:23:23,998 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:23:24,009 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:23:24,009 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:23:24,009 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:23:24,009 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:23:27,374 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:27,375 - __main__ - INFO - LLM call completed in 3.37 seconds
2025-07-01 13:23:27,376 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:23:27,376 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:23:27,376 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:23:27,376 - socket_server - INFO - Received result for 38.
2025-07-01 13:23:27,377 - socket_server - INFO - Sent response to ('127.0.0.1', 56763): success
2025-07-01 13:23:37,478 - socket_server - INFO - New client connected from ('127.0.0.1', 56767)
2025-07-01 13:23:37,478 - socket_server - INFO - Received request from ('127.0.0.1', 56767): chat
2025-07-01 13:23:37,478 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:23:37,479 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:23:37,479 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:23:37,479 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:23:37,484 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:23:37,632 - __main__ - INFO - User message: truy cập man_time
2025-07-01 13:23:37,633 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:23:37,633 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:23:38,893 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:38,895 - __main__ - INFO - LLM call completed in 1.26 seconds
2025-07-01 13:23:38,895 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:23:38,896 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:23:38,896 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:23:38,896 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 13:23:38,897 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:23:38,897 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:23:38,897 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:23:41,718 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:41,720 - __main__ - INFO - LLM call completed in 2.82 seconds
2025-07-01 13:23:41,721 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:23:41,721 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:23:41,722 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:23:41,722 - socket_server - INFO - Received result for 38.
2025-07-01 13:23:41,723 - socket_server - INFO - Sent response to ('127.0.0.1', 56767): success
2025-07-01 13:23:48,171 - socket_server - INFO - New client connected from ('127.0.0.1', 56770)
2025-07-01 13:23:48,172 - socket_server - INFO - Received request from ('127.0.0.1', 56770): chat
2025-07-01 13:23:48,172 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:23:48,173 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:23:48,173 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:23:48,173 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:23:48,178 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:23:48,331 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:23:48,331 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:23:48,331 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:23:50,383 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:50,385 - __main__ - INFO - LLM call completed in 2.05 seconds
2025-07-01 13:23:50,386 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:23:50,386 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:23:50,387 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:23:50,387 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:23:50,388 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MONTH(ngay_lap) AS thang, SUM(tong_tien) AS doanh_thu FROM hoa_don WHERE YEAR(ngay_lap) = YEAR(CURDATE()) GROUP BY MONTH(ngay_lap) ORDER BY MONTH(ngay_lap)'}
2025-07-01 13:23:50,397 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:23:50,397 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:23:50,397 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:23:50,397 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:23:50,398 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:23:51,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:23:51,763 - __main__ - INFO - LLM call completed in 1.37 seconds
2025-07-01 13:23:51,765 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:23:51,765 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:23:51,766 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:23:51,766 - socket_server - INFO - Received result for 38.
2025-07-01 13:23:51,766 - socket_server - INFO - Sent response to ('127.0.0.1', 56770): success
2025-07-01 13:24:00,466 - socket_server - INFO - New client connected from ('127.0.0.1', 56773)
2025-07-01 13:24:00,466 - socket_server - INFO - Received request from ('127.0.0.1', 56773): chat
2025-07-01 13:24:00,466 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:24:00,467 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:24:00,467 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:24:00,467 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:24:00,472 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:24:00,642 - __main__ - INFO - User message: có
2025-07-01 13:24:00,643 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:24:00,643 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:24:01,603 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:24:01,604 - __main__ - INFO - LLM call completed in 0.96 seconds
2025-07-01 13:24:01,604 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:24:01,604 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:24:01,604 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:24:01,605 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:24:01,605 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time'}
2025-07-01 13:24:01,607 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:24:01,608 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:24:01,608 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:24:01,608 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:24:05,037 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:24:05,039 - __main__ - INFO - LLM call completed in 3.43 seconds
2025-07-01 13:24:05,040 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:24:05,040 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:24:05,041 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:24:05,041 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:24:05,042 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MONTH(ngay_lap) AS thang, SUM(tong_tien) AS doanh_thu FROM hoa_don WHERE YEAR(ngay_lap) = YEAR(CURDATE()) GROUP BY MONTH(ngay_lap) ORDER BY MONTH(ngay_lap)'}
2025-07-01 13:24:05,057 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:24:05,058 - __main__ - WARNING - Tool call returned error: 1146 (42S02): Table 'man_time.hoa_don' doesn't exist
2025-07-01 13:24:05,058 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:24:05,059 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:24:05,059 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:24:06,978 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:24:06,980 - __main__ - INFO - LLM call completed in 1.92 seconds
2025-07-01 13:24:06,981 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:24:06,981 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:24:06,982 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:24:06,982 - socket_server - INFO - Received result for 38.
2025-07-01 13:24:06,983 - socket_server - INFO - Sent response to ('127.0.0.1', 56773): success
2025-07-01 13:24:41,179 - socket_server - INFO - New client connected from ('127.0.0.1', 56782)
2025-07-01 13:24:41,180 - socket_server - INFO - Received request from ('127.0.0.1', 56782): chat
2025-07-01 13:24:41,180 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:24:41,180 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:24:41,180 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:24:41,181 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:24:41,185 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:24:41,336 - __main__ - INFO - User message: có
2025-07-01 13:24:41,336 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:24:41,336 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:24:42,355 - socket_server - INFO - Client ('127.0.0.1', 56757) closed connection
2025-07-01 13:24:42,356 - socket_server - INFO - Client ('127.0.0.1', 56757) disconnected
2025-07-01 13:24:43,761 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:24:43,763 - __main__ - INFO - LLM call completed in 2.43 seconds
2025-07-01 13:24:43,763 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:24:43,764 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:24:43,765 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:24:43,765 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/man_time
2025-07-01 13:24:43,766 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:24:43,766 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:24:43,767 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:24:45,941 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:24:45,943 - __main__ - INFO - LLM call completed in 2.18 seconds
2025-07-01 13:24:45,944 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:24:45,944 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:24:45,945 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:24:45,945 - socket_server - INFO - Received result for 38.
2025-07-01 13:24:45,946 - socket_server - INFO - Sent response to ('127.0.0.1', 56782): success
2025-07-01 13:24:52,656 - socket_server - INFO - Client ('127.0.0.1', 56763) closed connection
2025-07-01 13:24:52,658 - socket_server - INFO - Client ('127.0.0.1', 56763) disconnected
2025-07-01 13:25:07,487 - socket_server - INFO - Client ('127.0.0.1', 56767) closed connection
2025-07-01 13:25:07,488 - socket_server - INFO - Client ('127.0.0.1', 56767) disconnected
2025-07-01 13:25:18,170 - socket_server - INFO - Client ('127.0.0.1', 56770) closed connection
2025-07-01 13:25:18,170 - socket_server - INFO - Client ('127.0.0.1', 56770) disconnected
2025-07-01 13:25:30,476 - socket_server - INFO - Client ('127.0.0.1', 56773) closed connection
2025-07-01 13:25:30,476 - socket_server - INFO - Client ('127.0.0.1', 56773) disconnected
2025-07-01 13:26:11,183 - socket_server - INFO - Client ('127.0.0.1', 56782) closed connection
2025-07-01 13:26:11,184 - socket_server - INFO - Client ('127.0.0.1', 56782) disconnected
2025-07-01 13:28:20,600 - __main__ - INFO - Server tasks cancelled.
2025-07-01 13:28:20,610 - __main__ - INFO - Stopping server...
2025-07-01 13:28:20,611 - socket_server - INFO - Stopping server...
2025-07-01 13:28:20,611 - socket_server - INFO - Stopping server...
2025-07-01 13:28:20,611 - socket_server - INFO - Socket Server stopped
2025-07-01 13:28:20,611 - socket_server - INFO - Socket Server stopped
2025-07-01 13:28:20,612 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 13:28:51,591 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 13:28:54,398 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 13:28:54,399 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 13:28:54,399 - __main__ - INFO - Message processor task started.
2025-07-01 13:28:54,401 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 13:29:08,401 - socket_server - INFO - New client connected from ('127.0.0.1', 56917)
2025-07-01 13:29:08,403 - socket_server - INFO - Received request from ('127.0.0.1', 56917): chat
2025-07-01 13:29:08,403 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:29:08,404 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:29:08,404 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:29:08,404 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:29:08,404 - __main__ - INFO - New context established: rag:general
2025-07-01 13:29:08,419 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:29:08,878 - __main__ - INFO - User message: liệt kê db
2025-07-01 13:29:08,879 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:29:08,879 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:29:11,640 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:29:11,646 - __main__ - INFO - LLM call completed in 2.77 seconds
2025-07-01 13:29:11,646 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:29:11,646 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:29:11,647 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:29:11,647 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:29:11,647 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:29:11,665 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:29:11,668 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:29:11,669 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:29:11,674 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:29:15,191 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:29:15,193 - __main__ - INFO - LLM call completed in 3.52 seconds
2025-07-01 13:29:15,193 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:29:15,194 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:29:15,195 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:29:15,195 - socket_server - INFO - Received result for 38.
2025-07-01 13:29:15,196 - socket_server - INFO - Sent response to ('127.0.0.1', 56917): success
2025-07-01 13:29:23,255 - socket_server - INFO - New client connected from ('127.0.0.1', 56920)
2025-07-01 13:29:23,255 - socket_server - INFO - Received request from ('127.0.0.1', 56920): chat
2025-07-01 13:29:23,256 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:29:23,256 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:29:23,256 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:29:23,256 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:29:23,261 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:29:23,414 - __main__ - INFO - User message: truy cập man_time
2025-07-01 13:29:23,415 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:29:23,415 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:29:24,532 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:29:24,533 - __main__ - INFO - LLM call completed in 1.12 seconds
2025-07-01 13:29:24,533 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:29:24,533 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:29:24,533 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:29:24,533 - __main__ - INFO - Executing tool call: sql+db://sql/schema/{db_name*}
2025-07-01 13:29:24,533 - __main__ - INFO - Executing tool: sql+db://sql/schema/{db_name*} with args: {'db_name': 'man_time'}
2025-07-01 13:29:24,533 - __main__ - INFO - Constructed URI for resource template: sql+db://sql/schema/man_time
2025-07-01 13:29:24,544 - __main__ - INFO - Tool sql+db://sql/schema/{db_name*} executed successfully
2025-07-01 13:29:24,544 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:29:24,544 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:29:24,544 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:29:51,166 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:29:51,169 - __main__ - INFO - LLM call completed in 26.62 seconds
2025-07-01 13:29:51,169 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:29:51,170 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:29:51,170 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:29:51,171 - socket_server - INFO - Received result for 38.
2025-07-01 13:29:51,172 - socket_server - INFO - Sent response to ('127.0.0.1', 56920): success
2025-07-01 13:30:03,748 - socket_server - INFO - New client connected from ('127.0.0.1', 56941)
2025-07-01 13:30:03,748 - socket_server - INFO - Received request from ('127.0.0.1', 56941): chat
2025-07-01 13:30:03,748 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:30:03,748 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:30:03,748 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:30:03,749 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:30:03,753 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:30:03,918 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:30:03,918 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:30:03,919 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:30:07,734 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:07,736 - __main__ - INFO - LLM call completed in 3.82 seconds
2025-07-01 13:30:07,737 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:30:07,737 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:30:07,737 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:30:07,738 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:30:07,738 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT dt.Thang, SUM(fds.DoanhThu) AS TongDoanhThu FROM fact_doanhso fds JOIN dim_thoigian dt ON fds.MaNgay = dt.MaNgay WHERE dt.Nam = YEAR(CURRENT_DATE()) GROUP BY dt.Thang ORDER BY dt.Thang;'}
2025-07-01 13:30:07,744 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:30:07,744 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:30:07,744 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:30:07,745 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:30:07,745 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:30:09,250 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:09,253 - __main__ - INFO - LLM call completed in 1.51 seconds
2025-07-01 13:30:09,253 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:30:09,254 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:30:09,254 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:30:09,255 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:30:09,256 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time;'}
2025-07-01 13:30:09,261 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:30:09,262 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:30:09,262 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:30:09,263 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:30:11,494 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:11,496 - __main__ - INFO - LLM call completed in 2.23 seconds
2025-07-01 13:30:11,496 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:30:11,497 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:30:11,497 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:30:11,497 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:30:11,498 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT dt.Thang, SUM(fds.DoanhThu) AS TongDoanhThu FROM fact_doanhso fds JOIN dim_thoigian dt ON fds.MaNgay = dt.MaNgay WHERE dt.Nam = YEAR(CURRENT_DATE()) GROUP BY dt.Thang ORDER BY dt.Thang;'}
2025-07-01 13:30:11,504 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:30:11,504 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:30:11,504 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:30:11,505 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:30:21,896 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:21,899 - __main__ - INFO - LLM call completed in 10.39 seconds
2025-07-01 13:30:21,900 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:30:21,900 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:30:21,901 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:30:21,901 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:30:21,901 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': "[{'Thang': 1, 'TongDoanhThu': 15000000}, {'Thang': 2, 'TongDoanhThu': 23000000}, {'Thang': 3, 'TongDoanhThu': 18000000}, {'Thang': 4, 'TongDoanhThu': 25000000}, {'Thang': 5, 'TongDoanhThu': 30000000}, {'Thang': 6, 'TongDoanhThu': 27000000}, {'Thang': 7, 'TongDoanhThu': 22000000}, {'Thang': 8, 'TongDoanhThu': 26000000}, {'Thang': 9, 'TongDoanhThu': 31000000}, {'Thang': 10, 'TongDoanhThu': 29000000}, {'Thang': 11, 'TongDoanhThu': 35000000}, {'Thang': 12, 'TongDoanhThu': 40000000}]", 'title': 'Doanh Thu Theo Tháng Trong Năm Nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng Doanh Thu (VNĐ)'}
2025-07-01 13:30:21,904 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:30:21,904 - __main__ - WARNING - Tool call returned error: Invalid JSON data format.
2025-07-01 13:30:21,904 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:30:21,905 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:30:21,905 - __main__ - INFO - LLM iteration 5/10
2025-07-01 13:30:35,780 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:35,781 - __main__ - INFO - LLM call completed in 13.88 seconds
2025-07-01 13:30:35,782 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:30:35,782 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:30:35,782 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:30:35,782 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:30:35,782 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Thang": 1, "TongDoanhThu": 15000000}, {"Thang": 2, "TongDoanhThu": 23000000}, {"Thang": 3, "TongDoanhThu": 18000000}, {"Thang": 4, "TongDoanhThu": 25000000}, {"Thang": 5, "TongDoanhThu": 30000000}, {"Thang": 6, "TongDoanhThu": 27000000}, {"Thang": 7, "TongDoanhThu": 22000000}, {"Thang": 8, "TongDoanhThu": 26000000}, {"Thang": 9, "TongDoanhThu": 31000000}, {"Thang": 10, "TongDoanhThu": 29000000}, {"Thang": 11, "TongDoanhThu": 35000000}, {"Thang": 12, "TongDoanhThu": 40000000}]', 'title': 'Doanh Thu Theo Tháng Trong Năm Nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng Doanh Thu (VNĐ)'}
2025-07-01 13:30:35,976 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:30:35,976 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:30:35,976 - __main__ - INFO - Parallel tool execution completed in 0.19 seconds
2025-07-01 13:30:35,977 - __main__ - INFO - Tool execution completed in 0.19 seconds
2025-07-01 13:30:35,977 - __main__ - INFO - LLM iteration 6/10
2025-07-01 13:30:38,403 - socket_server - INFO - Client ('127.0.0.1', 56917) closed connection
2025-07-01 13:30:38,404 - socket_server - INFO - Client ('127.0.0.1', 56917) disconnected
2025-07-01 13:30:40,954 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:30:40,955 - __main__ - INFO - LLM call completed in 4.98 seconds
2025-07-01 13:30:40,955 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:30:40,955 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:30:40,956 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:30:40,956 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:30:40,956 - socket_server - INFO - Received result for 38.
2025-07-01 13:30:40,956 - socket_server - INFO - Sent response to ('127.0.0.1', 56941): success
2025-07-01 13:30:53,267 - socket_server - INFO - Client ('127.0.0.1', 56920) closed connection
2025-07-01 13:30:53,267 - socket_server - INFO - Client ('127.0.0.1', 56920) disconnected
2025-07-01 13:31:33,752 - socket_server - INFO - Client ('127.0.0.1', 56941) closed connection
2025-07-01 13:31:33,754 - socket_server - INFO - Client ('127.0.0.1', 56941) disconnected
2025-07-01 13:36:39,974 - socket_server - INFO - New client connected from ('127.0.0.1', 57152)
2025-07-01 13:36:39,974 - socket_server - INFO - Received request from ('127.0.0.1', 57152): chat
2025-07-01 13:36:39,975 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:36:39,975 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:36:39,975 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:36:39,976 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:36:39,981 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:36:40,133 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:36:40,134 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:36:40,134 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:36:42,454 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:36:42,456 - __main__ - INFO - LLM call completed in 2.32 seconds
2025-07-01 13:36:42,456 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:36:42,457 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:36:42,457 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:36:42,457 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:36:42,457 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time;'}
2025-07-01 13:36:42,467 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:36:42,468 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:36:42,468 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:36:42,468 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:36:44,753 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:36:44,754 - __main__ - INFO - LLM call completed in 2.29 seconds
2025-07-01 13:36:44,755 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:36:44,755 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:36:44,755 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:36:44,756 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:36:44,756 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT dt.Thang, SUM(fds.DoanhThu) AS TongDoanhThu FROM fact_doanhso fds JOIN dim_thoigian dt ON fds.MaNgay = dt.MaNgay WHERE dt.Nam = YEAR(CURRENT_DATE()) GROUP BY dt.Thang ORDER BY dt.Thang;'}
2025-07-01 13:36:44,761 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:36:44,761 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:36:44,762 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:36:44,762 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:36:54,039 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:36:54,041 - __main__ - INFO - LLM call completed in 9.28 seconds
2025-07-01 13:36:54,041 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:36:54,042 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:36:54,042 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:36:54,042 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:36:54,043 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Thang": 1, "TongDoanhThu": 15000000}, {"Thang": 2, "TongDoanhThu": 23000000}, {"Thang": 3, "TongDoanhThu": 18000000}, {"Thang": 4, "TongDoanhThu": 25000000}, {"Thang": 5, "TongDoanhThu": 30000000}, {"Thang": 6, "TongDoanhThu": 27000000}, {"Thang": 7, "TongDoanhThu": 22000000}, {"Thang": 8, "TongDoanhThu": 26000000}, {"Thang": 9, "TongDoanhThu": 31000000}, {"Thang": 10, "TongDoanhThu": 29000000}, {"Thang": 11, "TongDoanhThu": 35000000}, {"Thang": 12, "TongDoanhThu": 40000000}]', 'title': 'Doanh Thu Theo Tháng Trong Năm Nay', 'x_column': 'Thang', 'x_label': 'Tháng', 'y_column': 'TongDoanhThu', 'y_label': 'Tổng Doanh Thu (VNĐ)'}
2025-07-01 13:36:54,168 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:36:54,169 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:36:54,169 - __main__ - INFO - Parallel tool execution completed in 0.13 seconds
2025-07-01 13:36:54,169 - __main__ - INFO - Tool execution completed in 0.13 seconds
2025-07-01 13:36:54,169 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:36:58,157 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:36:58,158 - __main__ - INFO - LLM call completed in 3.99 seconds
2025-07-01 13:36:58,158 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:36:58,158 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:36:58,158 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:36:58,158 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:36:58,158 - socket_server - INFO - Received result for 38.
2025-07-01 13:36:58,159 - socket_server - INFO - Sent response to ('127.0.0.1', 57152): success
2025-07-01 13:38:09,974 - socket_server - INFO - Client ('127.0.0.1', 57152) closed connection
2025-07-01 13:38:09,974 - socket_server - INFO - Client ('127.0.0.1', 57152) disconnected
2025-07-01 13:49:54,715 - __main__ - INFO - Server tasks cancelled.
2025-07-01 13:49:54,722 - __main__ - INFO - Stopping server...
2025-07-01 13:49:54,723 - socket_server - INFO - Stopping server...
2025-07-01 13:49:54,723 - socket_server - INFO - Socket Server stopped
2025-07-01 13:49:54,723 - socket_server - INFO - Stopping server...
2025-07-01 13:49:54,723 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 13:49:54,724 - socket_server - INFO - Socket Server stopped
2025-07-01 13:49:57,992 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 13:50:00,872 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 13:50:00,873 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 13:50:00,873 - __main__ - INFO - Message processor task started.
2025-07-01 13:50:00,875 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 13:50:04,542 - socket_server - INFO - New client connected from ('127.0.0.1', 57347)
2025-07-01 13:50:04,542 - socket_server - INFO - Received request from ('127.0.0.1', 57347): chat
2025-07-01 13:50:04,542 - __main__ - INFO - Enqueuing message for conversation 38
2025-07-01 13:50:04,543 - socket_server - INFO - Waiting for async processing result for 38...
2025-07-01 13:50:04,543 - __main__ - INFO - Dequeued message for conversation 38
2025-07-01 13:50:04,543 - __main__ - INFO - Processing message for conversation 38
2025-07-01 13:50:04,543 - __main__ - INFO - New context established: rag:general
2025-07-01 13:50:04,549 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:50:04,740 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:50:04,741 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:50:04,741 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:50:07,850 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:07,854 - __main__ - INFO - LLM call completed in 3.11 seconds
2025-07-01 13:50:07,855 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:07,855 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:07,856 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:07,856 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:50:07,857 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MONTH(ngay_lap) AS thang, SUM(tong_tien) AS doanh_thu FROM hoa_don WHERE YEAR(ngay_lap) = YEAR(CURRENT_DATE()) GROUP BY thang ORDER BY thang ASC;'}
2025-07-01 13:50:07,870 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:50:07,871 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:50:07,872 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:50:07,873 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:50:07,874 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:50:08,707 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:08,711 - __main__ - INFO - LLM call completed in 0.84 seconds
2025-07-01 13:50:08,711 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:08,712 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:08,712 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:08,713 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:50:08,713 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:50:08,719 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:50:08,719 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:50:08,719 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:50:08,719 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:50:10,021 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:10,022 - __main__ - INFO - LLM call completed in 1.30 seconds
2025-07-01 13:50:10,023 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:10,023 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:10,023 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:10,023 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:50:10,023 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:10,023 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:10,023 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:50:11,426 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:11,427 - __main__ - INFO - LLM call completed in 1.40 seconds
2025-07-01 13:50:11,427 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:11,427 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:11,428 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:11,428 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/duantotnghiep_su25
2025-07-01 13:50:11,428 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:11,428 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:11,428 - __main__ - INFO - LLM iteration 5/10
2025-07-01 13:50:12,834 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:12,835 - __main__ - INFO - LLM call completed in 1.41 seconds
2025-07-01 13:50:12,835 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:12,835 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:12,835 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:12,836 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:50:12,836 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:12,836 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:12,836 - __main__ - INFO - LLM iteration 6/10
2025-07-01 13:50:15,931 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:15,932 - __main__ - INFO - LLM call completed in 3.10 seconds
2025-07-01 13:50:15,932 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:50:15,932 - __main__ - INFO - Generated final answer for conversation 38
2025-07-01 13:50:15,932 - __main__ - INFO - Processing complete for 38. Status: success
2025-07-01 13:50:15,933 - socket_server - INFO - Received result for 38.
2025-07-01 13:50:15,933 - socket_server - INFO - Sent response to ('127.0.0.1', 57347): success
2025-07-01 13:50:44,052 - socket_server - INFO - New client connected from ('127.0.0.1', 57383)
2025-07-01 13:50:44,052 - socket_server - INFO - Received request from ('127.0.0.1', 57383): chat
2025-07-01 13:50:44,052 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 13:50:44,053 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 13:50:44,053 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 13:50:44,053 - __main__ - INFO - Processing message for conversation 11
2025-07-01 13:50:44,053 - __main__ - INFO - New context established: rag:general
2025-07-01 13:50:44,058 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:50:44,207 - __main__ - INFO - User message: "Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay."
2025-07-01 13:50:44,208 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:50:44,208 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:50:45,930 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:45,931 - __main__ - INFO - LLM call completed in 1.72 seconds
2025-07-01 13:50:45,932 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:45,932 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:45,932 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:45,932 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:50:45,932 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'SELECT MONTH(order_date) AS month, SUM(total_amount) AS revenue FROM orders WHERE YEAR(order_date) = YEAR(CURDATE()) GROUP BY MONTH(order_date)'}
2025-07-01 13:50:45,935 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:50:45,935 - __main__ - WARNING - Tool call returned error: 1046 (3D000): No database selected
2025-07-01 13:50:45,935 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:45,935 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:45,935 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:50:46,782 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:46,783 - __main__ - INFO - LLM call completed in 0.85 seconds
2025-07-01 13:50:46,783 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:46,783 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:46,784 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:46,784 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:50:46,784 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:50:46,788 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:50:46,788 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:46,788 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:46,789 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:50:47,912 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:47,914 - __main__ - INFO - LLM call completed in 1.12 seconds
2025-07-01 13:50:47,914 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:47,915 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:47,915 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:47,915 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:50:47,916 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:47,916 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:47,916 - __main__ - INFO - LLM iteration 4/10
2025-07-01 13:50:48,959 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:48,961 - __main__ - INFO - LLM call completed in 1.04 seconds
2025-07-01 13:50:48,962 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:50:48,962 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:50:48,963 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:50:48,963 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:50:48,964 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:50:48,964 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:50:48,965 - __main__ - INFO - LLM iteration 5/10
2025-07-01 13:50:51,483 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:50:51,483 - __main__ - INFO - LLM call completed in 2.52 seconds
2025-07-01 13:50:51,484 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:50:51,484 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 13:50:51,484 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 13:50:51,484 - socket_server - INFO - Received result for 11.
2025-07-01 13:50:51,484 - socket_server - INFO - Sent response to ('127.0.0.1', 57383): success
2025-07-01 13:51:06,464 - socket_server - INFO - Client ('127.0.0.1', 57347) reset connection
2025-07-01 13:51:06,464 - socket_server - INFO - Client ('127.0.0.1', 57383) reset connection
2025-07-01 13:51:06,465 - socket_server - INFO - Client ('127.0.0.1', 57347) disconnected
2025-07-01 13:51:06,465 - socket_server - INFO - Client ('127.0.0.1', 57383) disconnected
2025-07-01 13:51:18,002 - socket_server - INFO - New client connected from ('127.0.0.1', 57406)
2025-07-01 13:51:18,003 - socket_server - INFO - Received request from ('127.0.0.1', 57406): chat
2025-07-01 13:51:18,004 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 13:51:18,005 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 13:51:18,005 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 13:51:18,005 - __main__ - INFO - Processing message for conversation 10
2025-07-01 13:51:18,006 - __main__ - INFO - New context established: rag:general
2025-07-01 13:51:18,019 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:51:18,390 - __main__ - INFO - User message: database
2025-07-01 13:51:18,391 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:51:18,391 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:51:20,155 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:51:20,158 - __main__ - INFO - LLM call completed in 1.77 seconds
2025-07-01 13:51:20,159 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:51:20,159 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:51:20,161 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:51:20,162 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 13:51:20,163 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 13:51:20,176 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 13:51:20,177 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 13:51:20,179 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 13:51:20,180 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:51:23,696 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:51:23,700 - __main__ - INFO - LLM call completed in 3.52 seconds
2025-07-01 13:51:23,700 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:51:23,701 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 13:51:23,702 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 13:51:23,702 - socket_server - INFO - Received result for 10.
2025-07-01 13:51:23,703 - socket_server - INFO - Sent response to ('127.0.0.1', 57406): success
2025-07-01 13:51:31,294 - socket_server - INFO - New client connected from ('127.0.0.1', 57422)
2025-07-01 13:51:31,295 - socket_server - INFO - Received request from ('127.0.0.1', 57422): chat
2025-07-01 13:51:31,295 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 13:51:31,296 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 13:51:31,296 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 13:51:31,297 - __main__ - INFO - Processing message for conversation 10
2025-07-01 13:51:31,308 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:51:31,638 - __main__ - INFO - User message: Liệt kê các bảng trong cơ sở dữ liệu `duantotnghiep_su25`."
2025-07-01 13:51:31,639 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:51:31,640 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:51:32,941 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:51:32,944 - __main__ - INFO - LLM call completed in 1.30 seconds
2025-07-01 13:51:32,945 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:51:32,946 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:51:32,946 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:51:32,947 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/duantotnghiep_su25
2025-07-01 13:51:32,948 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:51:32,949 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:51:32,950 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:51:36,265 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:51:36,267 - __main__ - INFO - LLM call completed in 3.32 seconds
2025-07-01 13:51:36,267 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:51:36,268 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 13:51:36,268 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 13:51:36,269 - socket_server - INFO - Received result for 10.
2025-07-01 13:51:36,272 - socket_server - INFO - Sent response to ('127.0.0.1', 57422): success
2025-07-01 13:52:48,001 - socket_server - INFO - Client ('127.0.0.1', 57406) closed connection
2025-07-01 13:52:48,002 - socket_server - INFO - Client ('127.0.0.1', 57406) disconnected
2025-07-01 13:52:56,968 - socket_server - INFO - New client connected from ('127.0.0.1', 57434)
2025-07-01 13:52:56,968 - socket_server - INFO - Received request from ('127.0.0.1', 57434): chat
2025-07-01 13:52:56,969 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 13:52:56,969 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 13:52:56,969 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 13:52:56,969 - __main__ - INFO - Processing message for conversation 10
2025-07-01 13:52:56,977 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:52:57,126 - __main__ - INFO - User message: truy cap man_time
2025-07-01 13:52:57,127 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:52:57,127 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:52:59,077 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:52:59,079 - __main__ - INFO - LLM call completed in 1.95 seconds
2025-07-01 13:52:59,079 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:52:59,079 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:52:59,079 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:52:59,080 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 13:52:59,080 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 13:52:59,080 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 13:52:59,080 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:53:01,298 - socket_server - INFO - Client ('127.0.0.1', 57422) closed connection
2025-07-01 13:53:01,299 - socket_server - INFO - Client ('127.0.0.1', 57422) disconnected
2025-07-01 13:53:01,500 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:53:01,501 - __main__ - INFO - LLM call completed in 2.42 seconds
2025-07-01 13:53:01,501 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:53:01,501 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 13:53:01,501 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 13:53:01,501 - socket_server - INFO - Received result for 10.
2025-07-01 13:53:01,502 - socket_server - INFO - Sent response to ('127.0.0.1', 57434): success
2025-07-01 13:53:16,130 - socket_server - INFO - New client connected from ('127.0.0.1', 57437)
2025-07-01 13:53:16,131 - socket_server - INFO - Received request from ('127.0.0.1', 57437): chat
2025-07-01 13:53:16,131 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 13:53:16,131 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 13:53:16,131 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 13:53:16,131 - __main__ - INFO - Processing message for conversation 10
2025-07-01 13:53:16,136 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:53:16,285 - __main__ - INFO - User message: use man_time
2025-07-01 13:53:16,285 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:53:16,285 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:53:17,356 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:53:17,358 - __main__ - INFO - LLM call completed in 1.07 seconds
2025-07-01 13:53:17,358 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:53:17,359 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:53:17,359 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:53:17,360 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 13:53:17,361 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time;'}
2025-07-01 13:53:17,365 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 13:53:17,366 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 13:53:17,366 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 13:53:17,367 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:53:20,294 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:53:20,295 - __main__ - INFO - LLM call completed in 2.93 seconds
2025-07-01 13:53:20,295 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:53:20,295 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 13:53:20,295 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 13:53:20,295 - socket_server - INFO - Received result for 10.
2025-07-01 13:53:20,295 - socket_server - INFO - Sent response to ('127.0.0.1', 57437): success
2025-07-01 13:53:53,169 - socket_server - INFO - New client connected from ('127.0.0.1', 57443)
2025-07-01 13:53:53,170 - socket_server - INFO - Received request from ('127.0.0.1', 57443): chat
2025-07-01 13:53:53,170 - __main__ - INFO - Enqueuing message for conversation 10
2025-07-01 13:53:53,171 - __main__ - INFO - Dequeued message for conversation 10
2025-07-01 13:53:53,171 - socket_server - INFO - Waiting for async processing result for 10...
2025-07-01 13:53:53,172 - __main__ - INFO - Processing message for conversation 10
2025-07-01 13:53:53,183 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 13:53:53,582 - __main__ - INFO - User message: vẽ biểu đồ doanh thu năm nay
2025-07-01 13:53:53,583 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 13:53:53,584 - __main__ - INFO - LLM iteration 1/10
2025-07-01 13:53:54,727 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:53:54,729 - __main__ - INFO - LLM call completed in 1.14 seconds
2025-07-01 13:53:54,731 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:53:54,732 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:53:54,733 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:53:54,734 - __main__ - INFO - Executing tool call: rag_query
2025-07-01 13:53:54,735 - __main__ - INFO - Executing tool: rag_query with args: {'query': 'doanh thu năm nay'}
2025-07-01 13:53:55,581 - __main__ - INFO - Tool rag_query executed successfully
2025-07-01 13:53:55,582 - __main__ - INFO - Parallel tool execution completed in 0.85 seconds
2025-07-01 13:53:55,582 - __main__ - INFO - Tool execution completed in 0.85 seconds
2025-07-01 13:53:55,582 - __main__ - INFO - LLM iteration 2/10
2025-07-01 13:54:01,742 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:54:01,743 - __main__ - INFO - LLM call completed in 6.16 seconds
2025-07-01 13:54:01,743 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 13:54:01,743 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 13:54:01,743 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 13:54:01,743 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 13:54:01,743 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"year": "2017", "revenue": 2608}, {"year": "2018", "revenue": 46848}, {"year": "2019", "revenue": 56500}, {"year": "2020", "revenue": 64678}, {"year": "2021", "revenue": 91279}, {"year": "2022", "revenue": 150865}, {"year": "2023", "revenue": 142770}, {"year": "2024", "revenue": 138855}]', 'title': 'Biểu đồ doanh thu qua các năm', 'x_column': 'year', 'x_label': 'Năm', 'y_column': 'revenue', 'y_label': 'Doanh thu (đơn vị: tỷ VNĐ)'}
2025-07-01 13:54:01,949 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 13:54:01,949 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 13:54:01,949 - __main__ - INFO - Parallel tool execution completed in 0.21 seconds
2025-07-01 13:54:01,950 - __main__ - INFO - Tool execution completed in 0.21 seconds
2025-07-01 13:54:01,950 - __main__ - INFO - LLM iteration 3/10
2025-07-01 13:54:07,685 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 13:54:07,686 - __main__ - INFO - LLM call completed in 5.74 seconds
2025-07-01 13:54:07,687 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 13:54:07,687 - __main__ - INFO - Generated final answer for conversation 10
2025-07-01 13:54:07,687 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 13:54:07,687 - __main__ - INFO - Processing complete for 10. Status: success
2025-07-01 13:54:07,687 - socket_server - INFO - Received result for 10.
2025-07-01 13:54:07,688 - socket_server - INFO - Sent response to ('127.0.0.1', 57443): success
2025-07-01 13:54:26,972 - socket_server - INFO - Client ('127.0.0.1', 57434) closed connection
2025-07-01 13:54:26,973 - socket_server - INFO - Client ('127.0.0.1', 57434) disconnected
2025-07-01 13:54:46,134 - socket_server - INFO - Client ('127.0.0.1', 57437) closed connection
2025-07-01 13:54:46,135 - socket_server - INFO - Client ('127.0.0.1', 57437) disconnected
2025-07-01 13:55:23,170 - socket_server - INFO - Client ('127.0.0.1', 57443) closed connection
2025-07-01 13:55:23,171 - socket_server - INFO - Client ('127.0.0.1', 57443) disconnected
2025-07-01 14:03:17,705 - socket_server - INFO - New client connected from ('127.0.0.1', 57646)
2025-07-01 14:03:17,705 - socket_server - INFO - Received request from ('127.0.0.1', 57646): chat
2025-07-01 14:03:17,706 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 14:03:17,706 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 14:03:17,707 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 14:03:17,707 - __main__ - INFO - Processing message for conversation 11
2025-07-01 14:03:17,717 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:03:18,072 - __main__ - INFO - User message: MessageBubble
2025-07-01 14:03:18,072 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:03:18,073 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:03:20,133 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:20,135 - __main__ - INFO - LLM call completed in 2.06 seconds
2025-07-01 14:03:20,136 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:03:20,136 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:03:20,136 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:03:20,136 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/query_ai
2025-07-01 14:03:20,137 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 14:03:20,137 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 14:03:20,137 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:03:21,383 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:21,384 - __main__ - INFO - LLM call completed in 1.25 seconds
2025-07-01 14:03:21,385 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:03:21,386 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:03:21,386 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:03:21,396 - __main__ - ERROR - Unknown tool name: sql+db://sql/list_tables/query_db
2025-07-01 14:03:21,396 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 14:03:21,397 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 14:03:21,398 - __main__ - INFO - LLM iteration 3/10
2025-07-01 14:03:24,827 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:24,830 - __main__ - INFO - LLM call completed in 3.43 seconds
2025-07-01 14:03:24,830 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:03:24,831 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 14:03:24,832 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 14:03:24,832 - socket_server - INFO - Received result for 11.
2025-07-01 14:03:24,833 - socket_server - INFO - Sent response to ('127.0.0.1', 57646): success
2025-07-01 14:03:49,474 - socket_server - INFO - New client connected from ('127.0.0.1', 57649)
2025-07-01 14:03:49,474 - socket_server - INFO - Received request from ('127.0.0.1', 57649): chat
2025-07-01 14:03:49,475 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 14:03:49,475 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 14:03:49,475 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 14:03:49,476 - __main__ - INFO - Processing message for conversation 11
2025-07-01 14:03:49,486 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:03:50,107 - __main__ - INFO - User message: Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay ở bảng doanh thu trong db man_time
2025-07-01 14:03:50,107 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:03:50,108 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:03:51,277 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:51,279 - __main__ - INFO - LLM call completed in 1.17 seconds
2025-07-01 14:03:51,279 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:03:51,280 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:03:51,280 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:03:51,280 - __main__ - ERROR - Unknown tool name: sql+db://sql/schema/man_time
2025-07-01 14:03:51,281 - __main__ - INFO - Parallel tool execution completed in 0.00 seconds
2025-07-01 14:03:51,281 - __main__ - INFO - Tool execution completed in 0.00 seconds
2025-07-01 14:03:51,281 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:03:52,889 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:52,893 - __main__ - INFO - LLM call completed in 1.61 seconds
2025-07-01 14:03:52,893 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:03:52,894 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:03:52,896 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:03:52,899 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 14:03:52,900 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT MONTH(order_date) AS month, SUM(total_amount) AS revenue FROM sales WHERE YEAR(order_date) = YEAR(CURDATE()) GROUP BY MONTH(order_date);'}
2025-07-01 14:03:52,918 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 14:03:52,919 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 14:03:52,920 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 14:03:52,921 - __main__ - INFO - LLM iteration 3/10
2025-07-01 14:03:58,551 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:03:58,555 - __main__ - INFO - LLM call completed in 5.63 seconds
2025-07-01 14:03:58,556 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:03:58,559 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 14:03:58,560 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 14:03:58,561 - socket_server - INFO - Received result for 11.
2025-07-01 14:03:58,562 - socket_server - INFO - Sent response to ('127.0.0.1', 57649): success
2025-07-01 14:04:22,513 - socket_server - INFO - New client connected from ('127.0.0.1', 57659)
2025-07-01 14:04:22,514 - socket_server - INFO - Received request from ('127.0.0.1', 57659): chat
2025-07-01 14:04:22,514 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:04:22,514 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:04:22,515 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:04:22,515 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:04:22,515 - __main__ - INFO - New context established: rag:general
2025-07-01 14:04:22,526 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:04:22,906 - __main__ - INFO - User message: liệt kê db
2025-07-01 14:04:22,907 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:04:22,907 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:04:23,944 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:04:23,947 - __main__ - INFO - LLM call completed in 1.04 seconds
2025-07-01 14:04:23,948 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:04:23,949 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:04:23,950 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:04:23,951 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 14:04:23,952 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 14:04:23,960 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 14:04:23,961 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 14:04:23,962 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 14:04:23,963 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 14:04:23,964 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:04:26,398 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:04:26,400 - __main__ - INFO - LLM call completed in 2.44 seconds
2025-07-01 14:04:26,401 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:04:26,402 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:04:26,402 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:04:26,403 - socket_server - INFO - Received result for 9.
2025-07-01 14:04:26,404 - socket_server - INFO - Sent response to ('127.0.0.1', 57659): success
2025-07-01 14:04:47,707 - socket_server - INFO - Client ('127.0.0.1', 57646) closed connection
2025-07-01 14:04:47,707 - socket_server - INFO - Client ('127.0.0.1', 57646) disconnected
2025-07-01 14:05:19,472 - socket_server - INFO - Client ('127.0.0.1', 57649) closed connection
2025-07-01 14:05:19,473 - socket_server - INFO - Client ('127.0.0.1', 57649) disconnected
2025-07-01 14:05:52,512 - socket_server - INFO - Client ('127.0.0.1', 57659) closed connection
2025-07-01 14:05:52,513 - socket_server - INFO - Client ('127.0.0.1', 57659) disconnected
2025-07-01 14:06:31,495 - socket_server - INFO - New client connected from ('127.0.0.1', 57728)
2025-07-01 14:06:31,495 - socket_server - INFO - Received request from ('127.0.0.1', 57728): chat
2025-07-01 14:06:31,496 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:06:31,496 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:06:31,497 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:06:31,497 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:06:31,509 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:06:31,964 - __main__ - INFO - User message: vẽ biểu đồ
2025-07-01 14:06:31,965 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:06:31,965 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:06:37,139 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:06:37,141 - __main__ - INFO - LLM call completed in 5.18 seconds
2025-07-01 14:06:37,142 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:06:37,142 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:06:37,142 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:06:37,142 - socket_server - INFO - Received result for 9.
2025-07-01 14:06:37,143 - socket_server - INFO - Sent response to ('127.0.0.1', 57728): success
2025-07-01 14:06:48,245 - socket_server - INFO - New client connected from ('127.0.0.1', 57736)
2025-07-01 14:06:48,245 - socket_server - INFO - Received request from ('127.0.0.1', 57736): chat
2025-07-01 14:06:48,246 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:06:48,246 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:06:48,246 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:06:48,247 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:06:48,258 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:06:48,650 - __main__ - INFO - User message: Vẽ biểu đồ cột thể hiện doanh thu theo tháng từ bảng sales."
2025-07-01 14:06:48,654 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:06:48,656 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:06:49,717 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:06:49,718 - __main__ - INFO - LLM call completed in 1.06 seconds
2025-07-01 14:06:49,719 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:06:49,719 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:06:49,719 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:06:49,720 - __main__ - INFO - Executing tool call: sql+db://sql/list_databases
2025-07-01 14:06:49,729 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-07-01 14:06:49,736 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-07-01 14:06:49,738 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 14:06:49,739 - __main__ - INFO - Parallel tool execution completed in 0.02 seconds
2025-07-01 14:06:49,740 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 14:06:49,740 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:06:53,086 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:06:53,087 - __main__ - INFO - LLM call completed in 3.35 seconds
2025-07-01 14:06:53,089 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:06:53,090 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:06:53,091 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:06:53,091 - socket_server - INFO - Received result for 9.
2025-07-01 14:06:53,093 - socket_server - INFO - Sent response to ('127.0.0.1', 57736): success
2025-07-01 14:07:47,426 - socket_server - INFO - New client connected from ('127.0.0.1', 57757)
2025-07-01 14:07:47,427 - socket_server - INFO - Received request from ('127.0.0.1', 57757): chat
2025-07-01 14:07:47,427 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:07:47,427 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:07:47,428 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:07:47,428 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:07:47,437 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:07:47,759 - __main__ - INFO - User message: bạn hãy lấy dữ liệu trên mạng và vẽ cho tôi 1 biểu đồ bất kì
2025-07-01 14:07:47,760 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:07:47,761 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:07:52,169 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:07:52,171 - __main__ - INFO - LLM call completed in 4.41 seconds
2025-07-01 14:07:52,172 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:07:52,172 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:07:52,172 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:07:52,173 - socket_server - INFO - Received result for 9.
2025-07-01 14:07:52,173 - socket_server - INFO - Sent response to ('127.0.0.1', 57757): success
2025-07-01 14:08:01,497 - socket_server - INFO - Client ('127.0.0.1', 57728) closed connection
2025-07-01 14:08:01,497 - socket_server - INFO - Client ('127.0.0.1', 57728) disconnected
2025-07-01 14:08:18,253 - socket_server - INFO - Client ('127.0.0.1', 57736) closed connection
2025-07-01 14:08:18,254 - socket_server - INFO - Client ('127.0.0.1', 57736) disconnected
2025-07-01 14:08:35,338 - socket_server - INFO - New client connected from ('127.0.0.1', 57776)
2025-07-01 14:08:35,338 - socket_server - INFO - Received request from ('127.0.0.1', 57776): chat
2025-07-01 14:08:35,338 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:08:35,339 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:08:35,339 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:08:35,339 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:08:35,343 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:08:35,494 - __main__ - INFO - User message: Tạo biểu đồ đường cho xu hướng lợi nhuận quý.
2025-07-01 14:08:35,494 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:08:35,495 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:08:39,496 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:08:39,498 - __main__ - INFO - LLM call completed in 4.00 seconds
2025-07-01 14:08:39,499 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:08:39,499 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:08:39,499 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:08:39,500 - socket_server - INFO - Received result for 9.
2025-07-01 14:08:39,501 - socket_server - INFO - Sent response to ('127.0.0.1', 57776): success
2025-07-01 14:09:07,220 - socket_server - INFO - New client connected from ('127.0.0.1', 57782)
2025-07-01 14:09:07,220 - socket_server - INFO - Received request from ('127.0.0.1', 57782): chat
2025-07-01 14:09:07,220 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:09:07,221 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:09:07,221 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:09:07,221 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:09:07,225 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:09:07,381 - __main__ - INFO - User message: Quý 1: giá trị 10triệu
- Quý 2: giá trị 20triệu
- Quý 3: giá trị 30triệu
- Quý 4: giá trị 40triệu
2025-07-01 14:09:07,382 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:09:07,382 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:09:10,975 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:09:10,977 - __main__ - INFO - LLM call completed in 3.60 seconds
2025-07-01 14:09:10,978 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:09:10,978 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:09:10,978 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:09:10,978 - socket_server - INFO - Received result for 9.
2025-07-01 14:09:10,979 - socket_server - INFO - Sent response to ('127.0.0.1', 57782): success
2025-07-01 14:09:17,438 - socket_server - INFO - Client ('127.0.0.1', 57757) closed connection
2025-07-01 14:09:17,440 - socket_server - INFO - Client ('127.0.0.1', 57757) disconnected
2025-07-01 14:09:59,129 - socket_server - INFO - New client connected from ('127.0.0.1', 57785)
2025-07-01 14:09:59,131 - socket_server - INFO - Received request from ('127.0.0.1', 57785): chat
2025-07-01 14:09:59,131 - __main__ - INFO - Enqueuing message for conversation 9
2025-07-01 14:09:59,132 - __main__ - INFO - Dequeued message for conversation 9
2025-07-01 14:09:59,132 - socket_server - INFO - Waiting for async processing result for 9...
2025-07-01 14:09:59,132 - __main__ - INFO - Processing message for conversation 9
2025-07-01 14:09:59,143 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:09:59,561 - __main__ - INFO - User message: Quý 1: giá trị 10triệu
- Quý 2: giá trị 20triệu
- Quý 3: giá trị 30triệu
- Quý 4: giá trị 40triệu
vẽ cho tôi biểu đồ cột
2025-07-01 14:09:59,562 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:09:59,563 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:10:03,044 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:10:03,048 - __main__ - INFO - LLM call completed in 3.48 seconds
2025-07-01 14:10:03,049 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:10:03,051 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:10:03,052 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:10:03,052 - __main__ - INFO - Executing tool call: chart_create_chart
2025-07-01 14:10:03,054 - __main__ - INFO - Executing tool: chart_create_chart with args: {'chart_type': 'bar', 'data_json': '[{"Quarter":"Q1","Profit":10},{"Quarter":"Q2","Profit":20},{"Quarter":"Q3","Profit":30},{"Quarter":"Q4","Profit":40}]', 'title': 'Xu Hướng Lợi Nhuận Theo Quý', 'x_column': 'Quarter', 'x_label': 'Quý', 'y_column': 'Profit', 'y_label': 'Lợi nhuận (triệu)'}
2025-07-01 14:10:03,337 - __main__ - INFO - Tool chart_create_chart executed successfully
2025-07-01 14:10:03,337 - __main__ - INFO - Chart image base64 captured from chart_create_chart tool.
2025-07-01 14:10:03,338 - __main__ - INFO - Parallel tool execution completed in 0.29 seconds
2025-07-01 14:10:03,338 - __main__ - INFO - Tool execution completed in 0.29 seconds
2025-07-01 14:10:03,338 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:10:05,349 - socket_server - INFO - Client ('127.0.0.1', 57776) closed connection
2025-07-01 14:10:05,354 - socket_server - INFO - Client ('127.0.0.1', 57776) disconnected
2025-07-01 14:10:07,749 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:10:07,750 - __main__ - INFO - LLM call completed in 4.41 seconds
2025-07-01 14:10:07,751 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:10:07,752 - __main__ - INFO - Generated final answer for conversation 9
2025-07-01 14:10:07,752 - __main__ - INFO - Added chart_image_base64 to final response.
2025-07-01 14:10:07,753 - __main__ - INFO - Processing complete for 9. Status: success
2025-07-01 14:10:07,753 - socket_server - INFO - Received result for 9.
2025-07-01 14:10:07,754 - socket_server - INFO - Sent response to ('127.0.0.1', 57785): success
2025-07-01 14:10:37,223 - socket_server - INFO - Client ('127.0.0.1', 57782) closed connection
2025-07-01 14:10:37,223 - socket_server - INFO - Client ('127.0.0.1', 57782) disconnected
2025-07-01 14:11:29,130 - socket_server - INFO - Client ('127.0.0.1', 57785) closed connection
2025-07-01 14:11:29,130 - socket_server - INFO - Client ('127.0.0.1', 57785) disconnected
2025-07-01 14:21:14,473 - socket_server - INFO - New client connected from ('127.0.0.1', 57996)
2025-07-01 14:21:14,474 - socket_server - INFO - Received request from ('127.0.0.1', 57996): chat
2025-07-01 14:21:14,474 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 14:21:14,474 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 14:21:14,475 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 14:21:14,475 - __main__ - INFO - Processing message for conversation 11
2025-07-01 14:21:14,480 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:21:14,630 - __main__ - INFO - User message: Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay ở bảng doanh thu trong db man_time
2025-07-01 14:21:14,630 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:21:14,630 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:21:18,408 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:21:18,409 - __main__ - INFO - LLM call completed in 3.78 seconds
2025-07-01 14:21:18,409 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:21:18,410 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:21:18,410 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:21:18,411 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 14:21:18,412 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time; SELECT MONTH(ngay_ban) AS month, SUM(doanh_thu) AS revenue FROM doanh_thu WHERE YEAR(ngay_ban) = YEAR(CURDATE()) GROUP BY MONTH(ngay_ban);'}
2025-07-01 14:21:18,419 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 14:21:18,423 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 14:21:18,425 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 14:21:18,426 - __main__ - INFO - Tool execution completed in 0.02 seconds
2025-07-01 14:21:18,427 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:21:23,423 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:21:23,425 - __main__ - INFO - LLM call completed in 5.00 seconds
2025-07-01 14:21:23,426 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:21:23,427 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 14:21:23,428 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 14:21:23,428 - socket_server - INFO - Received result for 11.
2025-07-01 14:21:23,431 - socket_server - INFO - Sent response to ('127.0.0.1', 57996): success
2025-07-01 14:21:36,772 - socket_server - INFO - Client ('127.0.0.1', 57996) reset connection
2025-07-01 14:21:36,772 - socket_server - INFO - Client ('127.0.0.1', 57996) disconnected
2025-07-01 14:57:56,191 - socket_server - INFO - New client connected from ('127.0.0.1', 58525)
2025-07-01 14:57:56,192 - socket_server - INFO - Received request from ('127.0.0.1', 58525): chat
2025-07-01 14:57:56,193 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 14:57:56,195 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 14:57:56,195 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 14:57:56,196 - __main__ - INFO - Processing message for conversation 11
2025-07-01 14:57:56,213 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:57:56,677 - __main__ - INFO - User message: Vẽ biểu đồ cột thể hiện doanh thu theo tháng trong năm nay ở bảng doanh thu trong db man_time
2025-07-01 14:57:56,678 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:57:56,678 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:58:02,450 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:58:02,453 - __main__ - INFO - LLM call completed in 5.77 seconds
2025-07-01 14:58:02,453 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:58:02,454 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 14:58:02,455 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 14:58:02,455 - socket_server - INFO - Received result for 11.
2025-07-01 14:58:02,456 - socket_server - INFO - Sent response to ('127.0.0.1', 58525): success
2025-07-01 14:58:19,405 - socket_server - INFO - New client connected from ('127.0.0.1', 58539)
2025-07-01 14:58:19,406 - socket_server - INFO - Received request from ('127.0.0.1', 58539): chat
2025-07-01 14:58:19,406 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 14:58:19,407 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 14:58:19,407 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 14:58:19,408 - __main__ - INFO - Processing message for conversation 11
2025-07-01 14:58:19,418 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 14:58:19,832 - __main__ - INFO - User message: truy cập man_time
2025-07-01 14:58:19,833 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 14:58:19,834 - __main__ - INFO - LLM iteration 1/10
2025-07-01 14:58:20,977 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:58:20,980 - __main__ - INFO - LLM call completed in 1.15 seconds
2025-07-01 14:58:20,981 - __main__ - INFO - LLM finish_reason: tool_calls
2025-07-01 14:58:20,982 - __main__ - INFO - LLM requested 1 tool calls
2025-07-01 14:58:20,983 - __main__ - INFO - Starting parallel execution of 1 tool calls
2025-07-01 14:58:20,985 - __main__ - INFO - Executing tool call: sql_query_db
2025-07-01 14:58:20,986 - __main__ - INFO - Executing tool: sql_query_db with args: {'query': 'USE man_time;'}
2025-07-01 14:58:20,992 - __main__ - INFO - Tool sql_query_db executed successfully
2025-07-01 14:58:20,993 - __main__ - WARNING - Tool call returned error: MySQL Connection not available.
2025-07-01 14:58:20,994 - __main__ - INFO - Parallel tool execution completed in 0.01 seconds
2025-07-01 14:58:20,995 - __main__ - INFO - Tool execution completed in 0.01 seconds
2025-07-01 14:58:20,995 - __main__ - INFO - LLM iteration 2/10
2025-07-01 14:58:24,877 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-01 14:58:24,882 - __main__ - INFO - LLM call completed in 3.89 seconds
2025-07-01 14:58:24,883 - __main__ - INFO - LLM finish_reason: stop
2025-07-01 14:58:24,883 - __main__ - INFO - Generated final answer for conversation 11
2025-07-01 14:58:24,883 - __main__ - INFO - Processing complete for 11. Status: success
2025-07-01 14:58:24,884 - socket_server - INFO - Received result for 11.
2025-07-01 14:58:24,890 - socket_server - INFO - Sent response to ('127.0.0.1', 58539): success
2025-07-01 14:59:26,198 - socket_server - INFO - Client ('127.0.0.1', 58525) closed connection
2025-07-01 14:59:26,199 - socket_server - INFO - Client ('127.0.0.1', 58525) disconnected
2025-07-01 14:59:49,407 - socket_server - INFO - Client ('127.0.0.1', 58539) closed connection
2025-07-01 14:59:49,408 - socket_server - INFO - Client ('127.0.0.1', 58539) disconnected
2025-07-01 15:07:56,301 - __main__ - INFO - Server tasks cancelled.
2025-07-01 15:07:56,354 - __main__ - INFO - Stopping server...
2025-07-01 15:07:56,354 - socket_server - INFO - Stopping server...
2025-07-01 15:07:56,354 - socket_server - INFO - Stopping server...
2025-07-01 15:07:56,354 - socket_server - INFO - Socket Server stopped
2025-07-01 15:07:56,355 - socket_server - INFO - Socket Server stopped
2025-07-01 15:07:56,355 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 15:07:59,583 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 15:08:02,191 - __main__ - WARNING - MCP client initialization attempt 1 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 15:08:02,191 - __main__ - WARNING - Error during failed client setup cleanup: Connection closed
2025-07-01 15:08:03,207 - __main__ - INFO - Attempting to initialize MCP client (attempt 2/3)
2025-07-01 15:08:03,208 - __main__ - WARNING - MCP client initialization attempt 2 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 15:08:03,209 - __main__ - WARNING - Error during failed client setup cleanup: Server session was closed unexpectedly
2025-07-01 15:08:04,213 - __main__ - INFO - Attempting to initialize MCP client (attempt 3/3)
2025-07-01 15:08:04,213 - __main__ - WARNING - MCP client initialization attempt 3 failed: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 15:08:04,214 - __main__ - ERROR - Error during server startup in start_and_serve: Client is not connected. Use the 'async with client:' context manager first.
2025-07-01 15:08:04,214 - __main__ - INFO - Stopping server...
2025-07-01 15:08:04,214 - __main__ - WARNING - Error closing MCP client during server shutdown: This event loop is already running
2025-07-01 15:08:04,240 - __main__ - INFO - Stopping server...
2025-07-01 15:08:04,269 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-6' coro=<Client._session_runner() done, defined at E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py:310> exception=RuntimeError('Server session was closed unexpectedly')>
  + Exception Group Traceback (most recent call last):
  |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 63, in handle_exception
  |     raise matched
  | ExceptionGroup:  (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    |     await stack.enter_async_context(self._context_manager())
    |   File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    |     result = await _enter(cm)
    |              ^^^^^^^^^^^^^^^^
    |   File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    |     return await anext(self.gen)
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    |     result = handler(matched)
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    |     raise leaf
    |   File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    |     raise RuntimeError("Server session was closed unexpectedly")
    | RuntimeError: Server session was closed unexpectedly
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 313, in _session_runner
    await stack.enter_async_context(self._context_manager())
  File "C:\Python313\Lib\contextlib.py", line 668, in enter_async_context
    result = await _enter(cm)
             ^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\exceptiongroup\_catch.py", line 65, in handle_exception
    result = handler(matched)
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\utilities\exceptions.py", line 29, in _exception_handler
    raise leaf
  File "E:\INSIGHT DATA\data-chatbot\chatbot\chatbot\.venv\Lib\site-packages\fastmcp\client\client.py", line 252, in _context_manager
    raise RuntimeError("Server session was closed unexpectedly")
RuntimeError: Server session was closed unexpectedly
2025-07-01 15:12:37,325 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 15:12:39,694 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 15:12:39,695 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 15:12:39,695 - __main__ - INFO - Message processor task started.
2025-07-01 15:12:39,697 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 15:13:09,379 - socket_server - INFO - New client connected from ('127.0.0.1', 59198)
2025-07-01 15:13:09,380 - socket_server - INFO - Received request from ('127.0.0.1', 59198): chat
2025-07-01 15:13:09,385 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 15:13:09,387 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 15:13:09,388 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 15:13:09,388 - __main__ - INFO - Processing message for conversation 11
2025-07-01 15:13:09,389 - __main__ - INFO - New context established: rag:general
2025-07-01 15:13:09,400 - __main__ - ERROR - Error processing message for conversation 11: cannot access local variable 'resource_template_list_names' where it is not associated with a value
2025-07-01 15:13:09,400 - __main__ - INFO - Processing complete for 11. Status: error
2025-07-01 15:13:09,401 - socket_server - INFO - Received result for 11.
2025-07-01 15:13:09,401 - socket_server - INFO - Sent response to ('127.0.0.1', 59198): error
2025-07-01 15:14:39,377 - socket_server - INFO - Client ('127.0.0.1', 59198) closed connection
2025-07-01 15:14:39,377 - socket_server - INFO - Client ('127.0.0.1', 59198) disconnected
2025-07-01 15:16:33,607 - __main__ - INFO - Server tasks cancelled.
2025-07-01 15:16:33,630 - __main__ - INFO - Stopping server...
2025-07-01 15:16:33,630 - socket_server - INFO - Stopping server...
2025-07-01 15:16:33,631 - socket_server - INFO - Socket Server stopped
2025-07-01 15:16:33,631 - socket_server - INFO - Stopping server...
2025-07-01 15:16:33,632 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 15:16:33,632 - socket_server - INFO - Socket Server stopped
2025-07-01 15:16:37,453 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 15:16:40,475 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 15:16:40,476 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 15:16:40,476 - __main__ - INFO - Message processor task started.
2025-07-01 15:16:40,479 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 15:17:45,522 - socket_server - INFO - New client connected from ('127.0.0.1', 59386)
2025-07-01 15:17:45,523 - socket_server - INFO - Received request from ('127.0.0.1', 59386): chat
2025-07-01 15:17:45,523 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 15:17:45,523 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 15:17:45,524 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 15:17:45,524 - __main__ - INFO - Processing message for conversation 11
2025-07-01 15:17:45,524 - __main__ - INFO - New context established: rag:general
2025-07-01 15:17:45,529 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 15:17:45,717 - __main__ - INFO - User message: liệt kê db
2025-07-01 15:17:45,718 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 15:17:45,718 - __main__ - INFO - LLM iteration 1/10
2025-07-01 15:17:47,099 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-01 15:17:47,103 - __main__ - ERROR - Error processing message for conversation 11: Error code: 400 - {'error': {'code': 'Arrearage', 'param': None, 'message': 'Access denied, please make sure your account is in good standing.', 'type': 'Arrearage'}, 'id': 'chatcmpl-c43b46db-05f5-99cd-b9a6-fb1c22fa5764', 'request_id': 'c43b46db-05f5-99cd-b9a6-fb1c22fa5764'}
2025-07-01 15:17:47,104 - __main__ - INFO - Processing complete for 11. Status: error
2025-07-01 15:17:47,104 - socket_server - INFO - Received result for 11.
2025-07-01 15:17:47,104 - socket_server - INFO - Sent response to ('127.0.0.1', 59386): error
2025-07-01 15:19:15,523 - socket_server - INFO - Client ('127.0.0.1', 59386) closed connection
2025-07-01 15:19:15,523 - socket_server - INFO - Client ('127.0.0.1', 59386) disconnected
2025-07-01 15:19:18,961 - __main__ - INFO - Server tasks cancelled.
2025-07-01 15:19:18,967 - __main__ - INFO - Stopping server...
2025-07-01 15:19:18,968 - socket_server - INFO - Stopping server...
2025-07-01 15:19:18,968 - socket_server - INFO - Socket Server stopped
2025-07-01 15:19:18,968 - socket_server - INFO - Stopping server...
2025-07-01 15:19:18,968 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 15:19:18,969 - socket_server - INFO - Socket Server stopped
2025-07-01 15:19:21,727 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 15:19:24,715 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 15:19:24,716 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 15:19:24,717 - __main__ - INFO - Message processor task started.
2025-07-01 15:19:24,719 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 15:19:35,931 - socket_server - INFO - New client connected from ('127.0.0.1', 59479)
2025-07-01 15:19:35,932 - socket_server - INFO - Received request from ('127.0.0.1', 59479): chat
2025-07-01 15:19:35,932 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 15:19:35,933 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 15:19:35,933 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 15:19:35,934 - __main__ - INFO - Processing message for conversation 11
2025-07-01 15:19:35,934 - __main__ - INFO - New context established: rag:general
2025-07-01 15:19:35,945 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 15:19:36,485 - __main__ - INFO - User message: liẹt ke db
2025-07-01 15:19:36,485 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 15:19:36,485 - __main__ - INFO - LLM iteration 1/10
2025-07-01 15:19:38,022 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-01 15:19:38,025 - __main__ - ERROR - Error processing message for conversation 11: Error code: 400 - {'error': {'code': 'Arrearage', 'param': None, 'message': 'Access denied, please make sure your account is in good standing.', 'type': 'Arrearage'}, 'id': 'chatcmpl-8af5e10b-24e5-91e9-a5b1-e266ebd0f415', 'request_id': '8af5e10b-24e5-91e9-a5b1-e266ebd0f415'}
2025-07-01 15:19:38,026 - __main__ - INFO - Processing complete for 11. Status: error
2025-07-01 15:19:38,026 - socket_server - INFO - Received result for 11.
2025-07-01 15:19:38,027 - socket_server - INFO - Sent response to ('127.0.0.1', 59479): error
2025-07-01 15:21:04,513 - __main__ - INFO - Server tasks cancelled.
2025-07-01 15:21:04,527 - __main__ - INFO - Stopping server...
2025-07-01 15:21:04,529 - socket_server - INFO - Stopping server...
2025-07-01 15:21:04,529 - socket_server - INFO - Stopping server...
2025-07-01 15:21:04,529 - socket_server - INFO - Socket Server stopped
2025-07-01 15:21:04,529 - socket_server - INFO - Socket Server stopped
2025-07-01 15:21:04,530 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
2025-07-01 15:29:54,074 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-01 15:29:57,816 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-01 15:29:57,817 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-01 15:29:57,817 - __main__ - INFO - Message processor task started.
2025-07-01 15:29:57,821 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-01 15:30:03,744 - socket_server - INFO - New client connected from ('127.0.0.1', 60120)
2025-07-01 15:30:03,745 - socket_server - INFO - Received request from ('127.0.0.1', 60120): chat
2025-07-01 15:30:03,745 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-01 15:30:03,746 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-01 15:30:03,746 - __main__ - INFO - Dequeued message for conversation 11
2025-07-01 15:30:03,746 - __main__ - INFO - Processing message for conversation 11
2025-07-01 15:30:03,747 - __main__ - INFO - New context established: rag:general
2025-07-01 15:30:03,754 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-01 15:30:03,978 - __main__ - INFO - User message: hello
2025-07-01 15:30:03,979 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-01 15:30:03,979 - __main__ - INFO - LLM iteration 1/10
2025-07-01 15:30:05,345 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-01 15:30:05,348 - __main__ - ERROR - Error processing message for conversation 11: Error code: 400 - {'error': {'code': 'Arrearage', 'param': None, 'message': 'Access denied, please make sure your account is in good standing.', 'type': 'Arrearage'}, 'id': 'chatcmpl-a5949e41-2296-916c-b106-df877167b30b', 'request_id': 'a5949e41-2296-916c-b106-df877167b30b'}
2025-07-01 15:30:05,348 - __main__ - INFO - Processing complete for 11. Status: error
2025-07-01 15:30:05,349 - socket_server - INFO - Received result for 11.
2025-07-01 15:30:05,349 - socket_server - INFO - Sent response to ('127.0.0.1', 60120): error
2025-07-01 15:31:33,744 - socket_server - INFO - Client ('127.0.0.1', 60120) closed connection
2025-07-01 15:31:33,748 - socket_server - INFO - Client ('127.0.0.1', 60120) disconnected
2025-07-02 09:24:52,572 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-07-02 09:24:59,549 - __main__ - INFO - Tool ready after 1 attempt(s)
2025-07-02 09:24:59,550 - __main__ - INFO - SocketServer started in a separate thread.
2025-07-02 09:24:59,550 - __main__ - INFO - Message processor task started.
2025-07-02 09:24:59,552 - socket_server - INFO - Socket Server started on localhost:8888
2025-07-02 09:27:52,433 - socket_server - INFO - New client connected from ('127.0.0.1', 50955)
2025-07-02 09:27:52,434 - socket_server - INFO - Received request from ('127.0.0.1', 50955): chat
2025-07-02 09:27:52,435 - __main__ - INFO - Enqueuing message for conversation 11
2025-07-02 09:27:52,435 - __main__ - INFO - Dequeued message for conversation 11
2025-07-02 09:27:52,436 - socket_server - INFO - Waiting for async processing result for 11...
2025-07-02 09:27:52,436 - __main__ - INFO - Processing message for conversation 11
2025-07-02 09:27:52,437 - __main__ - INFO - New context established: rag:general
2025-07-02 09:27:52,446 - __main__ - INFO - Available tools: ['rag_query', 'rag_get_collection_info', 'sql_query_db', 'chart_create_chart', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-07-02 09:27:52,866 - __main__ - INFO - User message: hello
2025-07-02 09:27:52,867 - __main__ - INFO - System prompt: Bạn là một chatbot phân tích dữ liệu chuyên về business intelligence và diễn giải dữ liệu.

    QUAN TRỌNG NHẤT: Bạn BẮT BUỘC phải sử dụng các công cụ để trả lời các câu hỏi của người dùng về dữ liệu,...
2025-07-02 09:27:52,867 - __main__ - INFO - LLM iteration 1/10
2025-07-02 09:27:54,585 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-07-02 09:27:54,590 - __main__ - ERROR - Error processing message for conversation 11: Error code: 400 - {'error': {'code': 'Arrearage', 'param': None, 'message': 'Access denied, please make sure your account is in good standing.', 'type': 'Arrearage'}, 'id': 'chatcmpl-630f3985-45f6-9118-94e5-391684dd2cdd', 'request_id': '630f3985-45f6-9118-94e5-391684dd2cdd'}
2025-07-02 09:27:54,591 - __main__ - INFO - Processing complete for 11. Status: error
2025-07-02 09:27:54,591 - socket_server - INFO - Received result for 11.
2025-07-02 09:27:54,593 - socket_server - INFO - Sent response to ('127.0.0.1', 50955): error
2025-07-02 09:29:22,444 - socket_server - INFO - Client ('127.0.0.1', 50955) closed connection
2025-07-02 09:29:22,450 - socket_server - INFO - Client ('127.0.0.1', 50955) disconnected
2025-07-02 10:35:35,025 - __main__ - INFO - Server tasks cancelled.
2025-07-02 10:35:35,064 - __main__ - INFO - Stopping server...
2025-07-02 10:35:35,064 - socket_server - INFO - Stopping server...
2025-07-02 10:35:35,065 - socket_server - INFO - Stopping server...
2025-07-02 10:35:35,065 - socket_server - INFO - Socket Server stopped
2025-07-02 10:35:35,065 - socket_server - INFO - Socket Server stopped
2025-07-02 10:35:35,065 - __main__ - WARNING - Main event loop not available or closed for processor task cancellation.
