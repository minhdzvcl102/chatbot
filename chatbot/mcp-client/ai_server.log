2025-06-23 14:21:58,712 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:22:16,540 - __main__ - INFO - New client connected from ('127.0.0.1', 53397)
2025-06-23 14:22:16,541 - __main__ - INFO - Received request from ('127.0.0.1', 53397): chat
2025-06-23 14:22:16,542 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:22:16,542 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:22:22,178 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,504 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:22:27,505 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:22:27,506 - __main__ - INFO - Sent response to ('127.0.0.1', 53397): success
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) closed connection
2025-06-23 14:22:46,537 - __main__ - INFO - Client ('127.0.0.1', 53397) disconnected
2025-06-23 14:23:57,066 - __main__ - INFO - New client connected from ('127.0.0.1', 53434)
2025-06-23 14:23:57,067 - __main__ - INFO - Received request from ('127.0.0.1', 53434): chat
2025-06-23 14:23:57,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:23:57,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:24:02,106 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,348 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:24:04,349 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:24:04,350 - __main__ - INFO - Sent response to ('127.0.0.1', 53434): success
2025-06-23 14:24:27,067 - __main__ - INFO - Client ('127.0.0.1', 53434) closed connection
2025-06-23 14:24:27,068 - __main__ - INFO - Client ('127.0.0.1', 53434) disconnected
2025-06-23 14:35:44,091 - __main__ - INFO - New client connected from ('127.0.0.1', 53627)
2025-06-23 14:35:44,108 - __main__ - INFO - Received request from ('127.0.0.1', 53627): chat
2025-06-23 14:35:44,133 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:35:44,136 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:35:51,416 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,150 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:36:12,151 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:36:12,153 - __main__ - INFO - Sent response to ('127.0.0.1', 53627): success
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) closed connection
2025-06-23 14:36:14,038 - __main__ - INFO - Client ('127.0.0.1', 53627) disconnected
2025-06-23 14:52:19,674 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 14:52:31,065 - __main__ - INFO - New client connected from ('127.0.0.1', 53954)
2025-06-23 14:52:31,066 - __main__ - INFO - Received request from ('127.0.0.1', 53954): chat
2025-06-23 14:52:31,069 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:52:31,069 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:52:37,041 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,619 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:52:42,620 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:52:42,621 - __main__ - INFO - Sent response to ('127.0.0.1', 53954): success
2025-06-23 14:53:01,045 - __main__ - INFO - Client ('127.0.0.1', 53954) closed connection
2025-06-23 14:53:01,046 - __main__ - INFO - Client ('127.0.0.1', 53954) disconnected
2025-06-23 14:55:18,665 - __main__ - INFO - New client connected from ('127.0.0.1', 54018)
2025-06-23 14:55:18,665 - __main__ - INFO - Received request from ('127.0.0.1', 54018): chat
2025-06-23 14:55:18,666 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:18,667 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:23,301 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:31,925 - __main__ - INFO - New client connected from ('127.0.0.1', 54029)
2025-06-23 14:55:31,926 - __main__ - INFO - Received request from ('127.0.0.1', 54029): chat
2025-06-23 14:55:31,927 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:31,927 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:32,873 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:32,874 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:32,875 - __main__ - INFO - Sent response to ('127.0.0.1', 54018): success
2025-06-23 14:55:36,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:47,299 - __main__ - INFO - New client connected from ('127.0.0.1', 54040)
2025-06-23 14:55:47,300 - __main__ - INFO - Received request from ('127.0.0.1', 54040): chat
2025-06-23 14:55:47,301 - __main__ - INFO - Processing message for conversation 6
2025-06-23 14:55:47,301 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) closed connection
2025-06-23 14:55:48,673 - __main__ - INFO - Client ('127.0.0.1', 54018) disconnected
2025-06-23 14:55:58,999 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:55:59,000 - __main__ - INFO - Generated answer after tool call for conversation 6
2025-06-23 14:55:59,001 - __main__ - INFO - Sent response to ('127.0.0.1', 54029): success
2025-06-23 14:56:01,928 - __main__ - INFO - Client ('127.0.0.1', 54029) closed connection
2025-06-23 14:56:01,929 - __main__ - INFO - Client ('127.0.0.1', 54029) disconnected
2025-06-23 14:56:02,858 - __main__ - INFO - New client connected from ('127.0.0.1', 54052)
2025-06-23 14:56:02,858 - __main__ - INFO - Received request from ('127.0.0.1', 54052): chat
2025-06-23 14:56:02,859 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:56:02,859 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:56:02,863 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:02,877 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 14:56:07,268 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,872 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:10,873 - __main__ - INFO - Generated answer for conversation 6
2025-06-23 14:56:10,873 - __main__ - INFO - Sent response to ('127.0.0.1', 54040): success
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) closed connection
2025-06-23 14:56:17,306 - __main__ - INFO - Client ('127.0.0.1', 54040) disconnected
2025-06-23 14:56:20,437 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:56:20,438 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:56:20,439 - __main__ - INFO - Sent response to ('127.0.0.1', 54052): success
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) closed connection
2025-06-23 14:56:32,866 - __main__ - INFO - Client ('127.0.0.1', 54052) disconnected
2025-06-23 14:57:19,260 - __main__ - INFO - New client connected from ('127.0.0.1', 54121)
2025-06-23 14:57:19,261 - __main__ - INFO - Received request from ('127.0.0.1', 54121): chat
2025-06-23 14:57:19,262 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:57:19,262 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:57:24,110 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,411 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:57:37,412 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:57:37,413 - __main__ - INFO - Sent response to ('127.0.0.1', 54121): success
2025-06-23 14:57:49,265 - __main__ - INFO - Client ('127.0.0.1', 54121) closed connection
2025-06-23 14:57:49,266 - __main__ - INFO - Client ('127.0.0.1', 54121) disconnected
2025-06-23 14:59:27,754 - __main__ - INFO - New client connected from ('127.0.0.1', 54171)
2025-06-23 14:59:27,755 - __main__ - INFO - Received request from ('127.0.0.1', 54171): chat
2025-06-23 14:59:27,756 - __main__ - INFO - Processing message for conversation 7
2025-06-23 14:59:27,757 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 14:59:33,606 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,204 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 14:59:44,205 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 14:59:44,206 - __main__ - INFO - Sent response to ('127.0.0.1', 54171): success
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) closed connection
2025-06-23 14:59:57,751 - __main__ - INFO - Client ('127.0.0.1', 54171) disconnected
2025-06-23 15:00:18,958 - __main__ - INFO - New client connected from ('127.0.0.1', 54182)
2025-06-23 15:00:18,961 - __main__ - INFO - Received request from ('127.0.0.1', 54182): chat
2025-06-23 15:00:18,962 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:00:18,962 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:00:23,733 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,882 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:00:34,883 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:00:34,884 - __main__ - INFO - Sent response to ('127.0.0.1', 54182): success
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) closed connection
2025-06-23 15:00:48,958 - __main__ - INFO - Client ('127.0.0.1', 54182) disconnected
2025-06-23 15:01:53,236 - __main__ - INFO - New client connected from ('127.0.0.1', 54193)
2025-06-23 15:01:53,237 - __main__ - INFO - Received request from ('127.0.0.1', 54193): chat
2025-06-23 15:01:53,238 - __main__ - INFO - Processing message for conversation 7
2025-06-23 15:01:53,239 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 15:01:55,971 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-39' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,980 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-40' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,983 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-41' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:55,987 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-42' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    loop = asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-23 15:01:57,842 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,974 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 15:02:10,975 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 15:02:10,976 - __main__ - INFO - Sent response to ('127.0.0.1', 54193): success
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) closed connection
2025-06-23 15:02:23,249 - __main__ - INFO - Client ('127.0.0.1', 54193) disconnected
2025-06-23 16:18:05,129 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:19:32,380 - __main__ - INFO - New client connected from ('127.0.0.1', 55113)
2025-06-23 16:19:32,380 - __main__ - INFO - Received request from ('127.0.0.1', 55113): chat
2025-06-23 16:19:32,382 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:19:32,383 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:19:38,307 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,360 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:19:40,361 - __main__ - INFO - Sent response to ('127.0.0.1', 55113): error
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) closed connection
2025-06-23 16:20:02,390 - __main__ - INFO - Client ('127.0.0.1', 55113) disconnected
2025-06-23 16:21:50,133 - __main__ - INFO - New client connected from ('127.0.0.1', 55149)
2025-06-23 16:21:50,134 - __main__ - INFO - Received request from ('127.0.0.1', 55149): chat
2025-06-23 16:21:50,135 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:21:50,135 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:21:54,453 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:21:54,458 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:21:54,458 - __main__ - INFO - Sent response to ('127.0.0.1', 55149): error
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) closed connection
2025-06-23 16:22:20,139 - __main__ - INFO - Client ('127.0.0.1', 55149) disconnected
2025-06-23 16:27:04,088 - __main__ - INFO - New client connected from ('127.0.0.1', 55218)
2025-06-23 16:27:04,089 - __main__ - INFO - Received request from ('127.0.0.1', 55218): chat
2025-06-23 16:27:04,089 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:04,090 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:10,517 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:10,520 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:10,521 - __main__ - INFO - Sent response to ('127.0.0.1', 55218): error
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) reset connection
2025-06-23 16:27:28,476 - __main__ - INFO - Client ('127.0.0.1', 55218) disconnected
2025-06-23 16:27:38,357 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:38,358 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - Stopping server...
2025-06-23 16:27:38,358 - __main__ - INFO - AI Socket Server stopped
2025-06-23 16:27:43,655 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:27:47,047 - __main__ - INFO - New client connected from ('127.0.0.1', 55236)
2025-06-23 16:27:47,047 - __main__ - INFO - Received request from ('127.0.0.1', 55236): chat
2025-06-23 16:27:47,048 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:47,048 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:27:51,474 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:27:51,479 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:27:51,480 - __main__ - INFO - Sent response to ('127.0.0.1', 55236): error
2025-06-23 16:27:57,819 - __main__ - INFO - New client connected from ('127.0.0.1', 55258)
2025-06-23 16:27:57,819 - __main__ - INFO - Received request from ('127.0.0.1', 55258): chat
2025-06-23 16:27:57,820 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:27:57,821 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:28:01,811 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:28:01,814 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-23 16:28:01,815 - __main__ - INFO - Sent response to ('127.0.0.1', 55258): error
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) closed connection
2025-06-23 16:28:17,046 - __main__ - INFO - Client ('127.0.0.1', 55236) disconnected
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) closed connection
2025-06-23 16:28:27,818 - __main__ - INFO - Client ('127.0.0.1', 55258) disconnected
2025-06-23 16:29:47,965 - __main__ - INFO - New client connected from ('127.0.0.1', 55282)
2025-06-23 16:29:47,966 - __main__ - INFO - Received request from ('127.0.0.1', 55282): chat
2025-06-23 16:29:47,967 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:29:47,967 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-23 16:29:56,848 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,534 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-23 16:30:08,535 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-23 16:30:08,536 - __main__ - INFO - Sent response to ('127.0.0.1', 55282): success
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) closed connection
2025-06-23 16:30:17,968 - __main__ - INFO - Client ('127.0.0.1', 55282) disconnected
2025-06-23 16:48:03,525 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-23 16:48:31,914 - __main__ - INFO - New client connected from ('127.0.0.1', 55696)
2025-06-23 16:48:31,915 - __main__ - INFO - Received request from ('127.0.0.1', 55696): chat
2025-06-23 16:48:31,919 - __main__ - INFO - Processing message for conversation 7
2025-06-23 16:48:31,919 - __main__ - ERROR - Error processing message for conversation 7: 'NoneType' object has no attribute 'list_resources'
2025-06-23 16:48:31,920 - __main__ - INFO - Sent response to ('127.0.0.1', 55696): error
2025-06-23 16:49:01,916 - __main__ - INFO - Client ('127.0.0.1', 55696) closed connection
2025-06-23 16:49:01,917 - __main__ - INFO - Client ('127.0.0.1', 55696) disconnected
2025-06-24 17:02:30,694 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 17:03:51,582 - __main__ - INFO - New client connected from ('127.0.0.1', 58883)
2025-06-24 17:03:51,584 - __main__ - INFO - Received request from ('127.0.0.1', 58883): chat
2025-06-24 17:03:51,588 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:03:51,588 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:03:57,563 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,436 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:02,437 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:04:02,438 - __main__ - INFO - Sent response to ('127.0.0.1', 58883): success
2025-06-24 17:04:21,588 - __main__ - INFO - Client ('127.0.0.1', 58883) closed connection
2025-06-24 17:04:21,589 - __main__ - INFO - Client ('127.0.0.1', 58883) disconnected
2025-06-24 17:04:35,833 - __main__ - INFO - New client connected from ('127.0.0.1', 58895)
2025-06-24 17:04:35,833 - __main__ - INFO - Received request from ('127.0.0.1', 58895): chat
2025-06-24 17:04:35,834 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:04:35,835 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:04:40,058 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:04:40,062 - __main__ - ERROR - Tool call error: {
  "error": "'FunctionTool' object is not callable"
}
2025-06-24 17:04:40,063 - __main__ - INFO - Sent response to ('127.0.0.1', 58895): error
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) closed connection
2025-06-24 17:05:05,843 - __main__ - INFO - Client ('127.0.0.1', 58895) disconnected
2025-06-24 17:07:51,797 - __main__ - INFO - New client connected from ('127.0.0.1', 58951)
2025-06-24 17:07:51,801 - __main__ - INFO - Received request from ('127.0.0.1', 58951): chat
2025-06-24 17:07:51,812 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:07:51,813 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:07:59,254 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,592 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:08:15,593 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:08:15,594 - __main__ - INFO - Sent response to ('127.0.0.1', 58951): success
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) closed connection
2025-06-24 17:08:21,781 - __main__ - INFO - Client ('127.0.0.1', 58951) disconnected
2025-06-24 17:08:52,083 - __main__ - INFO - New client connected from ('127.0.0.1', 58968)
2025-06-24 17:08:52,083 - __main__ - INFO - Received request from ('127.0.0.1', 58968): chat
2025-06-24 17:08:52,084 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:08:52,084 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:08:56,953 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,125 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:09:05,126 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:09:05,127 - __main__ - INFO - Sent response to ('127.0.0.1', 58968): success
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) closed connection
2025-06-24 17:09:22,090 - __main__ - INFO - Client ('127.0.0.1', 58968) disconnected
2025-06-24 17:32:01,194 - __main__ - INFO - New client connected from ('127.0.0.1', 59416)
2025-06-24 17:32:01,212 - __main__ - INFO - Received request from ('127.0.0.1', 59416): chat
2025-06-24 17:32:01,227 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:32:01,229 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:32:06,212 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-21' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,298 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-22' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:06,304 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-23' coro=<AsyncClient.aclose() done, defined at C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py:1978> exception=RuntimeError('Event loop is closed')>
Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\mcp-client\main.py", line 257, in handle_client
    "tool_call_id": tool_call["id"]
                   ~~~~~~~~~~^^^^^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_client.py", line 1985, in aclose
    await self._transport.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpx\_transports\default.py", line 406, in aclose
    await self._pool.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 353, in aclose
    await self._close_connections(closing_connections)
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\streams\tls.py", line 216, in aclose
    await self.transport_stream.aclose()
  File "C:\laragon\www\chatbot\chatbot\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 827, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\84862\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 550, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-24 17:32:08,320 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,858 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:32:27,860 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:32:27,862 - __main__ - INFO - Sent response to ('127.0.0.1', 59416): success
2025-06-24 17:32:31,134 - __main__ - INFO - Client ('127.0.0.1', 59416) closed connection
2025-06-24 17:32:31,135 - __main__ - INFO - Client ('127.0.0.1', 59416) disconnected
2025-06-24 17:48:50,942 - __main__ - INFO - New client connected from ('127.0.0.1', 59632)
2025-06-24 17:48:50,961 - __main__ - INFO - Received request from ('127.0.0.1', 59632): chat
2025-06-24 17:48:50,979 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:48:50,981 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:48:58,569 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,015 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:17,019 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:17,020 - __main__ - INFO - Sent response to ('127.0.0.1', 59632): success
2025-06-24 17:49:20,867 - __main__ - INFO - Client ('127.0.0.1', 59632) closed connection
2025-06-24 17:49:20,868 - __main__ - INFO - Client ('127.0.0.1', 59632) disconnected
2025-06-24 17:49:36,492 - __main__ - INFO - New client connected from ('127.0.0.1', 59667)
2025-06-24 17:49:36,492 - __main__ - INFO - Received request from ('127.0.0.1', 59667): chat
2025-06-24 17:49:36,493 - __main__ - INFO - Processing message for conversation 7
2025-06-24 17:49:36,494 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 17:49:42,650 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,465 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 17:49:45,466 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 17:49:45,467 - __main__ - INFO - Sent response to ('127.0.0.1', 59667): success
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) closed connection
2025-06-24 17:50:06,505 - __main__ - INFO - Client ('127.0.0.1', 59667) disconnected
2025-06-24 18:12:40,183 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:23:15,801 - __main__ - INFO - New client connected from ('127.0.0.1', 50874)
2025-06-24 18:23:15,807 - __main__ - INFO - Received request from ('127.0.0.1', 50874): chat
2025-06-24 18:23:15,814 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:23:15,815 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:23:19,861 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:23:19,873 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:23:23,302 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:23:23,306 - __main__ - INFO - Executing tool call 1/1: rag_query_for_chart
2025-06-24 18:23:23,322 - __main__ - INFO - Tool rag_query_for_chart executed successfully
2025-06-24 18:23:23,323 - __main__ - ERROR - Tool call error: Expected where to have exactly one operator, got {'chart_suitable': True, 'suggested_chart_type': 'line_chart'} in query.
2025-06-24 18:23:23,324 - __main__ - INFO - Sent response to ('127.0.0.1', 50874): error
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) closed connection
2025-06-24 18:23:45,794 - __main__ - INFO - Client ('127.0.0.1', 50874) disconnected
2025-06-24 18:27:18,568 - __main__ - INFO - New client connected from ('127.0.0.1', 50980)
2025-06-24 18:27:18,569 - __main__ - INFO - Received request from ('127.0.0.1', 50980): chat
2025-06-24 18:27:18,570 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:27:18,570 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:27:21,697 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:27:21,703 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:27:22,316 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:27:22,317 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-0f97311b-268a-9e55-9a1f-9ef6b6f99f37', 'request_id': '0f97311b-268a-9e55-9a1f-9ef6b6f99f37'}
2025-06-24 18:27:22,318 - __main__ - INFO - Sent response to ('127.0.0.1', 50980): error
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) closed connection
2025-06-24 18:27:48,576 - __main__ - INFO - Client ('127.0.0.1', 50980) disconnected
2025-06-24 18:28:38,594 - __main__ - INFO - New client connected from ('127.0.0.1', 51014)
2025-06-24 18:28:38,594 - __main__ - INFO - Received request from ('127.0.0.1', 51014): chat
2025-06-24 18:28:38,595 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:28:38,595 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:28:41,276 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:28:41,281 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:28:41,959 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:28:41,959 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-6a2b416e-b393-9865-af78-c1197c2c40ae', 'request_id': '6a2b416e-b393-9865-af78-c1197c2c40ae'}
2025-06-24 18:28:41,960 - __main__ - INFO - Sent response to ('127.0.0.1', 51014): error
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) closed connection
2025-06-24 18:29:08,603 - __main__ - INFO - Client ('127.0.0.1', 51014) disconnected
2025-06-24 18:29:54,164 - __main__ - INFO - New client connected from ('127.0.0.1', 51100)
2025-06-24 18:29:54,165 - __main__ - INFO - Received request from ('127.0.0.1', 51100): chat
2025-06-24 18:29:54,166 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:29:54,166 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:29:57,040 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:29:57,046 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:29:57,803 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 400 Bad Request"
2025-06-24 18:29:57,804 - __main__ - ERROR - Error processing message for conversation 7: Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: An assistant message with "tool_calls" must be followed by tool messages responding to each "tool_call_id". The following tool_call_ids did not have response messages: message[3].role', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-9ebf87b0-ea87-9c78-8eee-de142363422c', 'request_id': '9ebf87b0-ea87-9c78-8eee-de142363422c'}
2025-06-24 18:29:57,805 - __main__ - INFO - Sent response to ('127.0.0.1', 51100): error
2025-06-24 18:30:22,452 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:22,453 - __main__ - INFO - Received keyboard interrupt, stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - Stopping server...
2025-06-24 18:30:22,453 - __main__ - INFO - AI Socket Server stopped
2025-06-24 18:30:28,423 - __main__ - INFO - AI Socket Server started on localhost:8888
2025-06-24 18:30:36,268 - __main__ - INFO - New client connected from ('127.0.0.1', 51126)
2025-06-24 18:30:36,268 - __main__ - INFO - Received request from ('127.0.0.1', 51126): chat
2025-06-24 18:30:36,269 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:30:36,269 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:30:38,817 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:30:38,821 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:30:41,462 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:30:41,464 - __main__ - INFO - Executing tool call 1/1: rag_query
2025-06-24 18:30:42,119 - __main__ - INFO - Tool rag_query executed successfully
2025-06-24 18:31:05,970 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:05,971 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:05,972 - __main__ - INFO - Sent response to ('127.0.0.1', 51126): success
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) closed connection
2025-06-24 18:31:06,270 - __main__ - INFO - Client ('127.0.0.1', 51126) disconnected
2025-06-24 18:31:38,187 - __main__ - INFO - New client connected from ('127.0.0.1', 51144)
2025-06-24 18:31:38,187 - __main__ - INFO - Received request from ('127.0.0.1', 51144): chat
2025-06-24 18:31:38,188 - __main__ - INFO - Processing message for conversation 7
2025-06-24 18:31:38,189 - __main__ - INFO - Attempting to initialize MCP client (attempt 1/3)
2025-06-24 18:31:40,794 - __main__ - INFO - MCP client initialized successfully
2025-06-24 18:31:40,799 - __main__ - INFO - Available tools: ['rag_query', 'rag_query_for_chart', 'rag_get_collection_info', 'sql_query_db', 'sql+db://sql/list_databases', 'sql+db://sql/schema/{db_name*}', 'sql+db://sql/list_tables/{db_name*}']
2025-06-24 18:31:42,291 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:42,292 - __main__ - INFO - Executing tool call 1/1: sql+db://sql/list_databases
2025-06-24 18:31:42,293 - __main__ - INFO - Executing tool: sql+db://sql/list_databases with args: {}
2025-06-24 18:31:42,400 - __main__ - INFO - Tool sql+db://sql/list_databases executed successfully
2025-06-24 18:31:51,545 - httpx - INFO - HTTP Request: POST https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-06-24 18:31:51,546 - __main__ - INFO - Generated answer after tool call for conversation 7
2025-06-24 18:31:51,546 - __main__ - INFO - Sent response to ('127.0.0.1', 51144): success
2025-06-24 18:32:08,187 - __main__ - INFO - Client ('127.0.0.1', 51144) closed connection
2025-06-24 18:32:08,188 - __main__ - INFO - Client ('127.0.0.1', 51144) disconnected
